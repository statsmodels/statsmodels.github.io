

<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="_static/javascripts/modernizr.js"></script>
  
  
  
    <title>Fitting models using R-style formulas &#8212; statsmodels</title>
  <link rel="icon" type="image/png" sizes="32x32" href="_static/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="_static/icons/favicon-16x16.png">
  <link rel="manifest" href="_static/icons/site.webmanifest">
  <link rel="mask-icon" href="_static/icons/safari-pinned-tab.svg" color="#919191">
  <meta name="msapplication-TileColor" content="#2b5797">
  <meta name="msapplication-config" content="_static/icons/browserconfig.xml">
  <link rel="stylesheet" href="_static/stylesheets/examples.css">
  <link rel="stylesheet" href="_static/stylesheets/deprecation.css">
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/material.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Pitfalls" href="pitfalls.html" />
    <link rel="prev" title="Import Paths and Structure" href="api-structure.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=indigo data-md-color-accent=blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#example_formulas" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="index.html" title="statsmodels"
           class="md-header-nav__button md-logo">
          
              <img src="_static/statsmodels-logo-v2-bw.svg" height="26"
                   alt="statsmodels logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">statsmodels 0.13.5</span>
          <span class="md-header-nav__topic"> Fitting models using R-style formulas </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/statsmodels/statsmodels" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    statsmodels
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../versions-v2.json",
        target_loc = "../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="user-guide.html" class="md-tabs__link">User Guide</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="index.html" title="statsmodels" class="md-nav__button md-logo">
      
        <img src="_static/statsmodels-logo-v2-bw.svg" alt=" logo" width="48" height="48">
      
    </a>
    <a href="index.html"
       title="statsmodels">statsmodels 0.13.5</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/statsmodels/statsmodels" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    statsmodels
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="install.html" class="md-nav__link">Installing statsmodels</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="gettingstarted.html" class="md-nav__link">Getting started</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="user-guide.html" class="md-nav__link">User Guide</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="user-guide.html#background" class="md-nav__link">Background</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="endog_exog.html" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">endog</span></code>, <code class="docutils literal notranslate"><span class="pre">exog</span></code>, what’s that?</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="api-structure.html" class="md-nav__link">Import Paths and Structure</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Fitting models using R-style formulas </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Fitting models using R-style formulas</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#example-formulas--page-root" class="md-nav__link">Fitting models using R-style formulas</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#loading-modules-and-functions" class="md-nav__link">Loading modules and functions</a>
        </li>
        <li class="md-nav__item"><a href="#ols-regression-using-formulas" class="md-nav__link">OLS regression using formulas</a>
        </li>
        <li class="md-nav__item"><a href="#categorical-variables" class="md-nav__link">Categorical variables</a>
        </li>
        <li class="md-nav__item"><a href="#operators" class="md-nav__link">Operators</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#removing-variables" class="md-nav__link">Removing variables</a>
        </li>
        <li class="md-nav__item"><a href="#multiplicative-interactions" class="md-nav__link">Multiplicative interactions</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#functions" class="md-nav__link">Functions</a>
        </li>
        <li class="md-nav__item"><a href="#namespaces" class="md-nav__link">Namespaces</a>
        </li>
        <li class="md-nav__item"><a href="#using-formulas-with-models-that-do-not-yet-support-them" class="md-nav__link">Using formulas with models that do not (yet) support them</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="_sources/example_formulas.rst.txt">Show Source</a> </li>

  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="pitfalls.html" class="md-nav__link">Pitfalls</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="user-guide.html#regression-and-linear-models" class="md-nav__link">Regression and Linear Models</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="user-guide.html#time-series-analysis" class="md-nav__link">Time Series Analysis</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="user-guide.html#other-models" class="md-nav__link">Other Models</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="user-guide.html#statistics-and-tools" class="md-nav__link">Statistics and Tools</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="user-guide.html#data-sets" class="md-nav__link">Data Sets</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="user-guide.html#sandbox" class="md-nav__link">Sandbox</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="examples/index.html" class="md-nav__link">Examples</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="api.html" class="md-nav__link">API Reference</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="about.html" class="md-nav__link">About statsmodels</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="dev/index.html" class="md-nav__link">Developer Page</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="release/index.html" class="md-nav__link">Release Notes</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#example-formulas--page-root" class="md-nav__link">Fitting models using R-style formulas</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#loading-modules-and-functions" class="md-nav__link">Loading modules and functions</a>
        </li>
        <li class="md-nav__item"><a href="#ols-regression-using-formulas" class="md-nav__link">OLS regression using formulas</a>
        </li>
        <li class="md-nav__item"><a href="#categorical-variables" class="md-nav__link">Categorical variables</a>
        </li>
        <li class="md-nav__item"><a href="#operators" class="md-nav__link">Operators</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#removing-variables" class="md-nav__link">Removing variables</a>
        </li>
        <li class="md-nav__item"><a href="#multiplicative-interactions" class="md-nav__link">Multiplicative interactions</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#functions" class="md-nav__link">Functions</a>
        </li>
        <li class="md-nav__item"><a href="#namespaces" class="md-nav__link">Namespaces</a>
        </li>
        <li class="md-nav__item"><a href="#using-formulas-with-models-that-do-not-yet-support-them" class="md-nav__link">Using formulas with models that do not (yet) support them</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="_sources/example_formulas.rst.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="fitting-models-using-r-style-formulas">
<span id="formula-examples"></span><h1 id="example-formulas--page-root">Fitting models using R-style formulas<a class="headerlink" href="#example-formulas--page-root" title="Permalink to this heading">¶</a></h1>
<p>Since version 0.5.0, <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> allows users to fit statistical
models using R-style formulas. Internally, <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> uses the
<a class="reference external" href="https://patsy.readthedocs.io/en/latest/">patsy</a> package to convert formulas and
data to the matrices that are used in model fitting. The formula
framework is quite powerful; this tutorial only scratches the surface. A
full description of the formula language can be found in the <code class="docutils literal notranslate"><span class="pre">patsy</span></code>
docs:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://patsy.readthedocs.io/en/latest/">Patsy formula language description</a></p></li>
</ul>
<section id="loading-modules-and-functions">
<h2 id="loading-modules-and-functions">Loading modules and functions<a class="headerlink" href="#loading-modules-and-functions" title="Permalink to this heading">¶</a></h2>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>

<span class="gp">In [2]: </span><span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>

<span class="gp">In [3]: </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="gp">In [4]: </span><span class="kn">import</span> <span class="nn">pandas</span>
</pre></div>
</div>
<p>Notice that we called <code class="docutils literal notranslate"><span class="pre">statsmodels.formula.api</span></code> in addition to the usual
<code class="docutils literal notranslate"><span class="pre">statsmodels.api</span></code>. In fact, <code class="docutils literal notranslate"><span class="pre">statsmodels.api</span></code> is used here only to load
the dataset. The <code class="docutils literal notranslate"><span class="pre">formula.api</span></code> hosts many of the same
functions found in <code class="docutils literal notranslate"><span class="pre">api</span></code> (e.g. OLS, GLM), but it also holds lower case
counterparts for most of these models. In general, lower case models
accept <code class="docutils literal notranslate"><span class="pre">formula</span></code> and <code class="docutils literal notranslate"><span class="pre">df</span></code> arguments, whereas upper case ones take
<code class="docutils literal notranslate"><span class="pre">endog</span></code> and <code class="docutils literal notranslate"><span class="pre">exog</span></code> design matrices. <code class="docutils literal notranslate"><span class="pre">formula</span></code> accepts a string
which describes the model in terms of a <code class="docutils literal notranslate"><span class="pre">patsy</span></code> formula. <code class="docutils literal notranslate"><span class="pre">df</span></code> takes
a <a class="reference external" href="https://pandas.pydata.org/">pandas</a> data frame.</p>
<p><code class="docutils literal notranslate"><span class="pre">dir(smf)</span></code> will print a list of available models.</p>
<p>Formula-compatible models have the following generic call signature:
<code class="docutils literal notranslate"><span class="pre">(formula,</span> <span class="pre">data,</span> <span class="pre">subset=None,</span> <span class="pre">*args,</span> <span class="pre">**kwargs)</span></code></p>
</section>
<section id="ols-regression-using-formulas">
<h2 id="ols-regression-using-formulas">OLS regression using formulas<a class="headerlink" href="#ols-regression-using-formulas" title="Permalink to this heading">¶</a></h2>
<p>To begin, we fit the linear model described on the <a class="reference external" href="gettingstarted.html">Getting
Started</a> page. Download the data, subset columns,
and list-wise delete to remove missing observations:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [5]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get_rdataset</span><span class="p">(</span><span class="s2">"Guerry"</span><span class="p">,</span> <span class="s2">"HistData"</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>

<span class="gp">In [6]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">'Lottery'</span><span class="p">,</span> <span class="s1">'Literacy'</span><span class="p">,</span> <span class="s1">'Wealth'</span><span class="p">,</span> <span class="s1">'Region'</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="gp">In [7]: </span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="gh">Out[7]: </span><span class="go"></span>
<span class="go">   Lottery  Literacy  Wealth Region</span>
<span class="go">0       41        37      73      E</span>
<span class="go">1       38        51      22      N</span>
<span class="go">2       66        13      61      C</span>
<span class="go">3       80        46      76      E</span>
<span class="go">4       79        69      83      E</span>
</pre></div>
</div>
<p>Fit the model:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [8]: </span><span class="n">mod</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s1">'Lottery ~ Literacy + Wealth + Region'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>

<span class="gp">In [9]: </span><span class="n">res</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="gp">In [10]: </span><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
<span class="go">                            OLS Regression Results                            </span>
<span class="go">==============================================================================</span>
<span class="go">Dep. Variable:                Lottery   R-squared:                       0.338</span>
<span class="go">Model:                            OLS   Adj. R-squared:                  0.287</span>
<span class="go">Method:                 Least Squares   F-statistic:                     6.636</span>
<span class="go">Date:                Wed, 02 Nov 2022   Prob (F-statistic):           1.07e-05</span>
<span class="go">Time:                        17:12:34   Log-Likelihood:                -375.30</span>
<span class="go">No. Observations:                  85   AIC:                             764.6</span>
<span class="go">Df Residuals:                      78   BIC:                             781.7</span>
<span class="go">Df Model:                           6                                         </span>
<span class="go">Covariance Type:            nonrobust                                         </span>
<span class="go">===============================================================================</span>
<span class="go">                  coef    std err          t      P&gt;|t|      [0.025      0.975]</span>
<span class="gt">-------------------------------------------------------------------------------</span>
<span class="n">Intercept</span>      <span class="mf">38.6517</span>      <span class="mf">9.456</span>      <span class="mf">4.087</span>      <span class="mf">0.000</span>      <span class="mf">19.826</span>      <span class="mf">57.478</span>
<span class="n">Region</span><span class="p">[</span><span class="n">T</span><span class="o">.</span><span class="n">E</span><span class="p">]</span>   <span class="o">-</span><span class="mf">15.4278</span>      <span class="mf">9.727</span>     <span class="o">-</span><span class="mf">1.586</span>      <span class="mf">0.117</span>     <span class="o">-</span><span class="mf">34.793</span>       <span class="mf">3.938</span>
<span class="n">Region</span><span class="p">[</span><span class="n">T</span><span class="o">.</span><span class="n">N</span><span class="p">]</span>   <span class="o">-</span><span class="mf">10.0170</span>      <span class="mf">9.260</span>     <span class="o">-</span><span class="mf">1.082</span>      <span class="mf">0.283</span>     <span class="o">-</span><span class="mf">28.453</span>       <span class="mf">8.419</span>
<span class="n">Region</span><span class="p">[</span><span class="n">T</span><span class="o">.</span><span class="n">S</span><span class="p">]</span>    <span class="o">-</span><span class="mf">4.5483</span>      <span class="mf">7.279</span>     <span class="o">-</span><span class="mf">0.625</span>      <span class="mf">0.534</span>     <span class="o">-</span><span class="mf">19.039</span>       <span class="mf">9.943</span>
<span class="n">Region</span><span class="p">[</span><span class="n">T</span><span class="o">.</span><span class="n">W</span><span class="p">]</span>   <span class="o">-</span><span class="mf">10.0913</span>      <span class="mf">7.196</span>     <span class="o">-</span><span class="mf">1.402</span>      <span class="mf">0.165</span>     <span class="o">-</span><span class="mf">24.418</span>       <span class="mf">4.235</span>
<span class="n">Literacy</span>       <span class="o">-</span><span class="mf">0.1858</span>      <span class="mf">0.210</span>     <span class="o">-</span><span class="mf">0.886</span>      <span class="mf">0.378</span>      <span class="o">-</span><span class="mf">0.603</span>       <span class="mf">0.232</span>
<span class="n">Wealth</span>          <span class="mf">0.4515</span>      <span class="mf">0.103</span>      <span class="mf">4.390</span>      <span class="mf">0.000</span>       <span class="mf">0.247</span>       <span class="mf">0.656</span>
<span class="o">==============================================================================</span>
<span class="ne">Omnibus</span>:                        3.049   Durbin-Watson:                   1.785
<span class="n">Prob</span><span class="p">(</span><span class="n">Omnibus</span><span class="p">):</span>                  <span class="mf">0.218</span>   <span class="n">Jarque</span><span class="o">-</span><span class="n">Bera</span> <span class="p">(</span><span class="n">JB</span><span class="p">):</span>                <span class="mf">2.694</span>
<span class="ne">Skew</span>:                          -0.340   Prob(JB):                        0.260
<span class="ne">Kurtosis</span>:                       2.454   Cond. No.                         371.
<span class="o">==============================================================================</span>

<span class="ne">Notes</span>:
<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">Standard</span> <span class="n">Errors</span> <span class="n">assume</span> <span class="n">that</span> <span class="n">the</span> <span class="n">covariance</span> <span class="n">matrix</span> <span class="n">of</span> <span class="n">the</span> <span class="n">errors</span> <span class="ow">is</span> <span class="n">correctly</span> <span class="n">specified</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="categorical-variables">
<h2 id="categorical-variables">Categorical variables<a class="headerlink" href="#categorical-variables" title="Permalink to this heading">¶</a></h2>
<p>Looking at the summary printed above, notice that <code class="docutils literal notranslate"><span class="pre">patsy</span></code> determined
that elements of <em>Region</em> were text strings, so it treated <em>Region</em> as a
categorical variable. <code class="docutils literal notranslate"><span class="pre">patsy</span></code>’s default is also to include an
intercept, so we automatically dropped one of the <em>Region</em> categories.</p>
<p>If <em>Region</em> had been an integer variable that we wanted to treat
explicitly as categorical, we could have done so by using the <code class="docutils literal notranslate"><span class="pre">C()</span></code>
operator:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [11]: </span><span class="n">res</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s1">'Lottery ~ Literacy + Wealth + C(Region)'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="gp">In [12]: </span><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
<span class="go">Intercept         38.651655</span>
<span class="go">C(Region)[T.E]   -15.427785</span>
<span class="go">C(Region)[T.N]   -10.016961</span>
<span class="go">C(Region)[T.S]    -4.548257</span>
<span class="go">C(Region)[T.W]   -10.091276</span>
<span class="go">Literacy          -0.185819</span>
<span class="go">Wealth             0.451475</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
<p>Examples more advanced features <code class="docutils literal notranslate"><span class="pre">patsy</span></code>’s categorical variables
function can be found here: <a class="reference external" href="contrasts.html">Patsy: Contrast Coding Systems for
categorical variables</a></p>
</section>
<section id="operators">
<h2 id="operators">Operators<a class="headerlink" href="#operators" title="Permalink to this heading">¶</a></h2>
<p>We have already seen that “~” separates the left-hand side of the model
from the right-hand side, and that “+” adds new columns to the design
matrix.</p>
<section id="removing-variables">
<h3 id="removing-variables">Removing variables<a class="headerlink" href="#removing-variables" title="Permalink to this heading">¶</a></h3>
<p>The “-” sign can be used to remove columns/variables. For instance, we
can remove the intercept from a model by:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [13]: </span><span class="n">res</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s1">'Lottery ~ Literacy + Wealth + C(Region) -1 '</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="gp">In [14]: </span><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
<span class="go">C(Region)[C]    38.651655</span>
<span class="go">C(Region)[E]    23.223870</span>
<span class="go">C(Region)[N]    28.634694</span>
<span class="go">C(Region)[S]    34.103399</span>
<span class="go">C(Region)[W]    28.560379</span>
<span class="go">Literacy        -0.185819</span>
<span class="go">Wealth           0.451475</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
</section>
<section id="multiplicative-interactions">
<h3 id="multiplicative-interactions">Multiplicative interactions<a class="headerlink" href="#multiplicative-interactions" title="Permalink to this heading">¶</a></h3>
<p>“:” adds a new column to the design matrix with the product of the other
two columns. “*” will also include the individual columns that were
multiplied together:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [15]: </span><span class="n">res1</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s1">'Lottery ~ Literacy : Wealth - 1'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="gp">In [16]: </span><span class="n">res2</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s1">'Lottery ~ Literacy * Wealth - 1'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="gp">In [17]: </span><span class="nb">print</span><span class="p">(</span><span class="n">res1</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
<span class="go">Literacy:Wealth    0.018176</span>
<span class="go">dtype: float64</span>

<span class="gp">In [18]: </span><span class="nb">print</span><span class="p">(</span><span class="n">res2</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
<span class="go">Literacy           0.427386</span>
<span class="go">Wealth             1.080987</span>
<span class="go">Literacy:Wealth   -0.013609</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
<p>Many other things are possible with operators. Please consult the <a class="reference external" href="https://patsy.readthedocs.io/en/latest/formulas.html">patsy
docs</a> to learn
more.</p>
</section>
</section>
<section id="functions">
<h2 id="functions">Functions<a class="headerlink" href="#functions" title="Permalink to this heading">¶</a></h2>
<p>You can apply vectorized functions to the variables in your model:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [19]: </span><span class="n">res</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s1">'Lottery ~ np.log(Literacy)'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="gp">In [20]: </span><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
<span class="go">Intercept           115.609119</span>
<span class="go">np.log(Literacy)    -20.393959</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
<p>Define a custom function:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [21]: </span><span class="k">def</span> <span class="nf">log_plus_1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0</span>
<span class="gp">   ....: </span>

<span class="gp">In [22]: </span><span class="n">res</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s1">'Lottery ~ log_plus_1(Literacy)'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="gp">In [23]: </span><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
<span class="go">Intercept               136.003079</span>
<span class="go">log_plus_1(Literacy)    -20.393959</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
</section>
<section id="namespaces">
<span id="patsy-namespaces"></span><h2 id="namespaces">Namespaces<a class="headerlink" href="#namespaces" title="Permalink to this heading">¶</a></h2>
<p>Notice that all of the above examples use the calling namespace to look for the functions to apply. The namespace used can be controlled via the <code class="docutils literal notranslate"><span class="pre">eval_env</span></code> keyword. For example, you may want to give a custom namespace using the <code class="xref py py-class docutils literal notranslate"><span class="pre">patsy:patsy.EvalEnvironment</span></code> or you may want to use a “clean” namespace, which we provide by passing <code class="docutils literal notranslate"><span class="pre">eval_func=-1</span></code>. The default is to use the caller’s namespace. This can have (un)expected consequences, if, for example, someone has a variable names <code class="docutils literal notranslate"><span class="pre">C</span></code> in the user namespace or in their data structure passed to <code class="docutils literal notranslate"><span class="pre">patsy</span></code>, and <code class="docutils literal notranslate"><span class="pre">C</span></code> is used in the formula to handle a categorical variable. See the <a class="reference external" href="https://patsy.readthedocs.io/en/latest/API-reference.html">Patsy API Reference</a> for more information.</p>
</section>
<section id="using-formulas-with-models-that-do-not-yet-support-them">
<h2 id="using-formulas-with-models-that-do-not-yet-support-them">Using formulas with models that do not (yet) support them<a class="headerlink" href="#using-formulas-with-models-that-do-not-yet-support-them" title="Permalink to this heading">¶</a></h2>
<p>Even if a given <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> function does not support formulas, you
can still use <code class="docutils literal notranslate"><span class="pre">patsy</span></code>’s formula language to produce design matrices.
Those matrices can then be fed to the fitting function as <code class="docutils literal notranslate"><span class="pre">endog</span></code> and
<code class="docutils literal notranslate"><span class="pre">exog</span></code> arguments.</p>
<p>To generate <code class="docutils literal notranslate"><span class="pre">numpy</span></code> arrays:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [24]: </span><span class="kn">import</span> <span class="nn">patsy</span>

<span class="gp">In [25]: </span><span class="n">f</span> <span class="o">=</span> <span class="s1">'Lottery ~ Literacy * Wealth'</span>

<span class="gp">In [26]: </span><span class="n">y</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="n">patsy</span><span class="o">.</span><span class="n">dmatrices</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">'matrix'</span><span class="p">)</span>

<span class="gp">In [27]: </span><span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="go">[[41.]</span>
<span class="go"> [38.]</span>
<span class="go"> [66.]</span>
<span class="go"> [80.]</span>
<span class="go"> [79.]]</span>

<span class="gp">In [28]: </span><span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="go">[[1.000e+00 3.700e+01 7.300e+01 2.701e+03]</span>
<span class="go"> [1.000e+00 5.100e+01 2.200e+01 1.122e+03]</span>
<span class="go"> [1.000e+00 1.300e+01 6.100e+01 7.930e+02]</span>
<span class="go"> [1.000e+00 4.600e+01 7.600e+01 3.496e+03]</span>
<span class="go"> [1.000e+00 6.900e+01 8.300e+01 5.727e+03]]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">y</span></code> and <code class="docutils literal notranslate"><span class="pre">X</span></code> would be instances of <code class="docutils literal notranslate"><span class="pre">patsy.DesignMatrix</span></code> which is a subclass of <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>.</p>
<p>To generate pandas data frames:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [29]: </span><span class="n">f</span> <span class="o">=</span> <span class="s1">'Lottery ~ Literacy * Wealth'</span>

<span class="gp">In [30]: </span><span class="n">y</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="n">patsy</span><span class="o">.</span><span class="n">dmatrices</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">'dataframe'</span><span class="p">)</span>

<span class="gp">In [31]: </span><span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="go">   Lottery</span>
<span class="go">0     41.0</span>
<span class="go">1     38.0</span>
<span class="go">2     66.0</span>
<span class="go">3     80.0</span>
<span class="go">4     79.0</span>

<span class="gp">In [32]: </span><span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="go">   Intercept  Literacy  Wealth  Literacy:Wealth</span>
<span class="go">0        1.0      37.0    73.0           2701.0</span>
<span class="go">1        1.0      51.0    22.0           1122.0</span>
<span class="go">2        1.0      13.0    61.0            793.0</span>
<span class="go">3        1.0      46.0    76.0           3496.0</span>
<span class="go">4        1.0      69.0    83.0           5727.0</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [33]: </span><span class="nb">print</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
<span class="go">                            OLS Regression Results                            </span>
<span class="go">==============================================================================</span>
<span class="go">Dep. Variable:                Lottery   R-squared:                       0.309</span>
<span class="go">Model:                            OLS   Adj. R-squared:                  0.283</span>
<span class="go">Method:                 Least Squares   F-statistic:                     12.06</span>
<span class="go">Date:                Wed, 02 Nov 2022   Prob (F-statistic):           1.32e-06</span>
<span class="go">Time:                        17:12:34   Log-Likelihood:                -377.13</span>
<span class="go">No. Observations:                  85   AIC:                             762.3</span>
<span class="go">Df Residuals:                      81   BIC:                             772.0</span>
<span class="go">Df Model:                           3                                         </span>
<span class="go">Covariance Type:            nonrobust                                         </span>
<span class="go">===================================================================================</span>
<span class="go">                      coef    std err          t      P&gt;|t|      [0.025      0.975]</span>
<span class="gt">-----------------------------------------------------------------------------------</span>
<span class="n">Intercept</span>          <span class="mf">38.6348</span>     <span class="mf">15.825</span>      <span class="mf">2.441</span>      <span class="mf">0.017</span>       <span class="mf">7.149</span>      <span class="mf">70.121</span>
<span class="n">Literacy</span>           <span class="o">-</span><span class="mf">0.3522</span>      <span class="mf">0.334</span>     <span class="o">-</span><span class="mf">1.056</span>      <span class="mf">0.294</span>      <span class="o">-</span><span class="mf">1.016</span>       <span class="mf">0.312</span>
<span class="n">Wealth</span>              <span class="mf">0.4364</span>      <span class="mf">0.283</span>      <span class="mf">1.544</span>      <span class="mf">0.126</span>      <span class="o">-</span><span class="mf">0.126</span>       <span class="mf">0.999</span>
<span class="ne">Literacy</span>:Wealth    -0.0005      0.006     -0.085      0.933      -0.013       0.012
<span class="o">==============================================================================</span>
<span class="ne">Omnibus</span>:                        4.447   Durbin-Watson:                   1.953
<span class="n">Prob</span><span class="p">(</span><span class="n">Omnibus</span><span class="p">):</span>                  <span class="mf">0.108</span>   <span class="n">Jarque</span><span class="o">-</span><span class="n">Bera</span> <span class="p">(</span><span class="n">JB</span><span class="p">):</span>                <span class="mf">3.228</span>
<span class="ne">Skew</span>:                          -0.332   Prob(JB):                        0.199
<span class="ne">Kurtosis</span>:                       2.314   Cond. No.                     1.40e+04
<span class="o">==============================================================================</span>

<span class="ne">Notes</span>:
<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">Standard</span> <span class="n">Errors</span> <span class="n">assume</span> <span class="n">that</span> <span class="n">the</span> <span class="n">covariance</span> <span class="n">matrix</span> <span class="n">of</span> <span class="n">the</span> <span class="n">errors</span> <span class="ow">is</span> <span class="n">correctly</span> <span class="n">specified</span><span class="o">.</span>
<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">The</span> <span class="n">condition</span> <span class="n">number</span> <span class="ow">is</span> <span class="n">large</span><span class="p">,</span> <span class="mf">1.4e+04</span><span class="o">.</span> <span class="n">This</span> <span class="n">might</span> <span class="n">indicate</span> <span class="n">that</span> <span class="n">there</span> <span class="n">are</span>
<span class="n">strong</span> <span class="n">multicollinearity</span> <span class="ow">or</span> <span class="n">other</span> <span class="n">numerical</span> <span class="n">problems</span><span class="o">.</span>
</pre></div>
</div>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="api-structure.html" title="Import Paths and Structure"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Import Paths and Structure </span>
              </div>
            </a>
          
          
            <a href="pitfalls.html" title="Pitfalls"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Pitfalls </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2009-2019, Josef Perktold, Skipper Seabold, Jonathan Taylor, statsmodels-developers.
              
          </div>
            Last updated on
              Nov 02, 2022.
            <br/>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>