

<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../../../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../../../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../../../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../../../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../../../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>Weighted Generalized Linear Models &#8212; statsmodels</title>
  <link rel="icon" type="image/png" sizes="32x32" href="../../../_static/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../../../_static/icons/favicon-16x16.png">
  <link rel="manifest" href="../../../_static/icons/site.webmanifest">
  <link rel="mask-icon" href="../../../_static/icons/safari-pinned-tab.svg" color="#919191">
  <meta name="msapplication-TileColor" content="#2b5797">
  <meta name="msapplication-config" content="../../../_static/icons/browserconfig.xml">
  <link rel="stylesheet" href="../../../_static/stylesheets/examples.css">
  <link rel="stylesheet" href="../../../_static/stylesheets/deprecation.css">
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/material.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Influence Measures for GLM Logit" href="influence_glm_logit.html" />
    <link rel="prev" title="Generalized Linear Models (Formula)" href="glm_formula.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=indigo data-md-color-accent=blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#examples/notebooks/generated/glm_weights" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../../index.html" title="statsmodels"
           class="md-header-nav__button md-logo">
          
              <img src="../../../_static/statsmodels-logo-v2-bw.svg" height="26"
                   alt="statsmodels logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">statsmodels 0.13.5</span>
          <span class="md-header-nav__topic"> Weighted Generalized Linear Models </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../../../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/statsmodels/statsmodels" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    statsmodels
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../../../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../../../../versions-v2.json",
        target_loc = "../../../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../../index.html" class="md-tabs__link">Examples</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../../index.html" title="statsmodels" class="md-nav__button md-logo">
      
        <img src="../../../_static/statsmodels-logo-v2-bw.svg" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../../../index.html"
       title="statsmodels">statsmodels 0.13.5</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/statsmodels/statsmodels" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    statsmodels
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../../../install.html" class="md-nav__link">Installing statsmodels</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../gettingstarted.html" class="md-nav__link">Getting started</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../user-guide.html" class="md-nav__link">User Guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html" class="md-nav__link">Examples</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="../../index.html#linear-regression-models" class="md-nav__link">Linear Regression Models</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#plotting" class="md-nav__link">Plotting</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#discrete-choice-models" class="md-nav__link">Discrete Choice Models</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#nonparametric-statistics" class="md-nav__link">Nonparametric Statistics</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#generalized-linear-models" class="md-nav__link">Generalized Linear Models</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="glm.html" class="md-nav__link">Generalized Linear Models</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="glm_formula.html" class="md-nav__link">Generalized Linear Models (Formula)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Weighted Generalized Linear Models </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Weighted Generalized Linear Models</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#examples-notebooks-generated-glm-weights--page-root" class="md-nav__link">Weighted Generalized Linear Models</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Weighted-GLM:-Poisson-response-data" class="md-nav__link">Weighted GLM: Poisson response data</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Load-data" class="md-nav__link">Load data</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Condensing-and-Aggregating-observations" class="md-nav__link">Condensing and Aggregating observations</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Dataset-with-unique-observations" class="md-nav__link">Dataset with unique observations</a>
        </li>
        <li class="md-nav__item"><a href="#Dataset-with-unique-explanatory-variables-(exog)" class="md-nav__link">Dataset with unique explanatory variables (exog)</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Analysis" class="md-nav__link">Analysis</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#original-data" class="md-nav__link">original data</a>
        </li>
        <li class="md-nav__item"><a href="#condensed-data-(unique-observations-with-frequencies)" class="md-nav__link">condensed data (unique observations with frequencies)</a>
        </li>
        <li class="md-nav__item"><a href="#condensed-using-var_weights-instead-of-freq_weights" class="md-nav__link">condensed using <code class="docutils literal notranslate"><span class="pre">var_weights</span></code> instead of <code class="docutils literal notranslate"><span class="pre">freq_weights</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#aggregated-or-averaged-data-(unique-values-of-explanatory-variables)" class="md-nav__link">aggregated or averaged data (unique values of explanatory variables)</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#using-exposure" class="md-nav__link">using <code class="docutils literal notranslate"><span class="pre">exposure</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#using-var_weights" class="md-nav__link">using var_weights</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Comparison" class="md-nav__link">Comparison</a>
        </li>
        <li class="md-nav__item"><a href="#Likelihood-Ratio-type-tests" class="md-nav__link">Likelihood Ratio type tests</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#original-observations-and-frequency-weights" class="md-nav__link">original observations and frequency weights</a>
        </li>
        <li class="md-nav__item"><a href="#aggregated-data:-exposure-and-var_weights" class="md-nav__link">aggregated data: <code class="docutils literal notranslate"><span class="pre">exposure</span></code> and <code class="docutils literal notranslate"><span class="pre">var_weights</span></code></a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Investigating-Pearson-chi-square-statistic" class="md-nav__link">Investigating Pearson chi-square statistic</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Remainder" class="md-nav__link">Remainder</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../../../_sources/examples/notebooks/generated/glm_weights.ipynb.txt">Show Source</a> </li>

  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="influence_glm_logit.html" class="md-nav__link">Influence Measures for GLM Logit</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="quasibinomial.html" class="md-nav__link">Quasi-binomial regression</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#robust-regression" class="md-nav__link">Robust Regression</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#generalized-estimating-equations" class="md-nav__link">Generalized Estimating Equations</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#statistics" class="md-nav__link">Statistics</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#time-series-analysis" class="md-nav__link">Time Series Analysis</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#state-space-models" class="md-nav__link">State space models</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#state-space-models-technical-notes" class="md-nav__link">State space models - Technical notes</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#forecasting" class="md-nav__link">Forecasting</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#multivariate-methods" class="md-nav__link">Multivariate Methods</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#user-notes" class="md-nav__link">User Notes</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../api.html" class="md-nav__link">API Reference</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../about.html" class="md-nav__link">About statsmodels</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../dev/index.html" class="md-nav__link">Developer Page</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../release/index.html" class="md-nav__link">Release Notes</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#examples-notebooks-generated-glm-weights--page-root" class="md-nav__link">Weighted Generalized Linear Models</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Weighted-GLM:-Poisson-response-data" class="md-nav__link">Weighted GLM: Poisson response data</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Load-data" class="md-nav__link">Load data</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Condensing-and-Aggregating-observations" class="md-nav__link">Condensing and Aggregating observations</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Dataset-with-unique-observations" class="md-nav__link">Dataset with unique observations</a>
        </li>
        <li class="md-nav__item"><a href="#Dataset-with-unique-explanatory-variables-(exog)" class="md-nav__link">Dataset with unique explanatory variables (exog)</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Analysis" class="md-nav__link">Analysis</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#original-data" class="md-nav__link">original data</a>
        </li>
        <li class="md-nav__item"><a href="#condensed-data-(unique-observations-with-frequencies)" class="md-nav__link">condensed data (unique observations with frequencies)</a>
        </li>
        <li class="md-nav__item"><a href="#condensed-using-var_weights-instead-of-freq_weights" class="md-nav__link">condensed using <code class="docutils literal notranslate"><span class="pre">var_weights</span></code> instead of <code class="docutils literal notranslate"><span class="pre">freq_weights</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#aggregated-or-averaged-data-(unique-values-of-explanatory-variables)" class="md-nav__link">aggregated or averaged data (unique values of explanatory variables)</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#using-exposure" class="md-nav__link">using <code class="docutils literal notranslate"><span class="pre">exposure</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#using-var_weights" class="md-nav__link">using var_weights</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Comparison" class="md-nav__link">Comparison</a>
        </li>
        <li class="md-nav__item"><a href="#Likelihood-Ratio-type-tests" class="md-nav__link">Likelihood Ratio type tests</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#original-observations-and-frequency-weights" class="md-nav__link">original observations and frequency weights</a>
        </li>
        <li class="md-nav__item"><a href="#aggregated-data:-exposure-and-var_weights" class="md-nav__link">aggregated data: <code class="docutils literal notranslate"><span class="pre">exposure</span></code> and <code class="docutils literal notranslate"><span class="pre">var_weights</span></code></a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Investigating-Pearson-chi-square-statistic" class="md-nav__link">Investigating Pearson chi-square statistic</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Remainder" class="md-nav__link">Remainder</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../../../_sources/examples/notebooks/generated/glm_weights.ipynb.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Weighted-Generalized-Linear-Models">
<h1 id="examples-notebooks-generated-glm-weights--page-root">Weighted Generalized Linear Models<a class="headerlink" href="#examples-notebooks-generated-glm-weights--page-root" title="Permalink to this heading">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
</pre></div>
</div>
</div>
<section id="Weighted-GLM:-Poisson-response-data">
<h2 id="Weighted-GLM:-Poisson-response-data">Weighted GLM: Poisson response data<a class="headerlink" href="#Weighted-GLM:-Poisson-response-data" title="Permalink to this heading">¶</a></h2>
<section id="Load-data">
<h3 id="Load-data">Load data<a class="headerlink" href="#Load-data" title="Permalink to this heading">¶</a></h3>
<p>In this example, we’ll use the affair dataset using a handful of exogenous variables to predict the extra-marital affair rate.</p>
<p>Weights will be generated to show that <code class="docutils literal notranslate"><span class="pre">freq_weights</span></code> are equivalent to repeating records of data. On the other hand, <code class="docutils literal notranslate"><span class="pre">var_weights</span></code> is equivalent to aggregating data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">fair</span><span class="o">.</span><span class="n">NOTE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
::

    Number of observations: 6366
    Number of variables: 9
    Variable name definitions:

        rate_marriage   : How rate marriage, 1 = very poor, 2 = poor, 3 = fair,
                        4 = good, 5 = very good
        age             : Age
        yrs_married     : No. years married. Interval approximations. See
                        original paper for detailed explanation.
        children        : No. children
        religious       : How relgious, 1 = not, 2 = mildly, 3 = fairly,
                        4 = strongly
        educ            : Level of education, 9 = grade school, 12 = high
                        school, 14 = some college, 16 = college graduate,
                        17 = some graduate school, 20 = advanced degree
        occupation      : 1 = student, 2 = farming, agriculture; semi-skilled,
                        or unskilled worker; 3 = white-colloar; 4 = teacher
                        counselor social worker, nurse; artist, writers;
                        technician, skilled worker, 5 = managerial,
                        administrative, business, 6 = professional with
                        advanced degree
        occupation_husb : Husband's occupation. Same as occupation.
        affairs         : measure of time spent in extramarital affairs

    See the original paper for more details.

</pre></div></div>
</div>
<p>Load the data into a pandas dataframe.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">fair</span><span class="o">.</span><span class="n">load_pandas</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<p>The dependent (endogenous) variable is <code class="docutils literal notranslate"><span class="pre">affairs</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>rate_marriage</th>
<th>age</th>
<th>yrs_married</th>
<th>children</th>
<th>religious</th>
<th>educ</th>
<th>occupation</th>
<th>occupation_husb</th>
<th>affairs</th>
</tr>
</thead>
<tbody>
<tr>
<th>count</th>
<td>6366.000000</td>
<td>6366.000000</td>
<td>6366.000000</td>
<td>6366.000000</td>
<td>6366.000000</td>
<td>6366.000000</td>
<td>6366.000000</td>
<td>6366.000000</td>
<td>6366.000000</td>
</tr>
<tr>
<th>mean</th>
<td>4.109645</td>
<td>29.082862</td>
<td>9.009425</td>
<td>1.396874</td>
<td>2.426170</td>
<td>14.209865</td>
<td>3.424128</td>
<td>3.850141</td>
<td>0.705374</td>
</tr>
<tr>
<th>std</th>
<td>0.961430</td>
<td>6.847882</td>
<td>7.280120</td>
<td>1.433471</td>
<td>0.878369</td>
<td>2.178003</td>
<td>0.942399</td>
<td>1.346435</td>
<td>2.203374</td>
</tr>
<tr>
<th>min</th>
<td>1.000000</td>
<td>17.500000</td>
<td>0.500000</td>
<td>0.000000</td>
<td>1.000000</td>
<td>9.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>0.000000</td>
</tr>
<tr>
<th>25%</th>
<td>4.000000</td>
<td>22.000000</td>
<td>2.500000</td>
<td>0.000000</td>
<td>2.000000</td>
<td>12.000000</td>
<td>3.000000</td>
<td>3.000000</td>
<td>0.000000</td>
</tr>
<tr>
<th>50%</th>
<td>4.000000</td>
<td>27.000000</td>
<td>6.000000</td>
<td>1.000000</td>
<td>2.000000</td>
<td>14.000000</td>
<td>3.000000</td>
<td>4.000000</td>
<td>0.000000</td>
</tr>
<tr>
<th>75%</th>
<td>5.000000</td>
<td>32.000000</td>
<td>16.500000</td>
<td>2.000000</td>
<td>3.000000</td>
<td>16.000000</td>
<td>4.000000</td>
<td>5.000000</td>
<td>0.484848</td>
</tr>
<tr>
<th>max</th>
<td>5.000000</td>
<td>42.000000</td>
<td>23.000000</td>
<td>5.500000</td>
<td>4.000000</td>
<td>20.000000</td>
<td>6.000000</td>
<td>6.000000</td>
<td>57.599991</td>
</tr>
</tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>rate_marriage</th>
<th>age</th>
<th>yrs_married</th>
<th>children</th>
<th>religious</th>
<th>educ</th>
<th>occupation</th>
<th>occupation_husb</th>
<th>affairs</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>3.0</td>
<td>32.0</td>
<td>9.0</td>
<td>3.0</td>
<td>3.0</td>
<td>17.0</td>
<td>2.0</td>
<td>5.0</td>
<td>0.111111</td>
</tr>
<tr>
<th>1</th>
<td>3.0</td>
<td>27.0</td>
<td>13.0</td>
<td>3.0</td>
<td>1.0</td>
<td>14.0</td>
<td>3.0</td>
<td>4.0</td>
<td>3.230769</td>
</tr>
<tr>
<th>2</th>
<td>4.0</td>
<td>22.0</td>
<td>2.5</td>
<td>0.0</td>
<td>1.0</td>
<td>16.0</td>
<td>3.0</td>
<td>5.0</td>
<td>1.400000</td>
</tr>
</tbody>
</table>
</div></div>
</div>
<p>In the following we will work mostly with Poisson. While using decimal affairs works, we convert them to integers to have a count distribution.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s2">"affairs"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"affairs"</span><span class="p">])</span>
<span class="n">data</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>rate_marriage</th>
<th>age</th>
<th>yrs_married</th>
<th>children</th>
<th>religious</th>
<th>educ</th>
<th>occupation</th>
<th>occupation_husb</th>
<th>affairs</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>3.0</td>
<td>32.0</td>
<td>9.0</td>
<td>3.0</td>
<td>3.0</td>
<td>17.0</td>
<td>2.0</td>
<td>5.0</td>
<td>1.0</td>
</tr>
<tr>
<th>1</th>
<td>3.0</td>
<td>27.0</td>
<td>13.0</td>
<td>3.0</td>
<td>1.0</td>
<td>14.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
</tr>
<tr>
<th>2</th>
<td>4.0</td>
<td>22.0</td>
<td>2.5</td>
<td>0.0</td>
<td>1.0</td>
<td>16.0</td>
<td>3.0</td>
<td>5.0</td>
<td>2.0</td>
</tr>
</tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"affairs"</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.6775054979579014
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"affairs"</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([4313,  934,  488,  180,  130,  172,    7,   21,   67,    2,    0,
          0,   17,    0,    0,    0,    3,   12,    8,    0,    0,    0,
          0,    0,    2,    2,    2,    3,    0,    0,    0,    0,    0,
          0,    0,    0,    0,    0,    0,    1,    1,    0,    0,    0,
          0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,
          0,    0,    0,    1])
</pre></div></div>
</div>
</section>
</section>
<section id="Condensing-and-Aggregating-observations">
<h2 id="Condensing-and-Aggregating-observations">Condensing and Aggregating observations<a class="headerlink" href="#Condensing-and-Aggregating-observations" title="Permalink to this heading">¶</a></h2>
<p>We have 6366 observations in our original dataset. When we consider only some selected variables, then we have fewer unique observations. In the following we combine observations in two ways, first we combine observations that have values for all variables identical, and secondly we combine observations that have the same explanatory variables.</p>
<section id="Dataset-with-unique-observations">
<h3 id="Dataset-with-unique-observations">Dataset with unique observations<a class="headerlink" href="#Dataset-with-unique-observations" title="Permalink to this heading">¶</a></h3>
<p>We use pandas’s groupby to combine identical observations and create a new variable <code class="docutils literal notranslate"><span class="pre">freq</span></code> that count how many observation have the values in the corresponding row.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data2</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">data2</span><span class="p">[</span><span class="s2">"const"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">dc</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">data2</span><span class="p">[</span><span class="s2">"affairs rate_marriage age yrs_married const"</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">"affairs rate_marriage age yrs_married"</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
    <span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">dc</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dc</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"const"</span><span class="p">:</span> <span class="s2">"freq"</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dc</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">dc</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(476, 5)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>affairs</th>
<th>rate_marriage</th>
<th>age</th>
<th>yrs_married</th>
<th>freq</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>0.0</td>
<td>1.0</td>
<td>17.5</td>
<td>0.5</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>0.0</td>
<td>1.0</td>
<td>22.0</td>
<td>2.5</td>
<td>3</td>
</tr>
<tr>
<th>2</th>
<td>0.0</td>
<td>1.0</td>
<td>27.0</td>
<td>2.5</td>
<td>1</td>
</tr>
<tr>
<th>3</th>
<td>0.0</td>
<td>1.0</td>
<td>27.0</td>
<td>6.0</td>
<td>5</td>
</tr>
<tr>
<th>4</th>
<td>0.0</td>
<td>1.0</td>
<td>27.0</td>
<td>9.0</td>
<td>1</td>
</tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="Dataset-with-unique-explanatory-variables-(exog)">
<h3 id="Dataset-with-unique-explanatory-variables-(exog)">Dataset with unique explanatory variables (exog)<a class="headerlink" href="#Dataset-with-unique-explanatory-variables-(exog)" title="Permalink to this heading">¶</a></h3>
<p>For the next dataset we combine observations that have the same values of the explanatory variables. However, because the response variable can differ among combined observations, we compute the mean and the sum of the response variable for all combined observations.</p>
<p>We use again pandas <code class="docutils literal notranslate"><span class="pre">groupby</span></code> to combine observations and to create the new variables. We also flatten the <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> into a simple index.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">"affairs rate_marriage age yrs_married"</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
    <span class="s2">"rate_marriage age yrs_married"</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">df_a</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s2">"mean"</span><span class="p">,</span> <span class="s2">"sum"</span><span class="p">,</span> <span class="s2">"count"</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">merge_tuple</span><span class="p">(</span><span class="n">tpl</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tpl</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tpl</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">"_"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">tpl</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tpl</span>


<span class="n">df_a</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df_a</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">merge_tuple</span><span class="p">)</span>
<span class="n">df_a</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_a</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">df_a</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(130, 6)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>rate_marriage</th>
<th>age</th>
<th>yrs_married</th>
<th>affairs_mean</th>
<th>affairs_sum</th>
<th>affairs_count</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>1.0</td>
<td>17.5</td>
<td>0.5</td>
<td>0.000000</td>
<td>0.0</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>1.0</td>
<td>22.0</td>
<td>2.5</td>
<td>3.900000</td>
<td>39.0</td>
<td>10</td>
</tr>
<tr>
<th>2</th>
<td>1.0</td>
<td>27.0</td>
<td>2.5</td>
<td>3.400000</td>
<td>17.0</td>
<td>5</td>
</tr>
<tr>
<th>3</th>
<td>1.0</td>
<td>27.0</td>
<td>6.0</td>
<td>0.900000</td>
<td>9.0</td>
<td>10</td>
</tr>
<tr>
<th>4</th>
<td>1.0</td>
<td>27.0</td>
<td>9.0</td>
<td>1.333333</td>
<td>4.0</td>
<td>3</td>
</tr>
</tbody>
</table>
</div></div>
</div>
<p>After combining observations with have a dataframe <code class="docutils literal notranslate"><span class="pre">dc</span></code> with 467 unique observations, and a dataframe <code class="docutils literal notranslate"><span class="pre">df_a</span></code> with 130 observations with unique values of the explanatory variables.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"number of rows: </span><span class="se">\n</span><span class="s2">original, with unique observations, with unique exog"</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">df_a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
number of rows:
original, with unique observations, with unique exog
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(6366, 476, 130)
</pre></div></div>
</div>
</section>
</section>
<section id="Analysis">
<h2 id="Analysis">Analysis<a class="headerlink" href="#Analysis" title="Permalink to this heading">¶</a></h2>
<p>In the following, we compare the GLM-Poisson results of the original data with models of the combined observations where the multiplicity or aggregation is given by weights or exposure.</p>
<section id="original-data">
<h3 id="original-data">original data<a class="headerlink" href="#original-data" title="Permalink to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">glm</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">glm</span><span class="p">(</span>
    <span class="s2">"affairs ~ rate_marriage + age + yrs_married"</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
    <span class="n">family</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">Poisson</span><span class="p">(),</span>
<span class="p">)</span>
<span class="n">res_o</span> <span class="o">=</span> <span class="n">glm</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res_o</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                 Generalized Linear Model Regression Results
==============================================================================
Dep. Variable:                affairs   No. Observations:                 6366
Model:                            GLM   Df Residuals:                     6362
Model Family:                 Poisson   Df Model:                            3
Link Function:                    Log   Scale:                          1.0000
Method:                          IRLS   Log-Likelihood:                -10351.
Date:                Wed, 02 Nov 2022   Deviance:                       15375.
Time:                        17:04:57   Pearson chi2:                 3.23e+04
No. Iterations:                     6   Pseudo R-squ. (CS):             0.2420
Covariance Type:            nonrobust
=================================================================================
                    coef    std err          z      P&gt;|z|      [0.025      0.975]
---------------------------------------------------------------------------------
Intercept         2.7155      0.107     25.294      0.000       2.505       2.926
rate_marriage    -0.4952      0.012    -41.702      0.000      -0.518      -0.472
age              -0.0299      0.004     -6.691      0.000      -0.039      -0.021
yrs_married      -0.0108      0.004     -2.507      0.012      -0.019      -0.002
=================================================================================
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_o</span><span class="o">.</span><span class="n">pearson_chi2</span> <span class="o">/</span> <span class="n">res_o</span><span class="o">.</span><span class="n">df_resid</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
5.078702313363233
</pre></div></div>
</div>
</section>
<section id="condensed-data-(unique-observations-with-frequencies)">
<h3 id="condensed-data-(unique-observations-with-frequencies)">condensed data (unique observations with frequencies)<a class="headerlink" href="#condensed-data-(unique-observations-with-frequencies)" title="Permalink to this heading">¶</a></h3>
<p>Combining identical observations and using frequency weights to take into account the multiplicity of observations produces exactly the same results. Some results attribute will differ when we want to have information about the observation and not about the aggregate of all identical observations. For example, residuals do not take <code class="docutils literal notranslate"><span class="pre">freq_weights</span></code> into account.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">glm</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">glm</span><span class="p">(</span>
    <span class="s2">"affairs ~ rate_marriage + age + yrs_married"</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">dc</span><span class="p">,</span>
    <span class="n">family</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">Poisson</span><span class="p">(),</span>
    <span class="n">freq_weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dc</span><span class="p">[</span><span class="s2">"freq"</span><span class="p">]),</span>
<span class="p">)</span>
<span class="n">res_f</span> <span class="o">=</span> <span class="n">glm</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res_f</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                 Generalized Linear Model Regression Results
==============================================================================
Dep. Variable:                affairs   No. Observations:                  476
Model:                            GLM   Df Residuals:                     6362
Model Family:                 Poisson   Df Model:                            3
Link Function:                    Log   Scale:                          1.0000
Method:                          IRLS   Log-Likelihood:                -10351.
Date:                Wed, 02 Nov 2022   Deviance:                       15375.
Time:                        17:04:57   Pearson chi2:                 3.23e+04
No. Iterations:                     6   Pseudo R-squ. (CS):             0.9754
Covariance Type:            nonrobust
=================================================================================
                    coef    std err          z      P&gt;|z|      [0.025      0.975]
---------------------------------------------------------------------------------
Intercept         2.7155      0.107     25.294      0.000       2.505       2.926
rate_marriage    -0.4952      0.012    -41.702      0.000      -0.518      -0.472
age              -0.0299      0.004     -6.691      0.000      -0.039      -0.021
yrs_married      -0.0108      0.004     -2.507      0.012      -0.019      -0.002
=================================================================================
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_f</span><span class="o">.</span><span class="n">pearson_chi2</span> <span class="o">/</span> <span class="n">res_f</span><span class="o">.</span><span class="n">df_resid</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
5.0787023133632
</pre></div></div>
</div>
</section>
<section id="condensed-using-var_weights-instead-of-freq_weights">
<h3 id="condensed-using-var_weights-instead-of-freq_weights">condensed using <code class="docutils literal notranslate"><span class="pre">var_weights</span></code> instead of <code class="docutils literal notranslate"><span class="pre">freq_weights</span></code><a class="headerlink" href="#condensed-using-var_weights-instead-of-freq_weights" title="Permalink to this heading">¶</a></h3>
<p>Next, we compare <code class="docutils literal notranslate"><span class="pre">var_weights</span></code> to <code class="docutils literal notranslate"><span class="pre">freq_weights</span></code>. It is a common practice to incorporate <code class="docutils literal notranslate"><span class="pre">var_weights</span></code> when the endogenous variable reflects averages and not identical observations. I do not see a theoretical reason why it produces the same results (in general).</p>
<p>This produces the same results but <code class="docutils literal notranslate"><span class="pre">df_resid</span></code> differs the <code class="docutils literal notranslate"><span class="pre">freq_weights</span></code> example because <code class="docutils literal notranslate"><span class="pre">var_weights</span></code> do not change the number of effective observations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">glm</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">glm</span><span class="p">(</span>
    <span class="s2">"affairs ~ rate_marriage + age + yrs_married"</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">dc</span><span class="p">,</span>
    <span class="n">family</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">Poisson</span><span class="p">(),</span>
    <span class="n">var_weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dc</span><span class="p">[</span><span class="s2">"freq"</span><span class="p">]),</span>
<span class="p">)</span>
<span class="n">res_fv</span> <span class="o">=</span> <span class="n">glm</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res_fv</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                 Generalized Linear Model Regression Results
==============================================================================
Dep. Variable:                affairs   No. Observations:                  476
Model:                            GLM   Df Residuals:                      472
Model Family:                 Poisson   Df Model:                            3
Link Function:                    Log   Scale:                          1.0000
Method:                          IRLS   Log-Likelihood:                -10351.
Date:                Wed, 02 Nov 2022   Deviance:                       15375.
Time:                        17:04:57   Pearson chi2:                 3.23e+04
No. Iterations:                     6   Pseudo R-squ. (CS):             0.9754
Covariance Type:            nonrobust
=================================================================================
                    coef    std err          z      P&gt;|z|      [0.025      0.975]
---------------------------------------------------------------------------------
Intercept         2.7155      0.107     25.294      0.000       2.505       2.926
rate_marriage    -0.4952      0.012    -41.702      0.000      -0.518      -0.472
age              -0.0299      0.004     -6.691      0.000      -0.039      -0.021
yrs_married      -0.0108      0.004     -2.507      0.012      -0.019      -0.002
=================================================================================
</pre></div></div>
</div>
<p>Dispersion computed from the results is incorrect because of wrong <code class="docutils literal notranslate"><span class="pre">df_resid</span></code>. It is correct if we use the original <code class="docutils literal notranslate"><span class="pre">df_resid</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_fv</span><span class="o">.</span><span class="n">pearson_chi2</span> <span class="o">/</span> <span class="n">res_fv</span><span class="o">.</span><span class="n">df_resid</span><span class="p">,</span> <span class="n">res_f</span><span class="o">.</span><span class="n">pearson_chi2</span> <span class="o">/</span> <span class="n">res_f</span><span class="o">.</span><span class="n">df_resid</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(68.45488160512008, 5.0787023133632)
</pre></div></div>
</div>
</section>
<section id="aggregated-or-averaged-data-(unique-values-of-explanatory-variables)">
<h3 id="aggregated-or-averaged-data-(unique-values-of-explanatory-variables)">aggregated or averaged data (unique values of explanatory variables)<a class="headerlink" href="#aggregated-or-averaged-data-(unique-values-of-explanatory-variables)" title="Permalink to this heading">¶</a></h3>
<p>For these cases we combine observations that have the same values of the explanatory variables. The corresponding response variable is either a sum or an average.</p>
<section id="using-exposure">
<h4 id="using-exposure">using <code class="docutils literal notranslate"><span class="pre">exposure</span></code><a class="headerlink" href="#using-exposure" title="Permalink to this heading">¶</a></h4>
<p>If our dependent variable is the sum of the responses of all combined observations, then under the Poisson assumption the distribution remains the same but we have varying <code class="docutils literal notranslate"><span class="pre">exposure</span></code> given by the number of individuals that are represented by one aggregated observation.</p>
<p>The parameter estimates and covariance of parameters are the same with the original data, but log-likelihood, deviance and Pearson chi-squared differ</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">glm</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">glm</span><span class="p">(</span>
    <span class="s2">"affairs_sum ~ rate_marriage + age + yrs_married"</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df_a</span><span class="p">,</span>
    <span class="n">family</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">Poisson</span><span class="p">(),</span>
    <span class="n">exposure</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">df_a</span><span class="p">[</span><span class="s2">"affairs_count"</span><span class="p">]),</span>
<span class="p">)</span>
<span class="n">res_e</span> <span class="o">=</span> <span class="n">glm</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res_e</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                 Generalized Linear Model Regression Results
==============================================================================
Dep. Variable:            affairs_sum   No. Observations:                  130
Model:                            GLM   Df Residuals:                      126
Model Family:                 Poisson   Df Model:                            3
Link Function:                    Log   Scale:                          1.0000
Method:                          IRLS   Log-Likelihood:                -740.75
Date:                Wed, 02 Nov 2022   Deviance:                       967.46
Time:                        17:04:57   Pearson chi2:                     926.
No. Iterations:                     6   Pseudo R-squ. (CS):              1.000
Covariance Type:            nonrobust
=================================================================================
                    coef    std err          z      P&gt;|z|      [0.025      0.975]
---------------------------------------------------------------------------------
Intercept         2.7155      0.107     25.294      0.000       2.505       2.926
rate_marriage    -0.4952      0.012    -41.702      0.000      -0.518      -0.472
age              -0.0299      0.004     -6.691      0.000      -0.039      -0.021
yrs_married      -0.0108      0.004     -2.507      0.012      -0.019      -0.002
=================================================================================
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_e</span><span class="o">.</span><span class="n">pearson_chi2</span> <span class="o">/</span> <span class="n">res_e</span><span class="o">.</span><span class="n">df_resid</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
7.35078910917956
</pre></div></div>
</div>
</section>
<section id="using-var_weights">
<h4 id="using-var_weights">using var_weights<a class="headerlink" href="#using-var_weights" title="Permalink to this heading">¶</a></h4>
<p>We can also use the mean of all combined values of the dependent variable. In this case the variance will be related to the inverse of the total exposure reflected by one combined observation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">glm</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">glm</span><span class="p">(</span>
    <span class="s2">"affairs_mean ~ rate_marriage + age + yrs_married"</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df_a</span><span class="p">,</span>
    <span class="n">family</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">Poisson</span><span class="p">(),</span>
    <span class="n">var_weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">df_a</span><span class="p">[</span><span class="s2">"affairs_count"</span><span class="p">]),</span>
<span class="p">)</span>
<span class="n">res_a</span> <span class="o">=</span> <span class="n">glm</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res_a</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                 Generalized Linear Model Regression Results
==============================================================================
Dep. Variable:           affairs_mean   No. Observations:                  130
Model:                            GLM   Df Residuals:                      126
Model Family:                 Poisson   Df Model:                            3
Link Function:                    Log   Scale:                          1.0000
Method:                          IRLS   Log-Likelihood:                -5954.2
Date:                Wed, 02 Nov 2022   Deviance:                       967.46
Time:                        17:04:57   Pearson chi2:                     926.
No. Iterations:                     5   Pseudo R-squ. (CS):              1.000
Covariance Type:            nonrobust
=================================================================================
                    coef    std err          z      P&gt;|z|      [0.025      0.975]
---------------------------------------------------------------------------------
Intercept         2.7155      0.107     25.294      0.000       2.505       2.926
rate_marriage    -0.4952      0.012    -41.702      0.000      -0.518      -0.472
age              -0.0299      0.004     -6.691      0.000      -0.039      -0.021
yrs_married      -0.0108      0.004     -2.507      0.012      -0.019      -0.002
=================================================================================
</pre></div></div>
</div>
</section>
</section>
<section id="Comparison">
<h3 id="Comparison">Comparison<a class="headerlink" href="#Comparison" title="Permalink to this heading">¶</a></h3>
<p>We saw in the summary prints above that <code class="docutils literal notranslate"><span class="pre">params</span></code> and <code class="docutils literal notranslate"><span class="pre">cov_params</span></code> with associated Wald inference agree across versions. We summarize this in the following comparing individual results attributes across versions.</p>
<p>Parameter estimates <code class="docutils literal notranslate"><span class="pre">params</span></code>, standard errors of the parameters <code class="docutils literal notranslate"><span class="pre">bse</span></code> and <code class="docutils literal notranslate"><span class="pre">pvalues</span></code> of the parameters for the tests that the parameters are zeros all agree. However, the likelihood and goodness-of-fit statistics, <code class="docutils literal notranslate"><span class="pre">llf</span></code>, <code class="docutils literal notranslate"><span class="pre">deviance</span></code> and <code class="docutils literal notranslate"><span class="pre">pearson_chi2</span></code> only partially agree. Specifically, the aggregated version do not agree with the results using the original data.</p>
<p><strong>Warning</strong>: The behavior of <code class="docutils literal notranslate"><span class="pre">llf</span></code>, <code class="docutils literal notranslate"><span class="pre">deviance</span></code> and <code class="docutils literal notranslate"><span class="pre">pearson_chi2</span></code> might still change in future versions.</p>
<p>Both the sum and average of the response variable for unique values of the explanatory variables have a proper likelihood interpretation. However, this interpretation is not reflected in these three statistics. Computationally this might be due to missing adjustments when aggregated data is used. However, theoretically we can think in these cases, especially for <code class="docutils literal notranslate"><span class="pre">var_weights</span></code> of the misspecified case when likelihood analysis is inappropriate and the results should be interpreted as
quasi-likelihood estimates. There is an ambiguity in the definition of <code class="docutils literal notranslate"><span class="pre">var_weights</span></code> because they can be used for averages with correctly specified likelihood as well as for variance adjustments in the quasi-likelihood case. We are currently not trying to match the likelihood specification. However, in the next section we show that likelihood ratio type tests still produce the same result for all aggregation versions when we assume that the underlying model is correctly specified.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_all</span> <span class="o">=</span> <span class="p">[</span><span class="n">res_o</span><span class="p">,</span> <span class="n">res_f</span><span class="p">,</span> <span class="n">res_e</span><span class="p">,</span> <span class="n">res_a</span><span class="p">]</span>
<span class="n">names</span> <span class="o">=</span> <span class="s2">"res_o res_f res_e res_a"</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">params</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results_all</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>res_o</th>
<th>res_f</th>
<th>res_e</th>
<th>res_a</th>
</tr>
</thead>
<tbody>
<tr>
<th>Intercept</th>
<td>2.715533</td>
<td>2.715533</td>
<td>2.715533</td>
<td>2.715533</td>
</tr>
<tr>
<th>rate_marriage</th>
<td>-0.495180</td>
<td>-0.495180</td>
<td>-0.495180</td>
<td>-0.495180</td>
</tr>
<tr>
<th>age</th>
<td>-0.029914</td>
<td>-0.029914</td>
<td>-0.029914</td>
<td>-0.029914</td>
</tr>
<tr>
<th>yrs_married</th>
<td>-0.010763</td>
<td>-0.010763</td>
<td>-0.010763</td>
<td>-0.010763</td>
</tr>
</tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">bse</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results_all</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>res_o</th>
<th>res_f</th>
<th>res_e</th>
<th>res_a</th>
</tr>
</thead>
<tbody>
<tr>
<th>Intercept</th>
<td>0.107360</td>
<td>0.107360</td>
<td>0.107360</td>
<td>0.107360</td>
</tr>
<tr>
<th>rate_marriage</th>
<td>0.011874</td>
<td>0.011874</td>
<td>0.011874</td>
<td>0.011874</td>
</tr>
<tr>
<th>age</th>
<td>0.004471</td>
<td>0.004471</td>
<td>0.004471</td>
<td>0.004471</td>
</tr>
<tr>
<th>yrs_married</th>
<td>0.004294</td>
<td>0.004294</td>
<td>0.004294</td>
<td>0.004294</td>
</tr>
</tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">pvalues</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results_all</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>res_o</th>
<th>res_f</th>
<th>res_e</th>
<th>res_a</th>
</tr>
</thead>
<tbody>
<tr>
<th>Intercept</th>
<td>3.756282e-141</td>
<td>3.756280e-141</td>
<td>3.756282e-141</td>
<td>3.756282e-141</td>
</tr>
<tr>
<th>rate_marriage</th>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr>
<th>age</th>
<td>2.221918e-11</td>
<td>2.221918e-11</td>
<td>2.221918e-11</td>
<td>2.221918e-11</td>
</tr>
<tr>
<th>yrs_married</th>
<td>1.219200e-02</td>
<td>1.219200e-02</td>
<td>1.219200e-02</td>
<td>1.219200e-02</td>
</tr>
</tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([[</span><span class="n">r</span><span class="o">.</span><span class="n">llf</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">deviance</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">pearson_chi2</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results_all</span><span class="p">]),</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">names</span><span class="p">,</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">"llf"</span><span class="p">,</span> <span class="s2">"deviance"</span><span class="p">,</span> <span class="s2">"pearson chi2"</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>res_o</th>
<th>res_f</th>
<th>res_e</th>
<th>res_a</th>
</tr>
</thead>
<tbody>
<tr>
<th>llf</th>
<td>-10350.913296</td>
<td>-10350.913296</td>
<td>-740.748534</td>
<td>-5954.219866</td>
</tr>
<tr>
<th>deviance</th>
<td>15374.679054</td>
<td>15374.679054</td>
<td>967.455734</td>
<td>967.455734</td>
</tr>
<tr>
<th>pearson chi2</th>
<td>32310.704118</td>
<td>32310.704118</td>
<td>926.199428</td>
<td>926.199428</td>
</tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="Likelihood-Ratio-type-tests">
<h3 id="Likelihood-Ratio-type-tests">Likelihood Ratio type tests<a class="headerlink" href="#Likelihood-Ratio-type-tests" title="Permalink to this heading">¶</a></h3>
<p>We saw above that likelihood and related statistics do not agree between the aggregated and original, individual data. We illustrate in the following that likelihood ratio test and difference in deviance agree across versions, however Pearson chi-squared does not.</p>
<p>As before: This is not sufficiently clear yet and could change.</p>
<p>As a test case we drop the <code class="docutils literal notranslate"><span class="pre">age</span></code> variable and compute the likelihood ratio type statistics as difference between reduced or constrained and full or unconstrained model.</p>
<section id="original-observations-and-frequency-weights">
<h4 id="original-observations-and-frequency-weights">original observations and frequency weights<a class="headerlink" href="#original-observations-and-frequency-weights" title="Permalink to this heading">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">glm</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">glm</span><span class="p">(</span>
    <span class="s2">"affairs ~ rate_marriage + yrs_married"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">Poisson</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">res_o2</span> <span class="o">=</span> <span class="n">glm</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="c1"># print(res_f2.summary())</span>
<span class="n">res_o2</span><span class="o">.</span><span class="n">pearson_chi2</span> <span class="o">-</span> <span class="n">res_o</span><span class="o">.</span><span class="n">pearson_chi2</span><span class="p">,</span> <span class="n">res_o2</span><span class="o">.</span><span class="n">deviance</span> <span class="o">-</span> <span class="n">res_o</span><span class="o">.</span><span class="n">deviance</span><span class="p">,</span> <span class="n">res_o2</span><span class="o">.</span><span class="n">llf</span> <span class="o">-</span> <span class="n">res_o</span><span class="o">.</span><span class="n">llf</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(52.913431618813775, 45.726693322507344, -22.863346661253672)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">glm</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">glm</span><span class="p">(</span>
    <span class="s2">"affairs ~ rate_marriage + yrs_married"</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">dc</span><span class="p">,</span>
    <span class="n">family</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">Poisson</span><span class="p">(),</span>
    <span class="n">freq_weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dc</span><span class="p">[</span><span class="s2">"freq"</span><span class="p">]),</span>
<span class="p">)</span>
<span class="n">res_f2</span> <span class="o">=</span> <span class="n">glm</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="c1"># print(res_f2.summary())</span>
<span class="n">res_f2</span><span class="o">.</span><span class="n">pearson_chi2</span> <span class="o">-</span> <span class="n">res_f</span><span class="o">.</span><span class="n">pearson_chi2</span><span class="p">,</span> <span class="n">res_f2</span><span class="o">.</span><span class="n">deviance</span> <span class="o">-</span> <span class="n">res_f</span><span class="o">.</span><span class="n">deviance</span><span class="p">,</span> <span class="n">res_f2</span><span class="o">.</span><span class="n">llf</span> <span class="o">-</span> <span class="n">res_f</span><span class="o">.</span><span class="n">llf</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(52.91343161867189, 45.726693322505525, -22.863346661251853)
</pre></div></div>
</div>
</section>
<section id="aggregated-data:-exposure-and-var_weights">
<h4 id="aggregated-data:-exposure-and-var_weights">aggregated data: <code class="docutils literal notranslate"><span class="pre">exposure</span></code> and <code class="docutils literal notranslate"><span class="pre">var_weights</span></code><a class="headerlink" href="#aggregated-data:-exposure-and-var_weights" title="Permalink to this heading">¶</a></h4>
<p>Note: LR test agrees with original observations, <code class="docutils literal notranslate"><span class="pre">pearson_chi2</span></code> differs and has the wrong sign.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">glm</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">glm</span><span class="p">(</span>
    <span class="s2">"affairs_sum ~ rate_marriage + yrs_married"</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df_a</span><span class="p">,</span>
    <span class="n">family</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">Poisson</span><span class="p">(),</span>
    <span class="n">exposure</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">df_a</span><span class="p">[</span><span class="s2">"affairs_count"</span><span class="p">]),</span>
<span class="p">)</span>
<span class="n">res_e2</span> <span class="o">=</span> <span class="n">glm</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">res_e2</span><span class="o">.</span><span class="n">pearson_chi2</span> <span class="o">-</span> <span class="n">res_e</span><span class="o">.</span><span class="n">pearson_chi2</span><span class="p">,</span> <span class="n">res_e2</span><span class="o">.</span><span class="n">deviance</span> <span class="o">-</span> <span class="n">res_e</span><span class="o">.</span><span class="n">deviance</span><span class="p">,</span> <span class="n">res_e2</span><span class="o">.</span><span class="n">llf</span> <span class="o">-</span> <span class="n">res_e</span><span class="o">.</span><span class="n">llf</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(-31.61852752510731, 45.72669332250655, -22.863346661253217)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">glm</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">glm</span><span class="p">(</span>
    <span class="s2">"affairs_mean ~ rate_marriage + yrs_married"</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df_a</span><span class="p">,</span>
    <span class="n">family</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">Poisson</span><span class="p">(),</span>
    <span class="n">var_weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">df_a</span><span class="p">[</span><span class="s2">"affairs_count"</span><span class="p">]),</span>
<span class="p">)</span>
<span class="n">res_a2</span> <span class="o">=</span> <span class="n">glm</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">res_a2</span><span class="o">.</span><span class="n">pearson_chi2</span> <span class="o">-</span> <span class="n">res_a</span><span class="o">.</span><span class="n">pearson_chi2</span><span class="p">,</span> <span class="n">res_a2</span><span class="o">.</span><span class="n">deviance</span> <span class="o">-</span> <span class="n">res_a</span><span class="o">.</span><span class="n">deviance</span><span class="p">,</span> <span class="n">res_a2</span><span class="o">.</span><span class="n">llf</span> <span class="o">-</span> <span class="n">res_a</span><span class="o">.</span><span class="n">llf</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(-31.618527525103218, 45.72669332250655, -22.863346661253672)
</pre></div></div>
</div>
</section>
</section>
<section id="Investigating-Pearson-chi-square-statistic">
<h3 id="Investigating-Pearson-chi-square-statistic">Investigating Pearson chi-square statistic<a class="headerlink" href="#Investigating-Pearson-chi-square-statistic" title="Permalink to this heading">¶</a></h3>
<p>First, we do some sanity checks that there are no basic bugs in the computation of <code class="docutils literal notranslate"><span class="pre">pearson_chi2</span></code> and <code class="docutils literal notranslate"><span class="pre">resid_pearson</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_e2</span><span class="o">.</span><span class="n">pearson_chi2</span><span class="p">,</span> <span class="n">res_e</span><span class="o">.</span><span class="n">pearson_chi2</span><span class="p">,</span> <span class="p">(</span><span class="n">res_e2</span><span class="o">.</span><span class="n">resid_pearson</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="p">(</span>
    <span class="n">res_e</span><span class="o">.</span><span class="n">resid_pearson</span> <span class="o">**</span> <span class="mi">2</span>
<span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(894.5809002315173, 926.1994277566246, 894.5809002315173, 926.1994277566246)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_e</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">resid_response</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">res_e</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">variance</span><span class="p">(</span><span class="n">res_e</span><span class="o">.</span><span class="n">mu</span><span class="p">)[</span>
    <span class="p">:</span><span class="mi">5</span>
<span class="p">],</span> <span class="n">res_e</span><span class="o">.</span><span class="n">mu</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1.617851152192228e-14,
 array([ 5.42753476, 46.42940306, 19.98971769, 38.50138978, 11.18341883]),
 array([ 5.42753476, 46.42940306, 19.98971769, 38.50138978, 11.18341883]))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">res_e</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">resid_response</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">res_e</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">variance</span><span class="p">(</span><span class="n">res_e</span><span class="o">.</span><span class="n">mu</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
926.1994277566246
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_e2</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">resid_response</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">res_e2</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">variance</span><span class="p">(</span><span class="n">res_e2</span><span class="o">.</span><span class="n">mu</span><span class="p">)[</span>
    <span class="p">:</span><span class="mi">5</span>
<span class="p">],</span> <span class="n">res_e2</span><span class="o">.</span><span class="n">mu</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(9.9257354472334e-14,
 array([ 4.77165474, 44.4026604 , 22.2013302 , 39.14749309, 10.54229538]),
 array([ 4.77165474, 44.4026604 , 22.2013302 , 39.14749309, 10.54229538]))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">res_e2</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">resid_response</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">res_e2</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">variance</span><span class="p">(</span><span class="n">res_e2</span><span class="o">.</span><span class="n">mu</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
894.5809002315173
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">res_e2</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">resid_response</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="p">(</span><span class="n">res_e</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">resid_response</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(51204.8573783234, 47104.647795959645)
</pre></div></div>
</div>
<p>One possible reason for the incorrect sign is that we are subtracting quadratic terms that are divided by different denominators. In some related cases, the recommendation in the literature is to use a common denominator. We can compare pearson chi-squared statistic using the same variance assumption in the full and reduced model.</p>
<p>In this case we obtain the same pearson chi2 scaled difference between reduced and full model across all versions. (Issue <a class="reference external" href="https://github.com/statsmodels/statsmodels/issues/3616">#3616</a> is intended to track this further.)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="p">(</span><span class="n">res_e2</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">resid_response</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">res_e</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">resid_response</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="o">/</span> <span class="n">res_e2</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">variance</span><span class="p">(</span><span class="n">res_e2</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
44.4331417512193
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="p">(</span><span class="n">res_a2</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">resid_response</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">res_a</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">resid_response</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="o">/</span> <span class="n">res_a2</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">variance</span><span class="p">(</span><span class="n">res_a2</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span>
    <span class="o">*</span> <span class="n">res_a2</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">var_weights</span>
<span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
44.43314175121901
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="p">(</span><span class="n">res_f2</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">resid_response</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">res_f</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">resid_response</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="o">/</span> <span class="n">res_f2</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">variance</span><span class="p">(</span><span class="n">res_f2</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span>
    <span class="o">*</span> <span class="n">res_f2</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">freq_weights</span>
<span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
44.43314175121954
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="p">(</span><span class="n">res_o2</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">resid_response</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">res_o</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">resid_response</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="o">/</span> <span class="n">res_o2</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">variance</span><span class="p">(</span><span class="n">res_o2</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
44.43314175121988
</pre></div></div>
</div>
</section>
</section>
<section id="Remainder">
<h2 id="Remainder">Remainder<a class="headerlink" href="#Remainder" title="Permalink to this heading">¶</a></h2>
<p>The remainder of the notebook just contains some additional checks and can be ignored.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">res_e2</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">exposure</span><span class="p">)[:</span><span class="mi">5</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">df_a</span><span class="p">[</span><span class="s2">"affairs_count"</span><span class="p">])[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array([ 1., 10.,  5., 10.,  3.]), array([ 1, 10,  5, 10,  3]))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_e2</span><span class="o">.</span><span class="n">resid_pearson</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="n">res_e</span><span class="o">.</span><span class="n">resid_pearson</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
-9.664817945861138
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_e2</span><span class="o">.</span><span class="n">mu</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([ 4.77165474, 44.4026604 , 22.2013302 , 39.14749309, 10.54229538])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_a2</span><span class="o">.</span><span class="n">pearson_chi2</span><span class="p">,</span> <span class="n">res_a</span><span class="o">.</span><span class="n">pearson_chi2</span><span class="p">,</span> <span class="n">res_a2</span><span class="o">.</span><span class="n">resid_pearson</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">res_a</span><span class="o">.</span><span class="n">resid_pearson</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(894.5809002315159, 926.1994277566191, -42.347207135187446, -32.68238918932903)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="p">(</span><span class="n">res_a2</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">resid_response</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="o">/</span> <span class="n">res_a2</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">variance</span><span class="p">(</span><span class="n">res_a2</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span>
    <span class="o">*</span> <span class="n">res_a2</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">var_weights</span>
<span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
894.5809002315159
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="p">(</span><span class="n">res_a</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">resid_response</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="o">/</span> <span class="n">res_a</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">variance</span><span class="p">(</span><span class="n">res_a</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span>
    <span class="o">*</span> <span class="n">res_a</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">var_weights</span>
<span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
926.1994277566191
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="p">(</span><span class="n">res_a</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">resid_response</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="o">/</span> <span class="n">res_a</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">variance</span><span class="p">(</span><span class="n">res_a2</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span>
    <span class="o">*</span> <span class="n">res_a</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">var_weights</span>
<span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
850.1477584802968
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_e</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span><span class="p">[:</span><span class="mi">5</span><span class="p">],</span> <span class="n">res_e2</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array([ 0., 39., 17.,  9.,  4.]), array([ 0., 39., 17.,  9.,  4.]))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_a</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span><span class="p">[:</span><span class="mi">5</span><span class="p">],</span> <span class="n">res_a2</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array([0.        , 3.9       , 3.4       , 0.9       , 1.33333333]),
 array([0.        , 3.9       , 3.4       , 0.9       , 1.33333333]))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_a2</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">res_e2</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">exposure</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([ 0., 39., 17.,  9.,  4.])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_a2</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">res_a2</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">var_weights</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([ 0., 39., 17.,  9.,  4.])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>

<span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="mf">27.19530754604785</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="mf">29.083798806764687</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1.8390448369994542e-07, 6.931421143170174e-08)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_o</span><span class="o">.</span><span class="n">pvalues</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Intercept        3.756282e-141
rate_marriage     0.000000e+00
age               2.221918e-11
yrs_married       1.219200e-02
dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">res_e2</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res_e</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                 Generalized Linear Model Regression Results
==============================================================================
Dep. Variable:            affairs_sum   No. Observations:                  130
Model:                            GLM   Df Residuals:                      127
Model Family:                 Poisson   Df Model:                            2
Link Function:                    Log   Scale:                          1.0000
Method:                          IRLS   Log-Likelihood:                -763.61
Date:                Wed, 02 Nov 2022   Deviance:                       1013.2
Time:                        17:04:57   Pearson chi2:                     895.
No. Iterations:                     6   Pseudo R-squ. (CS):              1.000
Covariance Type:            nonrobust
=================================================================================
                    coef    std err          z      P&gt;|z|      [0.025      0.975]
---------------------------------------------------------------------------------
Intercept         2.0754      0.050     41.512      0.000       1.977       2.173
rate_marriage    -0.4947      0.012    -41.743      0.000      -0.518      -0.471
yrs_married      -0.0360      0.002    -17.542      0.000      -0.040      -0.032
=================================================================================
                 Generalized Linear Model Regression Results
==============================================================================
Dep. Variable:            affairs_sum   No. Observations:                  130
Model:                            GLM   Df Residuals:                      126
Model Family:                 Poisson   Df Model:                            3
Link Function:                    Log   Scale:                          1.0000
Method:                          IRLS   Log-Likelihood:                -740.75
Date:                Wed, 02 Nov 2022   Deviance:                       967.46
Time:                        17:04:57   Pearson chi2:                     926.
No. Iterations:                     6   Pseudo R-squ. (CS):              1.000
Covariance Type:            nonrobust
=================================================================================
                    coef    std err          z      P&gt;|z|      [0.025      0.975]
---------------------------------------------------------------------------------
Intercept         2.7155      0.107     25.294      0.000       2.505       2.926
rate_marriage    -0.4952      0.012    -41.702      0.000      -0.518      -0.472
age              -0.0299      0.004     -6.691      0.000      -0.039      -0.021
yrs_married      -0.0108      0.004     -2.507      0.012      -0.019      -0.002
=================================================================================
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">res_f2</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res_f</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                 Generalized Linear Model Regression Results
==============================================================================
Dep. Variable:                affairs   No. Observations:                  476
Model:                            GLM   Df Residuals:                     6363
Model Family:                 Poisson   Df Model:                            2
Link Function:                    Log   Scale:                          1.0000
Method:                          IRLS   Log-Likelihood:                -10374.
Date:                Wed, 02 Nov 2022   Deviance:                       15420.
Time:                        17:04:57   Pearson chi2:                 3.24e+04
No. Iterations:                     6   Pseudo R-squ. (CS):             0.9729
Covariance Type:            nonrobust
=================================================================================
                    coef    std err          z      P&gt;|z|      [0.025      0.975]
---------------------------------------------------------------------------------
Intercept         2.0754      0.050     41.512      0.000       1.977       2.173
rate_marriage    -0.4947      0.012    -41.743      0.000      -0.518      -0.471
yrs_married      -0.0360      0.002    -17.542      0.000      -0.040      -0.032
=================================================================================
                 Generalized Linear Model Regression Results
==============================================================================
Dep. Variable:                affairs   No. Observations:                  476
Model:                            GLM   Df Residuals:                     6362
Model Family:                 Poisson   Df Model:                            3
Link Function:                    Log   Scale:                          1.0000
Method:                          IRLS   Log-Likelihood:                -10351.
Date:                Wed, 02 Nov 2022   Deviance:                       15375.
Time:                        17:04:57   Pearson chi2:                 3.23e+04
No. Iterations:                     6   Pseudo R-squ. (CS):             0.9754
Covariance Type:            nonrobust
=================================================================================
                    coef    std err          z      P&gt;|z|      [0.025      0.975]
---------------------------------------------------------------------------------
Intercept         2.7155      0.107     25.294      0.000       2.505       2.926
rate_marriage    -0.4952      0.012    -41.702      0.000      -0.518      -0.472
age              -0.0299      0.004     -6.691      0.000      -0.039      -0.021
yrs_married      -0.0108      0.004     -2.507      0.012      -0.019      -0.002
=================================================================================
</pre></div></div>
</div>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="glm_formula.html" title="Generalized Linear Models (Formula)"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Generalized Linear Models (Formula) </span>
              </div>
            </a>
          
          
            <a href="influence_glm_logit.html" title="Influence Measures for GLM Logit"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Influence Measures for GLM Logit </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2009-2019, Josef Perktold, Skipper Seabold, Jonathan Taylor, statsmodels-developers.
              
          </div>
            Last updated on
              Nov 02, 2022.
            <br/>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../../../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>