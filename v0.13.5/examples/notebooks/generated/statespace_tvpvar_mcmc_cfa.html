

<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../../../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../../../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../../../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../../../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../../../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>TVP-VAR, MCMC, and sparse simulation smoothing &#8212; statsmodels</title>
  <link rel="icon" type="image/png" sizes="32x32" href="../../../_static/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../../../_static/icons/favicon-16x16.png">
  <link rel="manifest" href="../../../_static/icons/site.webmanifest">
  <link rel="mask-icon" href="../../../_static/icons/safari-pinned-tab.svg" color="#919191">
  <meta name="msapplication-TileColor" content="#2b5797">
  <meta name="msapplication-config" content="../../../_static/icons/browserconfig.xml">
  <link rel="stylesheet" href="../../../_static/stylesheets/examples.css">
  <link rel="stylesheet" href="../../../_static/stylesheets/deprecation.css">
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/material.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Fast Bayesian estimation of SARIMAX models" href="statespace_sarimax_pymc3.html" />
    <link rel="prev" title="Estimating or specifying parameters in state space models" href="statespace_fixed_params.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=indigo data-md-color-accent=blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#examples/notebooks/generated/statespace_tvpvar_mcmc_cfa" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../../index.html" title="statsmodels"
           class="md-header-nav__button md-logo">
          
              <img src="../../../_static/statsmodels-logo-v2-bw.svg" height="26"
                   alt="statsmodels logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">statsmodels 0.13.5</span>
          <span class="md-header-nav__topic"> TVP-VAR, MCMC, and sparse simulation smoothing </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../../../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/statsmodels/statsmodels" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    statsmodels
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../../../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../../../../versions-v2.json",
        target_loc = "../../../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../../index.html" class="md-tabs__link">Examples</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../../index.html" title="statsmodels" class="md-nav__button md-logo">
      
        <img src="../../../_static/statsmodels-logo-v2-bw.svg" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../../../index.html"
       title="statsmodels">statsmodels 0.13.5</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/statsmodels/statsmodels" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    statsmodels
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../../../install.html" class="md-nav__link">Installing statsmodels</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../gettingstarted.html" class="md-nav__link">Getting started</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../user-guide.html" class="md-nav__link">User Guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html" class="md-nav__link">Examples</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="../../index.html#linear-regression-models" class="md-nav__link">Linear Regression Models</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#plotting" class="md-nav__link">Plotting</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#discrete-choice-models" class="md-nav__link">Discrete Choice Models</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#nonparametric-statistics" class="md-nav__link">Nonparametric Statistics</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#generalized-linear-models" class="md-nav__link">Generalized Linear Models</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#robust-regression" class="md-nav__link">Robust Regression</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#generalized-estimating-equations" class="md-nav__link">Generalized Estimating Equations</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#statistics" class="md-nav__link">Statistics</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#time-series-analysis" class="md-nav__link">Time Series Analysis</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#state-space-models" class="md-nav__link">State space models</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="statespace_sarimax_faq.html" class="md-nav__link">SARIMAX and ARIMA: Frequently Asked Questions (FAQ)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="statespace_varmax.html" class="md-nav__link">VARMAX models</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="statespace_dfm_coincident.html" class="md-nav__link">Dynamic factors and coincident indices</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="statespace_structural_harvey_jaeger.html" class="md-nav__link">Detrending, Stylized Facts and the Business Cycle</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="statespace_cycles.html" class="md-nav__link">Trends and cycles in unemployment</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="statespace_local_linear_trend.html" class="md-nav__link">State space modeling: Local Linear Trends</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="statespace_arma_0.html" class="md-nav__link">Autoregressive Moving Average (ARMA): Sunspots data</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="statespace_seasonal.html" class="md-nav__link">Seasonality in time series data</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="statespace_fixed_params.html" class="md-nav__link">Estimating or specifying parameters in state space models</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> TVP-VAR, MCMC, and sparse simulation smoothing </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">TVP-VAR, MCMC, and sparse simulation smoothing</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#examples-notebooks-generated-statespace-tvpvar-mcmc-cfa--page-root" class="md-nav__link">TVP-VAR, MCMC, and sparse simulation smoothing</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Background" class="md-nav__link">Background</a>
        </li>
        <li class="md-nav__item"><a href="#Implementation-in-Statsmodels" class="md-nav__link">Implementation in Statsmodels</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Local-level-model" class="md-nav__link">Local level model</a>
        </li>
        <li class="md-nav__item"><a href="#Updating-the-model’s-parameters" class="md-nav__link">Updating the model’s parameters</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Application:-Bayesian-analysis-of-a-TVP-VAR-model-by-MCMC" class="md-nav__link">Application: Bayesian analysis of a TVP-VAR model by MCMC</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#TVP-VAR-model" class="md-nav__link">TVP-VAR model</a>
        </li>
        <li class="md-nav__item"><a href="#TVP-VAR-model-in-Statsmodels" class="md-nav__link">TVP-VAR model in Statsmodels</a>
        </li>
        <li class="md-nav__item"><a href="#Preliminary-investigation-with-ad-hoc-parameters-in-H,-Q" class="md-nav__link">Preliminary investigation with ad-hoc parameters in H, Q</a>
        </li>
        <li class="md-nav__item"><a href="#Bayesian-estimation-via-MCMC" class="md-nav__link">Bayesian estimation via MCMC</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Appendix:-performance" class="md-nav__link">Appendix: performance</a>
        </li>
        <li class="md-nav__item"><a href="#Bibliography" class="md-nav__link">Bibliography</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../../../_sources/examples/notebooks/generated/statespace_tvpvar_mcmc_cfa.ipynb.txt">Show Source</a> </li>

  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="statespace_sarimax_pymc3.html" class="md-nav__link">Fast Bayesian estimation of SARIMAX models</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="statespace_news.html" class="md-nav__link">Forecasting, updating datasets, and the “news”</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="statespace_custom_models.html" class="md-nav__link">Custom statespace models</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="ets.html" class="md-nav__link">ETS models</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#state-space-models-technical-notes" class="md-nav__link">State space models - Technical notes</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#forecasting" class="md-nav__link">Forecasting</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#multivariate-methods" class="md-nav__link">Multivariate Methods</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../index.html#user-notes" class="md-nav__link">User Notes</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../api.html" class="md-nav__link">API Reference</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../about.html" class="md-nav__link">About statsmodels</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../dev/index.html" class="md-nav__link">Developer Page</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../release/index.html" class="md-nav__link">Release Notes</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#examples-notebooks-generated-statespace-tvpvar-mcmc-cfa--page-root" class="md-nav__link">TVP-VAR, MCMC, and sparse simulation smoothing</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Background" class="md-nav__link">Background</a>
        </li>
        <li class="md-nav__item"><a href="#Implementation-in-Statsmodels" class="md-nav__link">Implementation in Statsmodels</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Local-level-model" class="md-nav__link">Local level model</a>
        </li>
        <li class="md-nav__item"><a href="#Updating-the-model’s-parameters" class="md-nav__link">Updating the model’s parameters</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Application:-Bayesian-analysis-of-a-TVP-VAR-model-by-MCMC" class="md-nav__link">Application: Bayesian analysis of a TVP-VAR model by MCMC</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#TVP-VAR-model" class="md-nav__link">TVP-VAR model</a>
        </li>
        <li class="md-nav__item"><a href="#TVP-VAR-model-in-Statsmodels" class="md-nav__link">TVP-VAR model in Statsmodels</a>
        </li>
        <li class="md-nav__item"><a href="#Preliminary-investigation-with-ad-hoc-parameters-in-H,-Q" class="md-nav__link">Preliminary investigation with ad-hoc parameters in H, Q</a>
        </li>
        <li class="md-nav__item"><a href="#Bayesian-estimation-via-MCMC" class="md-nav__link">Bayesian estimation via MCMC</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Appendix:-performance" class="md-nav__link">Appendix: performance</a>
        </li>
        <li class="md-nav__item"><a href="#Bibliography" class="md-nav__link">Bibliography</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../../../_sources/examples/notebooks/generated/statespace_tvpvar_mcmc_cfa.ipynb.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="TVP-VAR,-MCMC,-and-sparse-simulation-smoothing">
<h1 id="examples-notebooks-generated-statespace-tvpvar-mcmc-cfa--page-root">TVP-VAR, MCMC, and sparse simulation smoothing<a class="headerlink" href="#examples-notebooks-generated-statespace-tvpvar-mcmc-cfa--page-root" title="Permalink to this heading">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">reload</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">invwishart</span><span class="p">,</span> <span class="n">invgamma</span>

<span class="c1"># Get the macro dataset</span>
<span class="n">dta</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">macrodata</span><span class="o">.</span><span class="n">load_pandas</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
<span class="n">dta</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">'1959Q1'</span><span class="p">,</span> <span class="s1">'2009Q3'</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">'QS'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="Background">
<h2 id="Background">Background<a class="headerlink" href="#Background" title="Permalink to this heading">¶</a></h2>
<p>Bayesian analysis of linear Gaussian state space models via Markov chain Monte Carlo (MCMC) methods has become both commonplace and relatively straightforward in recent years, due especially to advances in sampling from the joint posterior of the unobserved state vector conditional on the data and model parameters (see especially Carter and Kohn (1994), de Jong and Shephard (1995), and Durbin and Koopman (2002)). This is particularly useful for Gibbs sampling MCMC approaches.</p>
<p>While these procedures make use of the forward/backward application of the recursive Kalman filter and smoother, another recent line of research takes a different approach and constructs the posterior joint distribution of the entire vector of states at once - see in particular Chan and Jeliazkov (2009) for an econometric time series treatment and McCausland et al. (2011) for a more general survey. In particular, the posterior mean and precision matrix are constructed explicitly, with the latter
a sparse band matrix. Advantage is then taken of efficient algorithms for Cholesky factorization of sparse band matrices; this reduces memory costs and can improve performance. Following McCausland et al. (2011), we refer to this method as the “Cholesky Factor Algorithm” (CFA) approach.</p>
<p>The CFA-based simulation smoother has some advantages and some drawbacks compared to that based on the more typical Kalman filter and smoother (KFS).</p>
<p><strong>Advantages of CFA</strong>:</p>
<ul class="simple">
<li><p>Derivation of the joint posterior distribution is relatively straightforward and easy to understand.</p></li>
<li><p>In some cases can be both faster and less memory-intensive than the KFS approach</p>
<ul>
<li><p>In the Appendix at the end of this notebook, we briefly discuss the performance of the two simulation smoothers for the TVP-VAR model. In summary: simple tests on a single machine suggest that for the TVP-VAR model, the CFA and KFS implementations in Statsmodels have about the same runtimes, while both implementations are about twice as fast as the replication code, written in Matlab, provided by Chan and Jeliazkov (2009).</p></li>
</ul>
</li>
</ul>
<p><strong>Drawbacks of CFA</strong>:</p>
<p>The main drawback is that this method has not (at least so far) reached the generality of the KFS approach. For example:</p>
<ul class="simple">
<li><p>It can not be used with models that have reduced-rank error terms in the observation or state equations.</p>
<ul>
<li><p>One implication of this is that the typical state space model trick of including identities in the state equation to accommodate, for example, higher-order lags in autoregressive models is not applicable. These models can still be handled by the CFA approach, but at the cost of requiring a slightly different implementation for each lag that is included.</p></li>
<li><p>As an example, standard ways of representing ARMA and VARMA processes in state space form do include identities in the observation and/or state equations, and so the basic formulas presented in Chan and Jeliazkov (2009) do not apply immediately to these models.</p></li>
</ul>
</li>
<li><p>Less flexibility is available in the state initialization / prior.</p></li>
</ul>
</section>
<section id="Implementation-in-Statsmodels">
<h2 id="Implementation-in-Statsmodels">Implementation in Statsmodels<a class="headerlink" href="#Implementation-in-Statsmodels" title="Permalink to this heading">¶</a></h2>
<p>A CFA simulation smoother along the lines of the basic formulas presented in Chan and Jeliazkov (2009) has been implemented in Statsmodels.</p>
<p><strong>Notes</strong>:</p>
<ul class="simple">
<li><p>Therefore, the CFA simulation smoother in Statsmodels so-far only supports the case that the state transition is truly a first-order Markov process (i.e. it does not support a p-th order Markov process that has been stacked using identities into a first-order process).</p></li>
<li><p>By contrast, the KFS smoother in Statsmodels is fully general any can be used for any state space model, including those with stacked p-th order Markov processes or other identities in the observation and state equations.</p></li>
</ul>
<p>Either a KFS or the CFA simulation smoothers can be constructed from a state space model using the <code class="docutils literal notranslate"><span class="pre">simulation_smoother</span></code> method. To show the basic idea, we first consider a simple example.</p>
<section id="Local-level-model">
<h3 id="Local-level-model">Local level model<a class="headerlink" href="#Local-level-model" title="Permalink to this heading">¶</a></h3>
<p>A local level model decomposes an observed series <span class="math notranslate nohighlight">\(y_t\)</span> into a persistent trend <span class="math notranslate nohighlight">\(\mu_t\)</span> and a transitory error component</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
y_t &amp; = \mu_t + \varepsilon_t, \qquad \varepsilon_t \sim N(0, \sigma_\text{irregular}^2) \\
\mu_t &amp; = \mu_{t-1} + \eta_t, \quad ~ \eta_t \sim N(0, \sigma_\text{level}^2)
\end{aligned}\end{split}\]</div>
<p>This model satisfies the requirements of the CFA simulation smoother because both the observation error term <span class="math notranslate nohighlight">\(\varepsilon_t\)</span> and the state innovation term <span class="math notranslate nohighlight">\(\eta_t\)</span> are non-degenerate - that is, their covariance matrices are full rank.</p>
<p>We apply this model to inflation, and consider simulating draws from the posterior of the joint state vector. That is, we are interested in sampling from</p>
<div class="math notranslate nohighlight">
\[p(\mu^t \mid y^t, \sigma_\text{irregular}^2, \sigma_\text{level}^2)\]</div>
<p>where we define <span class="math notranslate nohighlight">\(\mu^t \equiv (\mu_1, \dots, \mu_T)'\)</span> and <span class="math notranslate nohighlight">\(y^t \equiv (y_1, \dots, y_T)'\)</span>.</p>
<p>In Statsmodels, the local level model falls into the more general class of “unobserved components” models, and can be constructed as follows:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Construct a local level model for inflation</span>
<span class="n">mod</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">UnobservedComponents</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">infl</span><span class="p">,</span> <span class="s1">'llevel'</span><span class="p">)</span>

<span class="c1"># Fit the model's parameters (sigma2_varepsilon and sigma2_eta)</span>
<span class="c1"># via maximum likelihood</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>

<span class="c1"># Create simulation smoother objects</span>
<span class="n">sim_kfs</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">simulation_smoother</span><span class="p">()</span>              <span class="c1"># default method is KFS</span>
<span class="n">sim_cfa</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">simulation_smoother</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">'cfa'</span><span class="p">)</span>  <span class="c1"># can specify CFA method</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RUNNING THE L-BFGS-B CODE

           * * *

Machine precision = 2.220D-16
 N =            2     M =           10

At X0         0 variables are exactly at the bounds

At iterate    0    f=  2.40814D+00    |proj g|=  1.27979D-01

At iterate    5    f=  2.24982D+00    |proj g|=  9.50562D-04

           * * *

Tit   = total number of iterations
Tnf   = total number of function evaluations
Tnint = total number of segments explored during Cauchy searches
Skip  = number of BFGS updates skipped
Nact  = number of active bounds at final generalized Cauchy point
Projg = norm of the final projected gradient
F     = final function value

           * * *

   N    Tit     Tnf  Tnint  Skip  Nact     Projg        F
    2      7      9      1     0     0   2.952D-07   2.250D+00
  F =   2.2498167187366014

CONVERGENCE: NORM_OF_PROJECTED_GRADIENT_&lt;=_PGTOL
sigma2.irregular    3.373368
sigma2.level        0.744712
dtype: float64
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 This problem is unconstrained.
</pre></div></div>
</div>
<p>The simulation smoother objects <code class="docutils literal notranslate"><span class="pre">sim_kfs</span></code> and <code class="docutils literal notranslate"><span class="pre">sim_cfa</span></code> have <code class="docutils literal notranslate"><span class="pre">simulate</span></code> methods that perform simulation smoothing. Each time that <code class="docutils literal notranslate"><span class="pre">simulate</span></code> is called, the <code class="docutils literal notranslate"><span class="pre">simulated_state</span></code> attribute will be re-populated with a new simulated draw from the posterior.</p>
<p>Below, we construct 20 simulated paths for the trend, using the KFS and CFA approaches, where the simulation is at the maximum likelihood parameter estimates.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nsimulations</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">simulated_state_kfs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">mod</span><span class="o">.</span><span class="n">nobs</span><span class="p">,</span> <span class="n">nsimulations</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="n">dta</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">simulated_state_cfa</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">mod</span><span class="o">.</span><span class="n">nobs</span><span class="p">,</span> <span class="n">nsimulations</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="n">dta</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsimulations</span><span class="p">):</span>
    <span class="c1"># Apply KFS simulation smoothing</span>
    <span class="n">sim_kfs</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>
    <span class="c1"># Save the KFS simulated state</span>
    <span class="n">simulated_state_kfs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sim_kfs</span><span class="o">.</span><span class="n">simulated_state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Apply CFA simulation smoothing</span>
    <span class="n">sim_cfa</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>
    <span class="c1"># Save the CFA simulated state</span>
    <span class="n">simulated_state_cfa</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sim_cfa</span><span class="o">.</span><span class="n">simulated_state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Plotting the observed data and the simulations created using each method below, it is not too hard to see that these two methods are doing the same thing.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the inflation data along with simulated trends</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Plot data and KFS simulations</span>
<span class="n">dta</span><span class="o">.</span><span class="n">infl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'k'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Simulations based on KFS approach, MLE parameters'</span><span class="p">)</span>
<span class="n">simulated_state_kfs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'C0'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Plot data and CFA simulations</span>
<span class="n">dta</span><span class="o">.</span><span class="n">infl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'k'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Simulations based on CFA approach, MLE parameters'</span><span class="p">)</span>
<span class="n">simulated_state_cfa</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'C0'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Add a legend, clean up layout</span>
<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="s1">'Data'</span><span class="p">,</span> <span class="s1">'Simulated state'</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/examples_notebooks_generated_statespace_tvpvar_mcmc_cfa_9_0.png" src="../../../_images/examples_notebooks_generated_statespace_tvpvar_mcmc_cfa_9_0.png"/>
</div>
</div>
</section>
<section id="Updating-the-model’s-parameters">
<h3 id="Updating-the-model’s-parameters">Updating the model’s parameters<a class="headerlink" href="#Updating-the-model’s-parameters" title="Permalink to this heading">¶</a></h3>
<p>The simulation smoothers are tied to the model instance, here the variable <code class="docutils literal notranslate"><span class="pre">mod</span></code>. Whenever the model instance is updated with new parameters, the simulation smoothers will take those new parameters into account in future calls to the <code class="docutils literal notranslate"><span class="pre">simulate</span></code> method.</p>
<p>This is convenient for MCMC algorithms, which repeatedly (a) update the model’s parameters, (b) draw a sample of the state vector, and then (c) draw new values for the model’s parameters.</p>
<p>Here we will change the model to a different parameterization that yields a smoother trend, and show how the simulated values change (for brevity we only show the simulations from the KFS approach, but simulations from the CFA approach would be the same).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="c1"># Update the model's parameterization to one that attributes more</span>
<span class="c1"># variation in inflation to the observation error and so has less</span>
<span class="c1"># variation in the trend component</span>
<span class="n">mod</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">])</span>

<span class="c1"># Plot simulations</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsimulations</span><span class="p">):</span>
    <span class="n">sim_kfs</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">sim_kfs</span><span class="o">.</span><span class="n">simulated_state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">'C0'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Simulated state'</span><span class="p">)</span>

<span class="c1"># Plot data</span>
<span class="n">dta</span><span class="o">.</span><span class="n">infl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Data'</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Add title, legend, clean up layout</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Simulations with alternative parameterization yielding a smoother trend'</span><span class="p">)</span>
<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span> <span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/examples_notebooks_generated_statespace_tvpvar_mcmc_cfa_11_0.png" src="../../../_images/examples_notebooks_generated_statespace_tvpvar_mcmc_cfa_11_0.png"/>
</div>
</div>
</section>
</section>
<section id="Application:-Bayesian-analysis-of-a-TVP-VAR-model-by-MCMC">
<h2 id="Application:-Bayesian-analysis-of-a-TVP-VAR-model-by-MCMC">Application: Bayesian analysis of a TVP-VAR model by MCMC<a class="headerlink" href="#Application:-Bayesian-analysis-of-a-TVP-VAR-model-by-MCMC" title="Permalink to this heading">¶</a></h2>
<p>One of the applications that Chan and Jeliazkov (2009) consider is the time-varying parameters vector autoregression (TVP-VAR) model, estimated with Bayesian Gibb sampling (MCMC) methods. They apply this to model the co-movements in four macroeconomic time series:</p>
<ul class="simple">
<li><p>Real GDP growth</p></li>
<li><p>Inflation</p></li>
<li><p>Unemployment rate</p></li>
<li><p>Short-term interest rates</p></li>
</ul>
<p>We will replicate their example, using a very similar dataset that is included in Statsmodels.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Subset to the four variables of interest</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">dta</span><span class="p">[[</span><span class="s1">'realgdp'</span><span class="p">,</span> <span class="s1">'cpi'</span><span class="p">,</span> <span class="s1">'unemp'</span><span class="p">,</span> <span class="s1">'tbilrate'</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">y</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'gdp'</span><span class="p">,</span> <span class="s1">'inf'</span><span class="p">,</span> <span class="s1">'unemp'</span><span class="p">,</span> <span class="s1">'int'</span><span class="p">]</span>

<span class="c1"># Convert to real GDP growth and CPI inflation rates</span>
<span class="n">y</span><span class="p">[[</span><span class="s1">'gdp'</span><span class="p">,</span> <span class="s1">'inf'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">y</span><span class="p">[[</span><span class="s1">'gdp'</span><span class="p">,</span> <span class="s1">'inf'</span><span class="p">]])</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">y</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Evolution of macroeconomic variables included in TVP-VAR exercise'</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/examples_notebooks_generated_statespace_tvpvar_mcmc_cfa_13_0.png" src="../../../_images/examples_notebooks_generated_statespace_tvpvar_mcmc_cfa_13_0.png"/>
</div>
</div>
<section id="TVP-VAR-model">
<h3 id="TVP-VAR-model">TVP-VAR model<a class="headerlink" href="#TVP-VAR-model" title="Permalink to this heading">¶</a></h3>
<p><strong>Note</strong>: this section is based on Chan and Jeliazkov (2009) section 3.1, which can be consulted for additional details.</p>
<p>The usual (time-invariant) VAR(1) model is typically written:</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
y_t &amp; = \mu + \Phi y_{t-1} + \varepsilon_t, \qquad \varepsilon_t \sim N(0, H)
\end{aligned}\]</div>
<p>where <span class="math notranslate nohighlight">\(y_t\)</span> is a <span class="math notranslate nohighlight">\(p \times 1\)</span> vector of variables observed at time <span class="math notranslate nohighlight">\(t\)</span> and <span class="math notranslate nohighlight">\(H\)</span> is a covariance matrix.</p>
<p>The TVP-VAR(1) model generalizes this to allow the coefficients to vary over time according. Stacking all the parameters into a vector according to <span class="math notranslate nohighlight">\(\alpha_t = \text{vec}([\mu_t : \Phi_t])\)</span>, where <span class="math notranslate nohighlight">\(\text{vec}\)</span> denotes the operation that stacks columns of a matrix into a vector, we model their evolution over time according to:</p>
<div class="math notranslate nohighlight">
\[\alpha_{i,t+1} = \alpha_{i, t} + \eta_{i,t}, \qquad \eta_{i, t} \sim N(0, \sigma_i^2)\]</div>
<p>In other words, each parameter evolves independently according to a random walk.</p>
<p>Note that there are <span class="math notranslate nohighlight">\(p\)</span> coefficients in <span class="math notranslate nohighlight">\(\mu_t\)</span> and <span class="math notranslate nohighlight">\(p^2\)</span> coefficients in <span class="math notranslate nohighlight">\(\Phi_t\)</span>, so the full state vector <span class="math notranslate nohighlight">\(\alpha\)</span> is shaped <span class="math notranslate nohighlight">\(p * (p + 1) \times 1\)</span>.</p>
<p>Putting the TVP-VAR(1) model into state-space form is relatively straightforward, and in fact we just have to re-write the observation equation into SUR form:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
y_t &amp; = Z_t \alpha_t + \varepsilon_t, \qquad \varepsilon_t \sim N(0, H) \\
\alpha_{t+1} &amp; = \alpha_t + \eta_t, \qquad \eta_t \sim N(0, \text{diag}(\{\sigma_i^2\}))
\end{aligned}\end{split}\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}Z_t = \begin{bmatrix}
1 &amp; y_{t-1}' &amp; 0 &amp; \dots &amp; &amp;  0 \\
0 &amp; 0 &amp; 1 &amp; y_{t-1}' &amp;  &amp; 0 \\
\vdots &amp; &amp; &amp; \ddots &amp; \ddots &amp; \vdots \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; y_{t-1}'  \\
\end{bmatrix}\end{split}\]</div>
<p>As long as <span class="math notranslate nohighlight">\(H\)</span> is full rank and each of the variances <span class="math notranslate nohighlight">\(\sigma_i^2\)</span> is non-zero, the model satisfies the requirements of the CFA simulation smoother.</p>
<p>We also need to specify the initialization / prior for the initial state, <span class="math notranslate nohighlight">\(\alpha_1\)</span>. Here we will follow Chan and Jeliazkov (2009) in using <span class="math notranslate nohighlight">\(\alpha_1 \sim N(0, 5 I)\)</span>, although we could also model it as diffuse.</p>
<p>Aside from the time-varying coefficients <span class="math notranslate nohighlight">\(\alpha_t\)</span>, the other parameters that we will need to estimate are terms in the covariance matrix <span class="math notranslate nohighlight">\(H\)</span> and the random walk variances <span class="math notranslate nohighlight">\(\sigma_i^2\)</span>.</p>
</section>
<section id="TVP-VAR-model-in-Statsmodels">
<h3 id="TVP-VAR-model-in-Statsmodels">TVP-VAR model in Statsmodels<a class="headerlink" href="#TVP-VAR-model-in-Statsmodels" title="Permalink to this heading">¶</a></h3>
<p>Constructing this model programatically in Statsmodels is also relatively straightforward, since there are basically four steps:</p>
<ol class="arabic simple">
<li><p>Create a new <code class="docutils literal notranslate"><span class="pre">TVPVAR</span></code> class as a subclass of <code class="docutils literal notranslate"><span class="pre">sm.tsa.statespace.MLEModel</span></code></p></li>
<li><p>Fill in the fixed values of the state space system matrices</p></li>
<li><p>Specify the initialization of <span class="math notranslate nohighlight">\(\alpha_1\)</span></p></li>
<li><p>Create a method for updating the state space system matrices with new values of the covariance matrix <span class="math notranslate nohighlight">\(H\)</span> and the random walk variances <span class="math notranslate nohighlight">\(\sigma_i^2\)</span>.</p></li>
</ol>
<p>To do this, first note that the general state space representation used by Statsmodels is:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
y_t &amp; = d_t + Z_t \alpha_t + \varepsilon_t, \qquad \varepsilon_t \sim N(0, H_t) \\
\alpha_{t+1} &amp; = c_t + T_t \alpha_t + R_t \eta_t, \qquad \eta_t \sim N(0, Q_t) \\
\end{aligned}\end{split}\]</div>
<p>Then the TVP-VAR(1) model implies the following specializations:</p>
<ul class="simple">
<li><p>The intercept terms are zero, i.e. <span class="math notranslate nohighlight">\(c_t = d_t = 0\)</span></p></li>
<li><p>The design matrix <span class="math notranslate nohighlight">\(Z_t\)</span> is time-varying but its values are fixed as described above (i.e. its values contain ones and lags of <span class="math notranslate nohighlight">\(y_t\)</span>)</p></li>
<li><p>The observation covariance matrix is not time-varying, i.e. <span class="math notranslate nohighlight">\(H_t = H_{t+1} = H\)</span></p></li>
<li><p>The transition matrix is not time-varying and is equal to the identity matrix, i.e. <span class="math notranslate nohighlight">\(T_t = T_{t+1} = I\)</span></p></li>
<li><p>The selection matrix <span class="math notranslate nohighlight">\(R_t\)</span> is not time-varying and is also equal to the identity matrix, i.e. <span class="math notranslate nohighlight">\(R_t = R_{t+1} = I\)</span></p></li>
<li><p>The state covariance matrix <span class="math notranslate nohighlight">\(Q_t\)</span> is not time-varying and is diagonal, i.e. <span class="math notranslate nohighlight">\(Q_t = Q_{t+1} = \text{diag}(\{\sigma_i^2\})\)</span></p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Create a new TVPVAR class as a subclass of sm.tsa.statespace.MLEModel</span>
<span class="k">class</span> <span class="nc">TVPVAR</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">statespace</span><span class="o">.</span><span class="n">MLEModel</span><span class="p">):</span>
    <span class="c1"># Steps 2-3 are best done in the class "constructor", i.e. the __init__ method</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="c1"># Create a matrix with [y_t' : y_{t-1}'] for t = 2, ..., T</span>
        <span class="n">augmented</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">lagmat</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="s1">'both'</span><span class="p">,</span> <span class="n">original</span><span class="o">=</span><span class="s1">'in'</span><span class="p">,</span> <span class="n">use_pandas</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Separate into y_t and z_t = [1 : y_{t-1}']</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">y_t</span> <span class="o">=</span> <span class="n">augmented</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="n">p</span><span class="p">]</span>
        <span class="n">z_t</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">augmented</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">p</span><span class="p">:])</span>

        <span class="c1"># Recall that the length of the state vector is p * (p + 1)</span>
        <span class="n">k_states</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">y_t</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="n">z_t</span><span class="p">,</span> <span class="n">k_states</span><span class="o">=</span><span class="n">k_states</span><span class="p">)</span>

        <span class="c1"># Note that the state space system matrices default to contain zeros,</span>
        <span class="c1"># so we don't need to explicitly set c_t = d_t = 0.</span>

        <span class="c1"># Construct the design matrix Z_t</span>
        <span class="c1"># Notes:</span>
        <span class="c1"># -&gt; self.k_endog = p is the dimension of the observed vector</span>
        <span class="c1"># -&gt; self.k_states = p * (p + 1) is the dimension of the observed vector</span>
        <span class="c1"># -&gt; self.nobs = T is the number of observations in y_t</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">'design'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">k_endog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_states</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nobs</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_endog</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_endog</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_endog</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">'design'</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">z_t</span><span class="o">.</span><span class="n">T</span>

        <span class="c1"># Construct the transition matrix T = I</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">'transition'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">k_states</span><span class="p">)</span>

        <span class="c1"># Construct the selection matrix R = I</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">'selection'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">k_states</span><span class="p">)</span>

        <span class="c1"># Step 3: Initialize the state vector as alpha_1 ~ N(0, 5I)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssm</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="s1">'known'</span><span class="p">,</span> <span class="n">stationary_cov</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_states</span><span class="p">))</span>

    <span class="c1"># Step 4. Create a method that we can call to update H and Q</span>
    <span class="k">def</span> <span class="nf">update_variances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs_cov</span><span class="p">,</span> <span class="n">state_cov_diag</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">'obs_cov'</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs_cov</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">'state_cov'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">state_cov_diag</span><span class="p">)</span>

    <span class="c1"># Finally, it can be convenient to define human-readable names for</span>
    <span class="c1"># each element of the state vector. These will be available in output</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">state_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">state_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">k_endog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_endog</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_endog</span><span class="p">):</span>
            <span class="n">endog_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">state_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">[</span><span class="s1">'intercept.</span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="n">endog_name</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">[</span><span class="s1">'L1.</span><span class="si">%s</span><span class="s1">-&gt;</span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">other_name</span><span class="p">,</span> <span class="n">endog_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">other_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog_names</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">state_names</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>The above class defined the state space model for any given dataset. Now we need to create a specific instance of it with the dataset that we created earlier containing real GDP growth, inflation, unemployment, and interest rates.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an instance of our TVPVAR class with our observed dataset y</span>
<span class="n">mod</span> <span class="o">=</span> <span class="n">TVPVAR</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Preliminary-investigation-with-ad-hoc-parameters-in-H,-Q">
<h3 id="Preliminary-investigation-with-ad-hoc-parameters-in-H,-Q">Preliminary investigation with ad-hoc parameters in H, Q<a class="headerlink" href="#Preliminary-investigation-with-ad-hoc-parameters-in-H,-Q" title="Permalink to this heading">¶</a></h3>
<p>In our analysis below, we will need to begin our MCMC iterations with some initial parameterization. Following Chan and Jeliazkov (2009) we will set <span class="math notranslate nohighlight">\(H\)</span> to be the sample covariance matrix of our dataset, and we will set <span class="math notranslate nohighlight">\(\sigma_i^2 = 0.01\)</span> for each <span class="math notranslate nohighlight">\(i\)</span>.</p>
<p>Before discussing the MCMC scheme that will allow us to make inferences about the model, first we can consider the output of the model when simply plugging in these initial parameters. To fill in these parameters, we use the <code class="docutils literal notranslate"><span class="pre">update_variances</span></code> method that we defined earlier and then perform Kalman filtering and smoothing conditional on those parameters.</p>
<p><strong>Warning: This exercise is just by way of explanation - we must wait for the output of the MCMC exercise to study the actual implications of the model in a meaningful way</strong>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">initial_obs_cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">initial_state_cov_diag</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">]</span> <span class="o">*</span> <span class="n">mod</span><span class="o">.</span><span class="n">k_states</span>

<span class="c1"># Update H and Q</span>
<span class="n">mod</span><span class="o">.</span><span class="n">update_variances</span><span class="p">(</span><span class="n">initial_obs_cov</span><span class="p">,</span> <span class="n">initial_state_cov_diag</span><span class="p">)</span>

<span class="c1"># Perform Kalman filtering and smoothing</span>
<span class="c1"># (the [] is just an empty list that in some models might contain</span>
<span class="c1"># additional parameters. Here, we don't have any additional parameters</span>
<span class="c1"># so we just pass an empty list)</span>
<span class="n">initial_res</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">smooth</span><span class="p">([])</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">initial_res</span></code> variable contains the output of Kalman filtering and smoothing, conditional on those initial parameters. In particular, we may be interested in the “smoothed states”, which are <span class="math notranslate nohighlight">\(E[\alpha_t \mid y^t, H, \{\sigma_i^2\}]\)</span>.</p>
<p>First, lets create a function that graphs the coefficients over time, separated into the equations for equation of the observed variables.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_coefficients_by_equation</span><span class="p">(</span><span class="n">states</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

    <span class="c1"># The way we defined Z_t implies that the first 5 elements of the</span>
    <span class="c1"># state vector correspond to the first variable in y_t, which is GDP growth</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">states</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'GDP growth'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># The next 5 elements correspond to inflation</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">states</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Inflation rate'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>

    <span class="c1"># The next 5 elements correspond to unemployment</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">states</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">10</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Unemployment equation'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># The last 5 elements correspond to the interest rate</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">states</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">15</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Interest rate equation'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>

    <span class="k">return</span> <span class="n">ax</span>
<br/></pre></div>
</div>
</div>
<p>Now, we are interested in the smoothed states, which are available in the <code class="docutils literal notranslate"><span class="pre">states.smoothed</span></code> attribute out our results object <code class="docutils literal notranslate"><span class="pre">initial_res</span></code>.</p>
<p>As the graph below shows, the initial parameterization implies substantial time-variation in some of the coefficients.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Here, for illustration purposes only, we plot the time-varying</span>
<span class="c1"># coefficients conditional on an ad-hoc parameterization</span>

<span class="c1"># Recall that `initial_res` contains the Kalman filtering and smoothing,</span>
<span class="c1"># and the `states.smoothed` attribute contains the smoothed states</span>
<span class="n">plot_coefficients_by_equation</span><span class="p">(</span><span class="n">initial_res</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">smoothed</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/examples_notebooks_generated_statespace_tvpvar_mcmc_cfa_27_0.png" src="../../../_images/examples_notebooks_generated_statespace_tvpvar_mcmc_cfa_27_0.png"/>
</div>
</div>
</section>
<section id="Bayesian-estimation-via-MCMC">
<h3 id="Bayesian-estimation-via-MCMC">Bayesian estimation via MCMC<a class="headerlink" href="#Bayesian-estimation-via-MCMC" title="Permalink to this heading">¶</a></h3>
<p>We will now implement the Gibbs sampler scheme described in Chan and Jeliazkov (2009), Algorithm 2.</p>
<p>We use the following (conditionally conjugate) priors:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
H &amp; \sim \mathcal{IW}(\nu_1^0, S_1^0) \\
\sigma_i^2 &amp; \sim \mathcal{IG} \left ( \frac{\nu_{i2}^0}{2}, \frac{S_{i2}^0}{2} \right )
\end{aligned}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathcal{IW}\)</span> denotes the inverse-Wishart distribution and <span class="math notranslate nohighlight">\(\mathcal{IG}\)</span> denotes the inverse-Gamma distribution. We set the prior hyperparameters as:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
v_1^0 = T + 3, &amp; \quad S_1^0 = I \\
v_{i2}^0 = 6, &amp; \quad S_{i2}^0 = 0.01 \qquad \text{for each} ~ i\\
\end{aligned}\end{split}\]</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prior hyperparameters</span>

<span class="c1"># Prior for obs. cov. is inverse-Wishart(v_1^0=k + 3, S10=I)</span>
<span class="n">v10</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">k_endog</span> <span class="o">+</span> <span class="mi">3</span>
<span class="n">S10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">k_endog</span><span class="p">)</span>

<span class="c1"># Prior for state cov. variances is inverse-Gamma(v_{i2}^0 / 2 = 3, S+{i2}^0 / 2 = 0.005)</span>
<span class="n">vi20</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">Si20</span> <span class="o">=</span> <span class="mf">0.01</span>
</pre></div>
</div>
</div>
<p>Before running the MCMC iterations, there are a couple of practical steps:</p>
<ol class="arabic simple">
<li><p>Create arrays to store the draws of our state vector, observation covariance matrix, and state error variances.</p></li>
<li><p>Put the initial values for H and Q (described above) into the storage vectors</p></li>
<li><p>Construct the simulation smoother object associated with our <code class="docutils literal notranslate"><span class="pre">TVPVAR</span></code> instance to make draws of the state vector</p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Gibbs sampler setup</span>
<span class="n">niter</span> <span class="o">=</span> <span class="mi">11000</span>
<span class="n">nburn</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># 1. Create storage arrays</span>
<span class="n">store_states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">niter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mod</span><span class="o">.</span><span class="n">nobs</span><span class="p">,</span> <span class="n">mod</span><span class="o">.</span><span class="n">k_states</span><span class="p">))</span>
<span class="n">store_obs_cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">niter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mod</span><span class="o">.</span><span class="n">k_endog</span><span class="p">,</span> <span class="n">mod</span><span class="o">.</span><span class="n">k_endog</span><span class="p">))</span>
<span class="n">store_state_cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">niter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mod</span><span class="o">.</span><span class="n">k_states</span><span class="p">))</span>

<span class="c1"># 2. Put in the initial values</span>
<span class="n">store_obs_cov</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial_obs_cov</span>
<span class="n">store_state_cov</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial_state_cov_diag</span>
<span class="n">mod</span><span class="o">.</span><span class="n">update_variances</span><span class="p">(</span><span class="n">store_obs_cov</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">store_state_cov</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># 3. Construct posterior samplers</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">simulation_smoother</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">'cfa'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>As before, we could have used either the simulation smoother based on the Kalman filter and smoother or that based on the Cholesky Factor Algorithm.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">niter</span><span class="p">):</span>
    <span class="n">mod</span><span class="o">.</span><span class="n">update_variances</span><span class="p">(</span><span class="n">store_obs_cov</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">store_state_cov</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>

    <span class="c1"># 1. Sample states</span>
    <span class="n">store_states</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">simulated_state</span><span class="o">.</span><span class="n">T</span>

    <span class="c1"># 2. Simulate obs cov</span>
    <span class="n">fitted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">mod</span><span class="p">[</span><span class="s1">'design'</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">store_states</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">])[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">resid</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">endog</span> <span class="o">-</span> <span class="n">fitted</span>
    <span class="n">store_obs_cov</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">invwishart</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">v10</span> <span class="o">+</span> <span class="n">mod</span><span class="o">.</span><span class="n">nobs</span><span class="p">,</span> <span class="n">S10</span> <span class="o">+</span> <span class="n">resid</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">resid</span><span class="p">)</span>

    <span class="c1"># 3. Simulate state cov variances</span>
    <span class="n">resid</span> <span class="o">=</span> <span class="n">store_states</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">store_states</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">sse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">resid</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">k_states</span><span class="p">):</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="n">invgamma</span><span class="o">.</span><span class="n">rvs</span><span class="p">((</span><span class="n">vi20</span> <span class="o">+</span> <span class="n">mod</span><span class="o">.</span><span class="n">nobs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="p">(</span><span class="n">Si20</span> <span class="o">+</span> <span class="n">sse</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">store_state_cov</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">rv</span>
</pre></div>
</div>
</div>
<p>After removing a number of initial draws, the remaining draws from the posterior allow us to conduct inference. Below, we plot the posterior mean of the time-varying regression coefficients.</p>
<p>(<strong>Note</strong>: these plots are different from those in Figure 1 of the published version of Chan and Jeliazkov (2009), but they are very similar to those produced by the Matlab replication code available at <a class="reference external" href="http://joshuachan.org/code/code_TVPVAR.html">http://joshuachan.org/code/code_TVPVAR.html</a>)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Collect the posterior means of each time-varying coefficient</span>
<span class="n">states_posterior_mean</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">store_states</span><span class="p">[</span><span class="n">nburn</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">mod</span><span class="o">.</span><span class="n">_index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">mod</span><span class="o">.</span><span class="n">state_names</span><span class="p">)</span>

<span class="c1"># Plot these means over time</span>
<span class="n">plot_coefficients_by_equation</span><span class="p">(</span><span class="n">states_posterior_mean</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/examples_notebooks_generated_statespace_tvpvar_mcmc_cfa_35_0.png" src="../../../_images/examples_notebooks_generated_statespace_tvpvar_mcmc_cfa_35_0.png"/>
</div>
</div>
<p>Python also has a number of libraries to assist with exploring Bayesian models. Here we’ll just use the <a class="reference external" href="https://arviz-devs.github.io/arviz/index.html">arviz</a> package to explore the credible intervals of each of the covariance and variance parameters, although it makes available a much wider set of tools for analysis.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">arviz</span> <span class="k">as</span> <span class="nn">az</span>

<span class="c1"># Collect the observation error covariance parameters</span>
<span class="n">az_obs_cov</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">convert_to_inference_data</span><span class="p">({</span>
    <span class="p">(</span><span class="s1">'Var[</span><span class="si">%s</span><span class="s1">]'</span> <span class="o">%</span> <span class="n">mod</span><span class="o">.</span><span class="n">endog_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span> <span class="k">else</span>
     <span class="s1">'Cov[</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">]'</span> <span class="o">%</span> <span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">endog_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mod</span><span class="o">.</span><span class="n">endog_names</span><span class="p">[</span><span class="n">j</span><span class="p">])):</span>
    <span class="n">store_obs_cov</span><span class="p">[</span><span class="n">nburn</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">k_endog</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">mod</span><span class="o">.</span><span class="n">k_endog</span><span class="p">)})</span>

<span class="c1"># Plot the credible intervals</span>
<span class="n">az</span><span class="o">.</span><span class="n">plot_forest</span><span class="p">(</span><span class="n">az_obs_cov</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/examples_notebooks_generated_statespace_tvpvar_mcmc_cfa_37_0.png" src="../../../_images/examples_notebooks_generated_statespace_tvpvar_mcmc_cfa_37_0.png"/>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Collect the state innovation variance parameters</span>
<span class="n">az_state_cov</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">convert_to_inference_data</span><span class="p">({</span>
    <span class="sa">r</span><span class="s1">'$\sigma^2$[</span><span class="si">%s</span><span class="s1">]'</span> <span class="o">%</span> <span class="n">mod</span><span class="o">.</span><span class="n">state_names</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">store_state_cov</span><span class="p">[</span><span class="n">nburn</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">k_states</span><span class="p">)})</span>

<span class="c1"># Plot the credible intervals</span>
<span class="n">az</span><span class="o">.</span><span class="n">plot_forest</span><span class="p">(</span><span class="n">az_state_cov</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/examples_notebooks_generated_statespace_tvpvar_mcmc_cfa_38_0.png" src="../../../_images/examples_notebooks_generated_statespace_tvpvar_mcmc_cfa_38_0.png"/>
</div>
</div>
</section>
</section>
<section id="Appendix:-performance">
<h2 id="Appendix:-performance">Appendix: performance<a class="headerlink" href="#Appendix:-performance" title="Permalink to this heading">¶</a></h2>
<p>Finally, we run a few simple tests to compare the performance of the KFS and CFA simulation smoothers by using the <code class="docutils literal notranslate"><span class="pre">%timeit</span></code> Jupyter notebook magic.</p>
<p>One caveat is that the KFS simulation smoother can produce a variety of output beyond just simulations of the posterior state vector, and these additional computations could bias the results. To make the results comparable, we will tell the KFS simulation smoother to only compute simulations of the state by using the <code class="docutils literal notranslate"><span class="pre">simulation_output</span></code> argument.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.tsa.statespace.simulation_smoother</span> <span class="kn">import</span> <span class="n">SIMULATION_STATE</span>

<span class="n">sim_cfa</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">simulation_smoother</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">'cfa'</span><span class="p">)</span>
<span class="n">sim_kfs</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">simulation_smoother</span><span class="p">(</span><span class="n">simulation_output</span><span class="o">=</span><span class="n">SIMULATION_STATE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Then we can use the following code to perform a basic timing exercise:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">timeit</span> <span class="o">-</span><span class="n">n</span> <span class="mi">10000</span> <span class="o">-</span><span class="n">r</span> <span class="mi">3</span> <span class="n">sim_cfa</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>
<span class="o">%</span><span class="n">timeit</span> <span class="o">-</span><span class="n">n</span> <span class="mi">10000</span> <span class="o">-</span><span class="n">r</span> <span class="mi">3</span> <span class="n">sim_kfs</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>
</pre></div>
</div>
<p>On the machine this was tested on, this resulted in the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>2.06 ms ± 26.5 µs per loop (mean ± std. dev. of 3 runs, 10000 loops each)
2.02 ms ± 68.4 µs per loop (mean ± std. dev. of 3 runs, 10000 loops each)
</pre></div>
</div>
<p>These results suggest that - at least for this model - there are not noticeable computational gains from the CFA approach relative to the KFS approach. However, this does not rule out the following:</p>
<ol class="arabic simple">
<li><p>The Statsmodels implementation of the CFA simulation smoother could possibly be further optimized</p></li>
<li><p>The CFA approach may only show improvement for certain models (for example with a large number of <code class="docutils literal notranslate"><span class="pre">endog</span></code> variables)</p></li>
</ol>
<p>One simple way to take a first pass at assessing the first possibility is to compare the runtime of the Statsmodels implementation of the CFA simulation smoother to the Matlab implementation in the replication codes of Chan and Jeliazkov (2009), available at <a class="reference external" href="http://joshuachan.org/code/code_TVPVAR.html">http://joshuachan.org/code/code_TVPVAR.html</a>.</p>
<p>While the Statsmodels version of the CFA simulation smoother is written in Cython and compiled to C code, the Matlab version takes advantage of the Matlab’s sparse matrix capabilities. As a result, even though it is not compiled code, we might expect it to have relatively good performance.</p>
<p>On the machine this was tested on, the Matlab version typically ran the MCMC loop with 11,000 iterations in 70-75 seconds, while the MCMC loop in this notebook using the Statsmodels CFA simulation smoother (see above), also with 11,0000 iterations, ran in 40-45 seconds. This is some evidence that the Statsmodels implementation of the CFA smoother already performs relatively well (although it does not rule out that there are additional gains possible).</p>
</section>
<section id="Bibliography">
<h2 id="Bibliography">Bibliography<a class="headerlink" href="#Bibliography" title="Permalink to this heading">¶</a></h2>
<p>Carter, Chris K., and Robert Kohn. “On Gibbs sampling for state space models.” Biometrika 81, no. 3 (1994): 541-553.</p>
<p>Chan, Joshua CC, and Ivan Jeliazkov. “Efficient simulation and integrated likelihood estimation in state space models.” International Journal of Mathematical Modelling and Numerical Optimisation 1, no. 1-2 (2009): 101-120.</p>
<p>De Jong, Piet, and Neil Shephard. “The simulation smoother for time series models.” Biometrika 82, no. 2 (1995): 339-350.</p>
<p>Durbin, James, and Siem Jan Koopman. “A simple and efficient simulation smoother for state space time series analysis.” Biometrika 89, no. 3 (2002): 603-616.</p>
<p>McCausland, William J., Shirley Miller, and Denis Pelletier. “Simulation smoothing for state–space models: A computational efficiency analysis.” Computational Statistics &amp; Data Analysis 55, no. 1 (2011): 199-212.</p>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="statespace_fixed_params.html" title="Estimating or specifying parameters in state space models"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Estimating or specifying parameters in state space models </span>
              </div>
            </a>
          
          
            <a href="statespace_sarimax_pymc3.html" title="Fast Bayesian estimation of SARIMAX models"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Fast Bayesian estimation of SARIMAX models </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2009-2019, Josef Perktold, Skipper Seabold, Jonathan Taylor, statsmodels-developers.
              
          </div>
            Last updated on
              Nov 02, 2022.
            <br/>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../../../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>