

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../../../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../../../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../../../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../../../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../../../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>Dynamic factors and coincident indices &#8212; statsmodels</title>
  <link rel="icon" type="image/png" sizes="32x32" href="../../../_static/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../../../_static/icons/favicon-16x16.png">
  <link rel="manifest" href="../../../_static/icons/site.webmanifest">
  <link rel="mask-icon" href="../../../_static/icons/safari-pinned-tab.svg" color="#919191">
  <meta name="msapplication-TileColor" content="#2b5797">
  <meta name="msapplication-config" content="../../../_static/icons/browserconfig.xml">
  <link rel="stylesheet" href="../../../_static/stylesheets/examples.css">
    <link rel="stylesheet" href="../../../_static/material.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Detrending, Stylized Facts and the Business Cycle" href="statespace_structural_harvey_jaeger.html" />
    <link rel="prev" title="VARMAX models" href="statespace_varmax.html" />
  
   
  
  <script src="../../../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../../../_static/versions.json",
        target_loc = "../../../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>


  </head>
  <body dir=ltr
        data-md-color-primary=indigo data-md-color-accent=blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#examples/notebooks/generated/statespace_dfm_coincident" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../../index.html" title="statsmodels"
           class="md-header-nav__button md-logo">
          
              <img src="../../../_static/statsmodels-logo-v2-bw.svg" height="26"
                   alt="statsmodels logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">statsmodels v0.11.1</span>
          <span class="md-header-nav__topic"> Dynamic factors and coincident indices </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../../../search.html" method="GET" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/statsmodels/statsmodels" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    statsmodels
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../../index.html" class="md-tabs__link">Examples</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../../index.html" title="statsmodels" class="md-nav__button md-logo">
      
        <img src="../../../_static/statsmodels-logo-v2-bw.svg" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../../../index.html"
       title="statsmodels">statsmodels v0.11.1</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/statsmodels/statsmodels" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    statsmodels
  </div>
</a>
    </div>
  
  

  
  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
      <a href="../../../install.html" class="md-nav__link">Installing statsmodels</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../../gettingstarted.html" class="md-nav__link">Getting started</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../../user-guide.html" class="md-nav__link">User Guide</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html" class="md-nav__link">Examples</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
      <a href="../../index.html#linear-regression-models" class="md-nav__link">Linear Regression Models</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html#plotting" class="md-nav__link">Plotting</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html#discrete-choice-models" class="md-nav__link">Discrete Choice Models</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html#nonparametric-statistics" class="md-nav__link">Nonparametric Statistics</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html#generalized-linear-models" class="md-nav__link">Generalized Linear Models</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html#robust-regression" class="md-nav__link">Robust Regression</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html#generalized-estimating-equations" class="md-nav__link">Generalized Estimating Equations</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html#statistics" class="md-nav__link">Statistics</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html#time-series-analysis" class="md-nav__link">Time Series Analysis</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html#state-space-models" class="md-nav__link">State space models</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
      <a href="statespace_sarimax_stata.html" class="md-nav__link">SARIMAX: Introduction</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="statespace_sarimax_internet.html" class="md-nav__link">SARIMAX: Model selection, missing data</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="statespace_varmax.html" class="md-nav__link">VARMAX models</a>
      
    </li>
    <li class="md-nav__item">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Dynamic factors and coincident indices </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Dynamic factors and coincident indices</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#examples-notebooks-generated-statespace-dfm-coincident--page-root" class="md-nav__link">Dynamic factors and coincident indices</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Macroeconomic-data" class="md-nav__link">Macroeconomic data</a>
        </li>
        <li class="md-nav__item"><a href="#Dynamic-factors" class="md-nav__link">Dynamic factors</a>
        </li>
        <li class="md-nav__item"><a href="#Model-specification" class="md-nav__link">Model specification</a>
        </li>
        <li class="md-nav__item"><a href="#Parameter-estimation" class="md-nav__link">Parameter estimation</a>
        </li>
        <li class="md-nav__item"><a href="#Estimates" class="md-nav__link">Estimates</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Parameters" class="md-nav__link">Parameters</a>
        </li>
        <li class="md-nav__item"><a href="#Estimated-factors" class="md-nav__link">Estimated factors</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Post-estimation" class="md-nav__link">Post-estimation</a>
        </li>
        <li class="md-nav__item"><a href="#Coincident-Index" class="md-nav__link">Coincident Index</a>
        </li>
        <li class="md-nav__item"><a href="#Appendix-1:-Extending-the-dynamic-factor-model" class="md-nav__link">Appendix 1: Extending the dynamic factor model</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../../../_sources/examples/notebooks/generated/statespace_dfm_coincident.ipynb.txt">Show Source</a> </li>

  </ul>
</nav>
    </li>
    <li class="md-nav__item">
    
      <a href="statespace_structural_harvey_jaeger.html" class="md-nav__link">Detrending, Stylized Facts and the Business Cycle</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="statespace_cycles.html" class="md-nav__link">Trends and cycles in unemployment</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="statespace_local_linear_trend.html" class="md-nav__link">State space modeling: Local Linear Trends</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="statespace_arma_0.html" class="md-nav__link">Autoregressive Moving Average (ARMA): Sunspots data</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="statespace_seasonal.html" class="md-nav__link">Seasonality in time series data</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="statespace_fixed_params.html" class="md-nav__link">Estimating or specifying parameters in state space models</a>
      
    </li></ul>
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html#state-space-models-technical-notes" class="md-nav__link">State space models - Technical notes</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html#multivariate-methods" class="md-nav__link">Multivariate Methods</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html#user-notes" class="md-nav__link">User Notes</a>
      
    </li></ul>
    </li>
    <li class="md-nav__item">
    
      <a href="../../../api.html" class="md-nav__link">API Reference</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../../about.html" class="md-nav__link">About statsmodels</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../../dev/index.html" class="md-nav__link">Developer Page</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../../release/index.html" class="md-nav__link">Release Notes</a>
      
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#examples-notebooks-generated-statespace-dfm-coincident--page-root" class="md-nav__link">Dynamic factors and coincident indices</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Macroeconomic-data" class="md-nav__link">Macroeconomic data</a>
        </li>
        <li class="md-nav__item"><a href="#Dynamic-factors" class="md-nav__link">Dynamic factors</a>
        </li>
        <li class="md-nav__item"><a href="#Model-specification" class="md-nav__link">Model specification</a>
        </li>
        <li class="md-nav__item"><a href="#Parameter-estimation" class="md-nav__link">Parameter estimation</a>
        </li>
        <li class="md-nav__item"><a href="#Estimates" class="md-nav__link">Estimates</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Parameters" class="md-nav__link">Parameters</a>
        </li>
        <li class="md-nav__item"><a href="#Estimated-factors" class="md-nav__link">Estimated factors</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Post-estimation" class="md-nav__link">Post-estimation</a>
        </li>
        <li class="md-nav__item"><a href="#Coincident-Index" class="md-nav__link">Coincident Index</a>
        </li>
        <li class="md-nav__item"><a href="#Appendix-1:-Extending-the-dynamic-factor-model" class="md-nav__link">Appendix 1: Extending the dynamic factor model</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../../../_sources/examples/notebooks/generated/statespace_dfm_coincident.ipynb.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5.5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>

<h1 id="examples-notebooks-generated-statespace-dfm-coincident--page-root">Dynamic factors and coincident indices<a class="headerlink" href="#examples-notebooks-generated-statespace-dfm-coincident--page-root" title="Permalink to this headline">¶</a></h1>
<p>Factor models generally try to find a small number of unobserved “factors” that influence a substantial portion of the variation in a larger number of observed variables, and they are related to dimension-reduction techniques such as principal components analysis. Dynamic factor models explicitly model the transition dynamics of the unobserved factors, and so are often applied to time-series data.</p>
<p>Macroeconomic coincident indices are designed to capture the common component of the “business cycle”; such a component is assumed to simultaneously affect many macroeconomic variables. Although the estimation and use of coincident indices (for example the <a class="reference external" href="http://www.newyorkfed.org/research/regional_economy/coincident_summary.html">Index of Coincident Economic Indicators</a>) pre-dates dynamic factor models, in several influential papers Stock and Watson (1989, 1991) used a dynamic factor model
to provide a theoretical foundation for them.</p>
<p>Below, we follow the treatment found in Kim and Nelson (1999), of the Stock and Watson (1991) model, to formulate a dynamic factor model, estimate its parameters via maximum likelihood, and create a coincident index.</p>

<h2 id="Macroeconomic-data">Macroeconomic data<a class="headerlink" href="#Macroeconomic-data" title="Permalink to this headline">¶</a></h2>
<p>The coincident index is created by considering the comovements in four macroeconomic variables (versions of these variables are available on <a class="reference external" href="https://research.stlouisfed.org/fred2/">FRED</a>; the ID of the series used below is given in parentheses):</p>
<ul class="simple">
<li><p>Industrial production (IPMAN)</p></li>
<li><p>Real aggregate income (excluding transfer payments) (W875RX1)</p></li>
<li><p>Manufacturing and trade sales (CMRMTSPL)</p></li>
<li><p>Employees on non-farm payrolls (PAYEMS)</p></li>
</ul>
<p>In all cases, the data is at the monthly frequency and has been seasonally adjusted; the time-frame considered is 1972 - 2005.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pandas_datareader.data</span> <span class="kn">import</span> <span class="n">DataReader</span>

<span class="c1"># Get the datasets from FRED</span>
<span class="n">start</span> <span class="o">=</span> <span class="s1">'1979-01-01'</span>
<span class="n">end</span> <span class="o">=</span> <span class="s1">'2014-12-01'</span>
<span class="n">indprod</span> <span class="o">=</span> <span class="n">DataReader</span><span class="p">(</span><span class="s1">'IPMAN'</span><span class="p">,</span> <span class="s1">'fred'</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
<span class="n">income</span> <span class="o">=</span> <span class="n">DataReader</span><span class="p">(</span><span class="s1">'W875RX1'</span><span class="p">,</span> <span class="s1">'fred'</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
<span class="n">sales</span> <span class="o">=</span> <span class="n">DataReader</span><span class="p">(</span><span class="s1">'CMRMTSPL'</span><span class="p">,</span> <span class="s1">'fred'</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
<span class="n">emp</span> <span class="o">=</span> <span class="n">DataReader</span><span class="p">(</span><span class="s1">'PAYEMS'</span><span class="p">,</span> <span class="s1">'fred'</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
<span class="c1"># dta = pd.concat((indprod, income, sales, emp), axis=1)</span>
<span class="c1"># dta.columns = ['indprod', 'income', 'sales', 'emp']</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/travis/miniconda/envs/statsmodels-test/lib/python3.7/site-packages/pandas_datareader/compat/__init__.py:7: FutureWarning: pandas.util.testing is deprecated. Use the functions in the public API at pandas.testing instead.
  from pandas.util.testing import assert_frame_equal
</pre></div></div>
</div>
<p><strong>Note</strong>: in a recent update on FRED (8/12/15) the time series CMRMTSPL was truncated to begin in 1997; this is probably a mistake due to the fact that CMRMTSPL is a spliced series, so the earlier period is from the series HMRMT and the latter period is defined by CMRMT.</p>
<p>This has since (02/11/16) been corrected, however the series could also be constructed by hand from HMRMT and CMRMT, as shown below (process taken from the notes in the Alfred xls file).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># HMRMT = DataReader('HMRMT', 'fred', start='1967-01-01', end=end)</span>
<span class="c1"># CMRMT = DataReader('CMRMT', 'fred', start='1997-01-01', end=end)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># HMRMT_growth = HMRMT.diff() / HMRMT.shift()</span>
<span class="c1"># sales = pd.Series(np.zeros(emp.shape[0]), index=emp.index)</span>

<span class="c1"># # Fill in the recent entries (1997 onwards)</span>
<span class="c1"># sales[CMRMT.index] = CMRMT</span>

<span class="c1"># # Backfill the previous entries (pre 1997)</span>
<span class="c1"># idx = sales.loc[:'1997-01-01'].index</span>
<span class="c1"># for t in range(len(idx)-1, 0, -1):</span>
<span class="c1">#     month = idx[t]</span>
<span class="c1">#     prev_month = idx[t-1]</span>
<span class="c1">#     sales.loc[prev_month] = sales.loc[month] / (1 + HMRMT_growth.loc[prev_month].values)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dta</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">indprod</span><span class="p">,</span> <span class="n">income</span><span class="p">,</span> <span class="n">sales</span><span class="p">,</span> <span class="n">emp</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dta</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'indprod'</span><span class="p">,</span> <span class="s1">'income'</span><span class="p">,</span> <span class="s1">'sales'</span><span class="p">,</span> <span class="s1">'emp'</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dta</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">'indprod'</span><span class="p">:</span><span class="s1">'emp'</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/examples_notebooks_generated_statespace_dfm_coincident_8_0.png" src="../../../_images/examples_notebooks_generated_statespace_dfm_coincident_8_0.png"/>
</div>
</div>
<p>Stock and Watson (1991) report that for their datasets, they could not reject the null hypothesis of a unit root in each series (so the series are integrated), but they did not find strong evidence that the series were co-integrated.</p>
<p>As a result, they suggest estimating the model using the first differences (of the logs) of the variables, demeaned and standardized.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Create log-differenced series</span>
<span class="n">dta</span><span class="p">[</span><span class="s1">'dln_indprod'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">indprod</span><span class="p">))</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">dta</span><span class="p">[</span><span class="s1">'dln_income'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">income</span><span class="p">))</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">dta</span><span class="p">[</span><span class="s1">'dln_sales'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">sales</span><span class="p">))</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">dta</span><span class="p">[</span><span class="s1">'dln_emp'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">emp</span><span class="p">))</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span>

<span class="c1"># De-mean and standardize</span>
<span class="n">dta</span><span class="p">[</span><span class="s1">'std_indprod'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dta</span><span class="p">[</span><span class="s1">'dln_indprod'</span><span class="p">]</span> <span class="o">-</span> <span class="n">dta</span><span class="p">[</span><span class="s1">'dln_indprod'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">dta</span><span class="p">[</span><span class="s1">'dln_indprod'</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">dta</span><span class="p">[</span><span class="s1">'std_income'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dta</span><span class="p">[</span><span class="s1">'dln_income'</span><span class="p">]</span> <span class="o">-</span> <span class="n">dta</span><span class="p">[</span><span class="s1">'dln_income'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">dta</span><span class="p">[</span><span class="s1">'dln_income'</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">dta</span><span class="p">[</span><span class="s1">'std_sales'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dta</span><span class="p">[</span><span class="s1">'dln_sales'</span><span class="p">]</span> <span class="o">-</span> <span class="n">dta</span><span class="p">[</span><span class="s1">'dln_sales'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">dta</span><span class="p">[</span><span class="s1">'dln_sales'</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">dta</span><span class="p">[</span><span class="s1">'std_emp'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dta</span><span class="p">[</span><span class="s1">'dln_emp'</span><span class="p">]</span> <span class="o">-</span> <span class="n">dta</span><span class="p">[</span><span class="s1">'dln_emp'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">dta</span><span class="p">[</span><span class="s1">'dln_emp'</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>


<h2 id="Dynamic-factors">Dynamic factors<a class="headerlink" href="#Dynamic-factors" title="Permalink to this headline">¶</a></h2>
<p>A general dynamic factor model is written as:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
y_t &amp; = \Lambda f_t + B x_t + u_t \\
f_t &amp; = A_1 f_{t-1} + \dots + A_p f_{t-p} + \eta_t \qquad \eta_t \sim N(0, I)\\
u_t &amp; = C_1 u_{t-1} + \dots + C_q u_{t-q} + \varepsilon_t \qquad \varepsilon_t \sim N(0, \Sigma)
\end{align}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(y_t\)</span> are observed data, <span class="math notranslate nohighlight">\(f_t\)</span> are the unobserved factors (evolving as a vector autoregression), <span class="math notranslate nohighlight">\(x_t\)</span> are (optional) exogenous variables, and <span class="math notranslate nohighlight">\(u_t\)</span> is the error, or “idiosyncratic”, process (<span class="math notranslate nohighlight">\(u_t\)</span> is also optionally allowed to be autocorrelated). The <span class="math notranslate nohighlight">\(\Lambda\)</span> matrix is often referred to as the matrix of “factor loadings”. The variance of the factor error term is set to the identity matrix to ensure identification of the unobserved factors.</p>
<p>This model can be cast into state space form, and the unobserved factor estimated via the Kalman filter. The likelihood can be evaluated as a byproduct of the filtering recursions, and maximum likelihood estimation used to estimate the parameters.</p>


<h2 id="Model-specification">Model specification<a class="headerlink" href="#Model-specification" title="Permalink to this headline">¶</a></h2>
<p>The specific dynamic factor model in this application has 1 unobserved factor which is assumed to follow an AR(2) process. The innovations <span class="math notranslate nohighlight">\(\varepsilon_t\)</span> are assumed to be independent (so that <span class="math notranslate nohighlight">\(\Sigma\)</span> is a diagonal matrix) and the error term associated with each equation, <span class="math notranslate nohighlight">\(u_{i,t}\)</span> is assumed to follow an independent AR(2) process.</p>
<p>Thus the specification considered here is:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
y_{i,t} &amp; = \lambda_i f_t + u_{i,t} \\
u_{i,t} &amp; = c_{i,1} u_{1,t-1} + c_{i,2} u_{i,t-2} + \varepsilon_{i,t} \qquad &amp; \varepsilon_{i,t} \sim N(0, \sigma_i^2) \\
f_t &amp; = a_1 f_{t-1} + a_2 f_{t-2} + \eta_t \qquad &amp; \eta_t \sim N(0, I)\\
\end{align}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(i\)</span> is one of: <code class="docutils literal notranslate"><span class="pre">[indprod,</span> <span class="pre">income,</span> <span class="pre">sales,</span> <span class="pre">emp</span> <span class="pre">]</span></code>.</p>
<p>This model can be formulated using the <code class="docutils literal notranslate"><span class="pre">DynamicFactor</span></code> model built-in to statsmodels. In particular, we have the following specification:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">k_factors</span> <span class="pre">=</span> <span class="pre">1</span></code> - (there is 1 unobserved factor)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">factor_order</span> <span class="pre">=</span> <span class="pre">2</span></code> - (it follows an AR(2) process)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">error_var</span> <span class="pre">=</span> <span class="pre">False</span></code> - (the errors evolve as independent AR processes rather than jointly as a VAR - note that this is the default option, so it is not specified below)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">error_order</span> <span class="pre">=</span> <span class="pre">2</span></code> - (the errors are autocorrelated of order 2: i.e. AR(2) processes)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">error_cov_type</span> <span class="pre">=</span> <span class="pre">'diagonal'</span></code> - (the innovations are uncorrelated; this is again the default)</p></li>
</ul>
<p>Once the model is created, the parameters can be estimated via maximum likelihood; this is done using the <code class="docutils literal notranslate"><span class="pre">fit()</span></code> method.</p>
<p><strong>Note</strong>: recall that we have demeaned and standardized the data; this will be important in interpreting the results that follow.</p>
<p><strong>Aside</strong>: in their empirical example, Kim and Nelson (1999) actually consider a slightly different model in which the employment variable is allowed to also depend on lagged values of the factor - this model does not fit into the built-in <code class="docutils literal notranslate"><span class="pre">DynamicFactor</span></code> class, but can be accommodated by using a subclass to implement the required new parameters and restrictions - see Appendix A, below.</p>


<h2 id="Parameter-estimation">Parameter estimation<a class="headerlink" href="#Parameter-estimation" title="Permalink to this headline">¶</a></h2>
<p>Multivariate models can have a relatively large number of parameters, and it may be difficult to escape from local minima to find the maximized likelihood. In an attempt to mitigate this problem, I perform an initial maximization step (from the model-defined starting parameters) using the modified Powell method available in Scipy (see the minimize documentation for more information). The resulting parameters are then used as starting parameters in the standard LBFGS optimization method.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Get the endogenous data</span>
<span class="n">endog</span> <span class="o">=</span> <span class="n">dta</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">'1979-02-01'</span><span class="p">:,</span> <span class="s1">'std_indprod'</span><span class="p">:</span><span class="s1">'std_emp'</span><span class="p">]</span>

<span class="c1"># Create the model</span>
<span class="n">mod</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">DynamicFactor</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">k_factors</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">factor_order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">error_order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">initial_res</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">'powell'</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">initial_res</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/travis/build/statsmodels/statsmodels/statsmodels/tsa/base/tsa_model.py:162: ValueWarning: No frequency information was provided, so inferred frequency MS will be used.
  % freq, ValueWarning)
/home/travis/build/statsmodels/statsmodels/statsmodels/base/model.py:568: ConvergenceWarning: Maximum Likelihood optimization failed to converge. Check mle_retvals
  "Check mle_retvals", ConvergenceWarning)
</pre></div></div>
</div>


<h2 id="Estimates">Estimates<a class="headerlink" href="#Estimates" title="Permalink to this headline">¶</a></h2>
<p>Once the model has been estimated, there are two components that we can use for analysis or inference:</p>
<ul class="simple">
<li><p>The estimated parameters</p></li>
<li><p>The estimated factor</p></li>
</ul>

<h3 id="Parameters">Parameters<a class="headerlink" href="#Parameters" title="Permalink to this headline">¶</a></h3>
<p>The estimated parameters can be helpful in understanding the implications of the model, although in models with a larger number of observed variables and / or unobserved factors they can be difficult to interpret.</p>
<p>One reason for this difficulty is due to identification issues between the factor loadings and the unobserved factors. One easy-to-see identification issue is the sign of the loadings and the factors: an equivalent model to the one displayed below would result from reversing the signs of all factor loadings and the unobserved factor.</p>
<p>Here, one of the easy-to-interpret implications in this model is the persistence of the unobserved factor: we find that exhibits substantial persistence.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">separate_params</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                                             Statespace Model Results
=================================================================================================================
Dep. Variable:     ['std_indprod', 'std_income', 'std_sales', 'std_emp']   No. Observations:                  431
Model:                                 DynamicFactor(factors=1, order=2)   Log Likelihood               -2065.018
                                                          + AR(2) errors   AIC                           4166.036
Date:                                                   Fri, 21 Feb 2020   BIC                           4239.226
Time:                                                           13:55:46   HQIC                          4194.933
Sample:                                                       02-01-1979
                                                            - 12-01-2014
Covariance Type:                                                     opg
====================================================================================================
                                       coef    std err          z      P&gt;|z|      [0.025      0.975]
----------------------------------------------------------------------------------------------------
loading.f1.std_indprod              -0.8560      0.016    -52.137      0.000      -0.888      -0.824
loading.f1.std_income               -0.2516      0.034     -7.427      0.000      -0.318      -0.185
loading.f1.std_sales                -0.4757      0.024    -19.973      0.000      -0.522      -0.429
loading.f1.std_emp                  -0.2723      0.027    -10.043      0.000      -0.325      -0.219
sigma2.std_indprod                8.467e-15   1.38e-09   6.15e-06      1.000    -2.7e-09     2.7e-09
sigma2.std_income                    0.9030      0.020     46.071      0.000       0.865       0.941
sigma2.std_sales                     0.6023      0.035     17.298      0.000       0.534       0.671
sigma2.std_emp                       0.3706      0.015     25.457      0.000       0.342       0.399
L1.f1.f1                             0.2211      0.017     12.895      0.000       0.188       0.255
L2.f1.f1                             0.2765      0.021     13.122      0.000       0.235       0.318
L1.e(std_indprod).e(std_indprod)    -1.8926      0.002  -1150.429      0.000      -1.896      -1.889
L2.e(std_indprod).e(std_indprod)    -1.0000   9.89e-06  -1.01e+05      0.000      -1.000      -1.000
L1.e(std_income).e(std_income)      -0.1542      0.019     -8.279      0.000      -0.191      -0.118
L2.e(std_income).e(std_income)      -0.0874      0.020     -4.266      0.000      -0.128      -0.047
L1.e(std_sales).e(std_sales)        -0.4418      0.031    -14.373      0.000      -0.502      -0.382
L2.e(std_sales).e(std_sales)        -0.2077      0.021     -9.976      0.000      -0.248      -0.167
L1.e(std_emp).e(std_emp)             0.3047      0.034      8.980      0.000       0.238       0.371
L2.e(std_emp).e(std_emp)             0.4798      0.029     16.615      0.000       0.423       0.536
========================================================================================================
Ljung-Box (Q):          87.79, 34.95, 68.98, 70.65   Jarque-Bera (JB):   193.98, 9286.58, 20.13, 4165.73
Prob(Q):                    0.00, 0.70, 0.00, 0.00   Prob(JB):                    0.00, 0.00, 0.00, 0.00
Heteroskedasticity (H):     0.80, 4.82, 0.47, 0.41   Skew:                       0.07, -0.98, 0.19, 0.86
Prob(H) (two-sided):        0.19, 0.00, 0.00, 0.00   Kurtosis:                  6.28, 25.65, 3.99, 18.13
========================================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
[2] Covariance matrix is singular or near-singular, with condition number 7.04e+16. Standard errors may be unstable.
</pre></div></div>
</div>


<h3 id="Estimated-factors">Estimated factors<a class="headerlink" href="#Estimated-factors" title="Permalink to this headline">¶</a></h3>
<p>While it can be useful to plot the unobserved factors, it is less useful here than one might think for two reasons:</p>
<ol class="arabic simple">
<li><p>The sign-related identification issue described above.</p></li>
<li><p>Since the data was differenced, the estimated factor explains the variation in the differenced data, not the original data.</p></li>
</ol>
<p>It is for these reasons that the coincident index is created (see below).</p>
<p>With these reservations, the unobserved factor is plotted below, along with the NBER indicators for US recessions. It appears that the factor is successful at picking up some degree of business cycle activity.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

<span class="c1"># Plot the factor</span>
<span class="n">dates</span> <span class="o">=</span> <span class="n">endog</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">_mpl_repr</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">filtered</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Factor'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Retrieve and also plot the NBER recession indicators</span>
<span class="n">rec</span> <span class="o">=</span> <span class="n">DataReader</span><span class="p">(</span><span class="s1">'USREC'</span><span class="p">,</span> <span class="s1">'fred'</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
<span class="n">ylim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">dates</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rec</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/examples_notebooks_generated_statespace_dfm_coincident_19_0.png" src="../../../_images/examples_notebooks_generated_statespace_dfm_coincident_19_0.png"/>
</div>
</div>



<h2 id="Post-estimation">Post-estimation<a class="headerlink" href="#Post-estimation" title="Permalink to this headline">¶</a></h2>
<p>Although here we will be able to interpret the results of the model by constructing the coincident index, there is a useful and generic approach for getting a sense for what is being captured by the estimated factor. By taking the estimated factors as given, regressing them (and a constant) each (one at a time) on each of the observed variables, and recording the coefficients of determination (<span class="math notranslate nohighlight">\(R^2\)</span> values), we can get a sense of the variables for which each factor explains a substantial
portion of the variance and the variables for which it does not.</p>
<p>In models with more variables and more factors, this can sometimes lend interpretation to the factors (for example sometimes one factor will load primarily on real variables and another on nominal variables).</p>
<p>In this model, with only four endogenous variables and one factor, it is easy to digest a simple table of the <span class="math notranslate nohighlight">\(R^2\)</span> values, but in larger models it is not. For this reason, a bar plot is often employed; from the plot we can easily see that the factor explains most of the variation in industrial production index and a large portion of the variation in sales and employment, it is less helpful in explaining income.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">res</span><span class="o">.</span><span class="n">plot_coefficients_of_determination</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/examples_notebooks_generated_statespace_dfm_coincident_21_0.png" src="../../../_images/examples_notebooks_generated_statespace_dfm_coincident_21_0.png"/>
</div>
</div>


<h2 id="Coincident-Index">Coincident Index<a class="headerlink" href="#Coincident-Index" title="Permalink to this headline">¶</a></h2>
<p>As described above, the goal of this model was to create an interpretable series which could be used to understand the current status of the macroeconomy. This is what the coincident index is designed to do. It is constructed below. For readers interested in an explanation of the construction, see Kim and Nelson (1999) or Stock and Watson (1991).</p>
<p>In essence, what is done is to reconstruct the mean of the (differenced) factor. We will compare it to the coincident index on published by the Federal Reserve Bank of Philadelphia (USPHCI on FRED).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">usphci</span> <span class="o">=</span> <span class="n">DataReader</span><span class="p">(</span><span class="s1">'USPHCI'</span><span class="p">,</span> <span class="s1">'fred'</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s1">'1979-01-01'</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">'2014-12-01'</span><span class="p">)[</span><span class="s1">'USPHCI'</span><span class="p">]</span>
<span class="n">usphci</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">3</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/examples_notebooks_generated_statespace_dfm_coincident_23_0.png" src="../../../_images/examples_notebooks_generated_statespace_dfm_coincident_23_0.png"/>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dusphci</span> <span class="o">=</span> <span class="n">usphci</span><span class="o">.</span><span class="n">diff</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span>
<span class="k">def</span> <span class="nf">compute_coincident_index</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
    <span class="c1"># Estimate W(1)</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">specification</span>
    <span class="n">design</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">ssm</span><span class="p">[</span><span class="s1">'design'</span><span class="p">]</span>
    <span class="n">transition</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">ssm</span><span class="p">[</span><span class="s1">'transition'</span><span class="p">]</span>
    <span class="n">ss_kalman_gain</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">filter_results</span><span class="o">.</span><span class="n">kalman_gain</span><span class="p">[:,:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">k_states</span> <span class="o">=</span> <span class="n">ss_kalman_gain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">W1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">k_states</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">k_states</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ss_kalman_gain</span><span class="p">,</span> <span class="n">design</span><span class="p">),</span>
        <span class="n">transition</span>
    <span class="p">))</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ss_kalman_gain</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Compute the factor mean vector</span>
    <span class="n">factor_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">W1</span><span class="p">,</span> <span class="n">dta</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">'1972-02-01'</span><span class="p">:,</span> <span class="s1">'dln_indprod'</span><span class="p">:</span><span class="s1">'dln_emp'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

    <span class="c1"># Normalize the factors</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">filtered</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">factor</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">usphci</span><span class="o">.</span><span class="n">diff</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>

    <span class="c1"># Compute the coincident index</span>
    <span class="n">coincident_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">nobs</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># The initial value is arbitrary; here it is set to</span>
    <span class="c1"># facilitate comparison</span>
    <span class="n">coincident_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">usphci</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">factor_mean</span> <span class="o">/</span> <span class="n">dusphci</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mod</span><span class="o">.</span><span class="n">nobs</span><span class="p">):</span>
        <span class="n">coincident_index</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">coincident_index</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">factor</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">factor_mean</span>

    <span class="c1"># Attach dates</span>
    <span class="n">coincident_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">coincident_index</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">dta</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="c1"># Normalize to use the same base year as USPHCI</span>
    <span class="n">coincident_index</span> <span class="o">*=</span> <span class="p">(</span><span class="n">usphci</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">'1992-07-01'</span><span class="p">]</span> <span class="o">/</span> <span class="n">coincident_index</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">'1992-07-01'</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">coincident_index</span>
</pre></div>
</div>
</div>
<p>Below we plot the calculated coincident index along with the US recessions and the comparison coincident index USPHCI.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

<span class="c1"># Compute the index</span>
<span class="n">coincident_index</span> <span class="o">=</span> <span class="n">compute_coincident_index</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>

<span class="c1"># Plot the factor</span>
<span class="n">dates</span> <span class="o">=</span> <span class="n">endog</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">_mpl_repr</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">coincident_index</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Coincident index'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">usphci</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">_mpl_repr</span><span class="p">(),</span> <span class="n">usphci</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'USPHCI'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'lower right'</span><span class="p">)</span>

<span class="c1"># Retrieve and also plot the NBER recession indicators</span>
<span class="n">ylim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">dates</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rec</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/examples_notebooks_generated_statespace_dfm_coincident_26_0.png" src="../../../_images/examples_notebooks_generated_statespace_dfm_coincident_26_0.png"/>
</div>
</div>


<h2 id="Appendix-1:-Extending-the-dynamic-factor-model">Appendix 1: Extending the dynamic factor model<a class="headerlink" href="#Appendix-1:-Extending-the-dynamic-factor-model" title="Permalink to this headline">¶</a></h2>
<p>Recall that the previous specification was described by:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
y_{i,t} &amp; = \lambda_i f_t + u_{i,t} \\
u_{i,t} &amp; = c_{i,1} u_{1,t-1} + c_{i,2} u_{i,t-2} + \varepsilon_{i,t} \qquad &amp; \varepsilon_{i,t} \sim N(0, \sigma_i^2) \\
f_t &amp; = a_1 f_{t-1} + a_2 f_{t-2} + \eta_t \qquad &amp; \eta_t \sim N(0, I)\\
\end{align}\end{split}\]</div>
<p>Written in state space form, the previous specification of the model had the following observation equation:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{bmatrix}
y_{\text{indprod}, t} \\
y_{\text{income}, t} \\
y_{\text{sales}, t} \\
y_{\text{emp}, t} \\
\end{bmatrix} = \begin{bmatrix}
\lambda_\text{indprod} &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\lambda_\text{income}  &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\lambda_\text{sales}   &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\lambda_\text{emp}     &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\end{bmatrix}
\begin{bmatrix}
f_t \\
f_{t-1} \\
u_{\text{indprod}, t} \\
u_{\text{income}, t} \\
u_{\text{sales}, t} \\
u_{\text{emp}, t} \\
u_{\text{indprod}, t-1} \\
u_{\text{income}, t-1} \\
u_{\text{sales}, t-1} \\
u_{\text{emp}, t-1} \\
\end{bmatrix}\end{split}\]</div>
<p>and transition equation:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{bmatrix}
f_t \\
f_{t-1} \\
u_{\text{indprod}, t} \\
u_{\text{income}, t} \\
u_{\text{sales}, t} \\
u_{\text{emp}, t} \\
u_{\text{indprod}, t-1} \\
u_{\text{income}, t-1} \\
u_{\text{sales}, t-1} \\
u_{\text{emp}, t-1} \\
\end{bmatrix} = \begin{bmatrix}
a_1 &amp; a_2 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
1   &amp; 0   &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0   &amp; 0   &amp; c_{\text{indprod}, 1} &amp; 0 &amp; 0 &amp; 0 &amp; c_{\text{indprod}, 2} &amp; 0 &amp; 0 &amp; 0 \\
0   &amp; 0   &amp; 0 &amp; c_{\text{income}, 1} &amp; 0 &amp; 0 &amp; 0 &amp; c_{\text{income}, 2} &amp; 0 &amp; 0 \\
0   &amp; 0   &amp; 0 &amp; 0 &amp; c_{\text{sales}, 1} &amp; 0 &amp; 0 &amp; 0 &amp; c_{\text{sales}, 2} &amp; 0 \\
0   &amp; 0   &amp; 0 &amp; 0 &amp; 0 &amp; c_{\text{emp}, 1} &amp; 0 &amp; 0 &amp; 0 &amp; c_{\text{emp}, 2} \\
0   &amp; 0   &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0   &amp; 0   &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0   &amp; 0   &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0   &amp; 0   &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\end{bmatrix}
\begin{bmatrix}
f_{t-1} \\
f_{t-2} \\
u_{\text{indprod}, t-1} \\
u_{\text{income}, t-1} \\
u_{\text{sales}, t-1} \\
u_{\text{emp}, t-1} \\
u_{\text{indprod}, t-2} \\
u_{\text{income}, t-2} \\
u_{\text{sales}, t-2} \\
u_{\text{emp}, t-2} \\
\end{bmatrix}
+ R \begin{bmatrix}
\eta_t \\
\varepsilon_{t}
\end{bmatrix}\end{split}\]</div>
<p>the <code class="docutils literal notranslate"><span class="pre">DynamicFactor</span></code> model handles setting up the state space representation and, in the <code class="docutils literal notranslate"><span class="pre">DynamicFactor.update</span></code> method, it fills in the fitted parameter values into the appropriate locations.</p>
<p>The extended specification is the same as in the previous example, except that we also want to allow employment to depend on lagged values of the factor. This creates a change to the <span class="math notranslate nohighlight">\(y_{\text{emp},t}\)</span> equation. Now we have:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
y_{i,t} &amp; = \lambda_i f_t + u_{i,t} \qquad &amp; i \in \{\text{indprod}, \text{income}, \text{sales} \}\\
y_{i,t} &amp; = \lambda_{i,0} f_t + \lambda_{i,1} f_{t-1} + \lambda_{i,2} f_{t-2} + \lambda_{i,2} f_{t-3} + u_{i,t} \qquad &amp; i = \text{emp} \\
u_{i,t} &amp; = c_{i,1} u_{i,t-1} + c_{i,2} u_{i,t-2} + \varepsilon_{i,t} \qquad &amp; \varepsilon_{i,t} \sim N(0, \sigma_i^2) \\
f_t &amp; = a_1 f_{t-1} + a_2 f_{t-2} + \eta_t \qquad &amp; \eta_t \sim N(0, I)\\
\end{align}\end{split}\]</div>
<p>Now, the corresponding observation equation should look like the following:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{bmatrix}
y_{\text{indprod}, t} \\
y_{\text{income}, t} \\
y_{\text{sales}, t} \\
y_{\text{emp}, t} \\
\end{bmatrix} = \begin{bmatrix}
\lambda_\text{indprod} &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\lambda_\text{income}  &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\lambda_\text{sales}   &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\lambda_\text{emp,1}   &amp; \lambda_\text{emp,2} &amp; \lambda_\text{emp,3} &amp; \lambda_\text{emp,4} &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\end{bmatrix}
\begin{bmatrix}
f_t \\
f_{t-1} \\
f_{t-2} \\
f_{t-3} \\
u_{\text{indprod}, t} \\
u_{\text{income}, t} \\
u_{\text{sales}, t} \\
u_{\text{emp}, t} \\
u_{\text{indprod}, t-1} \\
u_{\text{income}, t-1} \\
u_{\text{sales}, t-1} \\
u_{\text{emp}, t-1} \\
\end{bmatrix}\end{split}\]</div>
<p>Notice that we have introduced two new state variables, <span class="math notranslate nohighlight">\(f_{t-2}\)</span> and <span class="math notranslate nohighlight">\(f_{t-3}\)</span>, which means we need to update the transition equation:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{bmatrix}
f_t \\
f_{t-1} \\
f_{t-2} \\
f_{t-3} \\
u_{\text{indprod}, t} \\
u_{\text{income}, t} \\
u_{\text{sales}, t} \\
u_{\text{emp}, t} \\
u_{\text{indprod}, t-1} \\
u_{\text{income}, t-1} \\
u_{\text{sales}, t-1} \\
u_{\text{emp}, t-1} \\
\end{bmatrix} = \begin{bmatrix}
a_1 &amp; a_2 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
1   &amp; 0   &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0   &amp; 1   &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0   &amp; 0   &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0   &amp; 0   &amp; 0 &amp; 0 &amp; c_{\text{indprod}, 1} &amp; 0 &amp; 0 &amp; 0 &amp; c_{\text{indprod}, 2} &amp; 0 &amp; 0 &amp; 0 \\
0   &amp; 0   &amp; 0 &amp; 0 &amp; 0 &amp; c_{\text{income}, 1} &amp; 0 &amp; 0 &amp; 0 &amp; c_{\text{income}, 2} &amp; 0 &amp; 0 \\
0   &amp; 0   &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; c_{\text{sales}, 1} &amp; 0 &amp; 0 &amp; 0 &amp; c_{\text{sales}, 2} &amp; 0 \\
0   &amp; 0   &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; c_{\text{emp}, 1} &amp; 0 &amp; 0 &amp; 0 &amp; c_{\text{emp}, 2} \\
0   &amp; 0   &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0   &amp; 0   &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0   &amp; 0   &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0   &amp; 0   &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\end{bmatrix}
\begin{bmatrix}
f_{t-1} \\
f_{t-2} \\
f_{t-3} \\
f_{t-4} \\
u_{\text{indprod}, t-1} \\
u_{\text{income}, t-1} \\
u_{\text{sales}, t-1} \\
u_{\text{emp}, t-1} \\
u_{\text{indprod}, t-2} \\
u_{\text{income}, t-2} \\
u_{\text{sales}, t-2} \\
u_{\text{emp}, t-2} \\
\end{bmatrix}
+ R \begin{bmatrix}
\eta_t \\
\varepsilon_{t}
\end{bmatrix}\end{split}\]</div>
<p>This model cannot be handled out-of-the-box by the <code class="docutils literal notranslate"><span class="pre">DynamicFactor</span></code> class, but it can be handled by creating a subclass when alters the state space representation in the appropriate way.</p>
<p>First, notice that if we had set <code class="docutils literal notranslate"><span class="pre">factor_order</span> <span class="pre">=</span> <span class="pre">4</span></code>, we would almost have what we wanted. In that case, the last line of the observation equation would be:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{bmatrix}
\vdots \\
y_{\text{emp}, t} \\
\end{bmatrix} = \begin{bmatrix}
\vdots &amp;  &amp;  &amp;  &amp;  &amp;  &amp;  &amp;  &amp;  &amp;  &amp;  &amp; \vdots \\
\lambda_\text{emp,1}   &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\end{bmatrix}
\begin{bmatrix}
f_t \\
f_{t-1} \\
f_{t-2} \\
f_{t-3} \\
\vdots
\end{bmatrix}\end{split}\]</div>
<p>and the first line of the transition equation would be:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{bmatrix}
f_t \\
\vdots
\end{bmatrix} = \begin{bmatrix}
a_1 &amp; a_2 &amp; a_3 &amp; a_4 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\vdots &amp;  &amp;  &amp;  &amp;  &amp;  &amp;  &amp;  &amp;  &amp;  &amp;  &amp; \vdots \\
\end{bmatrix}
\begin{bmatrix}
f_{t-1} \\
f_{t-2} \\
f_{t-3} \\
f_{t-4} \\
\vdots
\end{bmatrix}
+ R \begin{bmatrix}
\eta_t \\
\varepsilon_{t}
\end{bmatrix}\end{split}\]</div>
<p>Relative to what we want, we have the following differences:</p>
<ol class="arabic simple">
<li><p>In the above situation, the <span class="math notranslate nohighlight">\(\lambda_{\text{emp}, j}\)</span> are forced to be zero for <span class="math notranslate nohighlight">\(j &gt; 0\)</span>, and we want them to be estimated as parameters.</p></li>
<li><p>We only want the factor to transition according to an AR(2), but under the above situation it is an AR(4).</p></li>
</ol>
<p>Our strategy will be to subclass <code class="docutils literal notranslate"><span class="pre">DynamicFactor</span></code>, and let it do most of the work (setting up the state space representation, etc.) where it assumes that <code class="docutils literal notranslate"><span class="pre">factor_order</span> <span class="pre">=</span> <span class="pre">4</span></code>. The only things we will actually do in the subclass will be to fix those two issues.</p>
<p>First, here is the full code of the subclass; it is discussed below. It is important to note at the outset that none of the methods defined below could have been omitted. In fact, the methods <code class="docutils literal notranslate"><span class="pre">__init__</span></code>, <code class="docutils literal notranslate"><span class="pre">start_params</span></code>, <code class="docutils literal notranslate"><span class="pre">param_names</span></code>, <code class="docutils literal notranslate"><span class="pre">transform_params</span></code>, <code class="docutils literal notranslate"><span class="pre">untransform_params</span></code>, and <code class="docutils literal notranslate"><span class="pre">update</span></code> form the core of all state space models in statsmodels, not just the <code class="docutils literal notranslate"><span class="pre">DynamicFactor</span></code> class.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">statsmodels.tsa.statespace</span> <span class="kn">import</span> <span class="n">tools</span>
<span class="k">class</span> <span class="nc">ExtendedDFM</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">DynamicFactor</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="c1"># Setup the model as if we had a factor order of 4</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">ExtendedDFM</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
                <span class="n">endog</span><span class="p">,</span> <span class="n">k_factors</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">factor_order</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">error_order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="c1"># Note: `self.parameters` is an ordered dict with the</span>
            <span class="c1"># keys corresponding to parameter types, and the values</span>
            <span class="c1"># the number of parameters of that type.</span>
            <span class="c1"># Add the new parameters</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">'new_loadings'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>

            <span class="c1"># Cache a slice for the location of the 4 factor AR</span>
            <span class="c1"># parameters (a_1, ..., a_4) in the full parameter vector</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">'factor_loadings'</span><span class="p">]</span> <span class="o">+</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">'exog'</span><span class="p">]</span> <span class="o">+</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">'error_cov'</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_params_factor_ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">s_</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_params_factor_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">s_</span><span class="p">[</span><span class="n">offset</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">offset</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">start_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Add three new loading parameters to the end of the parameter</span>
        <span class="c1"># vector, initialized to zeros (for simplicity; they could</span>
        <span class="c1"># be initialized any way you like)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="nb">super</span><span class="p">(</span><span class="n">ExtendedDFM</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">start_params</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">param_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Add the corresponding names for the new loading parameters</span>
        <span class="c1">#  (the name can be anything you like)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">ExtendedDFM</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">param_names</span> <span class="o">+</span> <span class="p">[</span>
            <span class="s1">'loading.L</span><span class="si">%d</span><span class="s1">.f1.</span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog_names</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">transform_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unconstrained</span><span class="p">):</span>
            <span class="c1"># Perform the typical DFM transformation (w/o the new parameters)</span>
            <span class="n">constrained</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ExtendedDFM</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">transform_params</span><span class="p">(</span>
            <span class="n">unconstrained</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>

            <span class="c1"># Redo the factor AR constraint, since we only want an AR(2),</span>
            <span class="c1"># and the previous constraint was for an AR(4)</span>
            <span class="n">ar_params</span> <span class="o">=</span> <span class="n">unconstrained</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_params_factor_ar</span><span class="p">]</span>
            <span class="n">constrained</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_params_factor_ar</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">tools</span><span class="o">.</span><span class="n">constrain_stationary_univariate</span><span class="p">(</span><span class="n">ar_params</span><span class="p">))</span>

            <span class="c1"># Return all the parameters</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">constrained</span><span class="p">,</span> <span class="n">unconstrained</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]]</span>

    <span class="k">def</span> <span class="nf">untransform_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constrained</span><span class="p">):</span>
            <span class="c1"># Perform the typical DFM untransformation (w/o the new parameters)</span>
            <span class="n">unconstrained</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ExtendedDFM</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">untransform_params</span><span class="p">(</span>
                <span class="n">constrained</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>

            <span class="c1"># Redo the factor AR unconstrained, since we only want an AR(2),</span>
            <span class="c1"># and the previous unconstrained was for an AR(4)</span>
            <span class="n">ar_params</span> <span class="o">=</span> <span class="n">constrained</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_params_factor_ar</span><span class="p">]</span>
            <span class="n">unconstrained</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_params_factor_ar</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">tools</span><span class="o">.</span><span class="n">unconstrain_stationary_univariate</span><span class="p">(</span><span class="n">ar_params</span><span class="p">))</span>

            <span class="c1"># Return all the parameters</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">unconstrained</span><span class="p">,</span> <span class="n">constrained</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]]</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">transformed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Peform the transformation, if required</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">transformed</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_params</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_params_factor_zero</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Now perform the usual DFM update, but exclude our new parameters</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ExtendedDFM</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="n">transformed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Finally, set our new parameters in the design matrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssm</span><span class="p">[</span><span class="s1">'design'</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span>
</pre></div>
</div>
</div>
<p>So what did we just do?</p>
<p><strong>``__init__``</strong></p>
<p>The important step here was specifying the base dynamic factor model which we were operating with. In particular, as described above, we initialize with <code class="docutils literal notranslate"><span class="pre">factor_order=4</span></code>, even though we will only end up with an AR(2) model for the factor. We also performed some general setup-related tasks.</p>
<p><strong>``start_params``</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">start_params</span></code> are used as initial values in the optimizer. Since we are adding three new parameters, we need to pass those in. If we had not done this, the optimizer would use the default starting values, which would be three elements short.</p>
<p><strong>``param_names``</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">param_names</span></code> are used in a variety of places, but especially in the results class. Below we get a full result summary, which is only possible when all the parameters have associated names.</p>
<p><strong>``transform_params``</strong> and <strong>``untransform_params``</strong></p>
<p>The optimizer selects possibly parameter values in an unconstrained way. That’s not usually desired (since variances cannot be negative, for example), and <code class="docutils literal notranslate"><span class="pre">transform_params</span></code> is used to transform the unconstrained values used by the optimizer to constrained values appropriate to the model. Variances terms are typically squared (to force them to be positive), and AR lag coefficients are often constrained to lead to a stationary model. <code class="docutils literal notranslate"><span class="pre">untransform_params</span></code> is used for the reverse operation (and
is important because starting parameters are usually specified in terms of values appropriate to the model, and we need to convert them to parameters appropriate to the optimizer before we can begin the optimization routine).</p>
<p>Even though we do not need to transform or untransform our new parameters (the loadings can in theory take on any values), we still need to modify this function for two reasons:</p>
<ol class="arabic simple">
<li><p>The version in the <code class="docutils literal notranslate"><span class="pre">DynamicFactor</span></code> class is expecting 3 fewer parameters than we have now. At a minimum, we need to handle the three new parameters.</p></li>
<li><p>The version in the <code class="docutils literal notranslate"><span class="pre">DynamicFactor</span></code> class constrains the factor lag coefficients to be stationary as though it was an AR(4) model. Since we actually have an AR(2) model, we need to re-do the constraint. We also set the last two autoregressive coefficients to be zero here.</p></li>
</ol>
<p><strong>``update``</strong></p>
<p>The most important reason we need to specify a new <code class="docutils literal notranslate"><span class="pre">update</span></code> method is because we have three new parameters that we need to place into the state space formulation. In particular we let the parent <code class="docutils literal notranslate"><span class="pre">DynamicFactor.update</span></code> class handle placing all the parameters except the three new ones in to the state space representation, and then we put the last three in manually.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Create the model</span>
<span class="n">extended_mod</span> <span class="o">=</span> <span class="n">ExtendedDFM</span><span class="p">(</span><span class="n">endog</span><span class="p">)</span>
<span class="n">initial_extended_res</span> <span class="o">=</span> <span class="n">extended_mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">maxiter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">extended_res</span> <span class="o">=</span> <span class="n">extended_mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">initial_extended_res</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">'nm'</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">extended_res</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">separate_params</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/travis/build/statsmodels/statsmodels/statsmodels/tsa/base/tsa_model.py:162: ValueWarning: No frequency information was provided, so inferred frequency MS will be used.
  % freq, ValueWarning)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Optimization terminated successfully.
         Current function value: 4.698612
         Iterations: 268
         Function evaluations: 459
                                             Statespace Model Results
=================================================================================================================
Dep. Variable:     ['std_indprod', 'std_income', 'std_sales', 'std_emp']   No. Observations:                  431
Model:                                 DynamicFactor(factors=1, order=4)   Log Likelihood               -2025.102
                                                          + AR(2) errors   AIC                           4096.203
Date:                                                   Fri, 21 Feb 2020   BIC                           4189.724
Time:                                                           13:56:02   HQIC                          4133.128
Sample:                                                       02-01-1979
                                                            - 12-01-2014
Covariance Type:                                                     opg
====================================================================================================
                                       coef    std err          z      P&gt;|z|      [0.025      0.975]
----------------------------------------------------------------------------------------------------
loading.f1.std_indprod              -0.6889      0.036    -19.110      0.000      -0.760      -0.618
loading.f1.std_income               -0.2584      0.038     -6.727      0.000      -0.334      -0.183
loading.f1.std_sales                -0.4390      0.024    -18.549      0.000      -0.485      -0.393
loading.f1.std_emp                  -0.4166      0.039    -10.761      0.000      -0.493      -0.341
sigma2.std_indprod                   0.2456      0.046      5.323      0.000       0.155       0.336
sigma2.std_income                    0.8735      0.030     29.557      0.000       0.816       0.931
sigma2.std_sales                     0.5346      0.034     15.522      0.000       0.467       0.602
sigma2.std_emp                       0.2531      0.024     10.487      0.000       0.206       0.300
L1.f1.f1                             0.3047      0.059      5.169      0.000       0.189       0.420
L2.f1.f1                             0.3768      0.062      6.076      0.000       0.255       0.498
L3.f1.f1                                  0   1.96e-11          0      1.000   -3.85e-11    3.85e-11
L4.f1.f1                                  0   1.96e-11          0      1.000   -3.85e-11    3.85e-11
L1.e(std_indprod).e(std_indprod)    -0.3202      0.113     -2.828      0.005      -0.542      -0.098
L2.e(std_indprod).e(std_indprod)    -0.2253      0.090     -2.497      0.013      -0.402      -0.048
L1.e(std_income).e(std_income)      -0.1730      0.022     -7.835      0.000      -0.216      -0.130
L2.e(std_income).e(std_income)      -0.0936      0.044     -2.120      0.034      -0.180      -0.007
L1.e(std_sales).e(std_sales)        -0.4896      0.046    -10.597      0.000      -0.580      -0.399
L2.e(std_sales).e(std_sales)        -0.2268      0.050     -4.540      0.000      -0.325      -0.129
L1.e(std_emp).e(std_emp)             0.2334      0.042      5.523      0.000       0.151       0.316
L2.e(std_emp).e(std_emp)             0.4965      0.051      9.815      0.000       0.397       0.596
loading.L1.f1.std_emp               -0.0725      0.038     -1.898      0.058      -0.147       0.002
loading.L2.f1.std_emp                0.0005      0.036      0.014      0.989      -0.070       0.071
loading.L3.f1.std_emp               -0.1737      0.028     -6.168      0.000      -0.229      -0.119
========================================================================================================
Ljung-Box (Q):          59.16, 34.27, 68.30, 61.90   Jarque-Bera (JB):   231.63, 9689.10, 25.37, 3374.68
Prob(Q):                    0.03, 0.73, 0.00, 0.01   Prob(JB):                    0.00, 0.00, 0.00, 0.00
Heteroskedasticity (H):     0.76, 5.03, 0.44, 0.45   Skew:                       0.22, -0.97, 0.24, 0.75
Prob(H) (two-sided):        0.11, 0.00, 0.00, 0.00   Kurtosis:                  6.56, 26.15, 4.08, 16.63
========================================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
[2] Covariance matrix is singular or near-singular, with condition number 5.31e+17. Standard errors may be unstable.
</pre></div></div>
</div>
<p>Although this model increases the likelihood, it is not preferred by the AIC and BIC measures which penalize the additional three parameters.</p>
<p>Furthermore, the qualitative results are unchanged, as we can see from the updated <span class="math notranslate nohighlight">\(R^2\)</span> chart and the new coincident index, both of which are practically identical to the previous results.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">extended_res</span><span class="o">.</span><span class="n">plot_coefficients_of_determination</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/examples_notebooks_generated_statespace_dfm_coincident_34_0.png" src="../../../_images/examples_notebooks_generated_statespace_dfm_coincident_34_0.png"/>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

<span class="c1"># Compute the index</span>
<span class="n">extended_coincident_index</span> <span class="o">=</span> <span class="n">compute_coincident_index</span><span class="p">(</span><span class="n">extended_mod</span><span class="p">,</span> <span class="n">extended_res</span><span class="p">)</span>

<span class="c1"># Plot the factor</span>
<span class="n">dates</span> <span class="o">=</span> <span class="n">endog</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">_mpl_repr</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">coincident_index</span><span class="p">,</span> <span class="s1">'-'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Basic model'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">extended_coincident_index</span><span class="p">,</span> <span class="s1">'--'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Extended model'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">usphci</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">_mpl_repr</span><span class="p">(),</span> <span class="n">usphci</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'USPHCI'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'lower right'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">'Coincident indices, comparison'</span><span class="p">)</span>

<span class="c1"># Retrieve and also plot the NBER recession indicators</span>
<span class="n">ylim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">dates</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rec</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/examples_notebooks_generated_statespace_dfm_coincident_35_0.png" src="../../../_images/examples_notebooks_generated_statespace_dfm_coincident_35_0.png"/>
</div>
</div>




          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="statespace_varmax.html" title="Material"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> VARMAX models </span>
              </div>
            </a>
          
          
            <a href="statespace_structural_harvey_jaeger.html" title="Admonition"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Detrending, Stylized Facts and the Business Cycle </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2009-2019, Josef Perktold, Skipper Seabold, Jonathan Taylor, statsmodels-developers.
              
          </div>
            Last updated on
              Feb 21, 2020.
            <br/>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 2.4.2.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../../../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>