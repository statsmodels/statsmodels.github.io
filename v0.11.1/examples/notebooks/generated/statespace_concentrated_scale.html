

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../../../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../../../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../../../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../../../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../../../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>State space models - concentrating the scale out of the likelihood function &#8212; statsmodels</title>
  <link rel="icon" type="image/png" sizes="32x32" href="../../../_static/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../../../_static/icons/favicon-16x16.png">
  <link rel="manifest" href="../../../_static/icons/site.webmanifest">
  <link rel="mask-icon" href="../../../_static/icons/safari-pinned-tab.svg" color="#919191">
  <meta name="msapplication-TileColor" content="#2b5797">
  <meta name="msapplication-config" content="../../../_static/icons/browserconfig.xml">
  <link rel="stylesheet" href="../../../_static/stylesheets/examples.css">
    <link rel="stylesheet" href="../../../_static/material.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="statsmodels Principal Component Analysis" href="pca_fertility_factors.html" />
    <link rel="prev" title="Estimating or specifying parameters in state space models" href="statespace_fixed_params.html" />
  
   
  
  <script src="../../../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../../../_static/versions.json",
        target_loc = "../../../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>


  </head>
  <body dir=ltr
        data-md-color-primary=indigo data-md-color-accent=blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#examples/notebooks/generated/statespace_concentrated_scale" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../../index.html" title="statsmodels"
           class="md-header-nav__button md-logo">
          
              <img src="../../../_static/statsmodels-logo-v2-bw.svg" height="26"
                   alt="statsmodels logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">statsmodels v0.11.1</span>
          <span class="md-header-nav__topic"> State space models - concentrating the scale out of the likelihood function </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../../../search.html" method="GET" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/statsmodels/statsmodels" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    statsmodels
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../../index.html" class="md-tabs__link">Examples</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../../index.html" title="statsmodels" class="md-nav__button md-logo">
      
        <img src="../../../_static/statsmodels-logo-v2-bw.svg" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../../../index.html"
       title="statsmodels">statsmodels v0.11.1</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/statsmodels/statsmodels" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    statsmodels
  </div>
</a>
    </div>
  
  

  
  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
      <a href="../../../install.html" class="md-nav__link">Installing statsmodels</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../../gettingstarted.html" class="md-nav__link">Getting started</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../../user-guide.html" class="md-nav__link">User Guide</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html" class="md-nav__link">Examples</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
      <a href="../../index.html#linear-regression-models" class="md-nav__link">Linear Regression Models</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html#plotting" class="md-nav__link">Plotting</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html#discrete-choice-models" class="md-nav__link">Discrete Choice Models</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html#nonparametric-statistics" class="md-nav__link">Nonparametric Statistics</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html#generalized-linear-models" class="md-nav__link">Generalized Linear Models</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html#robust-regression" class="md-nav__link">Robust Regression</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html#generalized-estimating-equations" class="md-nav__link">Generalized Estimating Equations</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html#statistics" class="md-nav__link">Statistics</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html#time-series-analysis" class="md-nav__link">Time Series Analysis</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html#state-space-models" class="md-nav__link">State space models</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html#state-space-models-technical-notes" class="md-nav__link">State space models - Technical notes</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> State space models - concentrating the scale out of the likelihood function </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">State space models - concentrating the scale out of the likelihood function</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#examples-notebooks-generated-statespace-concentrated-scale--page-root" class="md-nav__link">State space models - concentrating the scale out of the likelihood function</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Introduction" class="md-nav__link">Introduction</a>
        </li>
        <li class="md-nav__item"><a href="#Example:-local-level-model" class="md-nav__link">Example: local level model</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Typical-approach" class="md-nav__link">Typical approach</a>
        </li>
        <li class="md-nav__item"><a href="#Concentrating-out-the-scale" class="md-nav__link">Concentrating out the scale</a>
        </li>
        <li class="md-nav__item"><a href="#Comparing-estimates" class="md-nav__link">Comparing estimates</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Example:-SARIMAX" class="md-nav__link">Example: SARIMAX</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../../../_sources/examples/notebooks/generated/statespace_concentrated_scale.ipynb.txt">Show Source</a> </li>

  </ul>
</nav>
    </li></ul>
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html#multivariate-methods" class="md-nav__link">Multivariate Methods</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../index.html#user-notes" class="md-nav__link">User Notes</a>
      
    </li></ul>
    </li>
    <li class="md-nav__item">
    
      <a href="../../../api.html" class="md-nav__link">API Reference</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../../about.html" class="md-nav__link">About statsmodels</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../../dev/index.html" class="md-nav__link">Developer Page</a>
      
    </li>
    <li class="md-nav__item">
    
      <a href="../../../release/index.html" class="md-nav__link">Release Notes</a>
      
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#examples-notebooks-generated-statespace-concentrated-scale--page-root" class="md-nav__link">State space models - concentrating the scale out of the likelihood function</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Introduction" class="md-nav__link">Introduction</a>
        </li>
        <li class="md-nav__item"><a href="#Example:-local-level-model" class="md-nav__link">Example: local level model</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Typical-approach" class="md-nav__link">Typical approach</a>
        </li>
        <li class="md-nav__item"><a href="#Concentrating-out-the-scale" class="md-nav__link">Concentrating out the scale</a>
        </li>
        <li class="md-nav__item"><a href="#Comparing-estimates" class="md-nav__link">Comparing estimates</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Example:-SARIMAX" class="md-nav__link">Example: SARIMAX</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../../../_sources/examples/notebooks/generated/statespace_concentrated_scale.ipynb.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5.5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>

<h1 id="examples-notebooks-generated-statespace-concentrated-scale--page-root">State space models - concentrating the scale out of the likelihood function<a class="headerlink" href="#examples-notebooks-generated-statespace-concentrated-scale--page-root" title="Permalink to this headline">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>

<span class="n">dta</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">macrodata</span><span class="o">.</span><span class="n">load_pandas</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
<span class="n">dta</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">'1959Q1'</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">'2009Q4'</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">'Q'</span><span class="p">)</span>
</pre></div>
</div>
</div>

<h2 id="Introduction">Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h2>
<p>(much of this is based on Harvey (1989); see especially section 3.4)</p>
<p>State space models can generically be written as follows (here we focus on time-invariant state space models, but similar results apply also to time-varying models):</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
y_t &amp; = Z \alpha_t + \varepsilon_t, \quad \varepsilon_t \sim N(0, H) \\
\alpha_{t+1} &amp; = T \alpha_t + R \eta_t \quad \eta_t \sim N(0, Q)
\end{align}\end{split}\]</div>
<p>Often, some or all of the values in the matrices <span class="math notranslate nohighlight">\(Z, H, T, R, Q\)</span> are unknown and must be estimated; in statsmodels, estimation is often done by finding the parameters that maximize the likelihood function. In particular, if we collect the parameters in a vector <span class="math notranslate nohighlight">\(\psi\)</span>, then each of these matrices can be thought of as functions of those parameters, for example <span class="math notranslate nohighlight">\(Z = Z(\psi)\)</span>, etc.</p>
<p>Usually, the likelihood function is maximized numerically, for example by applying quasi-Newton “hill-climbing” algorithms, and this becomes more and more difficult the more parameters there are. It turns out that in many cases we can reparameterize the model as <span class="math notranslate nohighlight">\([\psi_*', \sigma_*^2]'\)</span>, where <span class="math notranslate nohighlight">\(\sigma_*^2\)</span> is the “scale” of the model (usually, it replaces one of the error variance terms) and it is possible to find the maximum likelihood estimate of <span class="math notranslate nohighlight">\(\sigma_*^2\)</span> analytically, by
differentiating the likelihood function. This implies that numerical methods are only required to estimate the parameters <span class="math notranslate nohighlight">\(\psi_*\)</span>, which has dimension one less than that of <span class="math notranslate nohighlight">\(\psi\)</span>.</p>


<h2 id="Example:-local-level-model">Example: local level model<a class="headerlink" href="#Example:-local-level-model" title="Permalink to this headline">¶</a></h2>
<p>(see, for example, section 4.2 of Harvey (1989))</p>
<p>As a specific example, consider the local level model, which can be written as:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
y_t &amp; = \alpha_t + \varepsilon_t, \quad \varepsilon_t \sim N(0, \sigma_\varepsilon^2) \\
\alpha_{t+1} &amp; = \alpha_t + \eta_t \quad \eta_t \sim N(0, \sigma_\eta^2)
\end{align}\end{split}\]</div>
<p>In this model, <span class="math notranslate nohighlight">\(Z, T,\)</span> and <span class="math notranslate nohighlight">\(R\)</span> are all fixed to be equal to <span class="math notranslate nohighlight">\(1\)</span>, and there are two unknown parameters, so that <span class="math notranslate nohighlight">\(\psi = [\sigma_\varepsilon^2, \sigma_\eta^2]\)</span>.</p>

<h3 id="Typical-approach">Typical approach<a class="headerlink" href="#Typical-approach" title="Permalink to this headline">¶</a></h3>
<p>First, we show how to define this model without concentrating out the scale, using statsmodels’ state space library:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">class</span> <span class="nc">LocalLevel</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">statespace</span><span class="o">.</span><span class="n">MLEModel</span><span class="p">):</span>
    <span class="n">_start_params</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span>
    <span class="n">_param_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'var.level'</span><span class="p">,</span> <span class="s1">'var.irregular'</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LocalLevel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">k_states</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">initialization</span><span class="o">=</span><span class="s1">'diffuse'</span><span class="p">)</span>

        <span class="bp">self</span><span class="p">[</span><span class="s1">'design'</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">'transition'</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">'selection'</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">transform_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unconstrained</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">unconstrained</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">def</span> <span class="nf">untransform_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unconstrained</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">unconstrained</span><span class="o">**</span><span class="mf">0.5</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">LocalLevel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="p">[</span><span class="s1">'state_cov'</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">'obs_cov'</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

</pre></div>
</div>
</div>
<p>There are two parameters in this model that must be chosen: <code class="docutils literal notranslate"><span class="pre">var.level</span></code> <span class="math notranslate nohighlight">\((\sigma_\eta^2)\)</span> and <code class="docutils literal notranslate"><span class="pre">var.irregular</span></code> <span class="math notranslate nohighlight">\((\sigma_\varepsilon^2)\)</span>. We can use the built-in <code class="docutils literal notranslate"><span class="pre">fit</span></code> method to choose them by numerically maximizing the likelihood function.</p>
<p>In our example, we are applying the local level model to consumer price index inflation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mod</span> <span class="o">=</span> <span class="n">LocalLevel</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">infl</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                           Statespace Model Results
==============================================================================
Dep. Variable:                   infl   No. Observations:                  203
Model:                     LocalLevel   Log Likelihood                -457.632
Date:                Fri, 21 Feb 2020   AIC                            921.263
Time:                        13:54:03   BIC                            931.203
Sample:                    03-31-1959   HQIC                           925.285
                         - 09-30-2009
Covariance Type:                  opg
=================================================================================
                    coef    std err          z      P&gt;|z|      [0.025      0.975]
---------------------------------------------------------------------------------
var.level         0.7447      0.156      4.766      0.000       0.438       1.051
var.irregular     3.3733      0.315     10.715      0.000       2.756       3.990
===================================================================================
Ljung-Box (Q):                       41.51   Jarque-Bera (JB):               182.26
Prob(Q):                              0.40   Prob(JB):                         0.00
Heteroskedasticity (H):               1.75   Skew:                            -1.02
Prob(H) (two-sided):                  0.02   Kurtosis:                         7.18
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
</pre></div></div>
</div>
<p>We can look at the results from the numerical optimizer in the results attribute <code class="docutils literal notranslate"><span class="pre">mle_retvals</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">mle_retvals</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{'fopt': 2.2543435113821833, 'gopt': array([-7.10298487e-06, -9.72852909e-06]), 'fcalls': 27, 'warnflag': 0, 'converged': True, 'iterations': 7}
</pre></div></div>
</div>


<h3 id="Concentrating-out-the-scale">Concentrating out the scale<a class="headerlink" href="#Concentrating-out-the-scale" title="Permalink to this headline">¶</a></h3>
<p>Now, there are two ways to reparameterize this model as above:</p>
<ol class="arabic simple">
<li><p>The first way is to set <span class="math notranslate nohighlight">\(\sigma_*^2 \equiv \sigma_\varepsilon^2\)</span> so that <span class="math notranslate nohighlight">\(\psi_* = \psi / \sigma_\varepsilon^2 = [1, q_\eta]\)</span> where <span class="math notranslate nohighlight">\(q_\eta = \sigma_\eta^2 / \sigma_\varepsilon^2\)</span>.</p></li>
<li><p>The second way is to set <span class="math notranslate nohighlight">\(\sigma_*^2 \equiv \sigma_\eta^2\)</span> so that <span class="math notranslate nohighlight">\(\psi_* = \psi / \sigma_\eta^2 = [h, 1]\)</span> where <span class="math notranslate nohighlight">\(h = \sigma_\varepsilon^2 / \sigma_\eta^2\)</span>.</p></li>
</ol>
<p>In the first case, we only need to numerically maximize the likelihood with respect to <span class="math notranslate nohighlight">\(q_\eta\)</span>, and in the second case we only need to numerically maximize the likelihood with respect to <span class="math notranslate nohighlight">\(h\)</span>.</p>
<p>Either approach would work well in most cases, and in the example below we will use the second method.</p>
<p>To reformulate the model to take advantage of the concentrated likelihood function, we need to write the model in terms of the parameter vector <span class="math notranslate nohighlight">\(\psi_* = [g, 1]\)</span>. Because this parameter vector defines <span class="math notranslate nohighlight">\(\sigma_\eta^2 \equiv 1\)</span>, we now include a new line <code class="docutils literal notranslate"><span class="pre">self['state_cov',</span> <span class="pre">0,</span> <span class="pre">0]</span> <span class="pre">=</span> <span class="pre">1</span></code> and the only unknown parameter is <span class="math notranslate nohighlight">\(h\)</span>. Because our parameter <span class="math notranslate nohighlight">\(h\)</span> is no longer a variance, we renamed it here to be <code class="docutils literal notranslate"><span class="pre">ratio.irregular</span></code>.</p>
<p>The key piece that is required to formulate the model so that the scale can be computed from the Kalman filter recursions (rather than selected numerically) is setting the flag <code class="docutils literal notranslate"><span class="pre">self.ssm.filter_concentrated</span> <span class="pre">=</span> <span class="pre">True</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">class</span> <span class="nc">LocalLevelConcentrated</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">statespace</span><span class="o">.</span><span class="n">MLEModel</span><span class="p">):</span>
    <span class="n">_start_params</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">]</span>
    <span class="n">_param_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'ratio.irregular'</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LocalLevelConcentrated</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">k_states</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">initialization</span><span class="o">=</span><span class="s1">'diffuse'</span><span class="p">)</span>

        <span class="bp">self</span><span class="p">[</span><span class="s1">'design'</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">'transition'</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">'selection'</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">'state_cov'</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ssm</span><span class="o">.</span><span class="n">filter_concentrated</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">transform_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unconstrained</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">unconstrained</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">def</span> <span class="nf">untransform_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unconstrained</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">unconstrained</span><span class="o">**</span><span class="mf">0.5</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">LocalLevelConcentrated</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">'obs_cov'</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

</pre></div>
</div>
</div>
<p>Again, we can use the built-in <code class="docutils literal notranslate"><span class="pre">fit</span></code> method to find the maximum likelihood estimate of <span class="math notranslate nohighlight">\(h\)</span>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mod_conc</span> <span class="o">=</span> <span class="n">LocalLevelConcentrated</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">infl</span><span class="p">)</span>
<span class="n">res_conc</span> <span class="o">=</span> <span class="n">mod_conc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res_conc</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                             Statespace Model Results
==================================================================================
Dep. Variable:                       infl   No. Observations:                  203
Model:             LocalLevelConcentrated   Log Likelihood                -457.632
Date:                    Fri, 21 Feb 2020   AIC                            921.263
Time:                            13:54:03   BIC                            931.203
Sample:                        03-31-1959   HQIC                           925.285
                             - 09-30-2009   Scale                            0.745
Covariance Type:                      opg
===================================================================================
                      coef    std err          z      P&gt;|z|      [0.025      0.975]
-----------------------------------------------------------------------------------
ratio.irregular     4.5297      1.226      3.694      0.000       2.126       6.933
===================================================================================
Ljung-Box (Q):                       41.51   Jarque-Bera (JB):               182.26
Prob(Q):                              0.40   Prob(JB):                         0.00
Heteroskedasticity (H):               1.75   Skew:                            -1.02
Prob(H) (two-sided):                  0.02   Kurtosis:                         7.18
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
</pre></div></div>
</div>
<p>The estimate of <span class="math notranslate nohighlight">\(h\)</span> is provided in the middle table of parameters (<code class="docutils literal notranslate"><span class="pre">ratio.irregular</span></code>), while the estimate of the scale is provided in the upper table. Below, we will show that these estimates are consistent with those from the previous approach.</p>
<p>And we can again look at the results from the numerical optimizer in the results attribute <code class="docutils literal notranslate"><span class="pre">mle_retvals</span></code>. It turns out that two fewer iterations were required in this case, since there was one fewer parameter to select. Moreover, since the numerical maximization problem was easier, the optimizer was able to find a value that made the gradient for this parameter slightly closer to zero than it was above.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">res_conc</span><span class="o">.</span><span class="n">mle_retvals</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{'fopt': 2.2543435111703576, 'gopt': array([-6.71906975e-08]), 'fcalls': 12, 'warnflag': 0, 'converged': True, 'iterations': 5}
</pre></div></div>
</div>


<h3 id="Comparing-estimates">Comparing estimates<a class="headerlink" href="#Comparing-estimates" title="Permalink to this headline">¶</a></h3>
<p>Recall that <span class="math notranslate nohighlight">\(h = \sigma_\varepsilon^2 / \sigma_\eta^2\)</span> and the scale is <span class="math notranslate nohighlight">\(\sigma_*^2 = \sigma_\eta^2\)</span>. Using these definitions, we can see that both models produce nearly identical results:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'Original model'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'var.level     = </span><span class="si">%.5f</span><span class="s1">'</span> <span class="o">%</span> <span class="n">res</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'var.irregular = </span><span class="si">%.5f</span><span class="s1">'</span> <span class="o">%</span> <span class="n">res</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">Concentrated model'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'scale         = </span><span class="si">%.5f</span><span class="s1">'</span> <span class="o">%</span> <span class="n">res_conc</span><span class="o">.</span><span class="n">scale</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'h * scale     = </span><span class="si">%.5f</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">res_conc</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">res_conc</span><span class="o">.</span><span class="n">scale</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Original model
var.level     = 0.74469
var.irregular = 3.37330

Concentrated model
scale         = 0.74472
h * scale     = 3.37338
</pre></div></div>
</div>



<h2 id="Example:-SARIMAX">Example: SARIMAX<a class="headerlink" href="#Example:-SARIMAX" title="Permalink to this headline">¶</a></h2>
<p>By default in SARIMAX models, the variance term is chosen by numerically maximizing the likelihood function, but an option has been added to allow concentrating the scale out.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Typical approach</span>
<span class="n">mod_ar</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">SARIMAX</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">cpi</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">trend</span><span class="o">=</span><span class="s1">'ct'</span><span class="p">)</span>
<span class="n">res_ar</span> <span class="o">=</span> <span class="n">mod_ar</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Estimating the model with the scale concentrated out</span>
<span class="n">mod_ar_conc</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">SARIMAX</span><span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">cpi</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">trend</span><span class="o">=</span><span class="s1">'ct'</span><span class="p">,</span> <span class="n">concentrate_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">res_ar_conc</span> <span class="o">=</span> <span class="n">mod_ar_conc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>These two approaches produce about the same loglikelihood and parameters, although the model with the concentrated scale was able to improve the fit very slightly:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'Loglikelihood'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'- Original model:     </span><span class="si">%.4f</span><span class="s1">'</span> <span class="o">%</span> <span class="n">res_ar</span><span class="o">.</span><span class="n">llf</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'- Concentrated model: </span><span class="si">%.4f</span><span class="s1">'</span> <span class="o">%</span> <span class="n">res_ar_conc</span><span class="o">.</span><span class="n">llf</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">Parameters'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'- Original model:     </span><span class="si">%.4f</span><span class="s1">, </span><span class="si">%.4f</span><span class="s1">, </span><span class="si">%.4f</span><span class="s1">, </span><span class="si">%.4f</span><span class="s1">'</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">res_ar</span><span class="o">.</span><span class="n">params</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'- Concentrated model: </span><span class="si">%.4f</span><span class="s1">, </span><span class="si">%.4f</span><span class="s1">, </span><span class="si">%.4f</span><span class="s1">, </span><span class="si">%.4f</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">res_ar_conc</span><span class="o">.</span><span class="n">params</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">res_ar_conc</span><span class="o">.</span><span class="n">scale</span><span class="p">,)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Loglikelihood
- Original model:     -245.8275
- Concentrated model: -245.8264

Parameters
- Original model:     0.4921, 0.0243, 0.9808, 0.6490
- Concentrated model: 0.4864, 0.0242, 0.9809, 0.6492
</pre></div></div>
</div>
<p>This time, about 1/3 fewer iterations of the optimizer are required under the concentrated approach:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'Optimizer iterations'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'- Original model:     </span><span class="si">%d</span><span class="s1">'</span> <span class="o">%</span> <span class="n">res_ar</span><span class="o">.</span><span class="n">mle_retvals</span><span class="p">[</span><span class="s1">'iterations'</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'- Concentrated model: </span><span class="si">%d</span><span class="s1">'</span> <span class="o">%</span> <span class="n">res_ar_conc</span><span class="o">.</span><span class="n">mle_retvals</span><span class="p">[</span><span class="s1">'iterations'</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Optimizer iterations
- Original model:     36
- Concentrated model: 22
</pre></div></div>
</div>




          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="statespace_fixed_params.html" title="Material"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Estimating or specifying parameters in state space models </span>
              </div>
            </a>
          
          
            <a href="pca_fertility_factors.html" title="Admonition"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> statsmodels Principal Component Analysis </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2009-2019, Josef Perktold, Skipper Seabold, Jonathan Taylor, statsmodels-developers.
              
          </div>
            Last updated on
              Feb 21, 2020.
            <br/>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 2.4.2.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../../../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>