

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>statsmodels.tsa.arima_model &#8212; statsmodels v0.10.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../../_static/statsmodels_hybi_favico.ico"/>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<link rel="stylesheet" href="../../../_static/examples.css" type="text/css" />
<link rel="stylesheet" href="../../../_static/facebox.css" type="text/css" />
<script type="text/javascript" src="../../../_static/scripts.js">
</script>
<script type="text/javascript" src="../../../_static/facebox.js">
</script>
<script type="text/javascript">
$.facebox.settings.closeImage = "../../../_static/closelabel.png"
$.facebox.settings.loadingImage = "../../../_static/loading.gif"
</script>

<script>
$(document).ready(function() {
  $.getJSON("../../../../versions.json", function(versions) {
    var dropdown = document.createElement("div");
    dropdown.className = "dropdown";
    var button = document.createElement("button");
    button.className = "dropbtn";
    button.innerHTML = "Other Versions";
    var content = document.createElement("div");
    content.className = "dropdown-content";
    dropdown.appendChild(button);
    dropdown.appendChild(content);
    $(".header").prepend(dropdown);
    for (var i = 0; i < versions.length; i++) {
      if (versions[i].substring(0, 1) == "v") {
        versions[i] = [versions[i], versions[i].substring(1)];
      } else {
        versions[i] = [versions[i], versions[i]];
      };
    };
    for (var i = 0; i < versions.length; i++) {
      var a = document.createElement("a");
      a.innerHTML = versions[i][1];
      a.href = "../../../../" + versions[i][0] + "/index.html";
      a.title = versions[i][1];
      $(".dropdown-content").append(a);
    };
  });
});
</script>


  </head><body>
<div class="headerwrap">
    <div class = "header">
        
        <a href = "../../../index.html">
<img src="../../../_static/statsmodels_hybi_banner.png" alt="Logo"
    style="padding-left: 15px"/></a>
        
    </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
<li><a href ="../../../install.html">Install</a></li> &nbsp;|&nbsp;
<li><a href="https://groups.google.com/forum/?hl=en#!forum/pystatsmodels">Support</a></li> &nbsp;|&nbsp;
<li><a href="https://github.com/statsmodels/statsmodels/issues">Bugs</a></li> &nbsp;|&nbsp;
<li><a href="../../../dev/index.html">Develop</a></li> &nbsp;|&nbsp;
<li><a href="../../../examples/index.html">Examples</a></li> &nbsp;|&nbsp;
<li><a href="../../../faq.html">FAQ</a></li> &nbsp;|&nbsp;

          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> |</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            




  <h1>Source code for statsmodels.tsa.arima_model</h1><div class="highlight"><pre>
<span></span><span class="c1"># Note: The information criteria add 1 to the number of parameters</span>
<span class="c1">#       whenever the model has an AR or MA term since, in principle,</span>
<span class="c1">#       the variance could be treated as a free parameter and restricted</span>
<span class="c1">#       This code does not allow this, but it adds consistency with other</span>
<span class="c1">#       packages such as gretl and X12-ARIMA</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">statsmodels.compat.python</span> <span class="k">import</span> <span class="n">string_types</span><span class="p">,</span> <span class="nb">range</span><span class="p">,</span> <span class="n">long</span>
<span class="c1"># for 2to3 with extensions</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">optimize</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">t</span><span class="p">,</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="k">import</span> <span class="n">lfilter</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">dot</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">zeros</span><span class="p">,</span> <span class="n">pi</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="k">import</span> <span class="n">inv</span>

<span class="kn">from</span> <span class="nn">statsmodels.tools.decorators</span> <span class="k">import</span> <span class="n">cache_readonly</span>
<span class="kn">import</span> <span class="nn">statsmodels.tsa.base.tsa_model</span> <span class="k">as</span> <span class="nn">tsbase</span>
<span class="kn">import</span> <span class="nn">statsmodels.base.wrapper</span> <span class="k">as</span> <span class="nn">wrap</span>
<span class="kn">from</span> <span class="nn">statsmodels.regression.linear_model</span> <span class="k">import</span> <span class="n">yule_walker</span><span class="p">,</span> <span class="n">OLS</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.tsatools</span> <span class="k">import</span> <span class="p">(</span><span class="n">lagmat</span><span class="p">,</span> <span class="n">add_trend</span><span class="p">,</span>
                                      <span class="n">_ar_transparams</span><span class="p">,</span> <span class="n">_ar_invtransparams</span><span class="p">,</span>
                                      <span class="n">_ma_transparams</span><span class="p">,</span> <span class="n">_ma_invtransparams</span><span class="p">,</span>
                                      <span class="n">unintegrate</span><span class="p">,</span> <span class="n">unintegrate_levels</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.vector_ar</span> <span class="k">import</span> <span class="n">util</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.ar_model</span> <span class="k">import</span> <span class="n">AR</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima_process</span> <span class="k">import</span> <span class="n">arma2ma</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools.numdiff</span> <span class="k">import</span> <span class="n">approx_hess_cs</span><span class="p">,</span> <span class="n">approx_fprime_cs</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.kalmanf</span> <span class="k">import</span> <span class="n">KalmanFilter</span>

<span class="n">_armax_notes</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Notes</span>
<span class="s2">    -----</span>
<span class="s2">    If exogenous variables are given, then the model that is fit is</span>

<span class="s2">    .. math::</span>

<span class="s2">       \phi(L)(y_t - X_t\beta) = \theta(L)\epsilon_t</span>

<span class="s2">    where :math:`\phi` and :math:`\theta` are polynomials in the lag</span>
<span class="s2">    operator, :math:`L`. This is the regression model with ARMA errors,</span>
<span class="s2">    or ARMAX model. This specification is used, whether or not the model</span>
<span class="s2">    is fit using conditional sum of square or maximum-likelihood, using</span>
<span class="s2">    the `method` argument in</span>
<span class="s2">    :meth:`statsmodels.tsa.arima_model.</span><span class="si">%(Model)s</span><span class="s2">.fit`. Therefore, for</span>
<span class="s2">    now, `css` and `mle` refer to estimation methods only. This may</span>
<span class="s2">    change for the case of the `css` model in future versions.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">_arma_params</span> <span class="o">=</span> \
<span class="sd">&quot;&quot;&quot;endog : array-like</span>
<span class="sd">        The endogenous variable.</span>
<span class="sd">    order : iterable</span>
<span class="sd">        The (p,q) order of the model for the number of AR parameters,</span>
<span class="sd">        differences, and MA parameters to use.</span>
<span class="sd">    exog : array-like, optional</span>
<span class="sd">        An optional array of exogenous variables. This should *not* include a</span>
<span class="sd">        constant or trend. You can specify this in the `fit` method.&quot;&quot;&quot;</span>

<span class="n">_arma_model</span> <span class="o">=</span> <span class="s2">&quot;Autoregressive Moving Average ARMA(p,q) Model&quot;</span>

<span class="n">_arima_model</span> <span class="o">=</span> <span class="s2">&quot;Autoregressive Integrated Moving Average ARIMA(p,d,q) Model&quot;</span>

<span class="n">_arima_params</span> <span class="o">=</span> \
<span class="sd">&quot;&quot;&quot;endog : array-like</span>
<span class="sd">        The endogenous variable.</span>
<span class="sd">    order : iterable</span>
<span class="sd">        The (p,d,q) order of the model for the number of AR parameters,</span>
<span class="sd">        differences, and MA parameters to use.</span>
<span class="sd">    exog : array-like, optional</span>
<span class="sd">        An optional array of exogenous variables. This should *not* include a</span>
<span class="sd">        constant or trend. You can specify this in the `fit` method.&quot;&quot;&quot;</span>

<span class="n">_predict_notes</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Notes</span>
<span class="s2">        -----</span>
<span class="s2">        Use the results predict method instead.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">_results_notes</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Notes</span>
<span class="s2">        -----</span>
<span class="s2">        It is recommended to use dates with the time-series models, as the</span>
<span class="s2">        below will probably make clear. However, if ARIMA is used without</span>
<span class="s2">        dates and/or `start` and `end` are given as indices, then these</span>
<span class="s2">        indices are in terms of the *original*, undifferenced series. Ie.,</span>
<span class="s2">        given some undifferenced observations::</span>

<span class="s2">         1970Q1, 1</span>
<span class="s2">         1970Q2, 1.5</span>
<span class="s2">         1970Q3, 1.25</span>
<span class="s2">         1970Q4, 2.25</span>
<span class="s2">         1971Q1, 1.2</span>
<span class="s2">         1971Q2, 4.1</span>

<span class="s2">        1970Q1 is observation 0 in the original series. However, if we fit an</span>
<span class="s2">        ARIMA(p,1,q) model then we lose this first observation through</span>
<span class="s2">        differencing. Therefore, the first observation we can forecast (if</span>
<span class="s2">        using exact MLE) is index 1. In the differenced series this is index</span>
<span class="s2">        0, but we refer to it as 1 from the original series.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">_predict</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">%(Model)s</span><span class="s2"> model in-sample and out-of-sample prediction</span>

<span class="s2">        Parameters</span>
<span class="s2">        ----------</span>
<span class="s2">        </span><span class="si">%(params)s</span><span class="s2"></span>
<span class="s2">        start : int, str, or datetime</span>
<span class="s2">            Zero-indexed observation number at which to start forecasting, ie.,</span>
<span class="s2">            the first forecast is start. Can also be a date string to</span>
<span class="s2">            parse or a datetime type.</span>
<span class="s2">        end : int, str, or datetime</span>
<span class="s2">            Zero-indexed observation number at which to end forecasting, ie.,</span>
<span class="s2">            the first forecast is start. Can also be a date string to</span>
<span class="s2">            parse or a datetime type. However, if the dates index does not</span>
<span class="s2">            have a fixed frequency, end must be an integer index if you</span>
<span class="s2">            want out of sample prediction.</span>
<span class="s2">        exog : array-like, optional</span>
<span class="s2">            If the model is an ARMAX and out-of-sample forecasting is</span>
<span class="s2">            requested, exog must be given. Note that you&#39;ll need to pass</span>
<span class="s2">            `k_ar` additional lags for any exogenous variables. E.g., if you</span>
<span class="s2">            fit an ARMAX(2, q) model and want to predict 5 steps, you need 7</span>
<span class="s2">            observations to do this.</span>
<span class="s2">        dynamic : bool, optional</span>
<span class="s2">            The `dynamic` keyword affects in-sample prediction. If dynamic</span>
<span class="s2">            is False, then the in-sample lagged values are used for</span>
<span class="s2">            prediction. If `dynamic` is True, then in-sample forecasts are</span>
<span class="s2">            used in place of lagged dependent variables. The first forecasted</span>
<span class="s2">            value is `start`.</span>
<span class="s2">        </span><span class="si">%(extra_params)s</span><span class="s2"></span>

<span class="s2">        Returns</span>
<span class="s2">        -------</span>
<span class="s2">        </span><span class="si">%(returns)s</span><span class="s2"></span>
<span class="s2">        </span><span class="si">%(extra_section)s</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">_predict_returns</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;predict : array</span>
<span class="s2">            The predicted values.</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="n">_arma_predict</span> <span class="o">=</span> <span class="n">_predict</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;Model&quot;</span> <span class="p">:</span> <span class="s2">&quot;ARMA&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;params&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;&quot;params : array-like</span>
<span class="s2">            The fitted parameters of the model.&quot;&quot;&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;extra_params&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;returns&quot;</span> <span class="p">:</span> <span class="n">_predict_returns</span><span class="p">,</span>
                            <span class="s2">&quot;extra_section&quot;</span> <span class="p">:</span> <span class="n">_predict_notes</span><span class="p">}</span>

<span class="n">_arma_results_predict</span> <span class="o">=</span> <span class="n">_predict</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;Model&quot;</span> <span class="p">:</span> <span class="s2">&quot;ARMA&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;extra_params&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;returns&quot;</span> <span class="p">:</span> <span class="n">_predict_returns</span><span class="p">,</span>
                                    <span class="s2">&quot;extra_section&quot;</span> <span class="p">:</span> <span class="n">_results_notes</span><span class="p">}</span>
<span class="n">_arima_extras</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;typ : str {&#39;linear&#39;, &#39;levels&#39;}</span>

<span class="s2">            - &#39;linear&#39; : Linear prediction in terms of the differenced</span>
<span class="s2">              endogenous variables.</span>
<span class="s2">            - &#39;levels&#39; : Predict the levels of the original endogenous</span>
<span class="s2">              variables.</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>

<span class="n">_arima_predict</span> <span class="o">=</span> <span class="n">_predict</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;Model&quot;</span> <span class="p">:</span> <span class="s2">&quot;ARIMA&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;params&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;&quot;params : array-like</span>
<span class="s2">            The fitted parameters of the model.&quot;&quot;&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;extra_params&quot;</span> <span class="p">:</span> <span class="n">_arima_extras</span><span class="p">,</span>
                             <span class="s2">&quot;returns&quot;</span> <span class="p">:</span> <span class="n">_predict_returns</span><span class="p">,</span>
                             <span class="s2">&quot;extra_section&quot;</span> <span class="p">:</span> <span class="n">_predict_notes</span><span class="p">}</span>

<span class="n">_arima_results_predict</span> <span class="o">=</span> <span class="n">_predict</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;Model&quot;</span> <span class="p">:</span> <span class="s2">&quot;ARIMA&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;params&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;extra_params&quot;</span> <span class="p">:</span><span class="n">_arima_extras</span><span class="p">,</span>
                                     <span class="s2">&quot;returns&quot;</span> <span class="p">:</span> <span class="n">_predict_returns</span><span class="p">,</span>
                                     <span class="s2">&quot;extra_section&quot;</span> <span class="p">:</span> <span class="n">_results_notes</span><span class="p">}</span>

<span class="n">_arima_plot_predict_example</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;        Examples</span>
<span class="s2">        --------</span>
<span class="s2">        &gt;&gt;&gt; import statsmodels.api as sm</span>
<span class="s2">        &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="s2">        &gt;&gt;&gt; import pandas as pd</span>
<span class="s2">        &gt;&gt;&gt;</span>
<span class="s2">        &gt;&gt;&gt; dta = sm.datasets.sunspots.load_pandas().data[[&#39;SUNACTIVITY&#39;]]</span>
<span class="s2">        &gt;&gt;&gt; dta.index = pd.date_range(start=&#39;1700&#39;, end=&#39;2009&#39;, freq=&#39;A&#39;)</span>
<span class="s2">        &gt;&gt;&gt; res = sm.tsa.ARMA(dta, (3, 0)).fit()</span>
<span class="s2">        &gt;&gt;&gt; fig, ax = plt.subplots()</span>
<span class="s2">        &gt;&gt;&gt; ax = dta.loc[&#39;1950&#39;:].plot(ax=ax)</span>
<span class="s2">        &gt;&gt;&gt; fig = res.plot_predict(&#39;1990&#39;, &#39;2012&#39;, dynamic=True, ax=ax,</span>
<span class="s2">        ...                        plot_insample=False)</span>
<span class="s2">        &gt;&gt;&gt; plt.show()</span>

<span class="s2">        .. plot:: plots/arma_predict_plot.py</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">_plot_extras</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;alpha : float, optional</span>
<span class="s2">            The confidence intervals for the forecasts are (1 - alpha)%</span>
<span class="s2">        plot_insample : bool, optional</span>
<span class="s2">            Whether to plot the in-sample series. Default is True.</span>
<span class="s2">        ax : matplotlib.Axes, optional</span>
<span class="s2">            Existing axes to plot with.&quot;&quot;&quot;</span>

<span class="n">_plot_predict</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Plot forecasts</span>
<span class="s2">                      &quot;&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_predict</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]))</span> <span class="o">%</span> <span class="p">{</span>
    <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;extra_params&quot;</span><span class="p">:</span> <span class="n">_plot_extras</span><span class="p">,</span>
    <span class="s2">&quot;returns&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;fig : matplotlib.Figure</span>
<span class="s2">            The plotted Figure instance&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;extra_section&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">_arima_plot_predict_example</span> <span class="o">+</span>
                       <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">_results_notes</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">_arima_plot_predict</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Plot forecasts</span>
<span class="s2">                      &quot;&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_predict</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]))</span> <span class="o">%</span> <span class="p">{</span>
    <span class="s2">&quot;params&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;extra_params&quot;</span> <span class="p">:</span> <span class="n">_plot_extras</span><span class="p">,</span>
    <span class="s2">&quot;returns&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;&quot;fig : matplotlib.Figure</span>
<span class="s2">            The plotted Figure instance&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;extra_section&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">_arima_plot_predict_example</span> <span class="o">+</span>
                                   <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                                   <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_results_notes</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="mi">3</span><span class="p">])</span> <span class="o">+</span>
                              <span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        This is hard-coded to only allow plotting of the forecasts in levels.</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span> <span class="o">+</span>
                              <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_results_notes</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">3</span><span class="p">:]))</span>
                      <span class="p">}</span>


<span class="k">def</span> <span class="nf">cumsum_n</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x</span>


<span class="k">def</span> <span class="nf">_check_arima_start</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">k_ar</span><span class="p">,</span> <span class="n">k_diff</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The start index </span><span class="si">%d</span><span class="s2"> of the original series &quot;</span>
                         <span class="s2">&quot;has been differenced away&quot;</span> <span class="o">%</span> <span class="n">start</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">dynamic</span> <span class="ow">or</span> <span class="s1">&#39;mle&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">method</span><span class="p">)</span> <span class="ow">and</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">k_ar</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Start must be &gt;= k_ar for conditional MLE &quot;</span>
                         <span class="s2">&quot;or dynamic forecast. Got </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">start</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_get_predict_out_of_sample</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">k_trend</span><span class="p">,</span> <span class="n">k_exog</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span>
                               <span class="n">trendparam</span><span class="p">,</span> <span class="n">exparams</span><span class="p">,</span> <span class="n">arparams</span><span class="p">,</span> <span class="n">maparams</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span>
                               <span class="n">method</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns endog, resid, mu of appropriate length for out of sample</span>
<span class="sd">    prediction.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">q</span><span class="p">:</span>
        <span class="n">resid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">and</span> <span class="s1">&#39;mle&#39;</span> <span class="ow">in</span> <span class="n">method</span> <span class="ow">or</span> <span class="p">(</span><span class="n">start</span> <span class="o">==</span> <span class="n">p</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">start</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">resid</span><span class="p">[:</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[</span><span class="n">start</span><span class="o">-</span><span class="n">q</span><span class="p">:</span><span class="n">start</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">start</span><span class="p">:</span>
            <span class="n">resid</span><span class="p">[:</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[</span><span class="n">start</span><span class="o">-</span><span class="n">q</span><span class="o">-</span><span class="n">p</span><span class="p">:</span><span class="n">start</span><span class="o">-</span><span class="n">p</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">resid</span><span class="p">[:</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[</span><span class="o">-</span><span class="n">q</span><span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">resid</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">endog</span>
    <span class="k">if</span> <span class="n">k_trend</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># use expectation not constant</span>
        <span class="k">if</span> <span class="n">k_exog</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#TODO: technically should only hold for MLE not</span>
            <span class="c1"># conditional model. See #274.</span>
            <span class="c1"># ensure 2-d for conformability</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">exog</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">k_exog</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># have a 1d series of observations -&gt; 2d</span>
                <span class="n">exog</span> <span class="o">=</span> <span class="n">exog</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">exog</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># should have a 1d row of exog -&gt; 2d</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">exog</span><span class="p">)</span> <span class="o">!=</span> <span class="n">k_exog</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;1d exog given and len(exog) != k_exog&quot;</span><span class="p">)</span>
                <span class="n">exog</span> <span class="o">=</span> <span class="n">exog</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">lagmat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="n">exparams</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">original</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="n">trendparam</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">arparams</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
            <span class="c1"># arparams were reversed in unpack for ease later</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">arparams</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="n">trendparam</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">arparams</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mu</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">k_exog</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="n">exparams</span><span class="p">)</span>
        <span class="c1">#NOTE: you shouldn&#39;t have to give in-sample exog!</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">lagmat</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">original</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">arparams</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>

    <span class="n">endog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">p</span> <span class="ow">and</span> <span class="n">start</span><span class="p">:</span>
        <span class="n">endog</span><span class="p">[:</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">start</span><span class="o">-</span><span class="n">p</span><span class="p">:</span><span class="n">start</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">endog</span><span class="p">[:</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="n">p</span><span class="p">:]</span>

    <span class="k">return</span> <span class="n">endog</span><span class="p">,</span> <span class="n">resid</span><span class="p">,</span> <span class="n">mu</span>


<span class="k">def</span> <span class="nf">_arma_predict_out_of_sample</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">k_trend</span><span class="p">,</span> <span class="n">k_exog</span><span class="p">,</span>
                                <span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;mle&#39;</span><span class="p">):</span>
    <span class="p">(</span><span class="n">trendparam</span><span class="p">,</span> <span class="n">exparams</span><span class="p">,</span>
     <span class="n">arparams</span><span class="p">,</span> <span class="n">maparams</span><span class="p">)</span> <span class="o">=</span> <span class="n">_unpack_params</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">k_trend</span><span class="p">,</span>
                                          <span class="n">k_exog</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">endog</span><span class="p">,</span> <span class="n">resid</span><span class="p">,</span> <span class="n">mu</span> <span class="o">=</span> <span class="n">_get_predict_out_of_sample</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">k_trend</span><span class="p">,</span> <span class="n">k_exog</span><span class="p">,</span>
                                                  <span class="n">start</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">trendparam</span><span class="p">,</span>
                                                  <span class="n">exparams</span><span class="p">,</span> <span class="n">arparams</span><span class="p">,</span>
                                                  <span class="n">maparams</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span>
                                                  <span class="n">exog</span><span class="p">)</span>

    <span class="n">forecast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">steps</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">q</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">arparams</span><span class="p">,</span> <span class="n">endog</span><span class="p">[:</span><span class="n">p</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">maparams</span><span class="p">,</span>
                                                                <span class="n">resid</span><span class="p">[:</span><span class="n">q</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">arparams</span><span class="p">,</span> <span class="n">endog</span><span class="p">[:</span><span class="n">p</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">q</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># if q == 1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="n">fcast</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">arparams</span><span class="p">,</span> <span class="n">endog</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">p</span><span class="p">])</span> <span class="o">+</span>
                 <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">maparams</span><span class="p">[:</span><span class="n">q</span> <span class="o">-</span> <span class="n">i</span><span class="p">],</span> <span class="n">resid</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">q</span><span class="p">]))</span>
        <span class="n">forecast</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fcast</span>
        <span class="n">endog</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">fcast</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">fcast</span> <span class="o">=</span> <span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">arparams</span><span class="p">,</span> <span class="n">endog</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">p</span><span class="p">])</span>
        <span class="n">forecast</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fcast</span>
        <span class="n">endog</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">fcast</span>

    <span class="c1">#need to do one more without updating endog</span>
    <span class="n">forecast</span><span class="p">[</span><span class="n">steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu</span><span class="p">[</span><span class="n">steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">arparams</span><span class="p">,</span> <span class="n">endog</span><span class="p">[</span><span class="n">steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:])</span>
    <span class="k">return</span> <span class="n">forecast</span>


<span class="k">def</span> <span class="nf">_arma_predict_in_sample</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="n">resid</span><span class="p">,</span> <span class="n">k_ar</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pre- and in-sample fitting for ARMA.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;mle&#39;</span> <span class="ow">in</span> <span class="n">method</span><span class="p">:</span>
        <span class="n">fittedvalues</span> <span class="o">=</span> <span class="n">endog</span> <span class="o">-</span> <span class="n">resid</span>  <span class="c1"># get them all then trim</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fittedvalues</span> <span class="o">=</span> <span class="n">endog</span><span class="p">[</span><span class="n">k_ar</span><span class="p">:]</span> <span class="o">-</span> <span class="n">resid</span>

    <span class="n">fv_start</span> <span class="o">=</span> <span class="n">start</span>
    <span class="k">if</span> <span class="s1">&#39;mle&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">method</span><span class="p">:</span>
        <span class="n">fv_start</span> <span class="o">-=</span> <span class="n">k_ar</span>  <span class="c1"># start is in terms of endog index</span>
    <span class="n">fv_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fittedvalues</span><span class="p">),</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fittedvalues</span><span class="p">[</span><span class="n">fv_start</span><span class="p">:</span><span class="n">fv_end</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_unpack_params</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">k_trend</span><span class="p">,</span> <span class="n">k_exog</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">order</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">k_trend</span> <span class="o">+</span> <span class="n">k_exog</span>
    <span class="n">maparams</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="n">p</span><span class="p">:]</span>
    <span class="n">arparams</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="n">p</span><span class="p">]</span>
    <span class="n">trend</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:</span><span class="n">k_trend</span><span class="p">]</span>
    <span class="n">exparams</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">k_trend</span><span class="p">:</span><span class="n">k</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">trend</span><span class="p">,</span> <span class="n">exparams</span><span class="p">,</span> <span class="n">arparams</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">maparams</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">trend</span><span class="p">,</span> <span class="n">exparams</span><span class="p">,</span> <span class="n">arparams</span><span class="p">,</span> <span class="n">maparams</span>


<span class="k">def</span> <span class="nf">_unpack_order</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
    <span class="n">k_ar</span><span class="p">,</span> <span class="n">k_ma</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">order</span>
    <span class="n">k_lags</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">k_ar</span><span class="p">,</span> <span class="n">k_ma</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">k_ar</span><span class="p">,</span> <span class="n">k_ma</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">k_lags</span>


<span class="k">def</span> <span class="nf">_make_arma_names</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">k_trend</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">exog_names</span><span class="p">):</span>
    <span class="n">k_ar</span><span class="p">,</span> <span class="n">k_ma</span> <span class="o">=</span> <span class="n">order</span>
    <span class="n">exog_names</span> <span class="o">=</span> <span class="n">exog_names</span> <span class="ow">or</span> <span class="p">[]</span>
    <span class="n">ar_lag_names</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">make_lag_names</span><span class="p">([</span><span class="n">data</span><span class="o">.</span><span class="n">ynames</span><span class="p">],</span> <span class="n">k_ar</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">ar_lag_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;ar.&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ar_lag_names</span><span class="p">]</span>
    <span class="n">ma_lag_names</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">make_lag_names</span><span class="p">([</span><span class="n">data</span><span class="o">.</span><span class="n">ynames</span><span class="p">],</span> <span class="n">k_ma</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">ma_lag_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;ma.&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ma_lag_names</span><span class="p">]</span>
    <span class="n">trend_name</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">make_lag_names</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k_trend</span><span class="p">)</span>

    <span class="n">exog_names</span> <span class="o">=</span> <span class="n">trend_name</span> <span class="o">+</span> <span class="n">exog_names</span> <span class="o">+</span> <span class="n">ar_lag_names</span> <span class="o">+</span> <span class="n">ma_lag_names</span>
    <span class="k">return</span> <span class="n">exog_names</span>


<span class="k">def</span> <span class="nf">_make_arma_exog</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">trend</span><span class="p">):</span>
    <span class="n">k_trend</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># overwritten if no constant</span>
    <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">trend</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>   <span class="c1"># constant only</span>
        <span class="n">exog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">endog</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">trend</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>  <span class="c1"># constant plus exogenous</span>
        <span class="n">exog</span> <span class="o">=</span> <span class="n">add_trend</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="n">trend</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">prepend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">has_constant</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">trend</span> <span class="o">==</span> <span class="s1">&#39;nc&#39;</span><span class="p">:</span>
        <span class="c1"># make sure it&#39;s not holding constant from last run</span>
        <span class="k">if</span> <span class="n">exog</span><span class="o">.</span><span class="n">var</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">k_trend</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">trend</span> <span class="o">==</span> <span class="s1">&#39;nc&#39;</span><span class="p">:</span>
        <span class="n">k_trend</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">k_trend</span><span class="p">,</span> <span class="n">exog</span>


<span class="k">def</span> <span class="nf">_check_estimable</span><span class="p">(</span><span class="n">nobs</span><span class="p">,</span> <span class="n">n_params</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">nobs</span> <span class="o">&lt;=</span> <span class="n">n_params</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Insufficient degrees of freedom to estimate&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="ARMA"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMA.html#statsmodels.tsa.arima_model.ARMA">[docs]</a><span class="k">class</span> <span class="nc">ARMA</span><span class="p">(</span><span class="n">tsbase</span><span class="o">.</span><span class="n">TimeSeriesModel</span><span class="p">):</span>

    <span class="vm">__doc__</span> <span class="o">=</span> <span class="n">tsbase</span><span class="o">.</span><span class="n">_tsa_doc</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;model&quot;</span> <span class="p">:</span> <span class="n">_arma_model</span><span class="p">,</span>
                                 <span class="s2">&quot;params&quot;</span> <span class="p">:</span> <span class="n">_arma_params</span><span class="p">,</span> <span class="s2">&quot;extra_params&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;extra_sections&quot;</span> <span class="p">:</span> <span class="n">_armax_notes</span> <span class="o">%</span>
                                 <span class="p">{</span><span class="s2">&quot;Model&quot;</span> <span class="p">:</span> <span class="s2">&quot;ARMA&quot;</span><span class="p">}}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">missing</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ARMA</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">dates</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="n">missing</span><span class="p">)</span>
        <span class="c1"># GH 2575</span>
        <span class="n">_endog</span> <span class="o">=</span> <span class="n">endog</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="s1">&#39;ndim&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">endog</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_endog</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">_endog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_endog</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;endog must be 1-d or 2-d with 1 column&#39;</span><span class="p">)</span>
        <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">exog</span>  <span class="c1"># get it after it&#39;s gone through processing</span>
        <span class="n">_check_estimable</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">),</span> <span class="nb">sum</span><span class="p">(</span><span class="n">order</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span> <span class="o">=</span> <span class="n">k_ar</span> <span class="o">=</span> <span class="n">order</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_ma</span> <span class="o">=</span> <span class="n">k_ma</span> <span class="o">=</span> <span class="n">order</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_lags</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">k_ar</span><span class="p">,</span> <span class="n">k_ma</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exog</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">exog</span> <span class="o">=</span> <span class="n">exog</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
            <span class="n">k_exog</span> <span class="o">=</span> <span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># number of exog. variables excl. const</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">k_exog</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span> <span class="o">=</span> <span class="n">k_exog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_exog_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog_names</span>

    <span class="k">def</span> <span class="nf">_fit_start_params_hr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">start_ar_lags</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get starting parameters for fit.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        order : iterable</span>
<span class="sd">            (p,q,k) - AR lags, MA lags, and number of exogenous variables</span>
<span class="sd">            including the constant.</span>
<span class="sd">        start_ar_lags : int, optional</span>
<span class="sd">            If start_ar_lags is not None, rather than fitting an AR process</span>
<span class="sd">            according to best BIC, fits an AR process with a lag length equal</span>
<span class="sd">            to start_ar_lags.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        start_params : array</span>
<span class="sd">            A first guess at the starting parameters.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If necessary, fits an AR process with the laglength start_ar_lags, or</span>
<span class="sd">        selected according to best BIC if start_ar_lags is None.  Obtain the</span>
<span class="sd">        residuals.  Then fit an ARMA(p,q) model via OLS using these residuals</span>
<span class="sd">        for a first approximation.  Uses a separate OLS regression to find the</span>
<span class="sd">        coefficients of exogenous variables.</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        Hannan, E.J. and Rissanen, J.  1982.  &quot;Recursive estimation of mixed</span>
<span class="sd">            autoregressive-moving average order.&quot;  `Biometrika`.  69.1.</span>

<span class="sd">        Durbin, J. 1960. &quot;The Fitting of Time-Series Models.&quot;</span>
<span class="sd">        `Review of the International Statistical Institute`. Vol. 28, No. 3</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">order</span>
        <span class="n">start_params</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">p</span><span class="o">+</span><span class="n">q</span><span class="o">+</span><span class="n">k</span><span class="p">))</span>
        <span class="c1"># make copy of endog because overwritten</span>
        <span class="n">endog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ols_params</span> <span class="o">=</span> <span class="n">OLS</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">params</span>
            <span class="n">start_params</span><span class="p">[:</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">ols_params</span>
            <span class="n">endog</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="n">ols_params</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">q</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># make sure we don&#39;t run into small data problems in AR fit</span>
                <span class="n">nobs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">endog</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">start_ar_lags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">maxlag</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">12</span><span class="o">*</span><span class="p">(</span><span class="n">nobs</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">4.</span><span class="p">)))</span>
                    <span class="k">if</span> <span class="n">maxlag</span> <span class="o">&gt;=</span> <span class="n">nobs</span><span class="p">:</span>
                        <span class="n">maxlag</span> <span class="o">=</span> <span class="n">nobs</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="n">armod</span> <span class="o">=</span> <span class="n">AR</span><span class="p">(</span><span class="n">endog</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">ic</span><span class="o">=</span><span class="s1">&#39;bic&#39;</span><span class="p">,</span> <span class="n">trend</span><span class="o">=</span><span class="s1">&#39;nc&#39;</span><span class="p">,</span> <span class="n">maxlag</span><span class="o">=</span><span class="n">maxlag</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">start_ar_lags</span> <span class="o">&gt;=</span> <span class="n">nobs</span><span class="p">:</span>
                        <span class="n">start_ar_lags</span> <span class="o">=</span> <span class="n">nobs</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="n">armod</span> <span class="o">=</span> <span class="n">AR</span><span class="p">(</span><span class="n">endog</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trend</span><span class="o">=</span><span class="s1">&#39;nc&#39;</span><span class="p">,</span> <span class="n">maxlag</span><span class="o">=</span><span class="n">start_ar_lags</span><span class="p">)</span>
                <span class="n">arcoefs_tmp</span> <span class="o">=</span> <span class="n">armod</span><span class="o">.</span><span class="n">params</span>
                <span class="n">p_tmp</span> <span class="o">=</span> <span class="n">armod</span><span class="o">.</span><span class="n">k_ar</span>
                <span class="c1"># it&#39;s possible in small samples that optimal lag-order</span>
                <span class="c1"># doesn&#39;t leave enough obs. No consistent way to fix.</span>
                <span class="k">if</span> <span class="n">p_tmp</span> <span class="o">+</span> <span class="n">q</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">endog</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Proper starting parameters cannot&quot;</span>
                                     <span class="s2">&quot; be found for this order with this &quot;</span>
                                     <span class="s2">&quot;number of observations. Use the &quot;</span>
                                     <span class="s2">&quot;start_params argument, or set &quot;</span>
                                     <span class="s2">&quot;start_ar_lags to an integer less than &quot;</span>
                                     <span class="s2">&quot;len(endog) - q.&quot;</span><span class="p">)</span>
                <span class="n">resid</span> <span class="o">=</span> <span class="n">endog</span><span class="p">[</span><span class="n">p_tmp</span><span class="p">:]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lagmat</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">p_tmp</span><span class="p">,</span>
                                                      <span class="n">trim</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">),</span>
                                               <span class="n">arcoefs_tmp</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">p_tmp</span> <span class="o">+</span> <span class="n">q</span><span class="p">:</span>
                    <span class="n">endog_start</span> <span class="o">=</span> <span class="n">p_tmp</span> <span class="o">+</span> <span class="n">q</span> <span class="o">-</span> <span class="n">p</span>
                    <span class="n">resid_start</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">endog_start</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">resid_start</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">p_tmp</span> <span class="o">-</span> <span class="n">q</span>
                <span class="n">lag_endog</span> <span class="o">=</span> <span class="n">lagmat</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="s1">&#39;both&#39;</span><span class="p">)[</span><span class="n">endog_start</span><span class="p">:]</span>
                <span class="n">lag_resid</span> <span class="o">=</span> <span class="n">lagmat</span><span class="p">(</span><span class="n">resid</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="s1">&#39;both&#39;</span><span class="p">)[</span><span class="n">resid_start</span><span class="p">:]</span>
                <span class="c1"># stack ar lags and resids</span>
                <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">lag_endog</span><span class="p">,</span> <span class="n">lag_resid</span><span class="p">))</span>
                <span class="n">coefs</span> <span class="o">=</span> <span class="n">OLS</span><span class="p">(</span><span class="n">endog</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">p_tmp</span> <span class="o">+</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">):],</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">params</span>
                <span class="n">start_params</span><span class="p">[</span><span class="n">k</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="n">p</span><span class="o">+</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="n">coefs</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">start_params</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="n">p</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="n">p</span><span class="o">+</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="n">yule_walker</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">q</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">q</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">p</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">arcoefs</span> <span class="o">=</span> <span class="n">yule_walker</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">p</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">start_params</span><span class="p">[</span><span class="n">k</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">arcoefs</span>

        <span class="c1"># check AR coefficients</span>
        <span class="k">if</span> <span class="n">p</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">start_params</span><span class="p">[</span><span class="n">k</span><span class="p">:</span><span class="n">k</span> <span class="o">+</span> <span class="n">p</span><span class="p">]]</span>
                                            <span class="p">))</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The computed initial AR coefficients are not &quot;</span>
                             <span class="s2">&quot;stationary</span><span class="se">\n</span><span class="s2">You should induce stationarity, &quot;</span>
                             <span class="s2">&quot;choose a different model order, or you can</span><span class="se">\n</span><span class="s2">&quot;</span>
                             <span class="s2">&quot;pass your own start_params.&quot;</span><span class="p">)</span>
        <span class="c1"># check MA coefficients</span>
        <span class="k">elif</span> <span class="n">q</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">start_params</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">p</span><span class="p">:]]</span>
                                              <span class="p">))</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The computed initial MA coefficients are not &quot;</span>
                             <span class="s2">&quot;invertible</span><span class="se">\n</span><span class="s2">You should induce invertibility, &quot;</span>
                             <span class="s2">&quot;choose a different model order, or you can</span><span class="se">\n</span><span class="s2">&quot;</span>
                             <span class="s2">&quot;pass your own start_params.&quot;</span><span class="p">)</span>

        <span class="c1"># check MA coefficients</span>
        <span class="k">return</span> <span class="n">start_params</span>

    <span class="k">def</span> <span class="nf">_fit_start_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">start_ar_lags</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">!=</span> <span class="s1">&#39;css-mle&#39;</span><span class="p">:</span>  <span class="c1"># use Hannan-Rissanen to get start params</span>
            <span class="n">start_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_start_params_hr</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">start_ar_lags</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># use CSS to get start params</span>
            <span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">params</span><span class="p">:</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">loglike_css</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
            <span class="c1">#start_params = [.1]*(k_ar+k_ma+k_exog) # different one for k?</span>
            <span class="n">start_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_start_params_hr</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">start_ar_lags</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transparams</span><span class="p">:</span>
                <span class="n">start_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_invtransparams</span><span class="p">(</span><span class="n">start_params</span><span class="p">)</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">None</span><span class="p">,)</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
            <span class="n">mlefit</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">fmin_l_bfgs_b</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">start_params</span><span class="p">,</span>
                                            <span class="n">approx_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                                            <span class="n">pgtol</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">,</span> <span class="n">factr</span><span class="o">=</span><span class="mf">1e3</span><span class="p">,</span>
                                            <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">iprint</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">start_params</span> <span class="o">=</span> <span class="n">mlefit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transparams</span><span class="p">:</span>
                <span class="n">start_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span><span class="p">(</span><span class="n">start_params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">start_params</span>

<div class="viewcode-block" id="ARMA.score"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMA.score.html#statsmodels.tsa.arima_model.ARMA.score">[docs]</a>    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the score function at params.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This is a numerical approximation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">approx_fprime_cs</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglike</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="kc">False</span><span class="p">,))</span></div>

<div class="viewcode-block" id="ARMA.hessian"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMA.hessian.html#statsmodels.tsa.arima_model.ARMA.hessian">[docs]</a>    <span class="k">def</span> <span class="nf">hessian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the Hessian at params,</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This is a numerical approximation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">approx_hess_cs</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglike</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="kc">False</span><span class="p">,))</span></div>

    <span class="k">def</span> <span class="nf">_transparams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transforms params to induce stationarity/invertability.</span>

<span class="sd">        Reference</span>
<span class="sd">        ---------</span>
<span class="sd">        Jones(1980)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">k_ar</span><span class="p">,</span> <span class="n">k_ma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ma</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_trend</span>
        <span class="n">newparams</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="c1"># just copy exogenous parameters</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">newparams</span><span class="p">[:</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:</span><span class="n">k</span><span class="p">]</span>

        <span class="c1"># AR Coeffs</span>
        <span class="k">if</span> <span class="n">k_ar</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">newparams</span><span class="p">[</span><span class="n">k</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="n">k_ar</span><span class="p">]</span> <span class="o">=</span> <span class="n">_ar_transparams</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="n">k_ar</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>

        <span class="c1"># MA Coeffs</span>
        <span class="k">if</span> <span class="n">k_ma</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">newparams</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="n">k_ar</span><span class="p">:]</span> <span class="o">=</span> <span class="n">_ma_transparams</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="n">k_ar</span><span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">newparams</span>

    <span class="k">def</span> <span class="nf">_invtransparams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inverse of the Jones reparameterization</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">k_ar</span><span class="p">,</span> <span class="n">k_ma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ma</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_trend</span>
        <span class="n">newparams</span> <span class="o">=</span> <span class="n">start_params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">arcoefs</span> <span class="o">=</span> <span class="n">newparams</span><span class="p">[</span><span class="n">k</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="n">k_ar</span><span class="p">]</span>
        <span class="n">macoefs</span> <span class="o">=</span> <span class="n">newparams</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="n">k_ar</span><span class="p">:]</span>
        <span class="c1"># AR coeffs</span>
        <span class="k">if</span> <span class="n">k_ar</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">newparams</span><span class="p">[</span><span class="n">k</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="n">k_ar</span><span class="p">]</span> <span class="o">=</span> <span class="n">_ar_invtransparams</span><span class="p">(</span><span class="n">arcoefs</span><span class="p">)</span>

        <span class="c1"># MA coeffs</span>
        <span class="k">if</span> <span class="n">k_ma</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">newparams</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="n">k_ar</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="n">k_ar</span><span class="o">+</span><span class="n">k_ma</span><span class="p">]</span> <span class="o">=</span> <span class="n">_ma_invtransparams</span><span class="p">(</span><span class="n">macoefs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newparams</span>

    <span class="k">def</span> <span class="nf">_get_prediction_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;mle&#39;</span><span class="p">)</span>
        <span class="n">k_ar</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;k_ar&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">k_diff</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;k_diff&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;mle&#39;</span> <span class="ow">in</span> <span class="n">method</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dynamic</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">k_ar</span>
            <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">[</span><span class="n">start</span><span class="p">]</span>

        <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">out_of_sample</span><span class="p">,</span> <span class="n">prediction_index</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">ARMA</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_get_prediction_index</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>

        <span class="c1"># This replaces the _validate() call</span>
        <span class="k">if</span> <span class="s1">&#39;mle&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">method</span> <span class="ow">and</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">k_ar</span> <span class="o">-</span> <span class="n">k_diff</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Start must be &gt;= k_ar for conditional &quot;</span>
                             <span class="s2">&quot;MLE or dynamic forecast. Got </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">start</span><span class="p">)</span>
        <span class="c1"># Other validation</span>
        <span class="n">_check_arima_start</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">k_ar</span><span class="p">,</span> <span class="n">k_diff</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">out_of_sample</span><span class="p">,</span> <span class="n">prediction_index</span>

<div class="viewcode-block" id="ARMA.geterrors"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMA.geterrors.html#statsmodels.tsa.arima_model.ARMA.geterrors">[docs]</a>    <span class="k">def</span> <span class="nf">geterrors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the errors of the ARMA process.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array-like</span>
<span class="sd">            The fitted ARMA parameters</span>
<span class="sd">        order : array-like</span>
<span class="sd">            3 item iterable, with the number of AR, MA, and exogenous</span>
<span class="sd">            parameters, including the trend</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># start, end, out_of_sample, prediction_index = (</span>
        <span class="c1">#     self._get_prediction_index(start, end, index))</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">k_ar</span><span class="p">,</span> <span class="n">k_ma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ma</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_trend</span>

        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;mle&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;mle&#39;</span> <span class="ow">in</span> <span class="n">method</span><span class="p">:</span>  <span class="c1"># use KalmanFilter to get errors</span>
            <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="n">k_ar</span><span class="p">,</span> <span class="n">k_ma</span><span class="p">,</span> <span class="n">k_lags</span><span class="p">,</span> <span class="n">newparams</span><span class="p">,</span> <span class="n">Z_mat</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">R_mat</span><span class="p">,</span>
             <span class="n">T_mat</span><span class="p">,</span> <span class="n">paramsdtype</span><span class="p">)</span> <span class="o">=</span> <span class="n">KalmanFilter</span><span class="o">.</span><span class="n">_init_kalman_state</span><span class="p">(</span><span class="n">params</span><span class="p">,</span>
                                                                   <span class="bp">self</span><span class="p">)</span>

            <span class="n">errors</span> <span class="o">=</span> <span class="n">KalmanFilter</span><span class="o">.</span><span class="n">geterrors</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">k_ar</span><span class="p">,</span> <span class="n">k_ma</span><span class="p">,</span> <span class="n">k_lags</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span>
                                            <span class="n">Z_mat</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">R_mat</span><span class="p">,</span> <span class="n">T_mat</span><span class="p">,</span>
                                            <span class="n">paramsdtype</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">errors</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># non-cython version returns a tuple</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># use scipy.signal.lfilter</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_trend</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">-=</span> <span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span> <span class="n">params</span><span class="p">[:</span><span class="n">k</span><span class="p">])</span>

            <span class="n">k_ar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span>
            <span class="n">k_ma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ma</span>

            <span class="p">(</span><span class="n">trendparams</span><span class="p">,</span> <span class="n">exparams</span><span class="p">,</span>
             <span class="n">arparams</span><span class="p">,</span> <span class="n">maparams</span><span class="p">)</span> <span class="o">=</span> <span class="n">_unpack_params</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="p">(</span><span class="n">k_ar</span><span class="p">,</span> <span class="n">k_ma</span><span class="p">),</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">k_trend</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span><span class="p">,</span>
                                                  <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">arparams</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">maparams</span><span class="p">]</span>
            <span class="n">zi</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="nb">max</span><span class="p">(</span><span class="n">k_ar</span><span class="p">,</span> <span class="n">k_ma</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k_ar</span><span class="p">):</span>
                <span class="n">zi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">y</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">lfilter</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">zi</span><span class="o">=</span><span class="n">zi</span><span class="p">)</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">k_ar</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">errors</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span></div>

<div class="viewcode-block" id="ARMA.predict"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMA.predict.html#statsmodels.tsa.arima_model.ARMA.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dynamic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;mle&#39;</span><span class="p">)</span>  <span class="c1"># don&#39;t assume fit</span>
        <span class="c1">#params = np.asarray(params)</span>

        <span class="c1"># will return an index of a date</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">out_of_sample</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_prediction_index</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">out_of_sample</span> <span class="ow">and</span> <span class="p">(</span><span class="n">exog</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You must provide exog for ARMAX&quot;</span><span class="p">)</span>

        <span class="n">endog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span>
        <span class="n">resid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geterrors</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">k_ar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span>

        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Note: we ignore currently the index of exog if it is available</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">exog</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">exog</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">exog</span> <span class="o">=</span> <span class="n">exog</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">out_of_sample</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># we need the last k_ar exog for the lag-polynomial</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">k_ar</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dynamic</span><span class="p">:</span>
                <span class="c1"># need the last k_ar exog for the lag-polynomial</span>
                <span class="n">exog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">[</span><span class="o">-</span><span class="n">k_ar</span><span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_trend</span><span class="p">:],</span> <span class="n">exog</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">dynamic</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># need the last k_ar exog for the lag-polynomial</span>
                <span class="n">exog_insample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">[</span><span class="n">start</span> <span class="o">-</span> <span class="n">k_ar</span><span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_trend</span><span class="p">:]</span>
                <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">exog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">exog_insample</span><span class="p">,</span> <span class="n">exog</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">exog</span> <span class="o">=</span> <span class="n">exog_insample</span>
            <span class="c1">#TODO: now that predict does dynamic in-sample it should</span>
            <span class="c1"># also return error estimates and confidence intervals</span>
            <span class="c1"># but how? len(endog) is not tot_obs</span>
            <span class="n">out_of_sample</span> <span class="o">+=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">_arma_predict_out_of_sample</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">out_of_sample</span><span class="p">,</span> <span class="n">resid</span><span class="p">,</span>
                                               <span class="n">k_ar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ma</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_trend</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span>
                                               <span class="n">start</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>

        <span class="n">predictedvalues</span> <span class="o">=</span> <span class="n">_arma_predict_in_sample</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="n">resid</span><span class="p">,</span>
                                                  <span class="n">k_ar</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">out_of_sample</span><span class="p">:</span>
            <span class="n">forecastvalues</span> <span class="o">=</span> <span class="n">_arma_predict_out_of_sample</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">out_of_sample</span><span class="p">,</span>
                                                         <span class="n">resid</span><span class="p">,</span> <span class="n">k_ar</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">k_ma</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">k_trend</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span>
                                                         <span class="n">exog</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
            <span class="n">predictedvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">predictedvalues</span><span class="p">,</span> <span class="n">forecastvalues</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">predictedvalues</span></div>
    <span class="n">predict</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_arma_predict</span>

<div class="viewcode-block" id="ARMA.loglike"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMA.loglike.html#statsmodels.tsa.arima_model.ARMA.loglike">[docs]</a>    <span class="k">def</span> <span class="nf">loglike</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">set_sigma2</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the log-likelihood for ARMA(p,q) model</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Likelihood used depends on the method set in fit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mle&#39;</span><span class="p">,</span> <span class="s1">&#39;css-mle&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglike_kalman</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">set_sigma2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;css&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglike_css</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">set_sigma2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Method </span><span class="si">%s</span><span class="s2"> not understood&quot;</span> <span class="o">%</span> <span class="n">method</span><span class="p">)</span></div>

<div class="viewcode-block" id="ARMA.loglike_kalman"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMA.loglike_kalman.html#statsmodels.tsa.arima_model.ARMA.loglike_kalman">[docs]</a>    <span class="k">def</span> <span class="nf">loglike_kalman</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">set_sigma2</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute exact loglikelihood for ARMA(p,q) model by the Kalman Filter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">KalmanFilter</span><span class="o">.</span><span class="n">loglike</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">set_sigma2</span><span class="p">)</span></div>

<div class="viewcode-block" id="ARMA.loglike_css"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMA.loglike_css.html#statsmodels.tsa.arima_model.ARMA.loglike_css">[docs]</a>    <span class="k">def</span> <span class="nf">loglike_css</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">set_sigma2</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Conditional Sum of Squares likelihood function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">k_ar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span>
        <span class="n">k_ma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ma</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_trend</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">nobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nobs</span>
        <span class="c1"># how to handle if empty?</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transparams</span><span class="p">:</span>
            <span class="n">newparams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newparams</span> <span class="o">=</span> <span class="n">params</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">-=</span> <span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span> <span class="n">newparams</span><span class="p">[:</span><span class="n">k</span><span class="p">])</span>
        <span class="c1"># the order of p determines how many zeros errors to set for lfilter</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">newparams</span><span class="p">[</span><span class="n">k</span><span class="p">:</span><span class="n">k</span> <span class="o">+</span> <span class="n">k_ar</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">newparams</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">k_ar</span><span class="p">:]]</span>
        <span class="n">zi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">max</span><span class="p">(</span><span class="n">k_ar</span><span class="p">,</span> <span class="n">k_ma</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k_ar</span><span class="p">):</span>
            <span class="n">zi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">[:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y</span><span class="p">[:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="n">lfilter</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">zi</span><span class="o">=</span><span class="n">zi</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="n">k_ar</span><span class="p">:]</span>

        <span class="n">ssr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
        <span class="n">sigma2</span> <span class="o">=</span> <span class="n">ssr</span><span class="o">/</span><span class="n">nobs</span>
        <span class="k">if</span> <span class="n">set_sigma2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma2</span> <span class="o">=</span> <span class="n">sigma2</span>
        <span class="n">llf</span> <span class="o">=</span> <span class="o">-</span><span class="n">nobs</span><span class="o">/</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">log</span><span class="p">(</span><span class="n">sigma2</span><span class="p">))</span> <span class="o">-</span> <span class="n">ssr</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">llf</span></div>

<div class="viewcode-block" id="ARMA.fit"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMA.fit.html#statsmodels.tsa.arima_model.ARMA.fit">[docs]</a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trend</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;css-mle&quot;</span><span class="p">,</span>
            <span class="n">transparams</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">disp</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_ar_lags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fits ARMA(p,q) model using exact maximum likelihood via Kalman filter.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        start_params : array-like, optional</span>
<span class="sd">            Starting parameters for ARMA(p,q). If None, the default is given</span>
<span class="sd">            by ARMA._fit_start_params.  See there for more information.</span>
<span class="sd">        transparams : bool, optional</span>
<span class="sd">            Whether or not to transform the parameters to ensure stationarity.</span>
<span class="sd">            Uses the transformation suggested in Jones (1980).  If False,</span>
<span class="sd">            no checking for stationarity or invertibility is done.</span>
<span class="sd">        method : str {&#39;css-mle&#39;,&#39;mle&#39;,&#39;css&#39;}</span>
<span class="sd">            This is the loglikelihood to maximize.  If &quot;css-mle&quot;, the</span>
<span class="sd">            conditional sum of squares likelihood is maximized and its values</span>
<span class="sd">            are used as starting values for the computation of the exact</span>
<span class="sd">            likelihood via the Kalman filter.  If &quot;mle&quot;, the exact likelihood</span>
<span class="sd">            is maximized via the Kalman Filter.  If &quot;css&quot; the conditional sum</span>
<span class="sd">            of squares likelihood is maximized.  All three methods use</span>
<span class="sd">            `start_params` as starting parameters.  See above for more</span>
<span class="sd">            information.</span>
<span class="sd">        trend : str {&#39;c&#39;,&#39;nc&#39;}</span>
<span class="sd">            Whether to include a constant or not.  &#39;c&#39; includes constant,</span>
<span class="sd">            &#39;nc&#39; no constant.</span>
<span class="sd">        solver : str or None, optional</span>
<span class="sd">            Solver to be used.  The default is &#39;lbfgs&#39; (limited memory</span>
<span class="sd">            Broyden-Fletcher-Goldfarb-Shanno).  Other choices are &#39;bfgs&#39;,</span>
<span class="sd">            &#39;newton&#39; (Newton-Raphson), &#39;nm&#39; (Nelder-Mead), &#39;cg&#39; -</span>
<span class="sd">            (conjugate gradient), &#39;ncg&#39; (non-conjugate gradient), and</span>
<span class="sd">            &#39;powell&#39;. By default, the limited memory BFGS uses m=12 to</span>
<span class="sd">            approximate the Hessian, projected gradient tolerance of 1e-8 and</span>
<span class="sd">            factr = 1e2. You can change these by using kwargs.</span>
<span class="sd">        maxiter : int, optional</span>
<span class="sd">            The maximum number of function evaluations. Default is 500.</span>
<span class="sd">        tol : float</span>
<span class="sd">            The convergence tolerance.  Default is 1e-08.</span>
<span class="sd">        full_output : bool, optional</span>
<span class="sd">            If True, all output from solver will be available in</span>
<span class="sd">            the Results object&#39;s mle_retvals attribute.  Output is dependent</span>
<span class="sd">            on the solver.  See Notes for more information.</span>
<span class="sd">        disp : int, optional</span>
<span class="sd">            If True, convergence information is printed.  For the default</span>
<span class="sd">            l_bfgs_b solver, disp controls the frequency of the output during</span>
<span class="sd">            the iterations. disp &lt; 0 means no output in this case.</span>
<span class="sd">        callback : function, optional</span>
<span class="sd">            Called after each iteration as callback(xk) where xk is the current</span>
<span class="sd">            parameter vector.</span>
<span class="sd">        start_ar_lags : int, optional</span>
<span class="sd">            Parameter for fitting start_params. When fitting start_params,</span>
<span class="sd">            residuals are obtained from an AR fit, then an ARMA(p,q) model is</span>
<span class="sd">            fit via OLS using these residuals. If start_ar_lags is None, fit</span>
<span class="sd">            an AR process according to best BIC. If start_ar_lags is not None,</span>
<span class="sd">            fits an AR process with a lag length equal to start_ar_lags.</span>
<span class="sd">            See ARMA._fit_start_params_hr for more information.</span>
<span class="sd">        kwargs</span>
<span class="sd">            See Notes for keyword arguments that can be passed to fit.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        statsmodels.tsa.arima_model.ARMAResults class</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        statsmodels.base.model.LikelihoodModel.fit : for more information</span>
<span class="sd">            on using the solvers.</span>
<span class="sd">        ARMAResults : results class returned by fit</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If fit by &#39;mle&#39;, it is assumed for the Kalman Filter that the initial</span>
<span class="sd">        unknown state is zero, and that the initial variance is</span>
<span class="sd">        P = dot(inv(identity(m**2)-kron(T,T)),dot(R,R.T).ravel(&#39;F&#39;)).reshape(r,</span>
<span class="sd">        r, order = &#39;F&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">k_ar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span>
        <span class="n">k_ma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ma</span>

        <span class="c1"># enforce invertibility</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transparams</span> <span class="o">=</span> <span class="n">transparams</span>

        <span class="n">endog</span><span class="p">,</span> <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">k_exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nobs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">endog</span><span class="p">)</span>  <span class="c1"># this is overwritten if method is &#39;css&#39;</span>

        <span class="c1"># (re)set trend and handle exogenous variables</span>
        <span class="c1"># always pass original exog</span>
        <span class="n">k_trend</span><span class="p">,</span> <span class="n">exog</span> <span class="o">=</span> <span class="n">_make_arma_exog</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span> <span class="n">trend</span><span class="p">)</span>

        <span class="c1"># Check has something to estimate</span>
        <span class="k">if</span> <span class="n">k_ar</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">k_ma</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">k_trend</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">k_exog</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Estimation requires the inclusion of least one &quot;</span>
                         <span class="s2">&quot;AR term, MA term, a constant or an exogenous &quot;</span>
                         <span class="s2">&quot;variable.&quot;</span><span class="p">)</span>

        <span class="c1"># check again now that we know the trend</span>
        <span class="n">_check_estimable</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">endog</span><span class="p">),</span> <span class="n">k_ar</span> <span class="o">+</span> <span class="n">k_ma</span> <span class="o">+</span> <span class="n">k_exog</span> <span class="o">+</span> <span class="n">k_trend</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">k_trend</span> <span class="o">=</span> <span class="n">k_trend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exog</span> <span class="o">=</span> <span class="n">exog</span>    <span class="c1"># overwrites original exog from __init__</span>

        <span class="c1"># (re)set names for this model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exog_names</span> <span class="o">=</span> <span class="n">_make_arma_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">k_trend</span><span class="p">,</span>
                                           <span class="p">(</span><span class="n">k_ar</span><span class="p">,</span> <span class="n">k_ma</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orig_exog_names</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">k_trend</span> <span class="o">+</span> <span class="n">k_exog</span>

        <span class="c1"># choose objective function</span>
        <span class="k">if</span> <span class="n">k_ma</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">k_ar</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;css&quot;</span>  <span class="c1"># Always CSS when no AR or MA terms</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="c1"># adjust nobs for css</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;css&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nobs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">)</span> <span class="o">-</span> <span class="n">k_ar</span>

        <span class="k">if</span> <span class="n">start_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">start_params</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># estimate starting parameters</span>
            <span class="n">start_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_start_params</span><span class="p">((</span><span class="n">k_ar</span><span class="p">,</span> <span class="n">k_ma</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">method</span><span class="p">,</span>
                                                  <span class="n">start_ar_lags</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">transparams</span><span class="p">:</span>  <span class="c1"># transform initial parameters to ensure invertibility</span>
            <span class="n">start_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_invtransparams</span><span class="p">(</span><span class="n">start_params</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">solver</span> <span class="o">==</span> <span class="s1">&#39;lbfgs&#39;</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;pgtol&#39;</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;factr&#39;</span><span class="p">,</span> <span class="mf">1e2</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;approx_grad&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">mlefit</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ARMA</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">start_params</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">solver</span><span class="p">,</span>
                                       <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
                                       <span class="n">full_output</span><span class="o">=</span><span class="n">full_output</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="n">disp</span><span class="p">,</span>
                                       <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">mlefit</span><span class="o">.</span><span class="n">params</span>

        <span class="k">if</span> <span class="n">transparams</span><span class="p">:</span>  <span class="c1"># transform parameters back</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">transparams</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># so methods don&#39;t expect transf.</span>

        <span class="n">normalized_cov_params</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># TODO: fix this</span>
        <span class="n">armafit</span> <span class="o">=</span> <span class="n">ARMAResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">normalized_cov_params</span><span class="p">)</span>
        <span class="n">armafit</span><span class="o">.</span><span class="n">mle_retvals</span> <span class="o">=</span> <span class="n">mlefit</span><span class="o">.</span><span class="n">mle_retvals</span>
        <span class="n">armafit</span><span class="o">.</span><span class="n">mle_settings</span> <span class="o">=</span> <span class="n">mlefit</span><span class="o">.</span><span class="n">mle_settings</span>
        <span class="k">return</span> <span class="n">ARMAResultsWrapper</span><span class="p">(</span><span class="n">armafit</span><span class="p">)</span></div>

    <span class="c1"># base class of &quot;from_formula&quot; is &quot;class Model(object)&quot;</span>
<div class="viewcode-block" id="ARMA.from_formula"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMA.from_formula.html#statsmodels.tsa.arima_model.ARMA.from_formula">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_formula</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">drop_cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;from_formula is not supported&quot;</span>
                                  <span class="s2">&quot; for ARMA models.&quot;</span><span class="p">)</span></div></div>


<span class="c1">#NOTE: the length of endog changes when we give a difference to fit</span>
<span class="c1">#so model methods are not the same on unfit models as fit ones</span>
<span class="c1">#starting to think that order of model should be put in instantiation...</span>
<div class="viewcode-block" id="ARIMA"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARIMA.html#statsmodels.tsa.arima_model.ARIMA">[docs]</a><span class="k">class</span> <span class="nc">ARIMA</span><span class="p">(</span><span class="n">ARMA</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="n">tsbase</span><span class="o">.</span><span class="n">_tsa_doc</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;model&quot;</span> <span class="p">:</span> <span class="n">_arima_model</span><span class="p">,</span>
                                 <span class="s2">&quot;params&quot;</span> <span class="p">:</span> <span class="n">_arima_params</span><span class="p">,</span> <span class="s2">&quot;extra_params&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;extra_sections&quot;</span> <span class="p">:</span> <span class="n">_armax_notes</span> <span class="o">%</span>
                                 <span class="p">{</span><span class="s2">&quot;Model&quot;</span> <span class="p">:</span> <span class="s2">&quot;ARIMA&quot;</span><span class="p">}}</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">missing</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">):</span>
        <span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">order</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># then we just use an ARMA model</span>
            <span class="k">return</span> <span class="n">ARMA</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">exog</span><span class="p">,</span> <span class="n">dates</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">missing</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ARIMA</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
            <span class="n">mod</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">dates</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">missing</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">mod</span>

    <span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># using same defaults as in __init__</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dates&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;missing&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_lags</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_diff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ma</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span> <span class="n">dates</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">missing</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">missing</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">):</span>
        <span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">order</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1">#NOTE: to make more general, need to address the d == 2 stuff</span>
            <span class="c1"># in the predict method</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;d &gt; 2 is not supported&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ARIMA</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">exog</span><span class="p">,</span> <span class="n">dates</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">missing</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_diff</span> <span class="o">=</span> <span class="n">d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_first_unintegrate</span> <span class="o">=</span> <span class="n">unintegrate_levels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">[:</span><span class="n">d</span><span class="p">],</span> <span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">d</span><span class="p">)</span>
        <span class="c1">#NOTE: will check in ARMA but check again since differenced now</span>
        <span class="n">_check_estimable</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">),</span> <span class="n">p</span><span class="o">+</span><span class="n">q</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">[</span><span class="n">d</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ynames</span> <span class="o">=</span> <span class="s1">&#39;D.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog_names</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ynames</span> <span class="o">=</span> <span class="s1">&#39;D</span><span class="si">{0:d}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog_names</span>
        <span class="c1"># what about exog, should we difference it automatically before</span>
        <span class="c1"># super call?</span>

        <span class="c1"># Reset index</span>
        <span class="n">orig_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">)</span>
        <span class="n">new_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">row_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s1">&#39;row_labels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">row_labels</span><span class="p">[</span><span class="n">orig_length</span> <span class="o">-</span> <span class="n">new_length</span><span class="p">:])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_generated</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">[:</span><span class="o">-</span><span class="p">(</span><span class="n">orig_length</span> <span class="o">-</span> <span class="n">new_length</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">[</span><span class="n">orig_length</span> <span class="o">-</span> <span class="n">new_length</span><span class="p">:]</span>

    <span class="k">def</span> <span class="nf">_get_prediction_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;mle&#39;</span><span class="p">)</span>
        <span class="n">k_ar</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;k_ar&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">k_diff</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;k_diff&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;mle&#39;</span> <span class="ow">in</span> <span class="n">method</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dynamic</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">k_ar</span>
            <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">[</span><span class="n">start</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">long</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span>
            <span class="n">start</span> <span class="o">-=</span> <span class="n">k_diff</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The start index </span><span class="si">%d</span><span class="s1"> of the original series &#39;</span>
                                 <span class="s1">&#39; has been differenced away&#39;</span> <span class="o">%</span> <span class="n">start</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">long</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span>
            <span class="n">end</span> <span class="o">-=</span> <span class="n">k_diff</span>

        <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">out_of_sample</span><span class="p">,</span> <span class="n">prediction_index</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">ARIMA</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_get_prediction_index</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>

        <span class="c1"># From _get_predict_end</span>
        <span class="k">if</span> <span class="s1">&#39;mle&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dynamic</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">-=</span> <span class="n">k_ar</span>

        <span class="c1"># This replaces the _validate() call</span>
        <span class="k">if</span> <span class="s1">&#39;mle&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">method</span> <span class="ow">and</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">k_ar</span> <span class="o">-</span> <span class="n">k_diff</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Start must be &gt;= k_ar for conditional &quot;</span>
                             <span class="s2">&quot;MLE or dynamic forecast. Got </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">start</span><span class="p">)</span>
        <span class="c1"># Other validation</span>
        <span class="n">_check_arima_start</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">k_ar</span><span class="p">,</span> <span class="n">k_diff</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">out_of_sample</span><span class="p">,</span> <span class="n">prediction_index</span>

<div class="viewcode-block" id="ARIMA.fit"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARIMA.fit.html#statsmodels.tsa.arima_model.ARIMA.fit">[docs]</a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trend</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;css-mle&quot;</span><span class="p">,</span>
            <span class="n">transparams</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">disp</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_ar_lags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fits ARIMA(p,d,q) model by exact maximum likelihood via Kalman filter.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        start_params : array-like, optional</span>
<span class="sd">            Starting parameters for ARMA(p,q).  If None, the default is given</span>
<span class="sd">            by ARMA._fit_start_params.  See there for more information.</span>
<span class="sd">        transparams : bool, optional</span>
<span class="sd">            Whehter or not to transform the parameters to ensure stationarity.</span>
<span class="sd">            Uses the transformation suggested in Jones (1980).  If False,</span>
<span class="sd">            no checking for stationarity or invertibility is done.</span>
<span class="sd">        method : str {&#39;css-mle&#39;,&#39;mle&#39;,&#39;css&#39;}</span>
<span class="sd">            This is the loglikelihood to maximize.  If &quot;css-mle&quot;, the</span>
<span class="sd">            conditional sum of squares likelihood is maximized and its values</span>
<span class="sd">            are used as starting values for the computation of the exact</span>
<span class="sd">            likelihood via the Kalman filter.  If &quot;mle&quot;, the exact likelihood</span>
<span class="sd">            is maximized via the Kalman Filter.  If &quot;css&quot; the conditional sum</span>
<span class="sd">            of squares likelihood is maximized.  All three methods use</span>
<span class="sd">            `start_params` as starting parameters.  See above for more</span>
<span class="sd">            information.</span>
<span class="sd">        trend : str {&#39;c&#39;,&#39;nc&#39;}</span>
<span class="sd">            Whether to include a constant or not.  &#39;c&#39; includes constant,</span>
<span class="sd">            &#39;nc&#39; no constant.</span>
<span class="sd">        solver : str or None, optional</span>
<span class="sd">            Solver to be used.  The default is &#39;lbfgs&#39; (limited memory</span>
<span class="sd">            Broyden-Fletcher-Goldfarb-Shanno).  Other choices are &#39;bfgs&#39;,</span>
<span class="sd">            &#39;newton&#39; (Newton-Raphson), &#39;nm&#39; (Nelder-Mead), &#39;cg&#39; -</span>
<span class="sd">            (conjugate gradient), &#39;ncg&#39; (non-conjugate gradient), and</span>
<span class="sd">            &#39;powell&#39;. By default, the limited memory BFGS uses m=12 to</span>
<span class="sd">            approximate the Hessian, projected gradient tolerance of 1e-8 and</span>
<span class="sd">            factr = 1e2. You can change these by using kwargs.</span>
<span class="sd">        maxiter : int, optional</span>
<span class="sd">            The maximum number of function evaluations. Default is 500.</span>
<span class="sd">        tol : float</span>
<span class="sd">            The convergence tolerance.  Default is 1e-08.</span>
<span class="sd">        full_output : bool, optional</span>
<span class="sd">            If True, all output from solver will be available in</span>
<span class="sd">            the Results object&#39;s mle_retvals attribute.  Output is dependent</span>
<span class="sd">            on the solver.  See Notes for more information.</span>
<span class="sd">        disp : int, optional</span>
<span class="sd">            If True, convergence information is printed.  For the default</span>
<span class="sd">            l_bfgs_b solver, disp controls the frequency of the output during</span>
<span class="sd">            the iterations. disp &lt; 0 means no output in this case.</span>
<span class="sd">        callback : function, optional</span>
<span class="sd">            Called after each iteration as callback(xk) where xk is the current</span>
<span class="sd">            parameter vector.</span>
<span class="sd">        start_ar_lags : int, optional</span>
<span class="sd">            Parameter for fitting start_params. When fitting start_params,</span>
<span class="sd">            residuals are obtained from an AR fit, then an ARMA(p,q) model is</span>
<span class="sd">            fit via OLS using these residuals. If start_ar_lags is None, fit</span>
<span class="sd">            an AR process according to best BIC. If start_ar_lags is not None,</span>
<span class="sd">            fits an AR process with a lag length equal to start_ar_lags.</span>
<span class="sd">            See ARMA._fit_start_params_hr for more information.</span>
<span class="sd">        kwargs</span>
<span class="sd">            See Notes for keyword arguments that can be passed to fit.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        `statsmodels.tsa.arima.ARIMAResults` class</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        statsmodels.base.model.LikelihoodModel.fit : for more information</span>
<span class="sd">            on using the solvers.</span>
<span class="sd">        ARIMAResults : results class returned by fit</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If fit by &#39;mle&#39;, it is assumed for the Kalman Filter that the initial</span>
<span class="sd">        unknown state is zero, and that the initial variance is</span>
<span class="sd">        P = dot(inv(identity(m**2)-kron(T,T)),dot(R,R.T).ravel(&#39;F&#39;)).reshape(r,</span>
<span class="sd">        r, order = &#39;F&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mlefit</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ARIMA</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">start_params</span><span class="p">,</span> <span class="n">trend</span><span class="p">,</span>
                                           <span class="n">method</span><span class="p">,</span> <span class="n">transparams</span><span class="p">,</span> <span class="n">solver</span><span class="p">,</span>
                                           <span class="n">maxiter</span><span class="p">,</span> <span class="n">full_output</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span>
                                           <span class="n">callback</span><span class="p">,</span> <span class="n">start_ar_lags</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">normalized_cov_params</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># TODO: fix this?</span>
        <span class="n">arima_fit</span> <span class="o">=</span> <span class="n">ARIMAResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mlefit</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
                                 <span class="n">normalized_cov_params</span><span class="p">)</span>
        <span class="n">arima_fit</span><span class="o">.</span><span class="n">k_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_diff</span>

        <span class="n">arima_fit</span><span class="o">.</span><span class="n">mle_retvals</span> <span class="o">=</span> <span class="n">mlefit</span><span class="o">.</span><span class="n">mle_retvals</span>
        <span class="n">arima_fit</span><span class="o">.</span><span class="n">mle_settings</span> <span class="o">=</span> <span class="n">mlefit</span><span class="o">.</span><span class="n">mle_settings</span>

        <span class="k">return</span> <span class="n">ARIMAResultsWrapper</span><span class="p">(</span><span class="n">arima_fit</span><span class="p">)</span></div>

<div class="viewcode-block" id="ARIMA.predict"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARIMA.predict.html#statsmodels.tsa.arima_model.ARIMA.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                <span class="n">dynamic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># go ahead and convert to an index for easier checking</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="p">(</span><span class="n">string_types</span><span class="p">,</span> <span class="n">datetime</span><span class="p">)):</span>
            <span class="c1"># start = _index_date(start, self.data.dates)</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_index_label_loc</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">start</span>
            <span class="c1"># Adjustment since _index was already changed to fit the</span>
            <span class="c1"># differenced endog.</span>
            <span class="n">start</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_diff</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dynamic</span> <span class="ow">or</span> <span class="p">(</span><span class="n">start</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_diff</span> <span class="ow">and</span>
                               <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">ARIMA</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span>
                                                  <span class="n">dynamic</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># need to assume pre-sample residuals are zero</span>
                <span class="c1"># do this by a hack</span>
                <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ma</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">k_ma</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">predictedvalues</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ARIMA</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span>
                                                             <span class="n">end</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span>
                                                             <span class="n">dynamic</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">k_ma</span> <span class="o">=</span> <span class="n">q</span>
                <span class="k">return</span> <span class="n">predictedvalues</span>
        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;levels&#39;</span><span class="p">:</span>
            <span class="n">endog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">endog</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dynamic</span><span class="p">:</span>
                <span class="n">predict</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ARIMA</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span>
                                                     <span class="n">dynamic</span><span class="p">)</span>

                <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">out_of_sample</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_get_prediction_index</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">))</span>

                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_diff</span>
                <span class="k">if</span> <span class="s1">&#39;mle&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">:</span>
                    <span class="n">start</span> <span class="o">+=</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># for case where d == 2</span>
                    <span class="n">end</span> <span class="o">+=</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="c1"># add each predicted diff to lagged endog</span>
                    <span class="k">if</span> <span class="n">out_of_sample</span><span class="p">:</span>
                        <span class="n">fv</span> <span class="o">=</span> <span class="n">predict</span><span class="p">[:</span><span class="o">-</span><span class="n">out_of_sample</span><span class="p">]</span> <span class="o">+</span> <span class="n">endog</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1">#TODO: make a general solution to this</span>
                            <span class="n">fv</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">endog</span><span class="p">[</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span><span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                        <span class="n">levels</span> <span class="o">=</span> <span class="n">unintegrate_levels</span><span class="p">(</span><span class="n">endog</span><span class="p">[</span><span class="o">-</span><span class="n">d</span><span class="p">:],</span> <span class="n">d</span><span class="p">)</span>
                        <span class="n">fv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">fv</span><span class="p">,</span>
                                   <span class="n">unintegrate</span><span class="p">(</span><span class="n">predict</span><span class="p">[</span><span class="o">-</span><span class="n">out_of_sample</span><span class="p">:],</span>
                                               <span class="n">levels</span><span class="p">)[</span><span class="n">d</span><span class="p">:]]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">fv</span> <span class="o">=</span> <span class="n">predict</span> <span class="o">+</span> <span class="n">endog</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">fv</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">endog</span><span class="p">[</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span><span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">k_ar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span>
                    <span class="k">if</span> <span class="n">out_of_sample</span><span class="p">:</span>
                        <span class="n">fv</span> <span class="o">=</span> <span class="p">(</span><span class="n">predict</span><span class="p">[:</span><span class="o">-</span><span class="n">out_of_sample</span><span class="p">]</span> <span class="o">+</span>
                              <span class="n">endog</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span><span class="n">end</span><span class="o">+</span><span class="n">k_ar</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">fv</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">endog</span><span class="p">[</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span><span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                        <span class="n">levels</span> <span class="o">=</span> <span class="n">unintegrate_levels</span><span class="p">(</span><span class="n">endog</span><span class="p">[</span><span class="o">-</span><span class="n">d</span><span class="p">:],</span> <span class="n">d</span><span class="p">)</span>
                        <span class="n">fv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">fv</span><span class="p">,</span>
                                   <span class="n">unintegrate</span><span class="p">(</span><span class="n">predict</span><span class="p">[</span><span class="o">-</span><span class="n">out_of_sample</span><span class="p">:],</span>
                                               <span class="n">levels</span><span class="p">)[</span><span class="n">d</span><span class="p">:]]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">fv</span> <span class="o">=</span> <span class="n">predict</span> <span class="o">+</span> <span class="n">endog</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">k_ar</span><span class="p">):</span><span class="n">end</span><span class="o">+</span><span class="n">k_ar</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">fv</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">endog</span><span class="p">[</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span><span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#IFF we need to use pre-sample values assume pre-sample</span>
                <span class="c1"># residuals are zero, do this by a hack</span>
                <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_diff</span> <span class="ow">or</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># do the first k_diff+1 separately</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span>
                    <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ma</span>
                    <span class="n">k_exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span>
                    <span class="n">k_trend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_trend</span>
                    <span class="n">k_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_diff</span>
                    <span class="p">(</span><span class="n">trendparam</span><span class="p">,</span> <span class="n">exparams</span><span class="p">,</span>
                     <span class="n">arparams</span><span class="p">,</span> <span class="n">maparams</span><span class="p">)</span> <span class="o">=</span> <span class="n">_unpack_params</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span>
                                                          <span class="n">k_trend</span><span class="p">,</span>
                                                          <span class="n">k_exog</span><span class="p">,</span>
                                                          <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="c1"># this is the hack</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">k_ma</span> <span class="o">=</span> <span class="mi">0</span>

                    <span class="n">predict</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ARIMA</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span>
                                                         <span class="n">exog</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">start</span><span class="p">:</span>
                        <span class="n">start</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_prediction_index</span><span class="p">(</span>
                            <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">)</span>
                        <span class="n">start</span> <span class="o">+=</span> <span class="n">k_diff</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">k_ma</span> <span class="o">=</span> <span class="n">q</span>
                    <span class="k">return</span> <span class="n">endog</span><span class="p">[</span><span class="n">start</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">predict</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">predict</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ARIMA</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span>
                                                         <span class="n">exog</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">endog</span><span class="p">[</span><span class="n">start</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">predict</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fv</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma : no cover</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;typ </span><span class="si">%s</span><span class="s2"> not understood&quot;</span> <span class="o">%</span> <span class="n">typ</span><span class="p">)</span></div>

    <span class="n">predict</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_arima_predict</span></div>


<div class="viewcode-block" id="ARMAResults"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMAResults.html#statsmodels.tsa.arima_model.ARMAResults">[docs]</a><span class="k">class</span> <span class="nc">ARMAResults</span><span class="p">(</span><span class="n">tsbase</span><span class="o">.</span><span class="n">TimeSeriesModelResults</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to hold results from fitting an ARMA model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    model : ARMA instance</span>
<span class="sd">        The fitted model instance</span>
<span class="sd">    params : array</span>
<span class="sd">        Fitted parameters</span>
<span class="sd">    normalized_cov_params : array, optional</span>
<span class="sd">        The normalized variance covariance matrix</span>
<span class="sd">    scale : float, optional</span>
<span class="sd">        Optional argument to scale the variance covariance matrix.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    aic : float</span>
<span class="sd">        Akaike Information Criterion</span>
<span class="sd">        :math:`-2*llf+2* df_model`</span>
<span class="sd">        where `df_model` includes all AR parameters, MA parameters, constant</span>
<span class="sd">        terms parameters on constant terms and the variance.</span>
<span class="sd">    arparams : array</span>
<span class="sd">        The parameters associated with the AR coefficients in the model.</span>
<span class="sd">    arroots : array</span>
<span class="sd">        The roots of the AR coefficients are the solution to</span>
<span class="sd">        (1 - arparams[0]*z - arparams[1]*z**2 -...- arparams[p-1]*z**k_ar) = 0</span>
<span class="sd">        Stability requires that the roots in modulus lie outside the unit</span>
<span class="sd">        circle.</span>
<span class="sd">    bic : float</span>
<span class="sd">        Bayes Information Criterion</span>
<span class="sd">        -2*llf + log(nobs)*df_model</span>
<span class="sd">        Where if the model is fit using conditional sum of squares, the</span>
<span class="sd">        number of observations `nobs` does not include the `p` pre-sample</span>
<span class="sd">        observations.</span>
<span class="sd">    bse : array</span>
<span class="sd">        The standard errors of the parameters. These are computed using the</span>
<span class="sd">        numerical Hessian.</span>
<span class="sd">    df_model : array</span>
<span class="sd">        The model degrees of freedom = `k_exog` + `k_trend` + `k_ar` + `k_ma`</span>
<span class="sd">    df_resid : array</span>
<span class="sd">        The residual degrees of freedom = `nobs` - `df_model`</span>
<span class="sd">    fittedvalues : array</span>
<span class="sd">        The predicted values of the model.</span>
<span class="sd">    hqic : float</span>
<span class="sd">        Hannan-Quinn Information Criterion</span>
<span class="sd">        -2*llf + 2*(`df_model`)*log(log(nobs))</span>
<span class="sd">        Like `bic` if the model is fit using conditional sum of squares then</span>
<span class="sd">        the `k_ar` pre-sample observations are not counted in `nobs`.</span>
<span class="sd">    k_ar : int</span>
<span class="sd">        The number of AR coefficients in the model.</span>
<span class="sd">    k_exog : int</span>
<span class="sd">        The number of exogenous variables included in the model. Does not</span>
<span class="sd">        include the constant.</span>
<span class="sd">    k_ma : int</span>
<span class="sd">        The number of MA coefficients.</span>
<span class="sd">    k_trend : int</span>
<span class="sd">        This is 0 for no constant or 1 if a constant is included.</span>
<span class="sd">    llf : float</span>
<span class="sd">        The value of the log-likelihood function evaluated at `params`.</span>
<span class="sd">    maparams : array</span>
<span class="sd">        The value of the moving average coefficients.</span>
<span class="sd">    maroots : array</span>
<span class="sd">        The roots of the MA coefficients are the solution to</span>
<span class="sd">        (1 + maparams[0]*z + maparams[1]*z**2 + ... + maparams[q-1]*z**q) = 0</span>
<span class="sd">        Stability requires that the roots in modules lie outside the unit</span>
<span class="sd">        circle.</span>
<span class="sd">    model : ARMA instance</span>
<span class="sd">        A reference to the model that was fit.</span>
<span class="sd">    nobs : float</span>
<span class="sd">        The number of observations used to fit the model. If the model is fit</span>
<span class="sd">        using exact maximum likelihood this is equal to the total number of</span>
<span class="sd">        observations, `n_totobs`. If the model is fit using conditional</span>
<span class="sd">        maximum likelihood this is equal to `n_totobs` - `k_ar`.</span>
<span class="sd">    n_totobs : float</span>
<span class="sd">        The total number of observations for `endog`. This includes all</span>
<span class="sd">        observations, even pre-sample values if the model is fit using `css`.</span>
<span class="sd">    params : array</span>
<span class="sd">        The parameters of the model. The order of variables is the trend</span>
<span class="sd">        coefficients and the `k_exog` exognous coefficients, then the</span>
<span class="sd">        `k_ar` AR coefficients, and finally the `k_ma` MA coefficients.</span>
<span class="sd">    pvalues : array</span>
<span class="sd">        The p-values associated with the t-values of the coefficients. Note</span>
<span class="sd">        that the coefficients are assumed to have a Student&#39;s T distribution.</span>
<span class="sd">    resid : array</span>
<span class="sd">        The model residuals. If the model is fit using &#39;mle&#39; then the</span>
<span class="sd">        residuals are created via the Kalman Filter. If the model is fit</span>
<span class="sd">        using &#39;css&#39; then the residuals are obtained via `scipy.signal.lfilter`</span>
<span class="sd">        adjusted such that the first `k_ma` residuals are zero. These zero</span>
<span class="sd">        residuals are not returned.</span>
<span class="sd">    scale : float</span>
<span class="sd">        This is currently set to 1.0 and not used by the model or its results.</span>
<span class="sd">    sigma2 : float</span>
<span class="sd">        The variance of the residuals. If the model is fit by &#39;css&#39;,</span>
<span class="sd">        sigma2 = ssr/nobs, where ssr is the sum of squared residuals. If</span>
<span class="sd">        the model is fit by &#39;mle&#39;, then sigma2 = 1/nobs * sum(v**2 / F)</span>
<span class="sd">        where v is the one-step forecast error and F is the forecast error</span>
<span class="sd">        variance. See `nobs` for the difference in definitions depending on the</span>
<span class="sd">        fit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1">#TODO: use this for docstring when we fix nobs issue</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">normalized_cov_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ARMAResults</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">normalized_cov_params</span><span class="p">,</span>
                                          <span class="n">scale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma2</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sigma2</span>
        <span class="n">nobs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">nobs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nobs</span> <span class="o">=</span> <span class="n">nobs</span>
        <span class="n">k_exog</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">k_exog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span> <span class="o">=</span> <span class="n">k_exog</span>
        <span class="n">k_trend</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">k_trend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_trend</span> <span class="o">=</span> <span class="n">k_trend</span>
        <span class="n">k_ar</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">k_ar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span> <span class="o">=</span> <span class="n">k_ar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_totobs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span><span class="p">)</span>
        <span class="n">k_ma</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">k_ma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_ma</span> <span class="o">=</span> <span class="n">k_ma</span>
        <span class="n">df_model</span> <span class="o">=</span> <span class="n">k_exog</span> <span class="o">+</span> <span class="n">k_trend</span> <span class="o">+</span> <span class="n">k_ar</span> <span class="o">+</span> <span class="n">k_ma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ic_df_model</span> <span class="o">=</span> <span class="n">df_model</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_model</span> <span class="o">=</span> <span class="n">df_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_resid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nobs</span> <span class="o">-</span> <span class="n">df_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="ARMAResults.arroots"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMAResults.arroots.html#statsmodels.tsa.arima_model.ARMAResults.arroots">[docs]</a>    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">arroots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">arparams</span><span class="p">])</span><span class="o">**-</span><span class="mi">1</span></div>

<div class="viewcode-block" id="ARMAResults.maroots"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMAResults.maroots.html#statsmodels.tsa.arima_model.ARMAResults.maroots">[docs]</a>    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">maroots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maparams</span><span class="p">])</span><span class="o">**-</span><span class="mi">1</span></div>

<div class="viewcode-block" id="ARMAResults.arfreq"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMAResults.arfreq.html#statsmodels.tsa.arima_model.ARMAResults.arfreq">[docs]</a>    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">arfreq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the frequency of the AR roots.</span>

<span class="sd">        This is the solution, x, to z = abs(z)*exp(2j*np.pi*x) where z are the</span>
<span class="sd">        roots.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arroots</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span></div>

<div class="viewcode-block" id="ARMAResults.mafreq"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMAResults.mafreq.html#statsmodels.tsa.arima_model.ARMAResults.mafreq">[docs]</a>    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">mafreq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the frequency of the MA roots.</span>

<span class="sd">        This is the solution, x, to z = abs(z)*exp(2j*np.pi*x) where z are the</span>
<span class="sd">        roots.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maroots</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span></div>

<div class="viewcode-block" id="ARMAResults.arparams"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMAResults.arparams.html#statsmodels.tsa.arima_model.ARMAResults.arparams">[docs]</a>    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">arparams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_trend</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span><span class="p">]</span></div>

<div class="viewcode-block" id="ARMAResults.maparams"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMAResults.maparams.html#statsmodels.tsa.arima_model.ARMAResults.maparams">[docs]</a>    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">maparams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_trend</span>
        <span class="n">k_ar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="n">k_ar</span><span class="p">:]</span></div>

<div class="viewcode-block" id="ARMAResults.llf"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMAResults.llf.html#statsmodels.tsa.arima_model.ARMAResults.llf">[docs]</a>    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">llf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">loglike</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span></div>

<div class="viewcode-block" id="ARMAResults.bse"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMAResults.bse.html#statsmodels.tsa.arima_model.ARMAResults.bse">[docs]</a>    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">bse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
        <span class="n">hess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">hessian</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># can&#39;t take an inverse, ensure 1d</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="n">hess</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="o">-</span><span class="n">inv</span><span class="p">(</span><span class="n">hess</span><span class="p">)))</span></div>

<div class="viewcode-block" id="ARMAResults.cov_params"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMAResults.cov_params.html#statsmodels.tsa.arima_model.ARMAResults.cov_params">[docs]</a>    <span class="k">def</span> <span class="nf">cov_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># add scale argument?</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
        <span class="n">hess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">hessian</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">inv</span><span class="p">(</span><span class="n">hess</span><span class="p">)</span></div>

<div class="viewcode-block" id="ARMAResults.aic"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMAResults.aic.html#statsmodels.tsa.arima_model.ARMAResults.aic">[docs]</a>    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">aic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">llf</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ic_df_model</span></div>

<div class="viewcode-block" id="ARMAResults.bic"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMAResults.bic.html#statsmodels.tsa.arima_model.ARMAResults.bic">[docs]</a>    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">bic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">nobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nobs</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">llf</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">nobs</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ic_df_model</span></div>

<div class="viewcode-block" id="ARMAResults.hqic"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMAResults.hqic.html#statsmodels.tsa.arima_model.ARMAResults.hqic">[docs]</a>    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">hqic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">nobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nobs</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">llf</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">nobs</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ic_df_model</span></div>

<div class="viewcode-block" id="ARMAResults.fittedvalues"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMAResults.fittedvalues.html#statsmodels.tsa.arima_model.ARMAResults.fittedvalues">[docs]</a>    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">fittedvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="n">endog</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">endog</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">k_ar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span>
        <span class="n">exog</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">exog</span>  <span class="c1"># this is a copy</span>
        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;css&quot;</span> <span class="ow">and</span> <span class="n">k_ar</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">exog</span> <span class="o">=</span> <span class="n">exog</span><span class="p">[</span><span class="n">k_ar</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;css&quot;</span> <span class="ow">and</span> <span class="n">k_ar</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">endog</span> <span class="o">=</span> <span class="n">endog</span><span class="p">[</span><span class="n">k_ar</span><span class="p">:]</span>
        <span class="n">fv</span> <span class="o">=</span> <span class="n">endog</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">resid</span>
        <span class="c1"># add deterministic part back in</span>
        <span class="c1">#k = self.k_exog + self.k_trend</span>
        <span class="c1">#TODO: this needs to be commented out for MLE with constant</span>
        <span class="c1">#if k != 0:</span>
        <span class="c1">#    fv += dot(exog, self.params[:k])</span>
        <span class="k">return</span> <span class="n">fv</span></div>

<div class="viewcode-block" id="ARMAResults.resid"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMAResults.resid.html#statsmodels.tsa.arima_model.ARMAResults.resid">[docs]</a>    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">resid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geterrors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span></div>

<div class="viewcode-block" id="ARMAResults.pvalues"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMAResults.pvalues.html#statsmodels.tsa.arima_model.ARMAResults.pvalues">[docs]</a>    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">pvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1">#TODO: same for conditional and unconditional?</span>
        <span class="n">df_resid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_resid</span>
        <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tvalues</span><span class="p">),</span> <span class="n">df_resid</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span></div>

<div class="viewcode-block" id="ARMAResults.predict"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMAResults.predict.html#statsmodels.tsa.arima_model.ARMAResults.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dynamic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">)</span></div>
    <span class="n">predict</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_arma_results_predict</span>

    <span class="k">def</span> <span class="nf">_forecast_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">):</span>
        <span class="n">sigma2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma2</span>
        <span class="n">ma_rep</span> <span class="o">=</span> <span class="n">arma2ma</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">arparams</span><span class="p">],</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maparams</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="n">steps</span><span class="p">)</span>

        <span class="n">fcasterr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">ma_rep</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">fcasterr</span>

    <span class="k">def</span> <span class="nf">_forecast_conf_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">forecast</span><span class="p">,</span> <span class="n">fcasterr</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
        <span class="n">const</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
        <span class="n">conf_int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">const</span> <span class="o">*</span> <span class="n">fcasterr</span><span class="p">,</span>
                         <span class="n">forecast</span> <span class="o">+</span> <span class="n">const</span> <span class="o">*</span> <span class="n">fcasterr</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">conf_int</span>

<div class="viewcode-block" id="ARMAResults.forecast"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMAResults.forecast.html#statsmodels.tsa.arima_model.ARMAResults.forecast">[docs]</a>    <span class="k">def</span> <span class="nf">forecast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">05</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Out-of-sample forecasts</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        steps : int</span>
<span class="sd">            The number of out of sample forecasts from the end of the</span>
<span class="sd">            sample.</span>
<span class="sd">        exog : array</span>
<span class="sd">            If the model is an ARMAX, you must provide out of sample</span>
<span class="sd">            values for the exogenous variables. This should not include</span>
<span class="sd">            the constant.</span>
<span class="sd">        alpha : float</span>
<span class="sd">            The confidence intervals for the forecasts are (1 - alpha) %</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        forecast : array</span>
<span class="sd">            Array of out of sample forecasts</span>
<span class="sd">        stderr : array</span>
<span class="sd">            Array of the standard error of the forecasts.</span>
<span class="sd">        conf_int : array</span>
<span class="sd">            2d array of the confidence interval for the forecast</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#TODO: make a convenience function for this. we&#39;re using the</span>
            <span class="c1"># pattern elsewhere in the codebase</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">exog</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">exog</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">exog</span> <span class="o">=</span> <span class="n">exog</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">exog</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">exog</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;1d exog given and len(exog) != k_exog&quot;</span><span class="p">)</span>
                <span class="n">exog</span> <span class="o">=</span> <span class="n">exog</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">if</span> <span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">steps</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;new exog needed for each step&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span> <span class="o">!=</span> <span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;exog must contain the same number of &#39;</span>
                                 <span class="s1">&#39;variables as in the estimated model.&#39;</span><span class="p">)</span>
            <span class="c1"># prepend in-sample exog observations</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">exog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">exog</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span><span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_trend</span><span class="p">:],</span>
                                  <span class="n">exog</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Forecast values for exog are required when &#39;</span>
                                 <span class="s1">&#39;the model contains exogenous regressors.&#39;</span><span class="p">)</span>



        <span class="n">forecast</span> <span class="o">=</span> <span class="n">_arma_predict_out_of_sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
                                               <span class="n">steps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">k_ma</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_trend</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span><span class="p">,</span>
                                               <span class="n">exog</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>

        <span class="c1"># compute the standard errors</span>
        <span class="n">fcasterr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forecast_error</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
        <span class="n">conf_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forecast_conf_int</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">fcasterr</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">forecast</span><span class="p">,</span> <span class="n">fcasterr</span><span class="p">,</span> <span class="n">conf_int</span></div>

<div class="viewcode-block" id="ARMAResults.summary"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMAResults.summary.html#statsmodels.tsa.arima_model.ARMAResults.summary">[docs]</a>    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">05</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summarize the Model</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        alpha : float, optional</span>
<span class="sd">            Significance level for the confidence intervals.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        smry : Summary instance</span>
<span class="sd">            This holds the summary table and text, which can be printed or</span>
<span class="sd">            converted to various output formats.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        statsmodels.iolib.summary.Summary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">statsmodels.iolib.summary</span> <span class="k">import</span> <span class="n">Summary</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39; Model Results&#39;</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">method</span>
        <span class="c1"># get sample TODO: make better sample machinery for estimation</span>
        <span class="n">k_diff</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;k_diff&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;mle&#39;</span> <span class="ow">in</span> <span class="n">method</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">k_diff</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">k_diff</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dates</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dates</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="p">[</span><span class="n">dates</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m-</span><span class="si">%d</span><span class="s1">-%Y&#39;</span><span class="p">)]</span>
            <span class="n">sample</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;- &#39;</span> <span class="o">+</span> <span class="n">dates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m-</span><span class="si">%d</span><span class="s1">-%Y&#39;</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; - &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">orig_endog</span><span class="p">))</span>

        <span class="n">k_ar</span><span class="p">,</span> <span class="n">k_ma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ma</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">k_diff</span><span class="p">:</span>
            <span class="n">order</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="n">k_ar</span><span class="p">,</span> <span class="n">k_ma</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">order</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="n">k_ar</span><span class="p">,</span> <span class="n">k_diff</span><span class="p">,</span> <span class="n">k_ma</span><span class="p">))</span>
        <span class="n">top_left</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Dep. Variable:&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;Model:&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">order</span><span class="p">]),</span>
                    <span class="p">(</span><span class="s1">&#39;Method:&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">method</span><span class="p">]),</span>
                    <span class="p">(</span><span class="s1">&#39;Date:&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;Time:&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;Sample:&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">sample</span><span class="p">[</span><span class="mi">0</span><span class="p">]]),</span>
                    <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">sample</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                    <span class="p">]</span>

        <span class="n">top_right</span> <span class="o">=</span> <span class="p">[</span>
                     <span class="p">(</span><span class="s1">&#39;No. Observations:&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span><span class="p">))]),</span>
                     <span class="p">(</span><span class="s1">&#39;Log Likelihood&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%#5.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">llf</span><span class="p">]),</span>
                     <span class="p">(</span><span class="s1">&#39;S.D. of innovations&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%#5.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma2</span><span class="o">**.</span><span class="mi">5</span><span class="p">]),</span>
                     <span class="p">(</span><span class="s1">&#39;AIC&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%#5.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">aic</span><span class="p">]),</span>
                     <span class="p">(</span><span class="s1">&#39;BIC&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%#5.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">]),</span>
                     <span class="p">(</span><span class="s1">&#39;HQIC&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%#5.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">hqic</span><span class="p">])]</span>

        <span class="n">smry</span> <span class="o">=</span> <span class="n">Summary</span><span class="p">()</span>
        <span class="n">smry</span><span class="o">.</span><span class="n">add_table_2cols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gleft</span><span class="o">=</span><span class="n">top_left</span><span class="p">,</span> <span class="n">gright</span><span class="o">=</span><span class="n">top_right</span><span class="p">,</span>
                             <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="n">smry</span><span class="o">.</span><span class="n">add_table_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">use_t</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Make the roots table</span>
        <span class="kn">from</span> <span class="nn">statsmodels.iolib.table</span> <span class="k">import</span> <span class="n">SimpleTable</span>

        <span class="k">if</span> <span class="n">k_ma</span> <span class="ow">and</span> <span class="n">k_ar</span><span class="p">:</span>
            <span class="n">arstubs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;AR.</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k_ar</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="n">mastubs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MA.</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k_ma</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="n">stubs</span> <span class="o">=</span> <span class="n">arstubs</span> <span class="o">+</span> <span class="n">mastubs</span>
            <span class="n">roots</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">arroots</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maroots</span><span class="p">]</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">arfreq</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mafreq</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">k_ma</span><span class="p">:</span>
            <span class="n">mastubs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MA.</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k_ma</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="n">stubs</span> <span class="o">=</span> <span class="n">mastubs</span>
            <span class="n">roots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maroots</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mafreq</span>
        <span class="k">elif</span> <span class="n">k_ar</span><span class="p">:</span>
            <span class="n">arstubs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;AR.</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k_ar</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="n">stubs</span> <span class="o">=</span> <span class="n">arstubs</span>
            <span class="n">roots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arroots</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arfreq</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># 0,0 model</span>
            <span class="n">stubs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stubs</span><span class="p">):</span>  <span class="c1"># not 0, 0</span>
            <span class="n">modulus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">roots</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">roots</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">roots</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">modulus</span><span class="p">,</span> <span class="n">freq</span><span class="p">))</span>
            <span class="n">roots_table</span> <span class="o">=</span> <span class="n">SimpleTable</span><span class="p">([(</span><span class="s1">&#39;</span><span class="si">%17.4f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                        <span class="s1">&#39;</span><span class="si">%+17.4f</span><span class="s1">j&#39;</span> <span class="o">%</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                        <span class="s1">&#39;</span><span class="si">%17.4f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                        <span class="s1">&#39;</span><span class="si">%17.4f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">],</span>
                                      <span class="n">headers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;            Real&#39;</span><span class="p">,</span>
                                               <span class="s1">&#39;         Imaginary&#39;</span><span class="p">,</span>
                                               <span class="s1">&#39;         Modulus&#39;</span><span class="p">,</span>
                                               <span class="s1">&#39;        Frequency&#39;</span><span class="p">],</span>
                                      <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Roots&quot;</span><span class="p">,</span>
                                      <span class="n">stubs</span><span class="o">=</span><span class="n">stubs</span><span class="p">)</span>

            <span class="n">smry</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">roots_table</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">smry</span></div>

<div class="viewcode-block" id="ARMAResults.summary2"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMAResults.summary2.html#statsmodels.tsa.arima_model.ARMAResults.summary2">[docs]</a>    <span class="k">def</span> <span class="nf">summary2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">05</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.4f</span><span class="s2">&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Experimental summary function for ARIMA Results</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        title : string, optional</span>
<span class="sd">            Title for the top table. If not None, then this replaces the</span>
<span class="sd">            default title</span>
<span class="sd">        alpha : float</span>
<span class="sd">            significance level for the confidence intervals</span>
<span class="sd">        float_format: string</span>
<span class="sd">            print format for floats in parameters summary</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        smry : Summary instance</span>
<span class="sd">            This holds the summary table and text, which can be printed or</span>
<span class="sd">            converted to various output formats.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        statsmodels.iolib.summary2.Summary : class to hold summary</span>
<span class="sd">            results</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">pandas</span> <span class="k">import</span> <span class="n">DataFrame</span>
        <span class="c1"># get sample TODO: make better sample machinery for estimation</span>
        <span class="n">k_diff</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;k_diff&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;mle&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">method</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">k_diff</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">k_diff</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dates</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dates</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="p">[</span><span class="n">dates</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m-</span><span class="si">%d</span><span class="s1">-%Y&#39;</span><span class="p">)]</span>
            <span class="n">sample</span> <span class="o">+=</span> <span class="p">[</span><span class="n">dates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m-</span><span class="si">%d</span><span class="s1">-%Y&#39;</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; - &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">orig_endog</span><span class="p">))</span>

        <span class="n">k_ar</span><span class="p">,</span> <span class="n">k_ma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ma</span>

        <span class="c1"># Roots table</span>
        <span class="k">if</span> <span class="n">k_ma</span> <span class="ow">and</span> <span class="n">k_ar</span><span class="p">:</span>
            <span class="n">arstubs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;AR.</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k_ar</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="n">mastubs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MA.</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k_ma</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="n">stubs</span> <span class="o">=</span> <span class="n">arstubs</span> <span class="o">+</span> <span class="n">mastubs</span>
            <span class="n">roots</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">arroots</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maroots</span><span class="p">]</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">arfreq</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mafreq</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">k_ma</span><span class="p">:</span>
            <span class="n">mastubs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MA.</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k_ma</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="n">stubs</span> <span class="o">=</span> <span class="n">mastubs</span>
            <span class="n">roots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maroots</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mafreq</span>
        <span class="k">elif</span> <span class="n">k_ar</span><span class="p">:</span>
            <span class="n">arstubs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;AR.</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k_ar</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="n">stubs</span> <span class="o">=</span> <span class="n">arstubs</span>
            <span class="n">roots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arroots</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arfreq</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># 0, 0 order</span>
            <span class="n">stubs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stubs</span><span class="p">):</span>
            <span class="n">modulus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">roots</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">roots</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">roots</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">modulus</span><span class="p">,</span> <span class="n">freq</span><span class="p">))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Real&#39;</span><span class="p">,</span> <span class="s1">&#39;Imaginary&#39;</span><span class="p">,</span> <span class="s1">&#39;Modulus&#39;</span><span class="p">,</span> <span class="s1">&#39;Frequency&#39;</span><span class="p">]</span>
            <span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">stubs</span>

        <span class="c1"># Summary</span>
        <span class="kn">from</span> <span class="nn">statsmodels.iolib</span> <span class="k">import</span> <span class="n">summary2</span>
        <span class="n">smry</span> <span class="o">=</span> <span class="n">summary2</span><span class="o">.</span><span class="n">Summary</span><span class="p">()</span>

        <span class="c1"># Model info</span>
        <span class="n">model_info</span> <span class="o">=</span> <span class="n">summary2</span><span class="o">.</span><span class="n">summary_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">model_info</span><span class="p">[</span><span class="s1">&#39;Method:&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">method</span>
        <span class="n">model_info</span><span class="p">[</span><span class="s1">&#39;Sample:&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">model_info</span><span class="p">[</span><span class="s1">&#39;   &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">model_info</span><span class="p">[</span><span class="s1">&#39;S.D. of innovations:&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%#5.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma2</span><span class="o">**.</span><span class="mi">5</span>
        <span class="n">model_info</span><span class="p">[</span><span class="s1">&#39;HQIC:&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%#5.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">hqic</span>
        <span class="n">model_info</span><span class="p">[</span><span class="s1">&#39;No. Observations:&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span><span class="p">))</span>

        <span class="c1"># Parameters</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">summary2</span><span class="o">.</span><span class="n">summary_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">smry</span><span class="o">.</span><span class="n">add_dict</span><span class="p">(</span><span class="n">model_info</span><span class="p">)</span>
        <span class="n">smry</span><span class="o">.</span><span class="n">add_df</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="n">float_format</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stubs</span><span class="p">):</span>
            <span class="n">smry</span><span class="o">.</span><span class="n">add_df</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%17.4f</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">smry</span><span class="o">.</span><span class="n">add_title</span><span class="p">(</span><span class="n">results</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">smry</span></div>

<div class="viewcode-block" id="ARMAResults.plot_predict"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARMAResults.plot_predict.html#statsmodels.tsa.arima_model.ARMAResults.plot_predict">[docs]</a>    <span class="k">def</span> <span class="nf">plot_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dynamic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">alpha</span><span class="o">=.</span><span class="mi">05</span><span class="p">,</span> <span class="n">plot_insample</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">statsmodels.graphics.utils</span> <span class="k">import</span> <span class="n">_import_mpl</span><span class="p">,</span> <span class="n">create_mpl_ax</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">_import_mpl</span><span class="p">()</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">create_mpl_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="c1"># use predict so you set dates</span>
        <span class="n">forecast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">)</span>
        <span class="c1"># doing this twice. just add a plot keyword to predict?</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">out_of_sample</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_get_prediction_index</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">dynamic</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">out_of_sample</span><span class="p">:</span>
            <span class="n">steps</span> <span class="o">=</span> <span class="n">out_of_sample</span>
            <span class="n">fc_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forecast_error</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
            <span class="n">conf_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forecast_conf_int</span><span class="p">(</span><span class="n">forecast</span><span class="p">[</span><span class="o">-</span><span class="n">steps</span><span class="p">:],</span> <span class="n">fc_error</span><span class="p">,</span>
                                               <span class="n">alpha</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;predict_dates&quot;</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">pandas</span> <span class="k">import</span> <span class="n">Series</span>
            <span class="n">forecast</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">predict_dates</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;forecast&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_lines</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_xdata</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">out_of_sample</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:.0%}</span><span class="s2"> confidence interval&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="n">out_of_sample</span><span class="p">:],</span> <span class="n">conf_int</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">conf_int</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot_insample</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="n">end</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">start</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog_names</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span></div>
    <span class="n">plot_predict</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_plot_predict</span></div>


<span class="k">class</span> <span class="nc">ARMAResultsWrapper</span><span class="p">(</span><span class="n">wrap</span><span class="o">.</span><span class="n">ResultsWrapper</span><span class="p">):</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">_wrap_attrs</span> <span class="o">=</span> <span class="n">wrap</span><span class="o">.</span><span class="n">union_dicts</span><span class="p">(</span><span class="n">tsbase</span><span class="o">.</span><span class="n">TimeSeriesResultsWrapper</span><span class="o">.</span><span class="n">_wrap_attrs</span><span class="p">,</span>
                                   <span class="n">_attrs</span><span class="p">)</span>
    <span class="n">_methods</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">_wrap_methods</span> <span class="o">=</span> <span class="n">wrap</span><span class="o">.</span><span class="n">union_dicts</span><span class="p">(</span><span class="n">tsbase</span><span class="o">.</span><span class="n">TimeSeriesResultsWrapper</span><span class="o">.</span><span class="n">_wrap_methods</span><span class="p">,</span>
                                     <span class="n">_methods</span><span class="p">)</span>
<span class="n">wrap</span><span class="o">.</span><span class="n">populate_wrapper</span><span class="p">(</span><span class="n">ARMAResultsWrapper</span><span class="p">,</span> <span class="n">ARMAResults</span><span class="p">)</span>  <span class="c1"># noqa:E305</span>


<div class="viewcode-block" id="ARIMAResults"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARIMAResults.html#statsmodels.tsa.arima_model.ARIMAResults">[docs]</a><span class="k">class</span> <span class="nc">ARIMAResults</span><span class="p">(</span><span class="n">ARMAResults</span><span class="p">):</span>
<div class="viewcode-block" id="ARIMAResults.predict"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARIMAResults.predict.html#statsmodels.tsa.arima_model.ARIMAResults.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                <span class="n">dynamic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">)</span></div>
    <span class="n">predict</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_arima_results_predict</span>

    <span class="k">def</span> <span class="nf">_forecast_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">):</span>
        <span class="n">sigma2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma2</span>
        <span class="n">ma_rep</span> <span class="o">=</span> <span class="n">arma2ma</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">arparams</span><span class="p">],</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maparams</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="n">steps</span><span class="p">)</span>

        <span class="n">fcerr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">cumsum_n</span><span class="p">(</span><span class="n">ma_rep</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_diff</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">sigma2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fcerr</span>

    <span class="k">def</span> <span class="nf">_forecast_conf_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">forecast</span><span class="p">,</span> <span class="n">fcerr</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
        <span class="n">const</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
        <span class="n">conf_int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">const</span><span class="o">*</span><span class="n">fcerr</span><span class="p">,</span> <span class="n">forecast</span> <span class="o">+</span> <span class="n">const</span><span class="o">*</span><span class="n">fcerr</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">conf_int</span>

<div class="viewcode-block" id="ARIMAResults.forecast"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARIMAResults.forecast.html#statsmodels.tsa.arima_model.ARIMAResults.forecast">[docs]</a>    <span class="k">def</span> <span class="nf">forecast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">05</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Out-of-sample forecasts</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        steps : int</span>
<span class="sd">            The number of out of sample forecasts from the end of the</span>
<span class="sd">            sample.</span>
<span class="sd">        exog : array</span>
<span class="sd">            If the model is an ARIMAX, you must provide out of sample</span>
<span class="sd">            values for the exogenous variables. This should not include</span>
<span class="sd">            the constant.</span>
<span class="sd">        alpha : float</span>
<span class="sd">            The confidence intervals for the forecasts are (1 - alpha) %</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        forecast : array</span>
<span class="sd">            Array of out of sample forecasts</span>
<span class="sd">        stderr : array</span>
<span class="sd">            Array of the standard error of the forecasts.</span>
<span class="sd">        conf_int : array</span>
<span class="sd">            2d array of the confidence interval for the forecast</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Prediction is done in the levels of the original endogenous variable.</span>
<span class="sd">        If you would like prediction of differences in levels use `predict`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">exog</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">exog</span> <span class="o">=</span> <span class="n">exog</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">steps</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;new exog needed for each step&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span> <span class="o">!=</span> <span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;exog must contain the same number of &#39;</span>
                                 <span class="s1">&#39;variables as in the estimated model.&#39;</span><span class="p">)</span>
            <span class="c1"># prepend in-sample exog observations</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">exog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">exog</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span><span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_trend</span><span class="p">:],</span>
                                  <span class="n">exog</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Forecast values for exog are required when &#39;</span>
                                 <span class="s1">&#39;the model contains exogenous regressors.&#39;</span><span class="p">)</span>

        <span class="n">forecast</span> <span class="o">=</span> <span class="n">_arma_predict_out_of_sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">k_ar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ma</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">k_trend</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_exog</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span><span class="p">,</span>
                                               <span class="n">exog</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>

        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_diff</span>
        <span class="n">endog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">endog</span><span class="p">[</span><span class="o">-</span><span class="n">d</span><span class="p">:]</span>
        <span class="n">forecast</span> <span class="o">=</span> <span class="n">unintegrate</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">unintegrate_levels</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">d</span><span class="p">))[</span><span class="n">d</span><span class="p">:]</span>

        <span class="c1"># get forecast errors</span>
        <span class="n">fcerr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forecast_error</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
        <span class="n">conf_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forecast_conf_int</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">fcerr</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">forecast</span><span class="p">,</span> <span class="n">fcerr</span><span class="p">,</span> <span class="n">conf_int</span></div>

<div class="viewcode-block" id="ARIMAResults.plot_predict"><a class="viewcode-back" href="../../../generated/statsmodels.tsa.arima_model.ARIMAResults.plot_predict.html#statsmodels.tsa.arima_model.ARIMAResults.plot_predict">[docs]</a>    <span class="k">def</span> <span class="nf">plot_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dynamic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">alpha</span><span class="o">=.</span><span class="mi">05</span><span class="p">,</span> <span class="n">plot_insample</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">statsmodels.graphics.utils</span> <span class="k">import</span> <span class="n">_import_mpl</span><span class="p">,</span> <span class="n">create_mpl_ax</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">_import_mpl</span><span class="p">()</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">create_mpl_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="c1"># use predict so you set dates</span>
        <span class="n">forecast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="s1">&#39;levels&#39;</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">)</span>
        <span class="c1"># doing this twice. just add a plot keyword to predict?</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">out_of_sample</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_get_prediction_index</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">out_of_sample</span><span class="p">:</span>
            <span class="n">steps</span> <span class="o">=</span> <span class="n">out_of_sample</span>
            <span class="n">fc_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forecast_error</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
            <span class="n">conf_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forecast_conf_int</span><span class="p">(</span><span class="n">forecast</span><span class="p">[</span><span class="o">-</span><span class="n">steps</span><span class="p">:],</span> <span class="n">fc_error</span><span class="p">,</span>
                                               <span class="n">alpha</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;predict_dates&quot;</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">pandas</span> <span class="k">import</span> <span class="n">Series</span>
            <span class="n">forecast</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">predict_dates</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;forecast&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_lines</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_xdata</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">out_of_sample</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:.0%}</span><span class="s2"> confidence interval&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="n">out_of_sample</span><span class="p">:],</span> <span class="n">conf_int</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">conf_int</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot_insample</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">re</span>
            <span class="n">k_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_diff</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;D\d*\.&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog_names</span><span class="p">)</span>
            <span class="n">levels</span> <span class="o">=</span> <span class="n">unintegrate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_first_unintegrate</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="n">end</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">start</span><span class="p">],</span>
                    <span class="n">levels</span><span class="p">[</span><span class="n">start</span> <span class="o">+</span> <span class="n">k_diff</span><span class="p">:</span><span class="n">end</span> <span class="o">+</span> <span class="n">k_diff</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span></div>

    <span class="n">plot_predict</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_arima_plot_predict</span></div>


<span class="k">class</span> <span class="nc">ARIMAResultsWrapper</span><span class="p">(</span><span class="n">ARMAResultsWrapper</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="n">wrap</span><span class="o">.</span><span class="n">populate_wrapper</span><span class="p">(</span><span class="n">ARIMAResultsWrapper</span><span class="p">,</span> <span class="n">ARIMAResults</span><span class="p">)</span>  <span class="c1"># noqa:E305</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>

    <span class="c1"># simulate arma process</span>
    <span class="kn">from</span> <span class="nn">statsmodels.tsa.arima_process</span> <span class="k">import</span> <span class="n">arma_generate_sample</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">arma_generate_sample</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-.</span><span class="mi">75</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">],</span> <span class="n">nsample</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">arma</span> <span class="o">=</span> <span class="n">ARMA</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">arma</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trend</span><span class="o">=</span><span class="s1">&#39;nc&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>
    <span class="n">y_arma22</span> <span class="o">=</span> <span class="n">arma_generate_sample</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-.</span><span class="mi">85</span><span class="p">,</span> <span class="o">.</span><span class="mi">35</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">,</span> <span class="o">-.</span><span class="mi">9</span><span class="p">],</span>
                                    <span class="n">nsample</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">arma22</span> <span class="o">=</span> <span class="n">ARMA</span><span class="p">(</span><span class="n">y_arma22</span><span class="p">)</span>
    <span class="n">res22</span> <span class="o">=</span> <span class="n">arma22</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trend</span><span class="o">=</span><span class="s1">&#39;nc&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="c1"># test CSS</span>
    <span class="n">arma22_css</span> <span class="o">=</span> <span class="n">ARMA</span><span class="p">(</span><span class="n">y_arma22</span><span class="p">)</span>
    <span class="n">res22css</span> <span class="o">=</span> <span class="n">arma22_css</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trend</span><span class="o">=</span><span class="s1">&#39;nc&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;css&#39;</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">sunspots</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">as_pandas</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ar</span> <span class="o">=</span> <span class="n">ARMA</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">endog</span><span class="p">)</span>
    <span class="n">resar</span> <span class="o">=</span> <span class="n">ar</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trend</span><span class="o">=</span><span class="s1">&#39;nc&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="n">y_arma31</span> <span class="o">=</span> <span class="n">arma_generate_sample</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-.</span><span class="mi">75</span><span class="p">,</span> <span class="o">-.</span><span class="mi">35</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">],</span> <span class="p">[</span><span class="o">.</span><span class="mi">1</span><span class="p">],</span>
                                    <span class="n">nsample</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

    <span class="n">arma31css</span> <span class="o">=</span> <span class="n">ARMA</span><span class="p">(</span><span class="n">y_arma31</span><span class="p">)</span>
    <span class="n">res31css</span> <span class="o">=</span> <span class="n">arma31css</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;css&quot;</span><span class="p">,</span> <span class="n">trend</span><span class="o">=</span><span class="s2">&quot;nc&quot;</span><span class="p">,</span>
                             <span class="n">transparams</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">y_arma13</span> <span class="o">=</span> <span class="n">arma_generate_sample</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-.</span><span class="mi">75</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">,</span> <span class="o">-.</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">],</span>
                                    <span class="n">nsample</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">arma13css</span> <span class="o">=</span> <span class="n">ARMA</span><span class="p">(</span><span class="n">y_arma13</span><span class="p">)</span>
    <span class="n">res13css</span> <span class="o">=</span> <span class="n">arma13css</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;css&#39;</span><span class="p">,</span> <span class="n">trend</span><span class="o">=</span><span class="s1">&#39;nc&#39;</span><span class="p">)</span>

<span class="c1"># check css for p &lt; q and q &lt; p</span>
    <span class="n">y_arma41</span> <span class="o">=</span> <span class="n">arma_generate_sample</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-.</span><span class="mi">75</span><span class="p">,</span> <span class="o">.</span><span class="mi">35</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">,</span> <span class="o">-.</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-.</span><span class="mi">35</span><span class="p">],</span>
                                    <span class="n">nsample</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">arma41css</span> <span class="o">=</span> <span class="n">ARMA</span><span class="p">(</span><span class="n">y_arma41</span><span class="p">)</span>
    <span class="n">res41css</span> <span class="o">=</span> <span class="n">arma41css</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">trend</span><span class="o">=</span><span class="s1">&#39;nc&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;css&#39;</span><span class="p">)</span>

    <span class="n">y_arma14</span> <span class="o">=</span> <span class="n">arma_generate_sample</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-.</span><span class="mi">25</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-.</span><span class="mi">75</span><span class="p">,</span> <span class="o">.</span><span class="mi">35</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">,</span> <span class="o">-.</span><span class="mi">3</span><span class="p">],</span>
                                    <span class="n">nsample</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">arma14css</span> <span class="o">=</span> <span class="n">ARMA</span><span class="p">(</span><span class="n">y_arma14</span><span class="p">)</span>
    <span class="n">res14css</span> <span class="o">=</span> <span class="n">arma14css</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">trend</span><span class="o">=</span><span class="s1">&#39;nc&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;css&#39;</span><span class="p">)</span>

    <span class="c1"># ARIMA Model</span>
    <span class="kn">from</span> <span class="nn">statsmodels.datasets</span> <span class="k">import</span> <span class="n">webuse</span>
    <span class="n">dta</span> <span class="o">=</span> <span class="n">webuse</span><span class="p">(</span><span class="s1">&#39;wpi1&#39;</span><span class="p">)</span>
    <span class="n">wpi</span> <span class="o">=</span> <span class="n">dta</span><span class="p">[</span><span class="s1">&#39;wpi&#39;</span><span class="p">]</span>

    <span class="n">mod</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">wpi</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>




          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2009-2018, Josef Perktold, Skipper Seabold, Jonathan Taylor, statsmodels-developers.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.
    </div>
  </body>
</html>