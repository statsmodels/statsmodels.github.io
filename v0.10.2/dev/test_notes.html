

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Testing &#8212; statsmodels v0.10.2 documentation</title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../_static/statsmodels_hybi_favico.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Naming Conventions" href="naming_conventions.html" />
    <link rel="prev" title="Maintainer Notes" href="maintainer_notes.html" />
<link rel="stylesheet" href="../_static/examples.css" type="text/css" />
<link rel="stylesheet" href="../_static/facebox.css" type="text/css" />
<script type="text/javascript" src="../_static/scripts.js">
</script>
<script type="text/javascript" src="../_static/facebox.js">
</script>
<script type="text/javascript">
$.facebox.settings.closeImage = "../_static/closelabel.png"
$.facebox.settings.loadingImage = "../_static/loading.gif"
</script>

<script>
$(document).ready(function() {
  $.getJSON("../../versions.json", function(versions) {
    var dropdown = document.createElement("div");
    dropdown.className = "dropdown";
    var button = document.createElement("button");
    button.className = "dropbtn";
    button.innerHTML = "Other Versions";
    var content = document.createElement("div");
    content.className = "dropdown-content";
    dropdown.appendChild(button);
    dropdown.appendChild(content);
    $(".header").prepend(dropdown);
    for (var i = 0; i < versions.length; i++) {
      if (versions[i].substring(0, 1) == "v") {
        versions[i] = [versions[i], versions[i].substring(1)];
      } else {
        versions[i] = [versions[i], versions[i]];
      };
    };
    for (var i = 0; i < versions.length; i++) {
      var a = document.createElement("a");
      a.innerHTML = versions[i][1];
      a.href = "../../" + versions[i][0] + "/index.html";
      a.title = versions[i][1];
      $(".dropdown-content").append(a);
    };
  });
});
</script>


  </head><body>
<div class="headerwrap">
    <div class = "header">
        
        <a href = "../index.html">
<img src="../_static/statsmodels_hybi_banner.png" alt="Logo"
    style="padding-left: 15px"/></a>
        
    </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="naming_conventions.html" title="Naming Conventions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="maintainer_notes.html" title="Maintainer Notes"
             accesskey="P">previous</a> |</li>
<li><a href ="../install.html">Install</a></li> &nbsp;|&nbsp;
<li><a href="https://groups.google.com/forum/?hl=en#!forum/pystatsmodels">Support</a></li> &nbsp;|&nbsp;
<li><a href="https://github.com/statsmodels/statsmodels/issues">Bugs</a></li> &nbsp;|&nbsp;
<li><a href="index.html">Develop</a></li> &nbsp;|&nbsp;
<li><a href="../examples/index.html">Examples</a></li> &nbsp;|&nbsp;
<li><a href="../faq.html">FAQ</a></li> &nbsp;|&nbsp;

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Developer Page</a> |</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            




  <div class="section" id="testing">
<span id="id1"></span><h1>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setting-up-development-environment-locally">
<h2>Setting up development environment locally<a class="headerlink" href="#setting-up-development-environment-locally" title="Permalink to this headline">¶</a></h2>
<p>Follow our <a class="reference internal" href="../install.html#install"><span class="std std-ref">installation instructions</span></a> and set up a suitable
environment to build statsmodels from source. We recommend that you develop
using a development install of statsmodels:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">develop</span>
</pre></div>
</div>
<p>This will compile the C code and add statsmodels to your activate python
environment by creating links from your python environemnt’s libraries
to the statsmodels source code. Therefore, changes to pure python code will
be immediately available to the user without a re-install.</p>
</div>
<div class="section" id="test-driven-development">
<h2>Test Driven Development<a class="headerlink" href="#test-driven-development" title="Permalink to this headline">¶</a></h2>
<p>We strive to follow a <a class="reference external" href="https://en.wikipedia.org/wiki/Test-driven_development">Test Driven Development (TDD)</a> pattern.
All models or statistical functions that are added to the main code base are to have
tests versus an existing statistical package, if possible.</p>
</div>
<div class="section" id="introduction-to-pytest">
<h2>Introduction to pytest<a class="headerlink" href="#introduction-to-pytest" title="Permalink to this headline">¶</a></h2>
<p>Like many packages, statsmodels uses the <a class="reference external" href="https://docs.pytest.org/en/latest/contents.html">pytest testing system</a> and the convenient extensions in <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/routines.testing.html">numpy.testing</a>.  Pytest will find any file, directory, function, or class name that starts with <code class="docutils literal notranslate"><span class="pre">test</span></code> or <code class="docutils literal notranslate"><span class="pre">Test</span></code> (classes only). Test function should start with <code class="docutils literal notranslate"><span class="pre">test</span></code>, test classes should start with <code class="docutils literal notranslate"><span class="pre">Test</span></code>. These functions and classes should be placed in files with names beginning with <code class="docutils literal notranslate"><span class="pre">test</span></code> in a directory called <code class="docutils literal notranslate"><span class="pre">tests</span></code>.</p>
</div>
<div class="section" id="running-the-test-suite">
<span id="run-tests"></span><h2>Running the Test Suite<a class="headerlink" href="#running-the-test-suite" title="Permalink to this headline">¶</a></h2>
<p>You can run all the tests by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sm</span><span class="o">.</span><span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
<p>You can test submodules by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sm</span><span class="o">.</span><span class="n">discrete</span><span class="o">.</span><span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="running-tests-using-the-command-line">
<h2>Running Tests using the command line<a class="headerlink" href="#running-tests-using-the-command-line" title="Permalink to this headline">¶</a></h2>
<p>Test can also be run from the command line by calling <code class="docutils literal notranslate"><span class="pre">pytest</span></code>.  Tests can be run
at different levels:</p>
<ul class="simple">
<li><p>Project level, which runs all tests.  Running the entire test suite is slow
and normally this would only be needed if making deep changes to statsmodels.</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest statsmodels
</pre></div>
</div>
<ul class="simple">
<li><p>Folder level, which runs all tests below a folder</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest statsmodels/regression/tests
</pre></div>
</div>
<ul class="simple">
<li><p>File level, which runs all tests in a file</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest statsmodels/regression/tests/test_regression.py
</pre></div>
</div>
<ul class="simple">
<li><p>Class level, which runs all tests in a class</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest statsmodels/regression/tests/test_regression.py::TestOLS
</pre></div>
</div>
<ul class="simple">
<li><p>Test level, which runs a single test.  The first example runs a test in a
class.  The second runs a stand alone test.</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest statsmodels/regression/tests/test_regression.py::TestOLS::test_missing
pytest statsmodels/regression/tests/test_regression.py::test_ridge
</pre></div>
</div>
</div>
<div class="section" id="how-to-write-a-test">
<h2>How To Write A Test<a class="headerlink" href="#how-to-write-a-test" title="Permalink to this headline">¶</a></h2>
<p>NumPy provides a good introduction to unit testing with pytest and NumPy extensions <a class="reference external" href="https://github.com/numpy/numpy/blob/master/doc/TESTS.rst.txt">here</a>. It is worth a read for some more details.
Here, we will document a few conventions we follow that are worth mentioning. Often we want to test
a whole model at once rather than just one function, for example. The following is a pared down
version test_discrete.py. In this case, several different models with different options need to be
tested. The tests look something like</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numpy.testing</span> <span class="kn">import</span> <span class="n">assert_almost_equal</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="kn">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">results.results_discrete</span> <span class="kn">import</span> <span class="n">Spector</span>

<span class="k">class</span> <span class="nc">CheckDiscreteResults</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    res2 are the results. res1 are the values from statsmodels</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">assert_almost_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res1</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">res2</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    <span class="n">decimal_tvalues</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="k">def</span> <span class="nf">test_tvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">assert_almost_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res1</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">res2</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">decimal_tvalues</span><span class="p">)</span>

    <span class="c1"># ... as many more tests as there are common results</span>

<span class="k">class</span> <span class="nc">TestProbitNewton</span><span class="p">(</span><span class="n">CheckDiscreteResults</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests the Probit model using Newton&#39;s method for fitting.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setup_class</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="c1"># set up model</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">spector</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="n">data</span><span class="o">.</span><span class="n">exog</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">exog</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">res1</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">Probit</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">endog</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">exog</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;newton&#39;</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># set up results</span>
        <span class="n">res2</span> <span class="o">=</span> <span class="n">Spector</span><span class="o">.</span><span class="n">probit</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">res2</span> <span class="o">=</span> <span class="n">res2</span>

        <span class="c1"># set up precision</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">decimal_tvalues</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="k">def</span> <span class="nf">test_model_specifc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">assert_almost_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res1</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">res2</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>The main workhorse is the <cite>CheckDiscreteResults</cite> class. Notice that we can set the level of precision
for <cite>tvalues</cite> to be different than the default in the subclass  <cite>TestProbitNewton</cite>. All of the test
classes have a <code class="docutils literal notranslate"><span class="pre">&#64;classmethod</span></code> called <code class="docutils literal notranslate"><span class="pre">setup_class</span></code>. Otherwise, pytest would reinstantiate the class
before every single test method. If the fitting of the model is time consuming, then this is clearly
undesirable. Finally, we have a script at the bottom so that we can run the tests should be running
the Python file.</p>
</div>
<div class="section" id="test-results">
<h2>Test Results<a class="headerlink" href="#test-results" title="Permalink to this headline">¶</a></h2>
<p>The test results are the final piece of the above example. For many tests, especially those for the
models, there are many results against which you would like to test. It makes sense then to separate
the hard-coded results from the actual tests to make the tests more readable. If there are only a few
results it’s not necessary to separate the results. We often take results from some other statistical
package. It is important to document where you got the results from and why they might differ from
the results that we get. Each tests folder has a results subdirectory. Consider the folder structure
for the discrete models:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tests</span><span class="o">/</span>
    <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
    <span class="n">test_discrete</span><span class="o">.</span><span class="n">py</span>
    <span class="n">results</span><span class="o">/</span>
        <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
        <span class="n">results_discrete</span><span class="o">.</span><span class="n">py</span>
        <span class="n">nbinom_resids</span><span class="o">.</span><span class="n">csv</span>
</pre></div>
</div>
<p>It is up to you how best to structure the results. In the discrete model example, you will notice
that there are result classes based around particular datasets with a method for loading different
model results for that dataset. You can also include text files that hold results to be loaded by
results classes if it is easier than putting them in the class itself.</p>
</div>
</div>





          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Testing</a><ul>
<li><a class="reference internal" href="#setting-up-development-environment-locally">Setting up development environment locally</a></li>
<li><a class="reference internal" href="#test-driven-development">Test Driven Development</a></li>
<li><a class="reference internal" href="#introduction-to-pytest">Introduction to pytest</a></li>
<li><a class="reference internal" href="#running-the-test-suite">Running the Test Suite</a></li>
<li><a class="reference internal" href="#running-tests-using-the-command-line">Running Tests using the command line</a></li>
<li><a class="reference internal" href="#how-to-write-a-test">How To Write A Test</a></li>
<li><a class="reference internal" href="#test-results">Test Results</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="maintainer_notes.html"
                        title="previous chapter">Maintainer Notes</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="naming_conventions.html"
                        title="next chapter">Naming Conventions</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/dev/test_notes.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2009-2018, Josef Perktold, Skipper Seabold, Jonathan Taylor, statsmodels-developers.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.1.
    </div>
  </body>
</html>