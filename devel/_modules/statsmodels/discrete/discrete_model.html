


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../_static/favicon.ico">
    
    
  
      
        <title>statsmodels.discrete.discrete_model - statsmodels 0.15.0 (+26)</title>
      
    
  <link rel="icon" type="image/png" sizes="32x32" href="../../../_static/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../../../_static/icons/favicon-16x16.png">
  <link rel="manifest" href="../../../_static/icons/site.webmanifest">
  <link rel="mask-icon" href="../../../_static/icons/safari-pinned-tab.svg" color="#919191">
  <meta name="msapplication-TileColor" content="#2b5797">
  <meta name="msapplication-config" content="../../../_static/icons/browserconfig.xml">
  <link rel="stylesheet" href="../../../_static/stylesheets/examples.css">
  <link rel="stylesheet" href="../../../_static/stylesheets/deprecation.css">
    
      
        
        
          
          
          <meta name="theme-color" content="#4051b5">
        
      
      

    
    
    
      
        
        
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
        <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_immaterial_theme.9dcb20399d0097661.min.css" />
        <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
        <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../index.html" title="statsmodels 0.15.0 (+26)" class="md-header__button md-logo" aria-label="statsmodels 0.15.0 (+26)" data-md-component="logo">
      <img src="../../../_static/statsmodels-logo-v2-bw.svg" alt="logo">
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            statsmodels 0.15.0 (+26)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              statsmodels.discrete.discrete_model
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/statsmodels/statsmodels/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    statsmodels
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../index.html" title="statsmodels 0.15.0 (+26)" class="md-nav__button md-logo" aria-label="statsmodels 0.15.0 (+26)" data-md-component="logo">
      <img src="../../../_static/statsmodels-logo-v2-bw.svg" alt="logo">
    </a>
    statsmodels 0.15.0 (+26)
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/statsmodels/statsmodels/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    statsmodels
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../../install.html" class="md-nav__link">
        <span title="/install.rst (reference label)" class="md-ellipsis">Installing statsmodels</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../../gettingstarted.html" class="md-nav__link">
        <span title="/gettingstarted.rst (reference label)" class="md-ellipsis">Getting started</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide.html" class="md-nav__link">
        <span title="/user-guide.rst (reference label)" class="md-ellipsis">User Guide</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/index.html" class="md-nav__link">
        <span title="/examples/index.rst (reference label)" class="md-ellipsis">Examples</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api.html" class="md-nav__link">
        <span title="/api.rst (reference label)" class="md-ellipsis">API Reference</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../../about.html" class="md-nav__link">
        <span title="/about.rst (reference label)" class="md-ellipsis">About statsmodels</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dev/index.html" class="md-nav__link">
        <span title="/dev/index.rst (reference label)" class="md-ellipsis">Developer Page</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../../release/index.html" class="md-nav__link">
        <span title="/release/index.rst (reference label)" class="md-ellipsis">Release Notes</span>
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary">
  
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset" role="main">
                  


<h1>Source code for statsmodels.discrete.discrete_model</h1><div class="highlight"><pre>
<span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Limited dependent variable and qualitative variables.</span>

<span class="sd">Includes binary outcomes, count data, (ordered) ordinal data and limited</span>
<span class="sd">dependent variables.</span>

<span class="sd">General References</span>
<span class="sd">--------------------</span>

<span class="sd">A.C. Cameron and P.K. Trivedi.  `Regression Analysis of Count Data`.</span>
<span class="sd">    Cambridge, 1998</span>

<span class="sd">G.S. Madalla. `Limited-Dependent and Qualitative Variables in Econometrics`.</span>
<span class="sd">    Cambridge, 1983.</span>

<span class="sd">W. Greene. `Econometric Analysis`. Prentice Hall, 5th. edition. 2003.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Poisson&quot;</span><span class="p">,</span> <span class="s2">&quot;Logit&quot;</span><span class="p">,</span> <span class="s2">&quot;Probit&quot;</span><span class="p">,</span> <span class="s2">&quot;MNLogit&quot;</span><span class="p">,</span> <span class="s2">&quot;NegativeBinomial&quot;</span><span class="p">,</span>
           <span class="s2">&quot;GeneralizedPoisson&quot;</span><span class="p">,</span> <span class="s2">&quot;NegativeBinomialP&quot;</span><span class="p">,</span> <span class="s2">&quot;CountModel&quot;</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">statsmodels.compat.pandas</span> <span class="kn">import</span> <span class="n">Appender</span>

<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">MultiIndex</span><span class="p">,</span> <span class="n">get_dummies</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">special</span><span class="p">,</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">digamma</span><span class="p">,</span> <span class="n">gammaln</span><span class="p">,</span> <span class="n">loggamma</span><span class="p">,</span> <span class="n">polygamma</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">nbinom</span>

<span class="kn">from</span> <span class="nn">statsmodels.base.data</span> <span class="kn">import</span> <span class="n">handle_data</span>  <span class="c1"># for mnlogit</span>
<span class="kn">from</span> <span class="nn">statsmodels.base.l1_slsqp</span> <span class="kn">import</span> <span class="n">fit_l1_slsqp</span>
<span class="kn">import</span> <span class="nn">statsmodels.base.model</span> <span class="k">as</span> <span class="nn">base</span>
<span class="kn">import</span> <span class="nn">statsmodels.base.wrapper</span> <span class="k">as</span> <span class="nn">wrap</span>
<span class="kn">from</span> <span class="nn">statsmodels.base._constraints</span> <span class="kn">import</span> <span class="n">fit_constrained_wrap</span>
<span class="kn">import</span> <span class="nn">statsmodels.base._parameter_inference</span> <span class="k">as</span> <span class="nn">pinfer</span>
<span class="kn">from</span> <span class="nn">statsmodels.base</span> <span class="kn">import</span> <span class="n">_prediction_inference</span> <span class="k">as</span> <span class="n">pred</span>
<span class="kn">from</span> <span class="nn">statsmodels.distributions</span> <span class="kn">import</span> <span class="n">genpoisson_p</span>
<span class="kn">import</span> <span class="nn">statsmodels.regression.linear_model</span> <span class="k">as</span> <span class="nn">lm</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools</span> <span class="kn">import</span> <span class="n">data</span> <span class="k">as</span> <span class="n">data_tools</span><span class="p">,</span> <span class="n">tools</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools.decorators</span> <span class="kn">import</span> <span class="n">cache_readonly</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools.numdiff</span> <span class="kn">import</span> <span class="n">approx_fprime_cs</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools.sm_exceptions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">PerfectSeparationError</span><span class="p">,</span>
    <span class="n">PerfectSeparationWarning</span><span class="p">,</span>
    <span class="n">SpecificationWarning</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cvxopt</span>  <span class="c1"># noqa:F401</span>
    <span class="n">have_cvxopt</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">have_cvxopt</span> <span class="o">=</span> <span class="kc">False</span>


<span class="c1"># TODO: When we eventually get user-settable precision, we need to change</span>
<span class="c1">#       this</span>
<span class="n">FLOAT_EPS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>

<span class="c1"># Limit for exponentials to avoid overflow</span>
<span class="n">EXP_UPPER_LIMIT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span>

<span class="c1"># TODO: add options for the parameter covariance/variance</span>
<span class="c1">#       ie., OIM, EIM, and BHHH see Green 21.4</span>

<span class="n">_discrete_models_docs</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">_discrete_results_docs</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    </span><span class="si">%(one_line_description)s</span>

<span class="s2">    Parameters</span>
<span class="s2">    ----------</span>
<span class="s2">    model : A DiscreteModel instance</span>
<span class="s2">    params : array_like</span>
<span class="s2">        The parameters of a fitted model.</span>
<span class="s2">    hessian : array_like</span>
<span class="s2">        The hessian of the fitted model.</span>
<span class="s2">    scale : float</span>
<span class="s2">        A scale parameter for the covariance matrix.</span>

<span class="s2">    Attributes</span>
<span class="s2">    ----------</span>
<span class="s2">    df_resid : float</span>
<span class="s2">        See model definition.</span>
<span class="s2">    df_model : float</span>
<span class="s2">        See model definition.</span>
<span class="s2">    llf : float</span>
<span class="s2">        Value of the loglikelihood</span>
<span class="s2">    </span><span class="si">%(extra_attr)s</span><span class="s2">&quot;&quot;&quot;</span>

<span class="n">_l1_results_attr</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;    nnz_params : int</span>
<span class="s2">        The number of nonzero parameters in the model.  Train with</span>
<span class="s2">        trim_params == True or else numerical error will distort this.</span>
<span class="s2">    trimmed : bool array</span>
<span class="s2">        trimmed[i] == True if the ith parameter was trimmed from the model.&quot;&quot;&quot;</span>

<span class="n">_get_start_params_null_docs</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Compute one-step moment estimator for null (constant-only) model</span>

<span class="s2">This is a preliminary estimator used as start_params.</span>

<span class="s2">Returns</span>
<span class="s2">-------</span>
<span class="s2">params : ndarray</span>
<span class="s2">    parameter estimate based one one-step moment matching</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="n">_check_rank_doc</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    check_rank : bool</span>
<span class="s2">        Check exog rank to determine model degrees of freedom. Default is</span>
<span class="s2">        True. Setting to False reduces model initialization time when</span>
<span class="s2">        exog.shape[1] is large.</span>
<span class="s2">    &quot;&quot;&quot;</span>


<span class="c1"># helper for MNLogit (will be generally useful later)</span>
<span class="k">def</span> <span class="nf">_numpy_to_dummies</span><span class="p">(</span><span class="n">endog</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">endog</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">endog</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">]:</span>
        <span class="n">endog_dummies</span> <span class="o">=</span> <span class="n">endog</span>
        <span class="n">ynames</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">endog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dummies</span> <span class="o">=</span> <span class="n">get_dummies</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ynames</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">dummies</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dummies</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])}</span>
        <span class="n">endog_dummies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dummies</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">endog_dummies</span><span class="p">,</span> <span class="n">ynames</span>

    <span class="k">return</span> <span class="n">endog_dummies</span><span class="p">,</span> <span class="n">ynames</span>


<span class="k">def</span> <span class="nf">_pandas_to_dummies</span><span class="p">(</span><span class="n">endog</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">endog</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">endog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">yname</span> <span class="o">=</span> <span class="n">endog</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">endog_dummies</span> <span class="o">=</span> <span class="n">get_dummies</span><span class="p">(</span><span class="n">endog</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># assume already dummies</span>
            <span class="n">yname</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>
            <span class="n">endog_dummies</span> <span class="o">=</span> <span class="n">endog</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">yname</span> <span class="o">=</span> <span class="n">endog</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">yname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yname</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>
        <span class="n">endog_dummies</span> <span class="o">=</span> <span class="n">get_dummies</span><span class="p">(</span><span class="n">endog</span><span class="p">)</span>
    <span class="n">ynames</span> <span class="o">=</span> <span class="n">endog_dummies</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">endog_dummies</span><span class="p">,</span> <span class="n">ynames</span><span class="p">,</span> <span class="n">yname</span>


<span class="k">def</span> <span class="nf">_validate_l1_method</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    As of 0.10.0, the supported values for `method` in `fit_regularized`</span>
<span class="sd">    are &quot;l1&quot; and &quot;l1_cvxopt_cp&quot;.  If an invalid value is passed, raise</span>
<span class="sd">    with a helpful error message</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    method : str</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="s1">&#39;l1_cvxopt_cp&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;`method` = </span><span class="si">{method}</span><span class="s1"> is not supported, use either &#39;</span>
                         <span class="s1">&#39;&quot;l1&quot; or &quot;l1_cvxopt_cp&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">))</span>


<span class="c1">#### Private Model Classes ####</span>


<div class="viewcode-block" id="DiscreteModel"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.DiscreteModel.html#statsmodels.discrete.discrete_model.DiscreteModel">[docs]</a><span class="k">class</span> <span class="nc">DiscreteModel</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">LikelihoodModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract class for discrete choice models.</span>

<span class="sd">    This class does not do anything itself but lays out the methods and</span>
<span class="sd">    call signature expected of child classes in addition to those of</span>
<span class="sd">    statsmodels.model.LikelihoodModel.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">check_rank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_rank</span> <span class="o">=</span> <span class="n">check_rank</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raise_on_perfect_prediction</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># keep for backwards compat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_extra</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="DiscreteModel.initialize"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.DiscreteModel.initialize.html#statsmodels.discrete.discrete_model.DiscreteModel.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize is called by</span>
<span class="sd">        statsmodels.model.LikelihoodModel.__init__</span>
<span class="sd">        and should contain any preprocessing that needs to be done for a model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_rank</span><span class="p">:</span>
            <span class="c1"># assumes constant</span>
            <span class="n">rank</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">matrix_rank</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;qr&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If rank check is skipped, assume full</span>
            <span class="n">rank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_model</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rank</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_resid</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">rank</span><span class="p">)</span></div>

<div class="viewcode-block" id="DiscreteModel.cdf"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.DiscreteModel.cdf.html#statsmodels.discrete.discrete_model.DiscreteModel.cdf">[docs]</a>    <span class="k">def</span> <span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The cumulative distribution function of the model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="DiscreteModel.pdf"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.DiscreteModel.pdf.html#statsmodels.discrete.discrete_model.DiscreteModel.pdf">[docs]</a>    <span class="k">def</span> <span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The probability density (mass) function of the model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

    <span class="k">def</span> <span class="nf">_check_perfect_pred</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">endog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span>
        <span class="n">fittedvalues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">fittedvalues</span> <span class="o">-</span> <span class="n">endog</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raise_on_perfect_prediction</span><span class="p">:</span>
                <span class="c1"># backwards compatibility for attr raise_on_perfect_prediction</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Perfect separation detected, results not available&quot;</span>
                <span class="k">raise</span> <span class="n">PerfectSeparationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Perfect separation or prediction detected, &quot;</span>
                       <span class="s2">&quot;parameter may not be identified&quot;</span><span class="p">)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">PerfectSeparationWarning</span><span class="p">)</span>

<div class="viewcode-block" id="DiscreteModel.fit"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.DiscreteModel.fit.html#statsmodels.discrete.discrete_model.DiscreteModel.fit">[docs]</a>    <span class="nd">@Appender</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">LikelihoodModel</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;newton&#39;</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span>
            <span class="n">full_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit the model using maximum likelihood.</span>

<span class="sd">        The rest of the docstring is from</span>
<span class="sd">        statsmodels.base.model.LikelihoodModel.fit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">callback</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_perfect_pred</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># TODO: make a function factory to have multiple call-backs</span>

        <span class="n">mlefit</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">start_params</span><span class="o">=</span><span class="n">start_params</span><span class="p">,</span>
                             <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                             <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
                             <span class="n">full_output</span><span class="o">=</span><span class="n">full_output</span><span class="p">,</span>
                             <span class="n">disp</span><span class="o">=</span><span class="n">disp</span><span class="p">,</span>
                             <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mlefit</span>  <span class="c1"># It is up to subclasses to wrap results</span></div>

<div class="viewcode-block" id="DiscreteModel.fit_regularized"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.DiscreteModel.fit_regularized.html#statsmodels.discrete.discrete_model.DiscreteModel.fit_regularized">[docs]</a>    <span class="k">def</span> <span class="nf">fit_regularized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span>
                        <span class="n">maxiter</span><span class="o">=</span><span class="s1">&#39;defined_by_method&#39;</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">trim_mode</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                        <span class="n">auto_trim_tol</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">size_trim_tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">qc_tol</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span>
                        <span class="n">qc_verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit the model using a regularized maximum likelihood.</span>

<span class="sd">        The regularization method AND the solver used is determined by the</span>
<span class="sd">        argument method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        start_params : array_like, optional</span>
<span class="sd">            Initial guess of the solution for the loglikelihood maximization.</span>
<span class="sd">            The default is an array of zeros.</span>
<span class="sd">        method : &#39;l1&#39; or &#39;l1_cvxopt_cp&#39;</span>
<span class="sd">            See notes for details.</span>
<span class="sd">        maxiter : {int, &#39;defined_by_method&#39;}</span>
<span class="sd">            Maximum number of iterations to perform.</span>
<span class="sd">            If &#39;defined_by_method&#39;, then use method defaults (see notes).</span>
<span class="sd">        full_output : bool</span>
<span class="sd">            Set to True to have all available output in the Results object&#39;s</span>
<span class="sd">            mle_retvals attribute. The output is dependent on the solver.</span>
<span class="sd">            See LikelihoodModelResults notes section for more information.</span>
<span class="sd">        disp : bool</span>
<span class="sd">            Set to True to print convergence messages.</span>
<span class="sd">        fargs : tuple</span>
<span class="sd">            Extra arguments passed to the likelihood function, i.e.,</span>
<span class="sd">            loglike(x,*args).</span>
<span class="sd">        callback : callable callback(xk)</span>
<span class="sd">            Called after each iteration, as callback(xk), where xk is the</span>
<span class="sd">            current parameter vector.</span>
<span class="sd">        retall : bool</span>
<span class="sd">            Set to True to return list of solutions at each iteration.</span>
<span class="sd">            Available in Results object&#39;s mle_retvals attribute.</span>
<span class="sd">        alpha : non-negative scalar or numpy array (same size as parameters)</span>
<span class="sd">            The weight multiplying the l1 penalty term.</span>
<span class="sd">        trim_mode : &#39;auto, &#39;size&#39;, or &#39;off&#39;</span>
<span class="sd">            If not &#39;off&#39;, trim (set to zero) parameters that would have been</span>
<span class="sd">            zero if the solver reached the theoretical minimum.</span>
<span class="sd">            If &#39;auto&#39;, trim params using the Theory above.</span>
<span class="sd">            If &#39;size&#39;, trim params if they have very small absolute value.</span>
<span class="sd">        size_trim_tol : float or &#39;auto&#39; (default = &#39;auto&#39;)</span>
<span class="sd">            Tolerance used when trim_mode == &#39;size&#39;.</span>
<span class="sd">        auto_trim_tol : float</span>
<span class="sd">            Tolerance used when trim_mode == &#39;auto&#39;.</span>
<span class="sd">        qc_tol : float</span>
<span class="sd">            Print warning and do not allow auto trim when (ii) (above) is</span>
<span class="sd">            violated by this much.</span>
<span class="sd">        qc_verbose : bool</span>
<span class="sd">            If true, print out a full QC report upon failure.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Additional keyword arguments used when fitting the model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Results</span>
<span class="sd">            A results instance.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Using &#39;l1_cvxopt_cp&#39; requires the cvxopt module.</span>

<span class="sd">        Extra parameters are not penalized if alpha is given as a scalar.</span>
<span class="sd">        An example is the shape parameter in NegativeBinomial `nb1` and `nb2`.</span>

<span class="sd">        Optional arguments for the solvers (available in Results.mle_settings)::</span>

<span class="sd">            &#39;l1&#39;</span>
<span class="sd">                acc : float (default 1e-6)</span>
<span class="sd">                    Requested accuracy as used by slsqp</span>
<span class="sd">            &#39;l1_cvxopt_cp&#39;</span>
<span class="sd">                abstol : float</span>
<span class="sd">                    absolute accuracy (default: 1e-7).</span>
<span class="sd">                reltol : float</span>
<span class="sd">                    relative accuracy (default: 1e-6).</span>
<span class="sd">                feastol : float</span>
<span class="sd">                    tolerance for feasibility conditions (default: 1e-7).</span>
<span class="sd">                refinement : int</span>
<span class="sd">                    number of iterative refinement steps when solving KKT</span>
<span class="sd">                    equations (default: 1).</span>

<span class="sd">        Optimization methodology</span>

<span class="sd">        With :math:`L` the negative log likelihood, we solve the convex but</span>
<span class="sd">        non-smooth problem</span>

<span class="sd">        .. math:: \\min_\\beta L(\\beta) + \\sum_k\\alpha_k |\\beta_k|</span>

<span class="sd">        via the transformation to the smooth, convex, constrained problem</span>
<span class="sd">        in twice as many variables (adding the &quot;added variables&quot; :math:`u_k`)</span>

<span class="sd">        .. math:: \\min_{\\beta,u} L(\\beta) + \\sum_k\\alpha_k u_k,</span>

<span class="sd">        subject to</span>

<span class="sd">        .. math:: -u_k \\leq \\beta_k \\leq u_k.</span>

<span class="sd">        With :math:`\\partial_k L` the derivative of :math:`L` in the</span>
<span class="sd">        :math:`k^{th}` parameter direction, theory dictates that, at the</span>
<span class="sd">        minimum, exactly one of two conditions holds:</span>

<span class="sd">        (i) :math:`|\\partial_k L| = \\alpha_k`  and  :math:`\\beta_k \\neq 0`</span>
<span class="sd">        (ii) :math:`|\\partial_k L| \\leq \\alpha_k`  and  :math:`\\beta_k = 0`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_validate_l1_method</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
        <span class="c1"># Set attributes based on method</span>
        <span class="n">cov_params_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov_params_func_l1</span>

        <span class="c1">### Bundle up extra kwargs for the dictionary kwargs.  These are</span>
        <span class="c1">### passed through super(...).fit() as kwargs and unpacked at</span>
        <span class="c1">### appropriate times</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">alpha</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;alpha_rescaled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;trim_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trim_mode</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;size_trim_tol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">size_trim_tol</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;auto_trim_tol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">auto_trim_tol</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;qc_tol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qc_tol</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;qc_verbose&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qc_verbose</span>

        <span class="c1">### Define default keyword arguments to be passed to super(...).fit()</span>
        <span class="k">if</span> <span class="n">maxiter</span> <span class="o">==</span> <span class="s1">&#39;defined_by_method&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;l1&#39;</span><span class="p">:</span>
                <span class="n">maxiter</span> <span class="o">=</span> <span class="mi">1000</span>
            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;l1_cvxopt_cp&#39;</span><span class="p">:</span>
                <span class="n">maxiter</span> <span class="o">=</span> <span class="mi">70</span>

        <span class="c1">## Parameters to pass to super(...).fit()</span>
        <span class="c1"># For the &#39;extra&#39; parameters, pass all that are available,</span>
        <span class="c1"># even if we know (at this point) we will only use one.</span>
        <span class="n">extra_fit_funcs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;l1&#39;</span><span class="p">:</span> <span class="n">fit_l1_slsqp</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">have_cvxopt</span> <span class="ow">and</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;l1_cvxopt_cp&#39;</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">statsmodels.base.l1_cvxopt</span> <span class="kn">import</span> <span class="n">fit_l1_cvxopt_cp</span>
            <span class="n">extra_fit_funcs</span><span class="p">[</span><span class="s1">&#39;l1_cvxopt_cp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit_l1_cvxopt_cp</span>
        <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;l1_cvxopt_cp&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot use l1_cvxopt_cp as cvxopt &quot;</span>
                             <span class="s2">&quot;was not found (install it, or use method=&#39;l1&#39; instead)&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">callback</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_perfect_pred</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># make a function factory to have multiple call-backs</span>

        <span class="n">mlefit</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">start_params</span><span class="o">=</span><span class="n">start_params</span><span class="p">,</span>
                             <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                             <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
                             <span class="n">full_output</span><span class="o">=</span><span class="n">full_output</span><span class="p">,</span>
                             <span class="n">disp</span><span class="o">=</span><span class="n">disp</span><span class="p">,</span>
                             <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
                             <span class="n">extra_fit_funcs</span><span class="o">=</span><span class="n">extra_fit_funcs</span><span class="p">,</span>
                             <span class="n">cov_params_func</span><span class="o">=</span><span class="n">cov_params_func</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mlefit</span>  <span class="c1"># up to subclasses to wrap results</span></div>

<div class="viewcode-block" id="DiscreteModel.cov_params_func_l1"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.DiscreteModel.cov_params_func_l1.html#statsmodels.discrete.discrete_model.DiscreteModel.cov_params_func_l1">[docs]</a>    <span class="k">def</span> <span class="nf">cov_params_func_l1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">likelihood_model</span><span class="p">,</span> <span class="n">xopt</span><span class="p">,</span> <span class="n">retvals</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes cov_params on a reduced parameter space</span>
<span class="sd">        corresponding to the nonzero parameters resulting from the</span>
<span class="sd">        l1 regularized fit.</span>

<span class="sd">        Returns a full cov_params matrix, with entries corresponding</span>
<span class="sd">        to zero&#39;d values set to np.nan.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">likelihood_model</span><span class="o">.</span><span class="n">hessian</span><span class="p">(</span><span class="n">xopt</span><span class="p">)</span>
        <span class="n">trimmed</span> <span class="o">=</span> <span class="n">retvals</span><span class="p">[</span><span class="s1">&#39;trimmed&#39;</span><span class="p">]</span>
        <span class="n">nz_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="o">~</span><span class="n">trimmed</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nnz_params</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">trimmed</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">nnz_params</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">H_restricted</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="n">nz_idx</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">nz_idx</span><span class="p">]</span>
            <span class="c1"># Covariance estimate for the nonzero params</span>
            <span class="n">H_restricted_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="o">-</span><span class="n">H_restricted</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">H_restricted_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">cov_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">H</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">cov_params</span><span class="p">[</span><span class="n">nz_idx</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">nz_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">H_restricted_inv</span>

        <span class="k">return</span> <span class="n">cov_params</span></div>

<div class="viewcode-block" id="DiscreteModel.predict"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.DiscreteModel.predict.html#statsmodels.discrete.discrete_model.DiscreteModel.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">linear</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Predict response variable of a model given exogenous variables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

    <span class="k">def</span> <span class="nf">_derivative_exog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dummy_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">count_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This should implement the derivative of the non-linear function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">_derivative_exog_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">margeff</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">dummy_idx</span><span class="p">,</span>
                                <span class="n">count_idx</span><span class="p">,</span> <span class="n">transform</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper for _derivative_exog to wrap results appropriately</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.discrete_margins</span> <span class="kn">import</span> <span class="n">_get_count_effects</span><span class="p">,</span> <span class="n">_get_dummy_effects</span>

        <span class="k">if</span> <span class="n">count_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">margeff</span> <span class="o">=</span> <span class="n">_get_count_effects</span><span class="p">(</span><span class="n">margeff</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">count_idx</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dummy_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">margeff</span> <span class="o">=</span> <span class="n">_get_dummy_effects</span><span class="p">(</span><span class="n">margeff</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">dummy_idx</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">margeff</span></div>


<div class="viewcode-block" id="BinaryModel"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.BinaryModel.html#statsmodels.discrete.discrete_model.BinaryModel">[docs]</a><span class="k">class</span> <span class="nc">BinaryModel</span><span class="p">(</span><span class="n">DiscreteModel</span><span class="p">):</span>
    <span class="n">_continuous_ok</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">check_rank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># unconditional check, requires no extra kwargs added by subclasses</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">check_rank</span><span class="o">=</span><span class="n">check_rank</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">MultinomialModel</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;endog must be in the unit interval.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;offset&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_continuous_ok</span> <span class="ow">and</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">))):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;endog must be binary, either 0 or 1&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="BinaryModel.predict"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.BinaryModel.predict.html#statsmodels.discrete.discrete_model.BinaryModel.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">linear</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Predict response variable of a model given exogenous variables.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            Fitted parameters of the model.</span>
<span class="sd">        exog : array_like</span>
<span class="sd">            1d or 2d array of exogenous values.  If not supplied, the</span>
<span class="sd">            whole exog attribute of the model is used.</span>
<span class="sd">        which : {&#39;mean&#39;, &#39;linear&#39;, &#39;var&#39;, &#39;prob&#39;}, optional</span>
<span class="sd">            Statistic to predict. Default is &#39;mean&#39;.</span>

<span class="sd">            - &#39;mean&#39; returns the conditional expectation of endog E(y | x),</span>
<span class="sd">              i.e. exp of linear predictor.</span>
<span class="sd">            - &#39;linear&#39; returns the linear predictor of the mean function.</span>
<span class="sd">            - &#39;var&#39; returns the estimated variance of endog implied by the</span>
<span class="sd">              model.</span>

<span class="sd">            .. versionadded: 0.14</span>

<span class="sd">               ``which`` replaces and extends the deprecated ``linear``</span>
<span class="sd">               argument.</span>

<span class="sd">        linear : bool</span>
<span class="sd">            If True, returns the linear predicted values.  If False or None,</span>
<span class="sd">            then the statistic specified by ``which`` will be returned.</span>

<span class="sd">            .. deprecated: 0.14</span>

<span class="sd">               The ``linear` keyword is deprecated and will be removed,</span>
<span class="sd">               use ``which`` keyword instead.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        array</span>
<span class="sd">            Fitted values at exog.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">linear</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;linear keyword is deprecated, use which=&quot;linear&quot;&#39;</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">FutureWarning</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">linear</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">which</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span>

        <span class="c1"># Use fit offset if appropriate</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">exog</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;offset&#39;</span><span class="p">):</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>
        <span class="k">elif</span> <span class="n">offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>

        <span class="n">linpred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span>

        <span class="k">if</span> <span class="n">which</span> <span class="o">==</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">linpred</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">which</span> <span class="o">==</span> <span class="s2">&quot;linear&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">linpred</span>
        <span class="k">if</span> <span class="n">which</span> <span class="o">==</span> <span class="s2">&quot;var&quot;</span><span class="p">:</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">linpred</span><span class="p">)</span>
            <span class="n">var_</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">var_</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Only `which` is &quot;mean&quot;, &quot;linear&quot; or &quot;var&quot; are&#39;</span>
                             <span class="s1">&#39; available.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="BinaryModel.fit_regularized"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.BinaryModel.fit_regularized.html#statsmodels.discrete.discrete_model.BinaryModel.fit_regularized">[docs]</a>    <span class="nd">@Appender</span><span class="p">(</span><span class="n">DiscreteModel</span><span class="o">.</span><span class="n">fit_regularized</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit_regularized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span>
            <span class="n">maxiter</span><span class="o">=</span><span class="s1">&#39;defined_by_method&#39;</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">trim_mode</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">auto_trim_tol</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">size_trim_tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
            <span class="n">qc_tol</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">_validate_l1_method</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>

        <span class="n">bnryfit</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit_regularized</span><span class="p">(</span><span class="n">start_params</span><span class="o">=</span><span class="n">start_params</span><span class="p">,</span>
                                          <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                                          <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
                                          <span class="n">full_output</span><span class="o">=</span><span class="n">full_output</span><span class="p">,</span>
                                          <span class="n">disp</span><span class="o">=</span><span class="n">disp</span><span class="p">,</span>
                                          <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
                                          <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                                          <span class="n">trim_mode</span><span class="o">=</span><span class="n">trim_mode</span><span class="p">,</span>
                                          <span class="n">auto_trim_tol</span><span class="o">=</span><span class="n">auto_trim_tol</span><span class="p">,</span>
                                          <span class="n">size_trim_tol</span><span class="o">=</span><span class="n">size_trim_tol</span><span class="p">,</span>
                                          <span class="n">qc_tol</span><span class="o">=</span><span class="n">qc_tol</span><span class="p">,</span>
                                          <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">discretefit</span> <span class="o">=</span> <span class="n">L1BinaryResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bnryfit</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">L1BinaryResultsWrapper</span><span class="p">(</span><span class="n">discretefit</span><span class="p">)</span></div>

<div class="viewcode-block" id="BinaryModel.fit_constrained"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.BinaryModel.fit_constrained.html#statsmodels.discrete.discrete_model.BinaryModel.fit_constrained">[docs]</a>    <span class="k">def</span> <span class="nf">fit_constrained</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraints</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_kwds</span><span class="p">):</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">fit_constrained_wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraints</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="o">**</span><span class="n">fit_kwds</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>

    <span class="n">fit_constrained</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">fit_constrained_wrap</span><span class="o">.</span><span class="vm">__doc__</span>

    <span class="k">def</span> <span class="nf">_derivative_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="s1">&#39;dydx&#39;</span><span class="p">,</span>
                            <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For computing marginal effects standard errors.</span>

<span class="sd">        This is used only in the case of discrete and count regressors to</span>
<span class="sd">        get the variance-covariance of the marginal effects. It returns</span>
<span class="sd">        [d F / d params] where F is the predict.</span>

<span class="sd">        Transform can be &#39;dydx&#39; or &#39;eydx&#39;. Checking is done in margeff</span>
<span class="sd">        computations for appropriate transform.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">linpred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
        <span class="n">dF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">linpred</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">exog</span>
        <span class="k">if</span> <span class="s1">&#39;ey&#39;</span> <span class="ow">in</span> <span class="n">transform</span><span class="p">:</span>
            <span class="n">dF</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">dF</span>

    <span class="k">def</span> <span class="nf">_derivative_exog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="s1">&#39;dydx&#39;</span><span class="p">,</span>
                         <span class="n">dummy_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">count_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For computing marginal effects returns dF(XB) / dX where F(.) is</span>
<span class="sd">        the predicted probabilities</span>

<span class="sd">        transform can be &#39;dydx&#39;, &#39;dyex&#39;, &#39;eydx&#39;, or &#39;eyex&#39;.</span>

<span class="sd">        Not all of these make sense in the presence of discrete regressors,</span>
<span class="sd">        but checks are done in the results in get_margeff.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Note: this form should be appropriate for</span>
        <span class="c1">#   group 1 probit, logit, logistic, cloglog, heckprob, xtprobit</span>
        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>

        <span class="n">linpred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
        <span class="n">margeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">linpred</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">],</span>
                         <span class="n">params</span><span class="p">[</span><span class="kc">None</span><span class="p">,:])</span>

        <span class="k">if</span> <span class="s1">&#39;ex&#39;</span> <span class="ow">in</span> <span class="n">transform</span><span class="p">:</span>
            <span class="n">margeff</span> <span class="o">*=</span> <span class="n">exog</span>
        <span class="k">if</span> <span class="s1">&#39;ey&#39;</span> <span class="ow">in</span> <span class="n">transform</span><span class="p">:</span>
            <span class="n">margeff</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_derivative_exog_helper</span><span class="p">(</span><span class="n">margeff</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span>
                                            <span class="n">dummy_idx</span><span class="p">,</span> <span class="n">count_idx</span><span class="p">,</span> <span class="n">transform</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_deriv_mean_dparams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Derivative of the expected endog with respect to the parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : ndarray</span>
<span class="sd">            parameter at which score is evaluated</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        The value of the derivative of the expected endog with respect</span>
<span class="sd">        to the parameter vector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">link</span>
        <span class="n">lin_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
        <span class="n">idl</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">inverse_deriv</span><span class="p">(</span><span class="n">lin_pred</span><span class="p">)</span>
        <span class="n">dmat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span> <span class="o">*</span> <span class="n">idl</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">dmat</span>

<div class="viewcode-block" id="BinaryModel.get_distribution"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.BinaryModel.get_distribution.html#statsmodels.discrete.discrete_model.BinaryModel.get_distribution">[docs]</a>    <span class="k">def</span> <span class="nf">get_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get frozen instance of distribution based on predicted parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model.</span>
<span class="sd">        exog : ndarray, optional</span>
<span class="sd">            Explanatory variables for the main count model.</span>
<span class="sd">            If ``exog`` is None, then the data from the model will be used.</span>
<span class="sd">        offset : ndarray, optional</span>
<span class="sd">            Offset is added to the linear predictor of the mean function with</span>
<span class="sd">            coefficient equal to 1.</span>
<span class="sd">            Default is zero if exog is not None, and the model offset if exog</span>
<span class="sd">            is None.</span>
<span class="sd">        exposure : ndarray, optional</span>
<span class="sd">            Log(exposure) is added to the linear predictor  of the mean</span>
<span class="sd">            function with coefficient equal to 1. If exposure is specified,</span>
<span class="sd">            then it will be logged by the method. The user does not need to</span>
<span class="sd">            log it first.</span>
<span class="sd">            Default is one if exog is is not None, and it is the model exposure</span>
<span class="sd">            if exog is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Instance of frozen scipy distribution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
        <span class="c1"># distr = stats.bernoulli(mu[:, None])</span>
        <span class="n">distr</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">bernoulli</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">distr</span></div></div>


<div class="viewcode-block" id="MultinomialModel"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.MultinomialModel.html#statsmodels.discrete.discrete_model.MultinomialModel">[docs]</a><span class="k">class</span> <span class="nc">MultinomialModel</span><span class="p">(</span><span class="n">BinaryModel</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_handle_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">missing</span><span class="p">,</span> <span class="n">hasconst</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data_tools</span><span class="o">.</span><span class="n">_is_using_ndarray_type</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">endog_dummies</span><span class="p">,</span> <span class="n">ynames</span> <span class="o">=</span> <span class="n">_numpy_to_dummies</span><span class="p">(</span><span class="n">endog</span><span class="p">)</span>
            <span class="n">yname</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>
        <span class="k">elif</span> <span class="n">data_tools</span><span class="o">.</span><span class="n">_is_using_pandas</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">endog_dummies</span><span class="p">,</span> <span class="n">ynames</span><span class="p">,</span> <span class="n">yname</span> <span class="o">=</span> <span class="n">_pandas_to_dummies</span><span class="p">(</span><span class="n">endog</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">endog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">endog</span><span class="p">)</span>
            <span class="n">endog_dummies</span><span class="p">,</span> <span class="n">ynames</span> <span class="o">=</span> <span class="n">_numpy_to_dummies</span><span class="p">(</span><span class="n">endog</span><span class="p">)</span>
            <span class="n">yname</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ynames</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">ynames</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">endog_dummies</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">ynames</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ynames_map</span> <span class="o">=</span> <span class="n">ynames</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">handle_data</span><span class="p">(</span><span class="n">endog_dummies</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">missing</span><span class="p">,</span> <span class="n">hasconst</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">ynames</span> <span class="o">=</span> <span class="n">yname</span>  <span class="c1"># overwrite this to single endog name</span>
        <span class="n">data</span><span class="o">.</span><span class="n">orig_endog</span> <span class="o">=</span> <span class="n">endog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wendog</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">endog</span>

        <span class="c1"># repeating from upstream...</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;design_info&#39;</span><span class="p">,</span> <span class="s1">&#39;formula&#39;</span><span class="p">]:</span>  <span class="c1"># leave attached to data</span>
                <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">data</span>

<div class="viewcode-block" id="MultinomialModel.initialize"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.MultinomialModel.initialize.html#statsmodels.discrete.discrete_model.MultinomialModel.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Preprocesses the data for MNLogit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
        <span class="c1"># This is also a &quot;whiten&quot; method in other models (eg regression)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># turn it into an array of col idx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">J</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wendog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_model</span> <span class="o">*=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># for each J - 1 equation.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_resid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_model</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultinomialModel.predict"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.MultinomialModel.predict.html#statsmodels.discrete.discrete_model.MultinomialModel.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">linear</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Predict response variable of a model given exogenous variables.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            2d array of fitted parameters of the model. Should be in the</span>
<span class="sd">            order returned from the model.</span>
<span class="sd">        exog : array_like</span>
<span class="sd">            1d or 2d array of exogenous values.  If not supplied, the</span>
<span class="sd">            whole exog attribute of the model is used. If a 1d array is given</span>
<span class="sd">            it assumed to be 1 row of exogenous variables. If you only have</span>
<span class="sd">            one regressor and would like to do prediction, you must provide</span>
<span class="sd">            a 2d array with shape[1] == 1.</span>
<span class="sd">        which : {&#39;mean&#39;, &#39;linear&#39;, &#39;var&#39;, &#39;prob&#39;}, optional</span>
<span class="sd">            Statistic to predict. Default is &#39;mean&#39;.</span>

<span class="sd">            - &#39;mean&#39; returns the conditional expectation of endog E(y | x),</span>
<span class="sd">              i.e. exp of linear predictor.</span>
<span class="sd">            - &#39;linear&#39; returns the linear predictor of the mean function.</span>
<span class="sd">            - &#39;var&#39; returns the estimated variance of endog implied by the</span>
<span class="sd">              model.</span>

<span class="sd">            .. versionadded: 0.14</span>

<span class="sd">               ``which`` replaces and extends the deprecated ``linear``</span>
<span class="sd">               argument.</span>

<span class="sd">        linear : bool</span>
<span class="sd">            If True, returns the linear predicted values.  If False or None,</span>
<span class="sd">            then the statistic specified by ``which`` will be returned.</span>

<span class="sd">            .. deprecated: 0.14</span>

<span class="sd">               The ``linear` keyword is deprecated and will be removed,</span>
<span class="sd">               use ``which`` keyword instead.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Column 0 is the base case, the rest conform to the rows of params</span>
<span class="sd">        shifted up one for the base case.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">linear</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;linear keyword is deprecated, use which=&quot;linear&quot;&#39;</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">FutureWarning</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">linear</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">which</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span>

        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># do here to accommodate user-given exog</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="k">if</span> <span class="n">exog</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="n">exog</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>

        <span class="n">pred</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="n">which</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">which</span> <span class="o">==</span> <span class="s2">&quot;linear&quot;</span><span class="p">:</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exog</span><span class="p">)),</span> <span class="n">pred</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pred</span></div>

<div class="viewcode-block" id="MultinomialModel.fit"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.MultinomialModel.fit.html#statsmodels.discrete.discrete_model.MultinomialModel.fit">[docs]</a>    <span class="nd">@Appender</span><span class="p">(</span><span class="n">DiscreteModel</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;newton&#39;</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span>
            <span class="n">full_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">start_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">start_params</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">callback</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># placeholder until check_perfect_pred</span>
            <span class="n">callback</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span> <span class="p">:</span> <span class="kc">None</span>
        <span class="c1"># skip calling super to handle results from LikelihoodModel</span>
        <span class="n">mnfit</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">LikelihoodModel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_params</span> <span class="o">=</span> <span class="n">start_params</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="n">full_output</span><span class="p">,</span>
                <span class="n">disp</span><span class="o">=</span><span class="n">disp</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">mnfit</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">mnfit</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
        <span class="n">mnfit</span> <span class="o">=</span> <span class="n">MultinomialResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mnfit</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">MultinomialResultsWrapper</span><span class="p">(</span><span class="n">mnfit</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultinomialModel.fit_regularized"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.MultinomialModel.fit_regularized.html#statsmodels.discrete.discrete_model.MultinomialModel.fit_regularized">[docs]</a>    <span class="nd">@Appender</span><span class="p">(</span><span class="n">DiscreteModel</span><span class="o">.</span><span class="n">fit_regularized</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit_regularized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span>
            <span class="n">maxiter</span><span class="o">=</span><span class="s1">&#39;defined_by_method&#39;</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">trim_mode</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">auto_trim_tol</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">size_trim_tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
            <span class="n">qc_tol</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">start_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">start_params</span><span class="p">)</span>
        <span class="n">mnfit</span> <span class="o">=</span> <span class="n">DiscreteModel</span><span class="o">.</span><span class="n">fit_regularized</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="n">start_params</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
                <span class="n">full_output</span><span class="o">=</span><span class="n">full_output</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="n">disp</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">trim_mode</span><span class="o">=</span><span class="n">trim_mode</span><span class="p">,</span> <span class="n">auto_trim_tol</span><span class="o">=</span><span class="n">auto_trim_tol</span><span class="p">,</span>
                <span class="n">size_trim_tol</span><span class="o">=</span><span class="n">size_trim_tol</span><span class="p">,</span> <span class="n">qc_tol</span><span class="o">=</span><span class="n">qc_tol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">mnfit</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">mnfit</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
        <span class="n">mnfit</span> <span class="o">=</span> <span class="n">L1MultinomialResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mnfit</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">L1MultinomialResultsWrapper</span><span class="p">(</span><span class="n">mnfit</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_derivative_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="s1">&#39;dydx&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For computing marginal effects standard errors.</span>

<span class="sd">        This is used only in the case of discrete and count regressors to</span>
<span class="sd">        get the variance-covariance of the marginal effects. It returns</span>
<span class="sd">        [d F / d params] where F is the predicted probabilities for each</span>
<span class="sd">        choice. dFdparams is of shape nobs x (J*K) x (J-1)*K.</span>
<span class="sd">        The zero derivatives for the base category are not included.</span>

<span class="sd">        Transform can be &#39;dydx&#39; or &#39;eydx&#39;. Checking is done in margeff</span>
<span class="sd">        computations for appropriate transform.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># will get flatted from approx_fprime</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>

        <span class="n">eXB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
        <span class="n">sum_eXB</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">eXB</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">))[:,</span><span class="kc">None</span><span class="p">]</span>
        <span class="n">J</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">J</span><span class="p">)</span>
        <span class="n">K</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">)</span>
        <span class="n">repeat_eXB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">eXB</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># this is the derivative wrt the base level</span>
        <span class="n">F0</span> <span class="o">=</span> <span class="o">-</span><span class="n">repeat_eXB</span> <span class="o">*</span> <span class="n">X</span> <span class="o">/</span> <span class="n">sum_eXB</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="c1"># this is the derivative wrt the other levels when</span>
        <span class="c1"># dF_j / dParams_j (ie., own equation)</span>
        <span class="c1">#NOTE: this computes too much, any easy way to cut down?</span>
        <span class="n">F1</span> <span class="o">=</span> <span class="n">eXB</span><span class="o">.</span><span class="n">T</span><span class="p">[:,:,</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">X</span> <span class="o">*</span> <span class="p">(</span><span class="n">sum_eXB</span> <span class="o">-</span> <span class="n">repeat_eXB</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sum_eXB</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">F1</span> <span class="o">=</span> <span class="n">F1</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># put the nobs index first</span>

        <span class="c1"># other equation index</span>
        <span class="n">other_idx</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">K</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">F1</span><span class="p">[:,</span> <span class="n">other_idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">eXB</span><span class="o">.</span><span class="n">T</span><span class="p">[:,:,</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">repeat_eXB</span> <span class="o">/</span> \
                           <span class="p">(</span><span class="n">sum_eXB</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))[:,</span> <span class="n">other_idx</span><span class="p">]</span>
        <span class="n">dFdX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">F0</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,:],</span> <span class="n">F1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;ey&#39;</span> <span class="ow">in</span> <span class="n">transform</span><span class="p">:</span>
            <span class="n">dFdX</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="p">)[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">dFdX</span>

    <span class="k">def</span> <span class="nf">_derivative_exog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="s1">&#39;dydx&#39;</span><span class="p">,</span>
                         <span class="n">dummy_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">count_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For computing marginal effects returns dF(XB) / dX where F(.) is</span>
<span class="sd">        the predicted probabilities</span>

<span class="sd">        transform can be &#39;dydx&#39;, &#39;dyex&#39;, &#39;eydx&#39;, or &#39;eyex&#39;.</span>

<span class="sd">        Not all of these make sense in the presence of discrete regressors,</span>
<span class="sd">        but checks are done in the results in get_margeff.</span>

<span class="sd">        For Multinomial models the marginal effects are</span>

<span class="sd">        P[j] * (params[j] - sum_k P[k]*params[k])</span>

<span class="sd">        It is returned unshaped, so that each row contains each of the J</span>
<span class="sd">        equations. This makes it easier to take derivatives of this for</span>
<span class="sd">        standard errors. If you want average marginal effects you can do</span>
<span class="sd">        margeff.reshape(nobs, K, J, order=&#39;F).mean(0) and the marginal effects</span>
<span class="sd">        for choice J are in column J</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">J</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">J</span><span class="p">)</span>  <span class="c1"># number of alternative choices</span>
        <span class="n">K</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">)</span>  <span class="c1"># number of variables</span>
        <span class="c1"># Note: this form should be appropriate for</span>
        <span class="c1">#   group 1 probit, logit, logistic, cloglog, heckprob, xtprobit</span>
        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># will get flatted from approx_fprime</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>

        <span class="n">zeroparams</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">K</span><span class="p">),</span> <span class="n">params</span><span class="p">]</span>  <span class="c1"># add base in</span>

        <span class="n">cdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>

        <span class="c1"># TODO: meaningful interpretation for `iterm`?</span>
        <span class="n">iterm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cdf</span><span class="p">[:,</span> <span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="n">zeroparams</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
                          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">J</span><span class="p">))])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">margeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cdf</span><span class="p">[:,</span> <span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="n">zeroparams</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">iterm</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="p">)])</span>

        <span class="c1"># swap the axes to make sure margeff are in order nobs, K, J</span>
        <span class="n">margeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">margeff</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="k">if</span> <span class="s1">&#39;ex&#39;</span> <span class="ow">in</span> <span class="n">transform</span><span class="p">:</span>
            <span class="n">margeff</span> <span class="o">*=</span> <span class="n">exog</span>
        <span class="k">if</span> <span class="s1">&#39;ey&#39;</span> <span class="ow">in</span> <span class="n">transform</span><span class="p">:</span>
            <span class="n">margeff</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">,:]</span>

        <span class="n">margeff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_derivative_exog_helper</span><span class="p">(</span><span class="n">margeff</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span>
                                               <span class="n">dummy_idx</span><span class="p">,</span> <span class="n">count_idx</span><span class="p">,</span> <span class="n">transform</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">margeff</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exog</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="MultinomialModel.get_distribution"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.MultinomialModel.get_distribution.html#statsmodels.discrete.discrete_model.MultinomialModel.get_distribution">[docs]</a>    <span class="k">def</span> <span class="nf">get_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;get frozen instance of distribution</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div></div>


<div class="viewcode-block" id="CountModel"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.CountModel.html#statsmodels.discrete.discrete_model.CountModel">[docs]</a><span class="k">class</span> <span class="nc">CountModel</span><span class="p">(</span><span class="n">DiscreteModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exposure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                 <span class="n">check_rank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">check_rank</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="n">missing</span><span class="p">,</span>
                         <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">exposure</span><span class="o">=</span><span class="n">exposure</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exposure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exposure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exposure</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exposure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exposure</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_inputs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exposure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;offset&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exposure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;exposure&#39;</span><span class="p">)</span>

        <span class="c1"># promote dtype to float64 if needed</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">promote_types</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">promote_types</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_check_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">exposure</span><span class="p">,</span> <span class="n">endog</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">offset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">endog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;offset is not the same length as endog&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">exposure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">exposure</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">endog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;exposure is not the same length as endog&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_init_kwds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># this is a temporary fixup because exposure has been transformed</span>
        <span class="c1"># see #1609</span>
        <span class="n">kwds</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_get_init_kwds</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;exposure&#39;</span> <span class="ow">in</span> <span class="n">kwds</span> <span class="ow">and</span> <span class="n">kwds</span><span class="p">[</span><span class="s1">&#39;exposure&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwds</span><span class="p">[</span><span class="s1">&#39;exposure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">kwds</span><span class="p">[</span><span class="s1">&#39;exposure&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">kwds</span>

    <span class="k">def</span> <span class="nf">_get_predict_arrays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exposure</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="c1"># convert extras if not None</span>
        <span class="k">if</span> <span class="n">exposure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exposure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">exposure</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>

        <span class="c1"># get defaults</span>
        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># prediction is in-sample</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
            <span class="k">if</span> <span class="n">exposure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">exposure</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;exposure&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;offset&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># user specified</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">exog</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">exposure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">exposure</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">exposure</span>

<div class="viewcode-block" id="CountModel.predict"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.CountModel.predict.html#statsmodels.discrete.discrete_model.CountModel.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exposure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">which</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">linear</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Predict response variable of a count model given exogenous variables</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            Model parameters</span>
<span class="sd">        exog : array_like, optional</span>
<span class="sd">            Design / exogenous data. Is exog is None, model exog is used.</span>
<span class="sd">        exposure : array_like, optional</span>
<span class="sd">            Log(exposure) is added to the linear prediction with</span>
<span class="sd">            coefficient equal to 1. If exposure is not provided and exog</span>
<span class="sd">            is None, uses the model&#39;s exposure if present.  If not, uses</span>
<span class="sd">            0 as the default value.</span>
<span class="sd">        offset : array_like, optional</span>
<span class="sd">            Offset is added to the linear prediction with coefficient</span>
<span class="sd">            equal to 1. If offset is not provided and exog</span>
<span class="sd">            is None, uses the model&#39;s offset if present.  If not, uses</span>
<span class="sd">            0 as the default value.</span>
<span class="sd">        which : &#39;mean&#39;, &#39;linear&#39;, &#39;var&#39;, &#39;prob&#39; (optional)</span>
<span class="sd">            Statitistic to predict. Default is &#39;mean&#39;.</span>

<span class="sd">            - &#39;mean&#39; returns the conditional expectation of endog E(y | x),</span>
<span class="sd">              i.e. exp of linear predictor.</span>
<span class="sd">            - &#39;linear&#39; returns the linear predictor of the mean function.</span>
<span class="sd">            - &#39;var&#39; variance of endog implied by the likelihood model</span>
<span class="sd">            - &#39;prob&#39; predicted probabilities for counts.</span>

<span class="sd">            .. versionadded: 0.14</span>

<span class="sd">               ``which`` replaces and extends the deprecated ``linear``</span>
<span class="sd">               argument.</span>

<span class="sd">        linear : bool</span>
<span class="sd">            If True, returns the linear predicted values.  If False or None,</span>
<span class="sd">            then the statistic specified by ``which`` will be returned.</span>

<span class="sd">            .. deprecated: 0.14</span>

<span class="sd">               The ``linear` keyword is deprecated and will be removed,</span>
<span class="sd">               use ``which`` keyword instead.</span>


<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If exposure is specified, then it will be logged by the method.</span>
<span class="sd">        The user does not need to log it first.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">linear</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;linear keyword is deprecated, use which=&quot;linear&quot;&#39;</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">FutureWarning</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">linear</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">which</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span>

        <span class="c1"># the following is copied from GLM predict (without family/link check)</span>
        <span class="c1"># Use fit offset if appropriate</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">exog</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;offset&#39;</span><span class="p">):</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>
        <span class="k">elif</span> <span class="n">offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="c1"># Use fit exposure if appropriate</span>
        <span class="k">if</span> <span class="n">exposure</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">exog</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;exposure&#39;</span><span class="p">):</span>
            <span class="c1"># Already logged</span>
            <span class="n">exposure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exposure</span>
        <span class="k">elif</span> <span class="n">exposure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exposure</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exposure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">exposure</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>

        <span class="n">fitted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="n">params</span><span class="p">[:</span><span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">linpred</span> <span class="o">=</span> <span class="n">fitted</span> <span class="o">+</span> <span class="n">exposure</span> <span class="o">+</span> <span class="n">offset</span>
        <span class="k">if</span> <span class="n">which</span> <span class="o">==</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">linpred</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">which</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;lin&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">linpred</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;keyword which has to be &quot;mean&quot; and &quot;linear&quot;&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_derivative_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="s1">&#39;dydx&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For computing marginal effects standard errors.</span>

<span class="sd">        This is used only in the case of discrete and count regressors to</span>
<span class="sd">        get the variance-covariance of the marginal effects. It returns</span>
<span class="sd">        [d F / d params] where F is the predict.</span>

<span class="sd">        Transform can be &#39;dydx&#39; or &#39;eydx&#39;. Checking is done in margeff</span>
<span class="sd">        computations for appropriate transform.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="c1">#NOTE: this handles offset and exposure</span>
        <span class="n">dF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">exog</span>
        <span class="k">if</span> <span class="s1">&#39;ey&#39;</span> <span class="ow">in</span> <span class="n">transform</span><span class="p">:</span>
            <span class="n">dF</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">dF</span>

    <span class="k">def</span> <span class="nf">_derivative_exog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="s2">&quot;dydx&quot;</span><span class="p">,</span>
                         <span class="n">dummy_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">count_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For computing marginal effects. These are the marginal effects</span>
<span class="sd">        d F(XB) / dX</span>
<span class="sd">        For the Poisson model F(XB) is the predicted counts rather than</span>
<span class="sd">        the probabilities.</span>

<span class="sd">        transform can be &#39;dydx&#39;, &#39;dyex&#39;, &#39;eydx&#39;, or &#39;eyex&#39;.</span>

<span class="sd">        Not all of these make sense in the presence of discrete regressors,</span>
<span class="sd">        but checks are done in the results in get_margeff.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># group 3 poisson, nbreg, zip, zinb</span>
        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">k_extra</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;k_extra&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">params_exog</span> <span class="o">=</span> <span class="n">params</span> <span class="k">if</span> <span class="n">k_extra</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">params</span><span class="p">[:</span><span class="o">-</span><span class="n">k_extra</span><span class="p">]</span>
        <span class="n">margeff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">params_exog</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span>
        <span class="k">if</span> <span class="s1">&#39;ex&#39;</span> <span class="ow">in</span> <span class="n">transform</span><span class="p">:</span>
            <span class="n">margeff</span> <span class="o">*=</span> <span class="n">exog</span>
        <span class="k">if</span> <span class="s1">&#39;ey&#39;</span> <span class="ow">in</span> <span class="n">transform</span><span class="p">:</span>
            <span class="n">margeff</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_derivative_exog_helper</span><span class="p">(</span><span class="n">margeff</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span>
                                            <span class="n">dummy_idx</span><span class="p">,</span> <span class="n">count_idx</span><span class="p">,</span> <span class="n">transform</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_deriv_mean_dparams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Derivative of the expected endog with respect to the parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : ndarray</span>
<span class="sd">            parameter at which score is evaluated</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        The value of the derivative of the expected endog with respect</span>
<span class="sd">        to the parameter vector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">statsmodels.genmod.families</span> <span class="kn">import</span> <span class="n">links</span>
        <span class="n">link</span> <span class="o">=</span> <span class="n">links</span><span class="o">.</span><span class="n">Log</span><span class="p">()</span>
        <span class="n">lin_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
        <span class="n">idl</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">inverse_deriv</span><span class="p">(</span><span class="n">lin_pred</span><span class="p">)</span>
        <span class="n">dmat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span> <span class="o">*</span> <span class="n">idl</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_extra</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dmat_extra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dmat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_extra</span><span class="p">))</span>
            <span class="n">dmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">dmat</span><span class="p">,</span> <span class="n">dmat_extra</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">dmat</span>


<div class="viewcode-block" id="CountModel.fit"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.CountModel.fit.html#statsmodels.discrete.discrete_model.CountModel.fit">[docs]</a>    <span class="nd">@Appender</span><span class="p">(</span><span class="n">DiscreteModel</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;newton&#39;</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span>
            <span class="n">full_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">cntfit</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">start_params</span><span class="o">=</span><span class="n">start_params</span><span class="p">,</span>
                             <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                             <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
                             <span class="n">full_output</span><span class="o">=</span><span class="n">full_output</span><span class="p">,</span>
                             <span class="n">disp</span><span class="o">=</span><span class="n">disp</span><span class="p">,</span>
                             <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">discretefit</span> <span class="o">=</span> <span class="n">CountResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cntfit</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">CountResultsWrapper</span><span class="p">(</span><span class="n">discretefit</span><span class="p">)</span></div>

<div class="viewcode-block" id="CountModel.fit_regularized"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.CountModel.fit_regularized.html#statsmodels.discrete.discrete_model.CountModel.fit_regularized">[docs]</a>    <span class="nd">@Appender</span><span class="p">(</span><span class="n">DiscreteModel</span><span class="o">.</span><span class="n">fit_regularized</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit_regularized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span>
            <span class="n">maxiter</span><span class="o">=</span><span class="s1">&#39;defined_by_method&#39;</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">trim_mode</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">auto_trim_tol</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">size_trim_tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
            <span class="n">qc_tol</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">_validate_l1_method</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>

        <span class="n">cntfit</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit_regularized</span><span class="p">(</span><span class="n">start_params</span><span class="o">=</span><span class="n">start_params</span><span class="p">,</span>
                                         <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                                         <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
                                         <span class="n">full_output</span><span class="o">=</span><span class="n">full_output</span><span class="p">,</span>
                                         <span class="n">disp</span><span class="o">=</span><span class="n">disp</span><span class="p">,</span>
                                         <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
                                         <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                                         <span class="n">trim_mode</span><span class="o">=</span><span class="n">trim_mode</span><span class="p">,</span> <span class="n">auto_trim_tol</span><span class="o">=</span><span class="n">auto_trim_tol</span><span class="p">,</span>
                                         <span class="n">size_trim_tol</span><span class="o">=</span><span class="n">size_trim_tol</span><span class="p">,</span>
                                         <span class="n">qc_tol</span><span class="o">=</span><span class="n">qc_tol</span><span class="p">,</span>
                                         <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">discretefit</span> <span class="o">=</span> <span class="n">L1CountResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cntfit</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">L1CountResultsWrapper</span><span class="p">(</span><span class="n">discretefit</span><span class="p">)</span></div></div>


<span class="c1"># Public Model Classes</span>


<div class="viewcode-block" id="Poisson"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Poisson.html#statsmodels.discrete.discrete_model.Poisson">[docs]</a><span class="k">class</span> <span class="nc">Poisson</span><span class="p">(</span><span class="n">CountModel</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Poisson Model</span>

<span class="s2">    </span><span class="si">%(params)s</span>
<span class="s2">    </span><span class="si">%(extra_params)s</span>

<span class="s2">    Attributes</span>
<span class="s2">    ----------</span>
<span class="s2">    endog : ndarray</span>
<span class="s2">        A reference to the endogenous response variable</span>
<span class="s2">    exog : ndarray</span>
<span class="s2">        A reference to the exogenous design.</span>
<span class="s2">    &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="n">base</span><span class="o">.</span><span class="n">_model_params_doc</span><span class="p">,</span>
           <span class="s1">&#39;extra_params&#39;</span><span class="p">:</span>
<span class="w">           </span><span class="sd">&quot;&quot;&quot;offset : array_like</span>
<span class="sd">        Offset is added to the linear prediction with coefficient equal to 1.</span>
<span class="sd">    exposure : array_like</span>
<span class="sd">        Log(exposure) is added to the linear prediction with coefficient</span>
<span class="sd">        equal to 1.</span>
<span class="sd">        &quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">base</span><span class="o">.</span><span class="n">_missing_param_doc</span> <span class="o">+</span> <span class="n">_check_rank_doc</span><span class="p">}</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">family</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">statsmodels.genmod</span> <span class="kn">import</span> <span class="n">families</span>
        <span class="k">return</span> <span class="n">families</span><span class="o">.</span><span class="n">Poisson</span><span class="p">()</span>

<div class="viewcode-block" id="Poisson.cdf"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Poisson.cdf.html#statsmodels.discrete.discrete_model.Poisson.cdf">[docs]</a>    <span class="k">def</span> <span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Poisson model cumulative distribution function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X : array_like</span>
<span class="sd">            `X` is the linear predictor of the model.  See notes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        The value of the Poisson CDF at each point.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The CDF is defined as</span>

<span class="sd">        .. math:: \\exp\\left(-\\lambda\\right)\\sum_{i=0}^{y}\\frac{\\lambda^{i}}{i!}</span>

<span class="sd">        where :math:`\\lambda` assumes the loglinear model. I.e.,</span>

<span class="sd">        .. math:: \\ln\\lambda_{i}=X\\beta</span>

<span class="sd">        The parameter `X` is :math:`X\\beta` in the above formula.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span>
        <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">poisson</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">X</span><span class="p">))</span></div>

<div class="viewcode-block" id="Poisson.pdf"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Poisson.pdf.html#statsmodels.discrete.discrete_model.Poisson.pdf">[docs]</a>    <span class="k">def</span> <span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Poisson model probability mass function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X : array_like</span>
<span class="sd">            `X` is the linear predictor of the model.  See notes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pdf : ndarray</span>
<span class="sd">            The value of the Poisson probability mass function, PMF, for each</span>
<span class="sd">            point of X.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The PMF is defined as</span>

<span class="sd">        .. math:: \\frac{e^{-\\lambda_{i}}\\lambda_{i}^{y_{i}}}{y_{i}!}</span>

<span class="sd">        where :math:`\\lambda` assumes the loglinear model. I.e.,</span>

<span class="sd">        .. math:: \\ln\\lambda_{i}=x_{i}\\beta</span>

<span class="sd">        The parameter `X` is :math:`x_{i}\\beta` in the above formula.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">poisson</span><span class="o">.</span><span class="n">logpmf</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">X</span><span class="p">)))</span></div>

<div class="viewcode-block" id="Poisson.loglike"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Poisson.loglike.html#statsmodels.discrete.discrete_model.Poisson.loglike">[docs]</a>    <span class="k">def</span> <span class="nf">loglike</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loglikelihood of Poisson model</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        loglike : float</span>
<span class="sd">            The log-likelihood function of the model evaluated at `params`.</span>
<span class="sd">            See notes.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math:: \\ln L=\\sum_{i=1}^{n}\\left[-\\lambda_{i}+y_{i}x_{i}^{\\prime}\\beta-\\ln y_{i}!\\right]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">exposure</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">XB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">exposure</span>
        <span class="n">endog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">XB</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EXP_UPPER_LIMIT</span><span class="p">))</span>
            <span class="o">+</span> <span class="n">endog</span> <span class="o">*</span> <span class="n">XB</span>
            <span class="o">-</span> <span class="n">gammaln</span><span class="p">(</span><span class="n">endog</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Poisson.loglikeobs"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Poisson.loglikeobs.html#statsmodels.discrete.discrete_model.Poisson.loglikeobs">[docs]</a>    <span class="k">def</span> <span class="nf">loglikeobs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loglikelihood for observations of Poisson model</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        loglike : array_like</span>
<span class="sd">            The log likelihood for each observation of the model evaluated</span>
<span class="sd">            at `params`. See Notes</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math:: \\ln L_{i}=\\left[-\\lambda_{i}+y_{i}x_{i}^{\\prime}\\beta-\\ln y_{i}!\\right]</span>

<span class="sd">        for observations :math:`i=1,...,n`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">exposure</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">XB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">exposure</span>
        <span class="n">endog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span>
        <span class="c1">#np.sum(stats.poisson.logpmf(endog, np.exp(XB)))</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">XB</span><span class="p">)</span> <span class="o">+</span>  <span class="n">endog</span><span class="o">*</span><span class="n">XB</span> <span class="o">-</span> <span class="n">gammaln</span><span class="p">(</span><span class="n">endog</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span></div>

    <span class="nd">@Appender</span><span class="p">(</span><span class="n">_get_start_params_null_docs</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_get_start_params_null</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">exposure</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">const</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">exposure</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">const</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">params</span>

<div class="viewcode-block" id="Poisson.fit"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Poisson.fit.html#statsmodels.discrete.discrete_model.Poisson.fit">[docs]</a>    <span class="nd">@Appender</span><span class="p">(</span><span class="n">DiscreteModel</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;newton&#39;</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span>
            <span class="n">full_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">start_params</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">const_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># k_params or k_exog not available?</span>
            <span class="n">start_params</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">start_params</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">const_idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_start_params_null</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">kwds</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cov_type&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwds</span><span class="p">[</span><span class="s1">&#39;cov_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cov_type&#39;</span><span class="p">)</span>
            <span class="n">kwds</span><span class="p">[</span><span class="s1">&#39;cov_kwds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cov_kwds&#39;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="n">cntfit</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CountModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">start_params</span><span class="o">=</span><span class="n">start_params</span><span class="p">,</span>
                                             <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                                             <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
                                             <span class="n">full_output</span><span class="o">=</span><span class="n">full_output</span><span class="p">,</span>
                                             <span class="n">disp</span><span class="o">=</span><span class="n">disp</span><span class="p">,</span>
                                             <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
                                             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">discretefit</span> <span class="o">=</span> <span class="n">PoissonResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cntfit</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">PoissonResultsWrapper</span><span class="p">(</span><span class="n">discretefit</span><span class="p">)</span></div>

<div class="viewcode-block" id="Poisson.fit_regularized"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Poisson.fit_regularized.html#statsmodels.discrete.discrete_model.Poisson.fit_regularized">[docs]</a>    <span class="nd">@Appender</span><span class="p">(</span><span class="n">DiscreteModel</span><span class="o">.</span><span class="n">fit_regularized</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit_regularized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span>
            <span class="n">maxiter</span><span class="o">=</span><span class="s1">&#39;defined_by_method&#39;</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">trim_mode</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">auto_trim_tol</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">size_trim_tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
            <span class="n">qc_tol</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">_validate_l1_method</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>

        <span class="n">cntfit</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CountModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fit_regularized</span><span class="p">(</span>
                <span class="n">start_params</span><span class="o">=</span><span class="n">start_params</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
                <span class="n">full_output</span><span class="o">=</span><span class="n">full_output</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="n">disp</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">trim_mode</span><span class="o">=</span><span class="n">trim_mode</span><span class="p">,</span> <span class="n">auto_trim_tol</span><span class="o">=</span><span class="n">auto_trim_tol</span><span class="p">,</span>
                <span class="n">size_trim_tol</span><span class="o">=</span><span class="n">size_trim_tol</span><span class="p">,</span> <span class="n">qc_tol</span><span class="o">=</span><span class="n">qc_tol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">discretefit</span> <span class="o">=</span> <span class="n">L1PoissonResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cntfit</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">L1PoissonResultsWrapper</span><span class="p">(</span><span class="n">discretefit</span><span class="p">)</span></div>

<div class="viewcode-block" id="Poisson.fit_constrained"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Poisson.fit_constrained.html#statsmodels.discrete.discrete_model.Poisson.fit_constrained">[docs]</a>    <span class="k">def</span> <span class="nf">fit_constrained</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraints</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_kwds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;fit the model subject to linear equality constraints</span>

<span class="sd">        The constraints are of the form   `R params = q`</span>
<span class="sd">        where R is the constraint_matrix and q is the vector of</span>
<span class="sd">        constraint_values.</span>

<span class="sd">        The estimation creates a new model with transformed design matrix,</span>
<span class="sd">        exog, and converts the results back to the original parameterization.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        constraints : formula expression or tuple</span>
<span class="sd">            If it is a tuple, then the constraint needs to be given by two</span>
<span class="sd">            arrays (constraint_matrix, constraint_value), i.e. (R, q).</span>
<span class="sd">            Otherwise, the constraints can be given as strings or list of</span>
<span class="sd">            strings.</span>
<span class="sd">            see t_test for details</span>
<span class="sd">        start_params : None or array_like</span>
<span class="sd">            starting values for the optimization. `start_params` needs to be</span>
<span class="sd">            given in the original parameter space and are internally</span>
<span class="sd">            transformed.</span>
<span class="sd">        **fit_kwds : keyword arguments</span>
<span class="sd">            fit_kwds are used in the optimization of the transformed model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        results : Results instance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#constraints = (R, q)</span>
        <span class="c1"># TODO: temporary trailing underscore to not overwrite the monkey</span>
        <span class="c1">#       patched version</span>
        <span class="c1"># TODO: decide whether to move the imports</span>
        <span class="kn">from</span> <span class="nn">patsy</span> <span class="kn">import</span> <span class="n">DesignInfo</span>
        <span class="kn">from</span> <span class="nn">statsmodels.base._constraints</span> <span class="kn">import</span> <span class="p">(</span><span class="n">fit_constrained</span><span class="p">,</span>
                                                   <span class="n">LinearConstraints</span><span class="p">)</span>

        <span class="c1"># same pattern as in base.LikelihoodModel.t_test</span>
        <span class="n">lc</span> <span class="o">=</span> <span class="n">DesignInfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog_names</span><span class="p">)</span><span class="o">.</span><span class="n">linear_constraint</span><span class="p">(</span><span class="n">constraints</span><span class="p">)</span>
        <span class="n">R</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">lc</span><span class="o">.</span><span class="n">coefs</span><span class="p">,</span> <span class="n">lc</span><span class="o">.</span><span class="n">constants</span>

        <span class="c1"># TODO: add start_params option, need access to tranformation</span>
        <span class="c1">#       fit_constrained needs to do the transformation</span>
        <span class="n">params</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">res_constr</span> <span class="o">=</span> <span class="n">fit_constrained</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span>
                                                  <span class="n">start_params</span><span class="o">=</span><span class="n">start_params</span><span class="p">,</span>
                                                  <span class="n">fit_kwds</span><span class="o">=</span><span class="n">fit_kwds</span><span class="p">)</span>
        <span class="c1">#create dummy results Instance, TODO: wire up properly</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">maxiter</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nm&#39;</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                       <span class="n">warn_convergence</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># we get a wrapper back</span>
        <span class="n">res</span><span class="o">.</span><span class="n">mle_retvals</span><span class="p">[</span><span class="s1">&#39;fcall&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_constr</span><span class="o">.</span><span class="n">mle_retvals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fcall&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">res</span><span class="o">.</span><span class="n">mle_retvals</span><span class="p">[</span><span class="s1">&#39;iterations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_constr</span><span class="o">.</span><span class="n">mle_retvals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                                                        <span class="s1">&#39;iterations&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">res</span><span class="o">.</span><span class="n">mle_retvals</span><span class="p">[</span><span class="s1">&#39;converged&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_constr</span><span class="o">.</span><span class="n">mle_retvals</span><span class="p">[</span><span class="s1">&#39;converged&#39;</span><span class="p">]</span>
        <span class="n">res</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">res</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">cov_params_default</span> <span class="o">=</span> <span class="n">cov</span>
        <span class="n">cov_type</span> <span class="o">=</span> <span class="n">fit_kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cov_type&#39;</span><span class="p">,</span> <span class="s1">&#39;nonrobust&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cov_type</span> <span class="o">!=</span> <span class="s1">&#39;nonrobust&#39;</span><span class="p">:</span>
            <span class="n">res</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">normalized_cov_params</span> <span class="o">=</span> <span class="n">cov</span> <span class="c1"># assume scale=1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">normalized_cov_params</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">k_constr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">res</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">df_resid</span> <span class="o">+=</span> <span class="n">k_constr</span>
        <span class="n">res</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">df_model</span> <span class="o">-=</span> <span class="n">k_constr</span>
        <span class="n">res</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="n">LinearConstraints</span><span class="o">.</span><span class="n">from_patsy</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span>
        <span class="n">res</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">k_constr</span> <span class="o">=</span> <span class="n">k_constr</span>
        <span class="n">res</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">results_constrained</span> <span class="o">=</span> <span class="n">res_constr</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="Poisson.score"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Poisson.score.html#statsmodels.discrete.discrete_model.Poisson.score">[docs]</a>    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Poisson model score (gradient) vector of the log-likelihood</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        score : ndarray, 1-D</span>
<span class="sd">            The score vector of the model, i.e. the first derivative of the</span>
<span class="sd">            loglikelihood function, evaluated at `params`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math:: \\frac{\\partial\\ln L}{\\partial\\beta}=\\sum_{i=1}^{n}\\left(y_{i}-\\lambda_{i}\\right)x_{i}</span>

<span class="sd">        where the loglinear model is assumed</span>

<span class="sd">        .. math:: \\ln\\lambda_{i}=x_{i}\\beta</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">exposure</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">params</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">exposure</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">-</span> <span class="n">L</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span></div>

<div class="viewcode-block" id="Poisson.score_obs"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Poisson.score_obs.html#statsmodels.discrete.discrete_model.Poisson.score_obs">[docs]</a>    <span class="k">def</span> <span class="nf">score_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Poisson model Jacobian of the log-likelihood for each observation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        score : array_like</span>
<span class="sd">            The score vector (nobs, k_vars) of the model evaluated at `params`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math:: \\frac{\\partial\\ln L_{i}}{\\partial\\beta}=\\left(y_{i}-\\lambda_{i}\\right)x_{i}</span>

<span class="sd">        for observations :math:`i=1,...,n`</span>

<span class="sd">        where the loglinear model is assumed</span>

<span class="sd">        .. math:: \\ln\\lambda_{i}=x_{i}\\beta</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">exposure</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">params</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">exposure</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">-</span> <span class="n">L</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span></div>

<div class="viewcode-block" id="Poisson.score_factor"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Poisson.score_factor.html#statsmodels.discrete.discrete_model.Poisson.score_factor">[docs]</a>    <span class="k">def</span> <span class="nf">score_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Poisson model score_factor for each observation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        score : array_like</span>
<span class="sd">            The score factor (nobs, ) of the model evaluated at `params`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math:: \\frac{\\partial\\ln L_{i}}{\\partial\\beta}=\\left(y_{i}-\\lambda_{i}\\right)</span>

<span class="sd">        for observations :math:`i=1,...,n`</span>

<span class="sd">        where the loglinear model is assumed</span>

<span class="sd">        .. math:: \\ln\\lambda_{i}=x_{i}\\beta</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">exposure</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">params</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">exposure</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">-</span> <span class="n">L</span><span class="p">)</span></div>

<div class="viewcode-block" id="Poisson.hessian"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Poisson.hessian.html#statsmodels.discrete.discrete_model.Poisson.hessian">[docs]</a>    <span class="k">def</span> <span class="nf">hessian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Poisson model Hessian matrix of the loglikelihood</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        hess : ndarray, (k_vars, k_vars)</span>
<span class="sd">            The Hessian, second derivative of loglikelihood function,</span>
<span class="sd">            evaluated at `params`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math:: \\frac{\\partial^{2}\\ln L}{\\partial\\beta\\partial\\beta^{\\prime}}=-\\sum_{i=1}^{n}\\lambda_{i}x_{i}x_{i}^{\\prime}</span>

<span class="sd">        where the loglinear model is assumed</span>

<span class="sd">        .. math:: \\ln\\lambda_{i}=x_{i}\\beta</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">exposure</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">params</span><span class="p">)</span> <span class="o">+</span> <span class="n">exposure</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L</span><span class="o">*</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span></div>

<div class="viewcode-block" id="Poisson.hessian_factor"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Poisson.hessian_factor.html#statsmodels.discrete.discrete_model.Poisson.hessian_factor">[docs]</a>    <span class="k">def</span> <span class="nf">hessian_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Poisson model Hessian factor</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        hess : ndarray, (nobs,)</span>
<span class="sd">            The Hessian factor, second derivative of loglikelihood function</span>
<span class="sd">            with respect to the linear predictor evaluated at `params`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math:: \\frac{\\partial^{2}\\ln L}{\\partial\\beta\\partial\\beta^{\\prime}}=-\\sum_{i=1}^{n}\\lambda_{i}</span>

<span class="sd">        where the loglinear model is assumed</span>

<span class="sd">        .. math:: \\ln\\lambda_{i}=x_{i}\\beta</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">exposure</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">params</span><span class="p">)</span> <span class="o">+</span> <span class="n">exposure</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">L</span></div>

    <span class="k">def</span> <span class="nf">_deriv_score_obs_dendog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;derivative of score_obs w.r.t. endog</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : ndarray</span>
<span class="sd">            parameter at which score is evaluated</span>
<span class="sd">        scale : None or float</span>
<span class="sd">            If scale is None, then the default scale will be calculated.</span>
<span class="sd">            Default scale is defined by `self.scaletype` and set in fit.</span>
<span class="sd">            If scale is not None, then it is used as a fixed scale.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        derivative : ndarray_2d</span>
<span class="sd">            The derivative of the score_obs with respect to endog. This</span>
<span class="sd">            can is given by `score_factor0[:, None] * exog` where</span>
<span class="sd">            `score_factor0` is the score_factor without the residual.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>

<div class="viewcode-block" id="Poisson.predict"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Poisson.predict.html#statsmodels.discrete.discrete_model.Poisson.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exposure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">which</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">linear</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_values</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Predict response variable of a model given exogenous variables.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            2d array of fitted parameters of the model. Should be in the</span>
<span class="sd">            order returned from the model.</span>
<span class="sd">        exog : array_like, optional</span>
<span class="sd">            1d or 2d array of exogenous values.  If not supplied, then the</span>
<span class="sd">            exog attribute of the model is used. If a 1d array is given</span>
<span class="sd">            it assumed to be 1 row of exogenous variables. If you only have</span>
<span class="sd">            one regressor and would like to do prediction, you must provide</span>
<span class="sd">            a 2d array with shape[1] == 1.</span>
<span class="sd">        offset : array_like, optional</span>
<span class="sd">            Offset is added to the linear predictor with coefficient equal</span>
<span class="sd">            to 1.</span>
<span class="sd">            Default is zero if exog is not None, and the model offset if exog</span>
<span class="sd">            is None.</span>
<span class="sd">        exposure : array_like, optional</span>
<span class="sd">            Log(exposure) is added to the linear prediction with coefficient</span>
<span class="sd">            equal to 1.</span>
<span class="sd">            Default is one if exog is is not None, and is the model exposure</span>
<span class="sd">            if exog is None.</span>
<span class="sd">        which : &#39;mean&#39;, &#39;linear&#39;, &#39;var&#39;, &#39;prob&#39; (optional)</span>
<span class="sd">            Statitistic to predict. Default is &#39;mean&#39;.</span>

<span class="sd">            - &#39;mean&#39; returns the conditional expectation of endog E(y | x),</span>
<span class="sd">              i.e. exp of linear predictor.</span>
<span class="sd">            - &#39;linear&#39; returns the linear predictor of the mean function.</span>
<span class="sd">            - &#39;var&#39; returns the estimated variance of endog implied by the</span>
<span class="sd">              model.</span>
<span class="sd">            - &#39;prob&#39; return probabilities for counts from 0 to max(endog) or</span>
<span class="sd">              for y_values if those are provided.</span>

<span class="sd">            .. versionadded: 0.14</span>

<span class="sd">               ``which`` replaces and extends the deprecated ``linear``</span>
<span class="sd">               argument.</span>

<span class="sd">        linear : bool</span>
<span class="sd">            The ``linear` keyword is deprecated and will be removed,</span>
<span class="sd">            use ``which`` keyword instead.</span>
<span class="sd">            If True, returns the linear predicted values.  If False or None,</span>
<span class="sd">            then the statistic specified by ``which`` will be returned.</span>

<span class="sd">            .. deprecated: 0.14</span>

<span class="sd">               The ``linear` keyword is deprecated and will be removed,</span>
<span class="sd">               use ``which`` keyword instead.</span>

<span class="sd">        y_values : array_like</span>
<span class="sd">            Values of the random variable endog at which pmf is evaluated.</span>
<span class="sd">            Only used if ``which=&quot;prob&quot;``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Note docstring is reused by other count models</span>

        <span class="k">if</span> <span class="n">linear</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;linear keyword is deprecated, use which=&quot;linear&quot;&#39;</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">FutureWarning</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">linear</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">which</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span>

        <span class="k">if</span> <span class="n">which</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;lin&quot;</span><span class="p">):</span>
            <span class="n">which</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span>
        <span class="k">if</span> <span class="n">which</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;linear&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span> <span class="n">exposure</span><span class="o">=</span><span class="n">exposure</span><span class="p">,</span>
                                   <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span>
                                   <span class="n">which</span><span class="o">=</span><span class="n">which</span><span class="p">,</span> <span class="n">linear</span><span class="o">=</span><span class="n">linear</span><span class="p">)</span>
        <span class="c1"># TODO: add full set of which</span>
        <span class="k">elif</span> <span class="n">which</span> <span class="o">==</span> <span class="s2">&quot;var&quot;</span><span class="p">:</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span>
                              <span class="n">exposure</span><span class="o">=</span><span class="n">exposure</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span>
                              <span class="p">)</span>
            <span class="k">return</span> <span class="n">mu</span>
        <span class="k">elif</span> <span class="n">which</span> <span class="o">==</span> <span class="s2">&quot;prob&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">y_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">y_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">y_values</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span>
                              <span class="n">exposure</span><span class="o">=</span><span class="n">exposure</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span>
                              <span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>
            <span class="c1"># uses broadcasting</span>
            <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">poisson</span><span class="o">.</span><span class="n">_pmf</span><span class="p">(</span><span class="n">y_values</span><span class="p">,</span> <span class="n">mu</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Value of the `which` option is not recognized&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_prob_nonzero</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Probability that count is not zero</span>

<span class="sd">        internal use in Censored model, will be refactored or removed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prob_nz</span> <span class="o">=</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">prob_nz</span>

    <span class="k">def</span> <span class="nf">_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;variance implied by the distribution</span>

<span class="sd">        internal use, will be refactored or removed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">mu</span>

<div class="viewcode-block" id="Poisson.get_distribution"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Poisson.get_distribution.html#statsmodels.discrete.discrete_model.Poisson.get_distribution">[docs]</a>    <span class="k">def</span> <span class="nf">get_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exposure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get frozen instance of distribution based on predicted parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model.</span>
<span class="sd">        exog : ndarray, optional</span>
<span class="sd">            Explanatory variables for the main count model.</span>
<span class="sd">            If ``exog`` is None, then the data from the model will be used.</span>
<span class="sd">        offset : ndarray, optional</span>
<span class="sd">            Offset is added to the linear predictor of the mean function with</span>
<span class="sd">            coefficient equal to 1.</span>
<span class="sd">            Default is zero if exog is not None, and the model offset if exog</span>
<span class="sd">            is None.</span>
<span class="sd">        exposure : ndarray, optional</span>
<span class="sd">            Log(exposure) is added to the linear predictor  of the mean</span>
<span class="sd">            function with coefficient equal to 1. If exposure is specified,</span>
<span class="sd">            then it will be logged by the method. The user does not need to</span>
<span class="sd">            log it first.</span>
<span class="sd">            Default is one if exog is is not None, and it is the model exposure</span>
<span class="sd">            if exog is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Instance of frozen scipy distribution subclass.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span> <span class="n">exposure</span><span class="o">=</span><span class="n">exposure</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
        <span class="n">distr</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">distr</span></div></div>


<div class="viewcode-block" id="GeneralizedPoisson"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.GeneralizedPoisson.html#statsmodels.discrete.discrete_model.GeneralizedPoisson">[docs]</a><span class="k">class</span> <span class="nc">GeneralizedPoisson</span><span class="p">(</span><span class="n">CountModel</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Generalized Poisson Model</span>

<span class="s2">    </span><span class="si">%(params)s</span>
<span class="s2">    </span><span class="si">%(extra_params)s</span>

<span class="s2">    Attributes</span>
<span class="s2">    ----------</span>
<span class="s2">    endog : ndarray</span>
<span class="s2">        A reference to the endogenous response variable</span>
<span class="s2">    exog : ndarray</span>
<span class="s2">        A reference to the exogenous design.</span>
<span class="s2">    &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="n">base</span><span class="o">.</span><span class="n">_model_params_doc</span><span class="p">,</span>
           <span class="s1">&#39;extra_params&#39;</span><span class="p">:</span>
<span class="w">               </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    p : scalar</span>
<span class="sd">        P denotes parameterizations for GP regression. p=1 for GP-1 and</span>
<span class="sd">        p=2 for GP-2. Default is p=1.</span>
<span class="sd">    offset : array_like</span>
<span class="sd">        Offset is added to the linear prediction with coefficient equal to 1.</span>
<span class="sd">    exposure : array_like</span>
<span class="sd">        Log(exposure) is added to the linear prediction with coefficient</span>
<span class="sd">        equal to 1.&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">base</span><span class="o">.</span><span class="n">_missing_param_doc</span> <span class="o">+</span> <span class="n">_check_rank_doc</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">exposure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">check_rank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span>
                         <span class="n">exog</span><span class="p">,</span>
                         <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span>
                         <span class="n">exposure</span><span class="o">=</span><span class="n">exposure</span><span class="p">,</span>
                         <span class="n">missing</span><span class="o">=</span><span class="n">missing</span><span class="p">,</span>
                         <span class="n">check_rank</span><span class="o">=</span><span class="n">check_rank</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exog_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_extra</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_get_init_kwds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">kwds</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_get_init_kwds</span><span class="p">()</span>
        <span class="n">kwds</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">kwds</span>

    <span class="k">def</span> <span class="nf">_get_exogs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<div class="viewcode-block" id="GeneralizedPoisson.loglike"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.GeneralizedPoisson.loglike.html#statsmodels.discrete.discrete_model.GeneralizedPoisson.loglike">[docs]</a>    <span class="k">def</span> <span class="nf">loglike</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loglikelihood of Generalized Poisson model</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        loglike : float</span>
<span class="sd">            The log-likelihood function of the model evaluated at `params`.</span>
<span class="sd">            See notes.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math:: \\ln L=\\sum_{i=1}^{n}\\left[\\mu_{i}+(y_{i}-1)*ln(\\mu_{i}+</span>
<span class="sd">            \\alpha*\\mu_{i}^{p-1}*y_{i})-y_{i}*ln(1+\\alpha*\\mu_{i}^{p-1})-</span>
<span class="sd">            ln(y_{i}!)-\\frac{\\mu_{i}+\\alpha*\\mu_{i}^{p-1}*y_{i}}{1+\\alpha*</span>
<span class="sd">            \\mu_{i}^{p-1}}\\right]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loglikeobs</span><span class="p">(</span><span class="n">params</span><span class="p">))</span></div>

<div class="viewcode-block" id="GeneralizedPoisson.loglikeobs"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.GeneralizedPoisson.loglikeobs.html#statsmodels.discrete.discrete_model.GeneralizedPoisson.loglikeobs">[docs]</a>    <span class="k">def</span> <span class="nf">loglikeobs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loglikelihood for observations of Generalized Poisson model</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        loglike : ndarray</span>
<span class="sd">            The log likelihood for each observation of the model evaluated</span>
<span class="sd">            at `params`. See Notes</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math:: \\ln L=\\sum_{i=1}^{n}\\left[\\mu_{i}+(y_{i}-1)*ln(\\mu_{i}+</span>
<span class="sd">            \\alpha*\\mu_{i}^{p-1}*y_{i})-y_{i}*ln(1+\\alpha*\\mu_{i}^{p-1})-</span>
<span class="sd">            ln(y_{i}!)-\\frac{\\mu_{i}+\\alpha*\\mu_{i}^{p-1}*y_{i}}{1+\\alpha*</span>
<span class="sd">            \\mu_{i}^{p-1}}\\right]</span>

<span class="sd">        for observations :math:`i=1,...,n`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span>
        <span class="n">endog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">mu_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">mu_p</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">+</span> <span class="p">(</span><span class="n">a1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">endog</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">1e-20</span><span class="p">,</span> <span class="n">a1</span><span class="p">)</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">1e-20</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">endog</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span> <span class="o">-</span> <span class="n">endog</span> <span class="o">*</span>
                <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span> <span class="o">-</span> <span class="n">gammaln</span><span class="p">(</span><span class="n">endog</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">a2</span> <span class="o">/</span> <span class="n">a1</span><span class="p">)</span></div>

    <span class="nd">@Appender</span><span class="p">(</span><span class="n">_get_start_params_null_docs</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_get_start_params_null</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">exposure</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">const</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">exposure</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">const</span><span class="p">)]</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">const</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">exposure</span><span class="p">)</span>
        <span class="n">resid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">-</span> <span class="n">mu</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_dispersion</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">resid</span><span class="p">,</span> <span class="n">df_resid</span><span class="o">=</span><span class="n">resid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_estimate_dispersion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">resid</span><span class="p">,</span> <span class="n">df_resid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span>
        <span class="k">if</span> <span class="n">df_resid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df_resid</span> <span class="o">=</span> <span class="n">resid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">resid</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">mu</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df_resid</span>
        <span class="k">return</span> <span class="n">a</span>


<div class="viewcode-block" id="GeneralizedPoisson.fit"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.GeneralizedPoisson.fit.html#statsmodels.discrete.discrete_model.GeneralizedPoisson.fit">[docs]</a>    <span class="nd">@Appender</span><span class="p">(</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        use_transparams : bool</span>
<span class="sd">            This parameter enable internal transformation to impose</span>
<span class="sd">            non-negativity. True to enable. Default is False.</span>
<span class="sd">            use_transparams=True imposes the no underdispersion (alpha &gt; 0)</span>
<span class="sd">            constraint. In case use_transparams=True and method=&quot;newton&quot; or</span>
<span class="sd">            &quot;ncg&quot; transformation is ignored.</span>
<span class="sd">        &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="nd">@Appender</span><span class="p">(</span><span class="n">DiscreteModel</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bfgs&#39;</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span>
            <span class="n">full_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_transparams</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">cov_type</span><span class="o">=</span><span class="s1">&#39;nonrobust&#39;</span><span class="p">,</span> <span class="n">cov_kwds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">optim_kwds_prelim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">use_transparams</span> <span class="ow">and</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;newton&#39;</span><span class="p">,</span> <span class="s1">&#39;ncg&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_transparams</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Parameter &quot;use_transparams&quot; is ignored&#39;</span><span class="p">,</span>
                              <span class="ne">RuntimeWarning</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">start_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">offset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">kwds_prelim</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;disp&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;skip_hessian&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                           <span class="s1">&#39;warn_convergence&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">optim_kwds_prelim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">kwds_prelim</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">optim_kwds_prelim</span><span class="p">)</span>
            <span class="n">mod_poi</span> <span class="o">=</span> <span class="n">Poisson</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;always&quot;</span><span class="p">)</span>
                <span class="n">res_poi</span> <span class="o">=</span> <span class="n">mod_poi</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">**</span><span class="n">kwds_prelim</span><span class="p">)</span>
            <span class="n">start_params</span> <span class="o">=</span> <span class="n">res_poi</span><span class="o">.</span><span class="n">params</span>
            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_dispersion</span><span class="p">(</span><span class="n">res_poi</span><span class="o">.</span><span class="n">predict</span><span class="p">(),</span> <span class="n">res_poi</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span>
                                          <span class="n">df_resid</span><span class="o">=</span><span class="n">res_poi</span><span class="o">.</span><span class="n">df_resid</span><span class="p">)</span>
            <span class="n">start_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start_params</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">callback</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># work around perfect separation callback #3895</span>
            <span class="n">callback</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">x</span><span class="p">:</span> <span class="n">x</span>

        <span class="n">mlefit</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">start_params</span><span class="o">=</span><span class="n">start_params</span><span class="p">,</span>
                             <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
                             <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                             <span class="n">disp</span><span class="o">=</span><span class="n">disp</span><span class="p">,</span>
                             <span class="n">full_output</span><span class="o">=</span><span class="n">full_output</span><span class="p">,</span>
                             <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">optim_kwds_prelim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mlefit</span><span class="o">.</span><span class="n">mle_settings</span><span class="p">[</span><span class="s2">&quot;optim_kwds_prelim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">optim_kwds_prelim</span>
        <span class="k">if</span> <span class="n">use_transparams</span> <span class="ow">and</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;newton&quot;</span><span class="p">,</span> <span class="s2">&quot;ncg&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">mlefit</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mlefit</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">gpfit</span> <span class="o">=</span> <span class="n">GeneralizedPoissonResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mlefit</span><span class="o">.</span><span class="n">_results</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">GeneralizedPoissonResultsWrapper</span><span class="p">(</span><span class="n">gpfit</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cov_kwds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cov_kwds</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">result</span><span class="o">.</span><span class="n">_get_robustcov_results</span><span class="p">(</span><span class="n">cov_type</span><span class="o">=</span><span class="n">cov_type</span><span class="p">,</span>
                                      <span class="n">use_self</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_t</span><span class="o">=</span><span class="n">use_t</span><span class="p">,</span> <span class="o">**</span><span class="n">cov_kwds</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="GeneralizedPoisson.fit_regularized"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.GeneralizedPoisson.fit_regularized.html#statsmodels.discrete.discrete_model.GeneralizedPoisson.fit_regularized">[docs]</a>    <span class="nd">@Appender</span><span class="p">(</span><span class="n">DiscreteModel</span><span class="o">.</span><span class="n">fit_regularized</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit_regularized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span>
            <span class="n">maxiter</span><span class="o">=</span><span class="s1">&#39;defined_by_method&#39;</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">trim_mode</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">auto_trim_tol</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">size_trim_tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
            <span class="n">qc_tol</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">_validate_l1_method</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">alpha</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">k_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_extra</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">k_params</span><span class="p">)</span>
            <span class="n">alpha</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">alpha_p</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_extra</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="n">alpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">start_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">offset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">mod_poi</span> <span class="o">=</span> <span class="n">Poisson</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;always&quot;</span><span class="p">)</span>
                <span class="n">start_params</span> <span class="o">=</span> <span class="n">mod_poi</span><span class="o">.</span><span class="n">fit_regularized</span><span class="p">(</span>
                    <span class="n">start_params</span><span class="o">=</span><span class="n">start_params</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
                    <span class="n">full_output</span><span class="o">=</span><span class="n">full_output</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="n">alpha_p</span><span class="p">,</span> <span class="n">trim_mode</span><span class="o">=</span><span class="n">trim_mode</span><span class="p">,</span>
                    <span class="n">auto_trim_tol</span><span class="o">=</span><span class="n">auto_trim_tol</span><span class="p">,</span> <span class="n">size_trim_tol</span><span class="o">=</span><span class="n">size_trim_tol</span><span class="p">,</span>
                    <span class="n">qc_tol</span><span class="o">=</span><span class="n">qc_tol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">params</span>
            <span class="n">start_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start_params</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

        <span class="n">cntfit</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CountModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fit_regularized</span><span class="p">(</span>
                <span class="n">start_params</span><span class="o">=</span><span class="n">start_params</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
                <span class="n">full_output</span><span class="o">=</span><span class="n">full_output</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="n">disp</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">trim_mode</span><span class="o">=</span><span class="n">trim_mode</span><span class="p">,</span> <span class="n">auto_trim_tol</span><span class="o">=</span><span class="n">auto_trim_tol</span><span class="p">,</span>
                <span class="n">size_trim_tol</span><span class="o">=</span><span class="n">size_trim_tol</span><span class="p">,</span> <span class="n">qc_tol</span><span class="o">=</span><span class="n">qc_tol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">discretefit</span> <span class="o">=</span> <span class="n">L1GeneralizedPoissonResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cntfit</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">L1GeneralizedPoissonResultsWrapper</span><span class="p">(</span><span class="n">discretefit</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeneralizedPoisson.score_obs"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.GeneralizedPoisson.score_obs.html#statsmodels.discrete.discrete_model.GeneralizedPoisson.score_obs">[docs]</a>    <span class="k">def</span> <span class="nf">score_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span>
        <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span>
        <span class="n">mu_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">mu_p</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">mu_p</span> <span class="o">*</span> <span class="n">y</span>
        <span class="n">a3</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">**</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">a4</span> <span class="o">=</span> <span class="n">a3</span> <span class="o">*</span> <span class="n">y</span>
        <span class="n">dmudb</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">exog</span>

        <span class="n">dalpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_p</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="p">((</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">a2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">a1</span><span class="p">)</span> <span class="o">+</span> <span class="n">a2</span> <span class="o">/</span> <span class="n">a1</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">dparams</span> <span class="o">=</span> <span class="n">dmudb</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">a4</span> <span class="o">/</span> <span class="n">a1</span> <span class="o">+</span>
                           <span class="n">a3</span> <span class="o">*</span> <span class="n">a2</span> <span class="o">/</span> <span class="p">(</span><span class="n">a1</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                           <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">a2</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">a1</span><span class="p">)</span> <span class="o">+</span>
                           <span class="mi">1</span> <span class="o">/</span> <span class="n">mu</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">dparams</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">dalpha</span><span class="p">)),</span>
                              <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeneralizedPoisson.score"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.GeneralizedPoisson.score.html#statsmodels.discrete.discrete_model.GeneralizedPoisson.score">[docs]</a>    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="n">score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">score_obs</span><span class="p">(</span><span class="n">params</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span><span class="p">:</span>
            <span class="n">score</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">score</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="k">return</span> <span class="n">score</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">score</span></div>

<div class="viewcode-block" id="GeneralizedPoisson.score_factor"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.GeneralizedPoisson.score_factor.html#statsmodels.discrete.discrete_model.GeneralizedPoisson.score_factor">[docs]</a>    <span class="k">def</span> <span class="nf">score_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">endog</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="k">if</span> <span class="n">endog</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">endog</span>

        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">mu_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">mu_p</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">mu_p</span> <span class="o">*</span> <span class="n">y</span>
        <span class="n">a3</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">**</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">a4</span> <span class="o">=</span> <span class="n">a3</span> <span class="o">*</span> <span class="n">y</span>
        <span class="n">dmudb</span> <span class="o">=</span> <span class="n">mu</span>

        <span class="n">dalpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_p</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="p">((</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">a2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">a1</span><span class="p">)</span> <span class="o">+</span> <span class="n">a2</span> <span class="o">/</span> <span class="n">a1</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">dparams</span> <span class="o">=</span> <span class="n">dmudb</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">a4</span> <span class="o">/</span> <span class="n">a1</span> <span class="o">+</span>
                           <span class="n">a3</span> <span class="o">*</span> <span class="n">a2</span> <span class="o">/</span> <span class="p">(</span><span class="n">a1</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                           <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">a2</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">a1</span><span class="p">)</span> <span class="o">+</span>
                           <span class="mi">1</span> <span class="o">/</span> <span class="n">mu</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dparams</span><span class="p">,</span> <span class="n">dalpha</span></div>

    <span class="k">def</span> <span class="nf">_score_p</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generalized Poisson model derivative of the log-likelihood by p-parameter</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dldp : float</span>
<span class="sd">            dldp is first derivative of the loglikelihood function,</span>
<span class="sd">        evaluated at `p-parameter`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span>
        <span class="n">mu_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">mu_p</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">mu_p</span> <span class="o">*</span> <span class="n">y</span>

        <span class="n">dp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">a2</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">a2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">a1</span><span class="p">)</span> <span class="o">+</span>
                                   <span class="p">(</span><span class="n">a1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">a2</span> <span class="o">/</span> <span class="n">a1</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">dp</span>

<div class="viewcode-block" id="GeneralizedPoisson.hessian"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.GeneralizedPoisson.hessian.html#statsmodels.discrete.discrete_model.GeneralizedPoisson.hessian">[docs]</a>    <span class="k">def</span> <span class="nf">hessian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generalized Poisson model Hessian matrix of the loglikelihood</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        hess : ndarray, (k_vars, k_vars)</span>
<span class="sd">            The Hessian, second derivative of loglikelihood function,</span>
<span class="sd">            evaluated at `params`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span>
        <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span>
        <span class="n">mu_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">mu_p</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">mu_p</span> <span class="o">*</span> <span class="n">y</span>
        <span class="n">a3</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">**</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">a4</span> <span class="o">=</span> <span class="n">a3</span> <span class="o">*</span> <span class="n">y</span>
        <span class="n">a5</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">**</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">dmudb</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">exog</span>

        <span class="c1"># for dl/dparams dparams</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">hess_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">hess_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mu</span> <span class="o">*</span> <span class="n">exog</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">exog</span><span class="p">[:,</span><span class="n">j</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span>
                    <span class="p">(</span><span class="n">mu</span> <span class="o">*</span> <span class="p">(</span><span class="n">a3</span> <span class="o">*</span> <span class="n">a4</span> <span class="o">/</span> <span class="n">a1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span>
                           <span class="mi">2</span> <span class="o">*</span> <span class="n">a3</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a2</span> <span class="o">/</span> <span class="n">a1</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span>
                           <span class="mi">2</span> <span class="o">*</span> <span class="n">a3</span> <span class="o">*</span> <span class="p">(</span><span class="n">a4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">a1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span>
                           <span class="n">a4</span> <span class="o">*</span> <span class="n">p</span> <span class="o">/</span> <span class="p">(</span><span class="n">mu</span> <span class="o">*</span> <span class="n">a1</span><span class="p">)</span> <span class="o">+</span>
                           <span class="n">a3</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="n">a2</span> <span class="o">/</span> <span class="p">(</span><span class="n">mu</span> <span class="o">*</span> <span class="n">a1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                           <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">a4</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a2</span> <span class="o">*</span> <span class="n">mu</span><span class="p">)</span> <span class="o">-</span>
                           <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">a2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span>
                           <span class="n">a4</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a1</span> <span class="o">*</span> <span class="n">mu</span><span class="p">))</span> <span class="o">+</span>
                     <span class="p">((</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span> <span class="o">/</span> <span class="n">a2</span> <span class="o">-</span>
                      <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span> <span class="o">/</span> <span class="n">a1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">hess_arr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">hess_val</span><span class="p">)</span>
        <span class="n">tri_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu_indices</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">hess_arr</span><span class="p">[</span><span class="n">tri_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">hess_arr</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">tri_idx</span><span class="p">]</span>

        <span class="c1"># for dl/dparams dalpha</span>
        <span class="n">dldpda</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a4</span> <span class="o">*</span> <span class="n">mu_p</span> <span class="o">/</span> <span class="n">a1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span>
                         <span class="mi">2</span> <span class="o">*</span> <span class="n">a3</span> <span class="o">*</span> <span class="n">mu_p</span> <span class="o">*</span> <span class="n">a2</span> <span class="o">/</span> <span class="n">a1</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span>
                         <span class="n">mu_p</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span> <span class="o">/</span> <span class="n">a2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                         <span class="n">mu_p</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span> <span class="o">/</span> <span class="n">a1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                         <span class="n">a5</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">a2</span> <span class="o">-</span>
                         <span class="mi">2</span> <span class="o">*</span> <span class="n">a5</span> <span class="o">*</span> <span class="n">y</span> <span class="o">/</span> <span class="n">a1</span> <span class="o">+</span>
                         <span class="n">a5</span> <span class="o">*</span> <span class="n">a2</span> <span class="o">/</span> <span class="n">a1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">dmudb</span><span class="p">,</span>
                        <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">hess_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dldpda</span>
        <span class="n">hess_arr</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dldpda</span>

        <span class="c1"># for dl/dalpha dalpha</span>
        <span class="n">dldada</span> <span class="o">=</span> <span class="n">mu_p</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">y</span> <span class="o">/</span> <span class="n">a1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span>
                            <span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="n">a2</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span>
                            <span class="mi">2</span> <span class="o">*</span> <span class="n">a2</span> <span class="o">/</span> <span class="n">a1</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">hess_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dldada</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">hess_arr</span></div>

<div class="viewcode-block" id="GeneralizedPoisson.hessian_factor"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.GeneralizedPoisson.hessian_factor.html#statsmodels.discrete.discrete_model.GeneralizedPoisson.hessian_factor">[docs]</a>    <span class="k">def</span> <span class="nf">hessian_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generalized Poisson model Hessian matrix of the loglikelihood</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array-like</span>
<span class="sd">            The parameters of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        hess : ndarray, (nobs, 3)</span>
<span class="sd">            The Hessian factor, second derivative of loglikelihood function</span>
<span class="sd">            with respect to linear predictor and dispersion parameter</span>
<span class="sd">            evaluated at `params`</span>
<span class="sd">            The first column contains the second derivative w.r.t. linpred,</span>
<span class="sd">            the second column contains the cross derivative, and the</span>
<span class="sd">            third column contains the second derivative w.r.t. the dispersion</span>
<span class="sd">            parameter.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">mu_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">mu_p</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">mu_p</span> <span class="o">*</span> <span class="n">y</span>
        <span class="n">a3</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">**</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">a4</span> <span class="o">=</span> <span class="n">a3</span> <span class="o">*</span> <span class="n">y</span>
        <span class="n">a5</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">**</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">dmudb</span> <span class="o">=</span> <span class="n">mu</span>

        <span class="n">dbb</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">*</span> <span class="p">(</span>
             <span class="n">mu</span> <span class="o">*</span> <span class="p">(</span><span class="n">a3</span> <span class="o">*</span> <span class="n">a4</span> <span class="o">/</span> <span class="n">a1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span>
                   <span class="mi">2</span> <span class="o">*</span> <span class="n">a3</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a2</span> <span class="o">/</span> <span class="n">a1</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span>
                   <span class="mi">2</span> <span class="o">*</span> <span class="n">a3</span> <span class="o">*</span> <span class="p">(</span><span class="n">a4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">a1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span>
                   <span class="n">a4</span> <span class="o">*</span> <span class="n">p</span> <span class="o">/</span> <span class="p">(</span><span class="n">mu</span> <span class="o">*</span> <span class="n">a1</span><span class="p">)</span> <span class="o">+</span>
                   <span class="n">a3</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="n">a2</span> <span class="o">/</span> <span class="p">(</span><span class="n">mu</span> <span class="o">*</span> <span class="n">a1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                   <span class="n">a4</span> <span class="o">/</span> <span class="p">(</span><span class="n">mu</span> <span class="o">*</span> <span class="n">a1</span><span class="p">)</span> <span class="o">-</span>
                   <span class="n">a3</span> <span class="o">*</span> <span class="n">a2</span> <span class="o">/</span> <span class="p">(</span><span class="n">mu</span> <span class="o">*</span> <span class="n">a1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                   <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">a4</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a2</span> <span class="o">*</span> <span class="n">mu</span><span class="p">)</span> <span class="o">-</span>
                   <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">a2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span>
                   <span class="n">a4</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a1</span> <span class="o">*</span> <span class="n">mu</span><span class="p">)</span> <span class="o">-</span>
                   <span class="mi">1</span> <span class="o">/</span> <span class="n">mu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
             <span class="p">(</span><span class="o">-</span><span class="n">a4</span> <span class="o">/</span> <span class="n">a1</span> <span class="o">+</span>
              <span class="n">a3</span> <span class="o">*</span> <span class="n">a2</span> <span class="o">/</span> <span class="n">a1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
              <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span> <span class="o">/</span> <span class="n">a2</span> <span class="o">-</span>
              <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span> <span class="o">/</span> <span class="n">a1</span> <span class="o">+</span>
              <span class="mi">1</span> <span class="o">/</span> <span class="n">mu</span><span class="p">))</span>

        <span class="c1"># for dl/dlinpred dalpha</span>
        <span class="n">dba</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a4</span> <span class="o">*</span> <span class="n">mu_p</span> <span class="o">/</span> <span class="n">a1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span>
                         <span class="mi">2</span> <span class="o">*</span> <span class="n">a3</span> <span class="o">*</span> <span class="n">mu_p</span> <span class="o">*</span> <span class="n">a2</span> <span class="o">/</span> <span class="n">a1</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span>
                         <span class="n">mu_p</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span> <span class="o">/</span> <span class="n">a2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                         <span class="n">mu_p</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span> <span class="o">/</span> <span class="n">a1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                         <span class="n">a5</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">a2</span> <span class="o">-</span>
                         <span class="mi">2</span> <span class="o">*</span> <span class="n">a5</span> <span class="o">*</span> <span class="n">y</span> <span class="o">/</span> <span class="n">a1</span> <span class="o">+</span>
                         <span class="n">a5</span> <span class="o">*</span> <span class="n">a2</span> <span class="o">/</span> <span class="n">a1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">dmudb</span><span class="p">)</span>

        <span class="c1"># for dl/dalpha dalpha</span>
        <span class="n">daa</span> <span class="o">=</span> <span class="n">mu_p</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">y</span> <span class="o">/</span> <span class="n">a1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span>
                            <span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="n">a2</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span>
                            <span class="mi">2</span> <span class="o">*</span> <span class="n">a2</span> <span class="o">/</span> <span class="n">a1</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dbb</span><span class="p">,</span> <span class="n">dba</span><span class="p">,</span> <span class="n">daa</span></div>

<div class="viewcode-block" id="GeneralizedPoisson.predict"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.GeneralizedPoisson.predict.html#statsmodels.discrete.discrete_model.GeneralizedPoisson.predict">[docs]</a>    <span class="nd">@Appender</span><span class="p">(</span><span class="n">Poisson</span><span class="o">.</span><span class="n">predict</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exposure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">which</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">y_values</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>

        <span class="k">if</span> <span class="n">exposure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exposure</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;exposure&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">exposure</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">exposure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">exposure</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;offset&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">fitted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="n">params</span><span class="p">[:</span><span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">linpred</span> <span class="o">=</span> <span class="n">fitted</span> <span class="o">+</span> <span class="n">exposure</span> <span class="o">+</span> <span class="n">offset</span>

        <span class="k">if</span> <span class="n">which</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">linpred</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">which</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">linpred</span>
        <span class="k">elif</span> <span class="n">which</span> <span class="o">==</span> <span class="s1">&#39;var&#39;</span><span class="p">:</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">linpred</span><span class="p">)</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">pm1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span>  <span class="c1"># `p - 1` in GPP</span>
            <span class="n">var_</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">mean</span><span class="o">**</span><span class="n">pm1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">return</span> <span class="n">var_</span>
        <span class="k">elif</span> <span class="n">which</span> <span class="o">==</span> <span class="s1">&#39;prob&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">y_values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">y_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span> <span class="n">exposure</span><span class="o">=</span><span class="n">exposure</span><span class="p">,</span>
                              <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">genpoisson_p</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">y_values</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;keyword </span><span class="se">\&#39;</span><span class="s1">which</span><span class="se">\&#39;</span><span class="s1"> not recognized&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_deriv_score_obs_dendog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;derivative of score_obs w.r.t. endog</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : ndarray</span>
<span class="sd">            parameter at which score is evaluated</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        derivative : ndarray_2d</span>
<span class="sd">            The derivative of the score_obs with respect to endog.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># code duplication with NegativeBinomialP</span>
        <span class="kn">from</span> <span class="nn">statsmodels.tools.numdiff</span> <span class="kn">import</span> <span class="n">_approx_fprime_cs_scalar</span>

        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">sf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_factor</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">endog</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span>

        <span class="n">dsf</span> <span class="o">=</span> <span class="n">_approx_fprime_cs_scalar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
        <span class="c1"># deriv is 2d vector</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="n">dsf</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="n">dsf</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;variance implied by the distribution</span>

<span class="sd">        internal use, will be refactored or removed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pm1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span>  <span class="c1"># `p-1` in GPP</span>
        <span class="n">var_</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">mu</span><span class="o">**</span><span class="n">pm1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">return</span> <span class="n">var_</span>

    <span class="k">def</span> <span class="nf">_prob_nonzero</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Probability that count is not zero</span>

<span class="sd">        internal use in Censored model, will be refactored or removed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pm1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span>  <span class="c1"># p-1 in GPP</span>
        <span class="n">prob_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span> <span class="n">mu</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">mu</span><span class="o">**</span><span class="n">pm1</span><span class="p">))</span>
        <span class="n">prob_nz</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">prob_zero</span>
        <span class="k">return</span> <span class="n">prob_nz</span>

<div class="viewcode-block" id="GeneralizedPoisson.get_distribution"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.GeneralizedPoisson.get_distribution.html#statsmodels.discrete.discrete_model.GeneralizedPoisson.get_distribution">[docs]</a>    <span class="nd">@Appender</span><span class="p">(</span><span class="n">Poisson</span><span class="o">.</span><span class="n">get_distribution</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exposure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;get frozen instance of distribution</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span> <span class="n">exposure</span><span class="o">=</span><span class="n">exposure</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="c1"># distr = genpoisson_p(mu[:, None], params[-1], p)</span>
        <span class="n">distr</span> <span class="o">=</span> <span class="n">genpoisson_p</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">distr</span></div></div>


<div class="viewcode-block" id="Logit"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Logit.html#statsmodels.discrete.discrete_model.Logit">[docs]</a><span class="k">class</span> <span class="nc">Logit</span><span class="p">(</span><span class="n">BinaryModel</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Logit Model</span>

<span class="s2">    </span><span class="si">%(params)s</span>
<span class="s2">    offset : array_like</span>
<span class="s2">        Offset is added to the linear prediction with coefficient equal to 1.</span>
<span class="s2">    </span><span class="si">%(extra_params)s</span>

<span class="s2">    Attributes</span>
<span class="s2">    ----------</span>
<span class="s2">    endog : ndarray</span>
<span class="s2">        A reference to the endogenous response variable</span>
<span class="s2">    exog : ndarray</span>
<span class="s2">        A reference to the exogenous design.</span>
<span class="s2">    &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="n">base</span><span class="o">.</span><span class="n">_model_params_doc</span><span class="p">,</span>
           <span class="s1">&#39;extra_params&#39;</span><span class="p">:</span> <span class="n">base</span><span class="o">.</span><span class="n">_missing_param_doc</span> <span class="o">+</span> <span class="n">_check_rank_doc</span><span class="p">}</span>

    <span class="n">_continuous_ok</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">statsmodels.genmod.families</span> <span class="kn">import</span> <span class="n">links</span>
        <span class="n">link</span> <span class="o">=</span> <span class="n">links</span><span class="o">.</span><span class="n">Logit</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">link</span>

<div class="viewcode-block" id="Logit.cdf"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Logit.cdf.html#statsmodels.discrete.discrete_model.Logit.cdf">[docs]</a>    <span class="k">def</span> <span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The logistic cumulative distribution function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X : array_like</span>
<span class="sd">            `X` is the linear predictor of the logit model.  See notes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        1/(1 + exp(-X))</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        In the logit model,</span>

<span class="sd">        .. math:: \\Lambda\\left(x^{\\prime}\\beta\\right)=</span>
<span class="sd">                  \\text{Prob}\\left(Y=1|x\\right)=</span>
<span class="sd">                  \\frac{e^{x^{\\prime}\\beta}}{1+e^{x^{\\prime}\\beta}}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">X</span><span class="p">))</span></div>

<div class="viewcode-block" id="Logit.pdf"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Logit.pdf.html#statsmodels.discrete.discrete_model.Logit.pdf">[docs]</a>    <span class="k">def</span> <span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The logistic probability density function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X : array_like</span>
<span class="sd">            `X` is the linear predictor of the logit model.  See notes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pdf : ndarray</span>
<span class="sd">            The value of the Logit probability mass function, PMF, for each</span>
<span class="sd">            point of X. ``np.exp(-x)/(1+np.exp(-X))**2``</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        In the logit model,</span>

<span class="sd">        .. math:: \\lambda\\left(x^{\\prime}\\beta\\right)=\\frac{e^{-x^{\\prime}\\beta}}{\\left(1+e^{-x^{\\prime}\\beta}\\right)^{2}}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">X</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">X</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span></div>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">family</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">statsmodels.genmod</span> <span class="kn">import</span> <span class="n">families</span>
        <span class="k">return</span> <span class="n">families</span><span class="o">.</span><span class="n">Binomial</span><span class="p">()</span>

<div class="viewcode-block" id="Logit.loglike"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Logit.loglike.html#statsmodels.discrete.discrete_model.Logit.loglike">[docs]</a>    <span class="k">def</span> <span class="nf">loglike</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log-likelihood of logit model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the logit model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        loglike : float</span>
<span class="sd">            The log-likelihood function of the model evaluated at `params`.</span>
<span class="sd">            See notes.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math::</span>

<span class="sd">           \\ln L=\\sum_{i}\\ln\\Lambda</span>
<span class="sd">           \\left(q_{i}x_{i}^{\\prime}\\beta\\right)</span>

<span class="sd">        Where :math:`q=2y-1`. This simplification comes from the fact that the</span>
<span class="sd">        logistic distribution is symmetric.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">linpred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">linpred</span><span class="p">)))</span></div>

<div class="viewcode-block" id="Logit.loglikeobs"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Logit.loglikeobs.html#statsmodels.discrete.discrete_model.Logit.loglikeobs">[docs]</a>    <span class="k">def</span> <span class="nf">loglikeobs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log-likelihood of logit model for each observation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the logit model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        loglike : ndarray</span>
<span class="sd">            The log likelihood for each observation of the model evaluated</span>
<span class="sd">            at `params`. See Notes</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math::</span>

<span class="sd">           \\ln L=\\sum_{i}\\ln\\Lambda</span>
<span class="sd">           \\left(q_{i}x_{i}^{\\prime}\\beta\\right)</span>

<span class="sd">        for observations :math:`i=1,...,n`</span>

<span class="sd">        where :math:`q=2y-1`. This simplification comes from the fact that the</span>
<span class="sd">        logistic distribution is symmetric.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">linpred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">linpred</span><span class="p">))</span></div>

<div class="viewcode-block" id="Logit.score"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Logit.score.html#statsmodels.discrete.discrete_model.Logit.score">[docs]</a>    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logit model score (gradient) vector of the log-likelihood</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        score : ndarray, 1-D</span>
<span class="sd">            The score vector of the model, i.e. the first derivative of the</span>
<span class="sd">            loglikelihood function, evaluated at `params`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math:: \\frac{\\partial\\ln L}{\\partial\\beta}=\\sum_{i=1}^{n}\\left(y_{i}-\\Lambda_{i}\\right)x_{i}</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">fitted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">fitted</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span></div>

<div class="viewcode-block" id="Logit.score_obs"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Logit.score_obs.html#statsmodels.discrete.discrete_model.Logit.score_obs">[docs]</a>    <span class="k">def</span> <span class="nf">score_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logit model Jacobian of the log-likelihood for each observation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        jac : array_like</span>
<span class="sd">            The derivative of the loglikelihood for each observation evaluated</span>
<span class="sd">            at `params`.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math:: \\frac{\\partial\\ln L_{i}}{\\partial\\beta}=\\left(y_{i}-\\Lambda_{i}\\right)x_{i}</span>

<span class="sd">        for observations :math:`i=1,...,n`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">fitted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">fitted</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span></div>

<div class="viewcode-block" id="Logit.score_factor"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Logit.score_factor.html#statsmodels.discrete.discrete_model.Logit.score_factor">[docs]</a>    <span class="k">def</span> <span class="nf">score_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logit model derivative of the log-likelihood with respect to linpred.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        score_factor : array_like</span>
<span class="sd">            The derivative of the loglikelihood for each observation evaluated</span>
<span class="sd">            at `params`.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math:: \\frac{\\partial\\ln L_{i}}{\\partial\\beta}=\\left(y_{i}-\\lambda_{i}\\right)</span>

<span class="sd">        for observations :math:`i=1,...,n`</span>

<span class="sd">        where the loglinear model is assumed</span>

<span class="sd">        .. math:: \\ln\\lambda_{i}=x_{i}\\beta</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span>
        <span class="n">fitted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">fitted</span><span class="p">)</span></div>

<div class="viewcode-block" id="Logit.hessian"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Logit.hessian.html#statsmodels.discrete.discrete_model.Logit.hessian">[docs]</a>    <span class="k">def</span> <span class="nf">hessian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logit model Hessian matrix of the log-likelihood</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        hess : ndarray, (k_vars, k_vars)</span>
<span class="sd">            The Hessian, second derivative of loglikelihood function,</span>
<span class="sd">            evaluated at `params`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math:: \\frac{\\partial^{2}\\ln L}{\\partial\\beta\\partial\\beta^{\\prime}}=-\\sum_{i}\\Lambda_{i}\\left(1-\\Lambda_{i}\\right)x_{i}x_{i}^{\\prime}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">L</span><span class="p">)</span><span class="o">*</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">X</span><span class="p">)</span></div>

<div class="viewcode-block" id="Logit.hessian_factor"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Logit.hessian_factor.html#statsmodels.discrete.discrete_model.Logit.hessian_factor">[docs]</a>    <span class="k">def</span> <span class="nf">hessian_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logit model Hessian factor</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        hess : ndarray, (nobs,)</span>
<span class="sd">            The Hessian factor, second derivative of loglikelihood function</span>
<span class="sd">            with respect to the linear predictor evaluated at `params`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">L</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">L</span><span class="p">)</span></div>

<div class="viewcode-block" id="Logit.fit"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Logit.fit.html#statsmodels.discrete.discrete_model.Logit.fit">[docs]</a>    <span class="nd">@Appender</span><span class="p">(</span><span class="n">DiscreteModel</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;newton&#39;</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span>
            <span class="n">full_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">bnryfit</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">start_params</span><span class="o">=</span><span class="n">start_params</span><span class="p">,</span>
                              <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                              <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
                              <span class="n">full_output</span><span class="o">=</span><span class="n">full_output</span><span class="p">,</span>
                              <span class="n">disp</span><span class="o">=</span><span class="n">disp</span><span class="p">,</span>
                              <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">discretefit</span> <span class="o">=</span> <span class="n">LogitResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bnryfit</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">BinaryResultsWrapper</span><span class="p">(</span><span class="n">discretefit</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_deriv_score_obs_dendog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;derivative of score_obs w.r.t. endog</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : ndarray</span>
<span class="sd">            parameter at which score is evaluated</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        derivative : ndarray_2d</span>
<span class="sd">            The derivative of the score_obs with respect to endog. This</span>
<span class="sd">            can is given by `score_factor0[:, None] * exog` where</span>
<span class="sd">            `score_factor0` is the score_factor without the residual.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span></div>


<div class="viewcode-block" id="Probit"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Probit.html#statsmodels.discrete.discrete_model.Probit">[docs]</a><span class="k">class</span> <span class="nc">Probit</span><span class="p">(</span><span class="n">BinaryModel</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Probit Model</span>

<span class="s2">    </span><span class="si">%(params)s</span>
<span class="s2">    offset : array_like</span>
<span class="s2">        Offset is added to the linear prediction with coefficient equal to 1.</span>
<span class="s2">    </span><span class="si">%(extra_params)s</span>

<span class="s2">    Attributes</span>
<span class="s2">    ----------</span>
<span class="s2">    endog : ndarray</span>
<span class="s2">        A reference to the endogenous response variable</span>
<span class="s2">    exog : ndarray</span>
<span class="s2">        A reference to the exogenous design.</span>
<span class="s2">    &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="n">base</span><span class="o">.</span><span class="n">_model_params_doc</span><span class="p">,</span>
           <span class="s1">&#39;extra_params&#39;</span><span class="p">:</span> <span class="n">base</span><span class="o">.</span><span class="n">_missing_param_doc</span> <span class="o">+</span> <span class="n">_check_rank_doc</span><span class="p">}</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">statsmodels.genmod.families</span> <span class="kn">import</span> <span class="n">links</span>
        <span class="n">link</span> <span class="o">=</span> <span class="n">links</span><span class="o">.</span><span class="n">Probit</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">link</span>

<div class="viewcode-block" id="Probit.cdf"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Probit.cdf.html#statsmodels.discrete.discrete_model.Probit.cdf">[docs]</a>    <span class="k">def</span> <span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probit (Normal) cumulative distribution function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X : array_like</span>
<span class="sd">            The linear predictor of the model (XB).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cdf : ndarray</span>
<span class="sd">            The cdf evaluated at `X`.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function is just an alias for scipy.stats.norm.cdf</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></div>

<div class="viewcode-block" id="Probit.pdf"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Probit.pdf.html#statsmodels.discrete.discrete_model.Probit.pdf">[docs]</a>    <span class="k">def</span> <span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probit (Normal) probability density function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X : array_like</span>
<span class="sd">            The linear predictor of the model (XB).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pdf : ndarray</span>
<span class="sd">            The value of the normal density function for each point of X.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function is just an alias for scipy.stats.norm.pdf</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">_pdf</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></div>


<div class="viewcode-block" id="Probit.loglike"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Probit.loglike.html#statsmodels.discrete.discrete_model.Probit.loglike">[docs]</a>    <span class="k">def</span> <span class="nf">loglike</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log-likelihood of probit model (i.e., the normal distribution).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        loglike : float</span>
<span class="sd">            The log-likelihood function of the model evaluated at `params`.</span>
<span class="sd">            See notes.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math:: \\ln L=\\sum_{i}\\ln\\Phi\\left(q_{i}x_{i}^{\\prime}\\beta\\right)</span>

<span class="sd">        Where :math:`q=2y-1`. This simplification comes from the fact that the</span>
<span class="sd">        normal distribution is symmetric.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">q</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">linpred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">linpred</span><span class="p">),</span> <span class="n">FLOAT_EPS</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span></div>

<div class="viewcode-block" id="Probit.loglikeobs"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Probit.loglikeobs.html#statsmodels.discrete.discrete_model.Probit.loglikeobs">[docs]</a>    <span class="k">def</span> <span class="nf">loglikeobs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log-likelihood of probit model for each observation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        loglike : array_like</span>
<span class="sd">            The log likelihood for each observation of the model evaluated</span>
<span class="sd">            at `params`. See Notes</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math:: \\ln L_{i}=\\ln\\Phi\\left(q_{i}x_{i}^{\\prime}\\beta\\right)</span>

<span class="sd">        for observations :math:`i=1,...,n`</span>

<span class="sd">        where :math:`q=2y-1`. This simplification comes from the fact that the</span>
<span class="sd">        normal distribution is symmetric.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">q</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">linpred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">linpred</span><span class="p">),</span> <span class="n">FLOAT_EPS</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span></div>


<div class="viewcode-block" id="Probit.score"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Probit.score.html#statsmodels.discrete.discrete_model.Probit.score">[docs]</a>    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probit model score (gradient) vector</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        score : ndarray, 1-D</span>
<span class="sd">            The score vector of the model, i.e. the first derivative of the</span>
<span class="sd">            loglikelihood function, evaluated at `params`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math:: \\frac{\\partial\\ln L}{\\partial\\beta}=\\sum_{i=1}^{n}\\left[\\frac{q_{i}\\phi\\left(q_{i}x_{i}^{\\prime}\\beta\\right)}{\\Phi\\left(q_{i}x_{i}^{\\prime}\\beta\\right)}\\right]x_{i}</span>

<span class="sd">        Where :math:`q=2y-1`. This simplification comes from the fact that the</span>
<span class="sd">        normal distribution is symmetric.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">XB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="c1"># clip to get rid of invalid divide complaint</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">q</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">XB</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">XB</span><span class="p">),</span> <span class="n">FLOAT_EPS</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">FLOAT_EPS</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">X</span><span class="p">)</span></div>

<div class="viewcode-block" id="Probit.score_obs"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Probit.score_obs.html#statsmodels.discrete.discrete_model.Probit.score_obs">[docs]</a>    <span class="k">def</span> <span class="nf">score_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probit model Jacobian for each observation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        jac : array_like</span>
<span class="sd">            The derivative of the loglikelihood for each observation evaluated</span>
<span class="sd">            at `params`.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math:: \\frac{\\partial\\ln L_{i}}{\\partial\\beta}=\\left[\\frac{q_{i}\\phi\\left(q_{i}x_{i}^{\\prime}\\beta\\right)}{\\Phi\\left(q_{i}x_{i}^{\\prime}\\beta\\right)}\\right]x_{i}</span>

<span class="sd">        for observations :math:`i=1,...,n`</span>

<span class="sd">        Where :math:`q=2y-1`. This simplification comes from the fact that the</span>
<span class="sd">        normal distribution is symmetric.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">XB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="c1"># clip to get rid of invalid divide complaint</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">q</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">XB</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">XB</span><span class="p">),</span> <span class="n">FLOAT_EPS</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">FLOAT_EPS</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">L</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span></div>

<div class="viewcode-block" id="Probit.score_factor"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Probit.score_factor.html#statsmodels.discrete.discrete_model.Probit.score_factor">[docs]</a>    <span class="k">def</span> <span class="nf">score_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probit model Jacobian for each observation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array-like</span>
<span class="sd">            The parameters of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        score_factor : array_like (nobs,)</span>
<span class="sd">            The derivative of the loglikelihood function for each observation</span>
<span class="sd">            with respect to linear predictor evaluated at `params`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math:: \\frac{\\partial\\ln L_{i}}{\\partial\\beta}=\\left[\\frac{q_{i}\\phi\\left(q_{i}x_{i}^{\\prime}\\beta\\right)}{\\Phi\\left(q_{i}x_{i}^{\\prime}\\beta\\right)}\\right]x_{i}</span>

<span class="sd">        for observations :math:`i=1,...,n`</span>

<span class="sd">        Where :math:`q=2y-1`. This simplification comes from the fact that the</span>
<span class="sd">        normal distribution is symmetric.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span>
        <span class="n">XB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="c1"># clip to get rid of invalid divide complaint</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">q</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">XB</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">XB</span><span class="p">),</span> <span class="n">FLOAT_EPS</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">FLOAT_EPS</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">L</span></div>


<div class="viewcode-block" id="Probit.hessian"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Probit.hessian.html#statsmodels.discrete.discrete_model.Probit.hessian">[docs]</a>    <span class="k">def</span> <span class="nf">hessian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probit model Hessian matrix of the log-likelihood</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        hess : ndarray, (k_vars, k_vars)</span>
<span class="sd">            The Hessian, second derivative of loglikelihood function,</span>
<span class="sd">            evaluated at `params`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math:: \\frac{\\partial^{2}\\ln L}{\\partial\\beta\\partial\\beta^{\\prime}}=-\\lambda_{i}\\left(\\lambda_{i}+x_{i}^{\\prime}\\beta\\right)x_{i}x_{i}^{\\prime}</span>

<span class="sd">        where</span>

<span class="sd">        .. math:: \\lambda_{i}=\\frac{q_{i}\\phi\\left(q_{i}x_{i}^{\\prime}\\beta\\right)}{\\Phi\\left(q_{i}x_{i}^{\\prime}\\beta\\right)}</span>

<span class="sd">        and :math:`q=2y-1`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">XB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">q</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">XB</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">XB</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="o">-</span><span class="n">L</span><span class="o">*</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="n">XB</span><span class="p">)</span><span class="o">*</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">X</span><span class="p">)</span></div>

<div class="viewcode-block" id="Probit.hessian_factor"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Probit.hessian_factor.html#statsmodels.discrete.discrete_model.Probit.hessian_factor">[docs]</a>    <span class="k">def</span> <span class="nf">hessian_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probit model Hessian factor of the log-likelihood</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array-like</span>
<span class="sd">            The parameters of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        hess : ndarray, (nobs,)</span>
<span class="sd">            The Hessian factor, second derivative of loglikelihood function</span>
<span class="sd">            with respect to linear predictor evaluated at `params`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math:: \\frac{\\partial^{2}\\ln L}{\\partial\\beta\\partial\\beta^{\\prime}}=-\\lambda_{i}\\left(\\lambda_{i}+x_{i}^{\\prime}\\beta\\right)x_{i}x_{i}^{\\prime}</span>

<span class="sd">        where</span>

<span class="sd">        .. math:: \\lambda_{i}=\\frac{q_{i}\\phi\\left(q_{i}x_{i}^{\\prime}\\beta\\right)}{\\Phi\\left(q_{i}x_{i}^{\\prime}\\beta\\right)}</span>

<span class="sd">        and :math:`q=2y-1`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">XB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">q</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">XB</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">XB</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">L</span> <span class="o">*</span> <span class="p">(</span><span class="n">L</span> <span class="o">+</span> <span class="n">XB</span><span class="p">)</span></div>

<div class="viewcode-block" id="Probit.fit"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.Probit.fit.html#statsmodels.discrete.discrete_model.Probit.fit">[docs]</a>    <span class="nd">@Appender</span><span class="p">(</span><span class="n">DiscreteModel</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;newton&#39;</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span>
            <span class="n">full_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">bnryfit</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">start_params</span><span class="o">=</span><span class="n">start_params</span><span class="p">,</span>
                              <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                              <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
                              <span class="n">full_output</span><span class="o">=</span><span class="n">full_output</span><span class="p">,</span>
                              <span class="n">disp</span><span class="o">=</span><span class="n">disp</span><span class="p">,</span>
                              <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">discretefit</span> <span class="o">=</span> <span class="n">ProbitResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bnryfit</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">BinaryResultsWrapper</span><span class="p">(</span><span class="n">discretefit</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_deriv_score_obs_dendog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;derivative of score_obs w.r.t. endog</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : ndarray</span>
<span class="sd">            parameter at which score is evaluated</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        derivative : ndarray_2d</span>
<span class="sd">            The derivative of the score_obs with respect to endog. This</span>
<span class="sd">            can is given by `score_factor0[:, None] * exog` where</span>
<span class="sd">            `score_factor0` is the score_factor without the residual.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">linpred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>

        <span class="n">pdf_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">linpred</span><span class="p">)</span>
        <span class="c1"># clip to get rid of invalid divide complaint</span>
        <span class="n">cdf_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">linpred</span><span class="p">),</span> <span class="n">FLOAT_EPS</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">FLOAT_EPS</span><span class="p">)</span>
        <span class="n">deriv</span> <span class="o">=</span> <span class="n">pdf_</span> <span class="o">/</span> <span class="n">cdf_</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cdf_</span><span class="p">)</span>  <span class="c1"># deriv factor</span>
        <span class="k">return</span> <span class="n">deriv</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span></div>


<div class="viewcode-block" id="MNLogit"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.MNLogit.html#statsmodels.discrete.discrete_model.MNLogit">[docs]</a><span class="k">class</span> <span class="nc">MNLogit</span><span class="p">(</span><span class="n">MultinomialModel</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Multinomial Logit Model</span>

<span class="s2">    Parameters</span>
<span class="s2">    ----------</span>
<span class="s2">    endog : array_like</span>
<span class="s2">        `endog` is an 1-d vector of the endogenous response.  `endog` can</span>
<span class="s2">        contain strings, ints, or floats or may be a pandas Categorical Series.</span>
<span class="s2">        Note that if it contains strings, every distinct string will be a</span>
<span class="s2">        category.  No stripping of whitespace is done.</span>
<span class="s2">    exog : array_like</span>
<span class="s2">        A nobs x k array where `nobs` is the number of observations and `k`</span>
<span class="s2">        is the number of regressors. An intercept is not included by default</span>
<span class="s2">        and should be added by the user. See `statsmodels.tools.add_constant`.</span>
<span class="s2">    </span><span class="si">%(extra_params)s</span>

<span class="s2">    Attributes</span>
<span class="s2">    ----------</span>
<span class="s2">    endog : ndarray</span>
<span class="s2">        A reference to the endogenous response variable</span>
<span class="s2">    exog : ndarray</span>
<span class="s2">        A reference to the exogenous design.</span>
<span class="s2">    J : float</span>
<span class="s2">        The number of choices for the endogenous variable. Note that this</span>
<span class="s2">        is zero-indexed.</span>
<span class="s2">    K : float</span>
<span class="s2">        The actual number of parameters for the exogenous design.  Includes</span>
<span class="s2">        the constant if the design has one.</span>
<span class="s2">    names : dict</span>
<span class="s2">        A dictionary mapping the column number in `wendog` to the variables</span>
<span class="s2">        in `endog`.</span>
<span class="s2">    wendog : ndarray</span>
<span class="s2">        An n x j array where j is the number of unique categories in `endog`.</span>
<span class="s2">        Each column of j is a dummy variable indicating the category of</span>
<span class="s2">        each observation. See `names` for a dictionary mapping each column to</span>
<span class="s2">        its category.</span>

<span class="s2">    Notes</span>
<span class="s2">    -----</span>
<span class="s2">    See developer notes for further information on `MNLogit` internals.</span>
<span class="s2">    &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;extra_params&#39;</span><span class="p">:</span> <span class="n">base</span><span class="o">.</span><span class="n">_missing_param_doc</span> <span class="o">+</span> <span class="n">_check_rank_doc</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">check_rank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">check_rank</span><span class="o">=</span><span class="n">check_rank</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Override cov_names since multivariate model</span>
        <span class="n">yname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog_names</span>
        <span class="n">ynames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ynames_map</span>
        <span class="n">ynames</span> <span class="o">=</span> <span class="n">MultinomialResults</span><span class="o">.</span><span class="n">_maybe_convert_ynames_int</span><span class="p">(</span><span class="n">ynames</span><span class="p">)</span>
        <span class="c1"># use range below to ensure sortedness</span>
        <span class="n">ynames</span> <span class="o">=</span> <span class="p">[</span><span class="n">ynames</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">J</span><span class="p">))]</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">((</span><span class="n">ynames</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">xnames</span><span class="p">),</span>
                                      <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="n">yname</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">cov_names</span> <span class="o">=</span> <span class="n">idx</span>

<div class="viewcode-block" id="MNLogit.pdf"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.MNLogit.pdf.html#statsmodels.discrete.discrete_model.MNLogit.pdf">[docs]</a>    <span class="k">def</span> <span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eXB</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        NotImplemented</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="MNLogit.cdf"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.MNLogit.cdf.html#statsmodels.discrete.discrete_model.MNLogit.cdf">[docs]</a>    <span class="k">def</span> <span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Multinomial logit cumulative distribution function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X : ndarray</span>
<span class="sd">            The linear predictor of the model XB.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cdf : ndarray</span>
<span class="sd">            The cdf evaluated at `X`.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        In the multinomial logit model.</span>
<span class="sd">        .. math:: \\frac{\\exp\\left(\\beta_{j}^{\\prime}x_{i}\\right)}{\\sum_{k=0}^{J}\\exp\\left(\\beta_{k}^{\\prime}x_{i}\\right)}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eXB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">X</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">eXB</span><span class="o">/</span><span class="n">eXB</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span></div>

<div class="viewcode-block" id="MNLogit.loglike"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.MNLogit.loglike.html#statsmodels.discrete.discrete_model.MNLogit.loglike">[docs]</a>    <span class="k">def</span> <span class="nf">loglike</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log-likelihood of the multinomial logit model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the multinomial logit model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        loglike : float</span>
<span class="sd">            The log-likelihood function of the model evaluated at `params`.</span>
<span class="sd">            See notes.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math::</span>

<span class="sd">           \\ln L=\\sum_{i=1}^{n}\\sum_{j=0}^{J}d_{ij}\\ln</span>
<span class="sd">           \\left(\\frac{\\exp\\left(\\beta_{j}^{\\prime}x_{i}\\right)}</span>
<span class="sd">           {\\sum_{k=0}^{J}</span>
<span class="sd">           \\exp\\left(\\beta_{k}^{\\prime}x_{i}\\right)}\\right)</span>

<span class="sd">        where :math:`d_{ij}=1` if individual `i` chose alternative `j` and 0</span>
<span class="sd">        if not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wendog</span>
        <span class="n">logprob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span><span class="n">params</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">logprob</span><span class="p">)</span></div>

<div class="viewcode-block" id="MNLogit.loglikeobs"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.MNLogit.loglikeobs.html#statsmodels.discrete.discrete_model.MNLogit.loglikeobs">[docs]</a>    <span class="k">def</span> <span class="nf">loglikeobs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log-likelihood of the multinomial logit model for each observation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the multinomial logit model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        loglike : array_like</span>
<span class="sd">            The log likelihood for each observation of the model evaluated</span>
<span class="sd">            at `params`. See Notes</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math::</span>

<span class="sd">           \\ln L_{i}=\\sum_{j=0}^{J}d_{ij}\\ln</span>
<span class="sd">           \\left(\\frac{\\exp\\left(\\beta_{j}^{\\prime}x_{i}\\right)}</span>
<span class="sd">           {\\sum_{k=0}^{J}</span>
<span class="sd">           \\exp\\left(\\beta_{k}^{\\prime}x_{i}\\right)}\\right)</span>

<span class="sd">        for observations :math:`i=1,...,n`</span>

<span class="sd">        where :math:`d_{ij}=1` if individual `i` chose alternative `j` and 0</span>
<span class="sd">        if not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wendog</span>
        <span class="n">logprob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span><span class="n">params</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">d</span> <span class="o">*</span> <span class="n">logprob</span></div>

<div class="viewcode-block" id="MNLogit.score"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.MNLogit.score.html#statsmodels.discrete.discrete_model.MNLogit.score">[docs]</a>    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Score matrix for multinomial logit model log-likelihood</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : ndarray</span>
<span class="sd">            The parameters of the multinomial logit model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        score : ndarray, (K * (J-1),)</span>
<span class="sd">            The 2-d score vector, i.e. the first derivative of the</span>
<span class="sd">            loglikelihood function, of the multinomial logit model evaluated at</span>
<span class="sd">            `params`.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math:: \\frac{\\partial\\ln L}{\\partial\\beta_{j}}=\\sum_{i}\\left(d_{ij}-\\frac{\\exp\\left(\\beta_{j}^{\\prime}x_{i}\\right)}{\\sum_{k=0}^{J}\\exp\\left(\\beta_{k}^{\\prime}x_{i}\\right)}\\right)x_{i}</span>

<span class="sd">        for :math:`j=1,...,J`</span>

<span class="sd">        In the multinomial model the score matrix is K x J-1 but is returned</span>
<span class="sd">        as a flattened array to work with the solvers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
        <span class="n">firstterm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wendog</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span>
                                                  <span class="n">params</span><span class="p">))[:,</span><span class="mi">1</span><span class="p">:]</span>
        <span class="c1">#NOTE: might need to switch terms if params is reshaped</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">firstterm</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span></div>

<div class="viewcode-block" id="MNLogit.loglike_and_score"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.MNLogit.loglike_and_score.html#statsmodels.discrete.discrete_model.MNLogit.loglike_and_score">[docs]</a>    <span class="k">def</span> <span class="nf">loglike_and_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns log likelihood and score, efficiently reusing calculations.</span>

<span class="sd">        Note that both of these returned quantities will need to be negated</span>
<span class="sd">        before being minimized by the maximum likelihood fitting machinery.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
        <span class="n">cdf_dot_exog_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
        <span class="n">loglike_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wendog</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">cdf_dot_exog_params</span><span class="p">))</span>
        <span class="n">firstterm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wendog</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">cdf_dot_exog_params</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
        <span class="n">score_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">firstterm</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">loglike_value</span><span class="p">,</span> <span class="n">score_array</span></div>

<div class="viewcode-block" id="MNLogit.score_obs"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.MNLogit.score_obs.html#statsmodels.discrete.discrete_model.MNLogit.score_obs">[docs]</a>    <span class="k">def</span> <span class="nf">score_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Jacobian matrix for multinomial logit model log-likelihood</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : ndarray</span>
<span class="sd">            The parameters of the multinomial logit model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        jac : array_like</span>
<span class="sd">            The derivative of the loglikelihood for each observation evaluated</span>
<span class="sd">            at `params` .</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math:: \\frac{\\partial\\ln L_{i}}{\\partial\\beta_{j}}=\\left(d_{ij}-\\frac{\\exp\\left(\\beta_{j}^{\\prime}x_{i}\\right)}{\\sum_{k=0}^{J}\\exp\\left(\\beta_{k}^{\\prime}x_{i}\\right)}\\right)x_{i}</span>

<span class="sd">        for :math:`j=1,...,J`, for observations :math:`i=1,...,n`</span>

<span class="sd">        In the multinomial model the score vector is K x (J-1) but is returned</span>
<span class="sd">        as a flattened array. The Jacobian has the observations in rows and</span>
<span class="sd">        the flattened array of derivatives in columns.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
        <span class="n">firstterm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wendog</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span>
                                                  <span class="n">params</span><span class="p">))[:,</span><span class="mi">1</span><span class="p">:]</span>
        <span class="c1">#NOTE: might need to switch terms if params is reshaped</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">firstterm</span><span class="p">[:,:,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,:])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="MNLogit.hessian"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.MNLogit.hessian.html#statsmodels.discrete.discrete_model.MNLogit.hessian">[docs]</a>    <span class="k">def</span> <span class="nf">hessian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Multinomial logit Hessian matrix of the log-likelihood</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        hess : ndarray, (J*K, J*K)</span>
<span class="sd">            The Hessian, second derivative of loglikelihood function with</span>
<span class="sd">            respect to the flattened parameters, evaluated at `params`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. math:: \\frac{\\partial^{2}\\ln L}{\\partial\\beta_{j}\\partial\\beta_{l}}=-\\sum_{i=1}^{n}\\frac{\\exp\\left(\\beta_{j}^{\\prime}x_{i}\\right)}{\\sum_{k=0}^{J}\\exp\\left(\\beta_{k}^{\\prime}x_{i}\\right)}\\left[\\boldsymbol{1}\\left(j=l\\right)-\\frac{\\exp\\left(\\beta_{l}^{\\prime}x_{i}\\right)}{\\sum_{k=0}^{J}\\exp\\left(\\beta_{k}^{\\prime}x_{i}\\right)}\\right]x_{i}x_{l}^{\\prime}</span>

<span class="sd">        where</span>
<span class="sd">        :math:`\\boldsymbol{1}\\left(j=l\\right)` equals 1 if `j` = `l` and 0</span>
<span class="sd">        otherwise.</span>

<span class="sd">        The actual Hessian matrix has J**2 * K x K elements. Our Hessian</span>
<span class="sd">        is reshaped to be square (J*K, J*K) so that the solvers can use it.</span>

<span class="sd">        This implementation does not take advantage of the symmetry of</span>
<span class="sd">        the Hessian and could probably be refactored for speed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">pr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">params</span><span class="p">))</span>
        <span class="n">partials</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">J</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">J</span>
        <span class="n">K</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="c1"># this loop assumes we drop the first col.</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                    <span class="n">partials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>\
                        <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(((</span><span class="n">pr</span><span class="p">[:,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">pr</span><span class="p">[:,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]))[:,</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">X</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">partials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(((</span><span class="n">pr</span><span class="p">[:,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*-</span><span class="n">pr</span><span class="p">[:,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])[:,</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">X</span><span class="p">))</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">partials</span><span class="p">)</span>
        <span class="c1"># the developer&#39;s notes on multinomial should clear this math up</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">H</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">K</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">,</span> <span class="p">(</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">H</span></div></div>


<span class="c1">#TODO: Weibull can replaced by a survival analsysis function</span>
<span class="c1"># like stat&#39;s streg (The cox model as well)</span>
<span class="c1">#class Weibull(DiscreteModel):</span>
<span class="c1">#    &quot;&quot;&quot;</span>
<span class="c1">#    Binary choice Weibull model</span>
<span class="c1">#</span>
<span class="c1">#    Notes</span>
<span class="c1">#    ------</span>
<span class="c1">#    This is unfinished and untested.</span>
<span class="c1">#    &quot;&quot;&quot;</span>
<span class="c1">##TODO: add analytic hessian for Weibull</span>
<span class="c1">#    def initialize(self):</span>
<span class="c1">#        pass</span>
<span class="c1">#</span>
<span class="c1">#    def cdf(self, X):</span>
<span class="c1">#        &quot;&quot;&quot;</span>
<span class="c1">#        Gumbell (Log Weibull) cumulative distribution function</span>
<span class="c1">#        &quot;&quot;&quot;</span>
<span class="c1">##        return np.exp(-np.exp(-X))</span>
<span class="c1">#        return stats.gumbel_r.cdf(X)</span>
<span class="c1">#        # these two are equivalent.</span>
<span class="c1">#        # Greene table and discussion is incorrect.</span>
<span class="c1">#</span>
<span class="c1">#    def pdf(self, X):</span>
<span class="c1">#        &quot;&quot;&quot;</span>
<span class="c1">#        Gumbell (LogWeibull) probability distribution function</span>
<span class="c1">#        &quot;&quot;&quot;</span>
<span class="c1">#        return stats.gumbel_r.pdf(X)</span>
<span class="c1">#</span>
<span class="c1">#    def loglike(self, params):</span>
<span class="c1">#        &quot;&quot;&quot;</span>
<span class="c1">#        Loglikelihood of Weibull distribution</span>
<span class="c1">#        &quot;&quot;&quot;</span>
<span class="c1">#        X = self.exog</span>
<span class="c1">#        cdf = self.cdf(np.dot(X,params))</span>
<span class="c1">#        y = self.endog</span>
<span class="c1">#        return np.sum(y*np.log(cdf) + (1-y)*np.log(1-cdf))</span>
<span class="c1">#</span>
<span class="c1">#    def score(self, params):</span>
<span class="c1">#        y = self.endog</span>
<span class="c1">#        X = self.exog</span>
<span class="c1">#        F = self.cdf(np.dot(X,params))</span>
<span class="c1">#        f = self.pdf(np.dot(X,params))</span>
<span class="c1">#        term = (y*f/F + (1 - y)*-f/(1-F))</span>
<span class="c1">#        return np.dot(term,X)</span>
<span class="c1">#</span>
<span class="c1">#    def hessian(self, params):</span>
<span class="c1">#        hess = nd.Jacobian(self.score)</span>
<span class="c1">#        return hess(params)</span>
<span class="c1">#</span>
<span class="c1">#    def fit(self, start_params=None, method=&#39;newton&#39;, maxiter=35, tol=1e-08):</span>
<span class="c1">## The example had problems with all zero start values, Hessian = 0</span>
<span class="c1">#        if start_params is None:</span>
<span class="c1">#            start_params = OLS(self.endog, self.exog).fit().params</span>
<span class="c1">#        mlefit = super(Weibull, self).fit(start_params=start_params,</span>
<span class="c1">#                method=method, maxiter=maxiter, tol=tol)</span>
<span class="c1">#        return mlefit</span>
<span class="c1">#</span>


<div class="viewcode-block" id="NegativeBinomial"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.NegativeBinomial.html#statsmodels.discrete.discrete_model.NegativeBinomial">[docs]</a><span class="k">class</span> <span class="nc">NegativeBinomial</span><span class="p">(</span><span class="n">CountModel</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Negative Binomial Model</span>

<span class="s2">    </span><span class="si">%(params)s</span>
<span class="s2">    </span><span class="si">%(extra_params)s</span>

<span class="s2">    Attributes</span>
<span class="s2">    ----------</span>
<span class="s2">    endog : ndarray</span>
<span class="s2">        A reference to the endogenous response variable</span>
<span class="s2">    exog : ndarray</span>
<span class="s2">        A reference to the exogenous design.</span>

<span class="s2">    References</span>
<span class="s2">    ----------</span>
<span class="s2">    Greene, W. 2008. &quot;Functional forms for the negative binomial model</span>
<span class="s2">        for count data&quot;. Economics Letters. Volume 99, Number 3, pp.585-590.</span>
<span class="s2">    Hilbe, J.M. 2011. &quot;Negative binomial regression&quot;. Cambridge University</span>
<span class="s2">        Press.</span>
<span class="s2">    &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="n">base</span><span class="o">.</span><span class="n">_model_params_doc</span><span class="p">,</span>
           <span class="s1">&#39;extra_params&#39;</span><span class="p">:</span>
<span class="w">           </span><span class="sd">&quot;&quot;&quot;loglike_method : str</span>
<span class="sd">        Log-likelihood type. &#39;nb2&#39;,&#39;nb1&#39;, or &#39;geometric&#39;.</span>
<span class="sd">        Fitted value :math:`\\mu`</span>
<span class="sd">        Heterogeneity parameter :math:`\\alpha`</span>

<span class="sd">        - nb2: Variance equal to :math:`\\mu + \\alpha\\mu^2` (most common)</span>
<span class="sd">        - nb1: Variance equal to :math:`\\mu + \\alpha\\mu`</span>
<span class="sd">        - geometric: Variance equal to :math:`\\mu + \\mu^2`</span>
<span class="sd">    offset : array_like</span>
<span class="sd">        Offset is added to the linear prediction with coefficient equal to 1.</span>
<span class="sd">    exposure : array_like</span>
<span class="sd">        Log(exposure) is added to the linear prediction with coefficient</span>
<span class="sd">        equal to 1.</span>
<span class="sd">    &quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">base</span><span class="o">.</span><span class="n">_missing_param_doc</span> <span class="o">+</span> <span class="n">_check_rank_doc</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">loglike_method</span><span class="o">=</span><span class="s1">&#39;nb2&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">exposure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">check_rank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span>
                         <span class="n">exog</span><span class="p">,</span>
                         <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span>
                         <span class="n">exposure</span><span class="o">=</span><span class="n">exposure</span><span class="p">,</span>
                         <span class="n">missing</span><span class="o">=</span><span class="n">missing</span><span class="p">,</span>
                         <span class="n">check_rank</span><span class="o">=</span><span class="n">check_rank</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loglike_method</span> <span class="o">=</span> <span class="n">loglike_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">loglike_method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;nb2&#39;</span><span class="p">,</span> <span class="s1">&#39;nb1&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exog_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_extra</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_extra</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># store keys for extras if we need to recreate model instance</span>
        <span class="c1"># we need to append keys that do not go to super</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;loglike_method&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglike_method</span> <span class="o">==</span> <span class="s1">&#39;nb2&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hessian</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hessian_nb2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_nbin</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loglikeobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_nb2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># transform lnalpha -&gt; alpha in fit</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglike_method</span> <span class="o">==</span> <span class="s1">&#39;nb1&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hessian</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hessian_nb1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_nb1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loglikeobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_nb1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># transform lnalpha -&gt; alpha in fit</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglike_method</span> <span class="o">==</span> <span class="s1">&#39;geometric&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hessian</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hessian_geom</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_geom</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loglikeobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_geometric</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Likelihood type must &quot;nb1&quot;, &quot;nb2&quot; &#39;</span>
                             <span class="s1">&#39;or &quot;geometric&quot;&#39;</span><span class="p">)</span>

    <span class="c1"># Workaround to pickle instance methods</span>
    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">odict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># copy the dict since we change it</span>
        <span class="k">del</span> <span class="n">odict</span><span class="p">[</span><span class="s1">&#39;hessian&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">odict</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">odict</span><span class="p">[</span><span class="s1">&#39;loglikeobs&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">odict</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">indict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_ll_nbin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">iscomplex</span><span class="p">(</span><span class="n">params</span><span class="p">))</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">iscomplex</span><span class="p">(</span><span class="n">alpha</span><span class="p">):</span>
            <span class="n">gamma_ln</span> <span class="o">=</span> <span class="n">loggamma</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gamma_ln</span> <span class="o">=</span> <span class="n">gammaln</span>
        <span class="n">endog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">mu</span><span class="o">**</span><span class="n">Q</span>
        <span class="n">prob</span> <span class="o">=</span> <span class="n">size</span><span class="o">/</span><span class="p">(</span><span class="n">size</span><span class="o">+</span><span class="n">mu</span><span class="p">)</span>
        <span class="n">coeff</span> <span class="o">=</span> <span class="p">(</span><span class="n">gamma_ln</span><span class="p">(</span><span class="n">size</span><span class="o">+</span><span class="n">endog</span><span class="p">)</span> <span class="o">-</span> <span class="n">gamma_ln</span><span class="p">(</span><span class="n">endog</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span>
                 <span class="n">gamma_ln</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
        <span class="n">llf</span> <span class="o">=</span> <span class="n">coeff</span> <span class="o">+</span> <span class="n">size</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span> <span class="o">+</span> <span class="n">endog</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">prob</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">llf</span>

    <span class="k">def</span> <span class="nf">_ll_nb2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span><span class="p">:</span>  <span class="c1"># got lnalpha during fit</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_nbin</span><span class="p">(</span><span class="n">params</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ll_nb1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span><span class="p">:</span>  <span class="c1"># got lnalpha during fit</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_nbin</span><span class="p">(</span><span class="n">params</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ll_geometric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="c1"># we give alpha of 1 because it&#39;s actually log(alpha) where alpha=0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_nbin</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<div class="viewcode-block" id="NegativeBinomial.loglike"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.NegativeBinomial.loglike.html#statsmodels.discrete.discrete_model.NegativeBinomial.loglike">[docs]</a>    <span class="k">def</span> <span class="nf">loglike</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loglikelihood for negative binomial model</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model. If `loglike_method` is nb1 or</span>
<span class="sd">            nb2, then the ancillary parameter is expected to be the</span>
<span class="sd">            last element.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        llf : float</span>
<span class="sd">            The loglikelihood value at `params`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Following notation in Greene (2008), with negative binomial</span>
<span class="sd">        heterogeneity parameter :math:`\alpha`:</span>

<span class="sd">        .. math::</span>

<span class="sd">           \lambda_i &amp;= exp(X\beta) \\</span>
<span class="sd">           \theta &amp;= 1 / \alpha \\</span>
<span class="sd">           g_i &amp;= \theta \lambda_i^Q \\</span>
<span class="sd">           w_i &amp;= g_i/(g_i + \lambda_i) \\</span>
<span class="sd">           r_i &amp;= \theta / (\theta+\lambda_i) \\</span>
<span class="sd">           ln \mathcal{L}_i &amp;= ln \Gamma(y_i+g_i) - ln \Gamma(1+y_i) + g_iln (r_i) + y_i ln(1-r_i)</span>

<span class="sd">        where :math`Q=0` for NB2 and geometric and :math:`Q=1` for NB1.</span>
<span class="sd">        For the geometric, :math:`\alpha=0` as well.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">llf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loglikeobs</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">llf</span></div>

    <span class="k">def</span> <span class="nf">_score_geom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">dparams</span> <span class="o">=</span> <span class="n">exog</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">mu</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dparams</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_score_nbin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Score vector for NB2 model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span><span class="p">:</span> <span class="c1"># lnalpha came in during fit</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">mu</span><span class="o">**</span><span class="n">Q</span>
        <span class="n">prob</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">/</span> <span class="p">(</span><span class="n">a1</span> <span class="o">+</span> <span class="n">mu</span><span class="p">)</span>  <span class="c1"># a1 aka &quot;size&quot; in _ll_nbin</span>
        <span class="k">if</span> <span class="n">Q</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># nb1</span>
            <span class="c1"># Q == 1 --&gt; a1 = mu / alpha --&gt; prob = 1 / (alpha + 1)</span>
            <span class="n">dgpart</span> <span class="o">=</span> <span class="n">digamma</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">a1</span><span class="p">)</span> <span class="o">-</span> <span class="n">digamma</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
            <span class="n">dparams</span> <span class="o">=</span> <span class="n">exog</span> <span class="o">*</span> <span class="n">a1</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span> <span class="o">+</span>
                       <span class="n">dgpart</span><span class="p">)</span>
            <span class="n">dalpha</span> <span class="o">=</span> <span class="p">((</span><span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span> <span class="o">-</span>
                              <span class="n">mu</span><span class="o">*</span><span class="p">(</span><span class="n">dgpart</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">-</span>
                       <span class="n">mu</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span> <span class="o">+</span>
                           <span class="n">dgpart</span><span class="p">))</span><span class="o">/</span>
                       <span class="p">(</span><span class="n">alpha</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">alpha</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">Q</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># nb2</span>
            <span class="n">dgpart</span> <span class="o">=</span> <span class="n">digamma</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">a1</span><span class="p">)</span> <span class="o">-</span> <span class="n">digamma</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
            <span class="n">dparams</span> <span class="o">=</span> <span class="n">exog</span><span class="o">*</span><span class="n">a1</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">mu</span><span class="o">+</span><span class="n">a1</span><span class="p">)</span>
            <span class="n">da1</span> <span class="o">=</span> <span class="o">-</span><span class="n">alpha</span><span class="o">**-</span><span class="mi">2</span>
            <span class="n">dalpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">dgpart</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
                        <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a1</span><span class="o">+</span><span class="n">mu</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a1</span><span class="o">+</span><span class="n">mu</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="n">da1</span>

        <span class="c1">#multiply above by constant outside sum to reduce rounding error</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">dparams</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">dalpha</span><span class="o">*</span><span class="n">alpha</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">dparams</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">dalpha</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_score_nb1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score_nbin</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_hessian_geom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span>

        <span class="c1"># for dl/dparams dparams</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">hess_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">dim</span><span class="p">,</span> <span class="n">dim</span><span class="p">))</span>
        <span class="n">const_arr</span> <span class="o">=</span> <span class="n">mu</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">mu</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">hess_arr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">-</span><span class="n">exog</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">exog</span><span class="p">[:,</span><span class="n">j</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">const_arr</span><span class="p">,</span>
                           <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
                           <span class="p">)</span>
                <span class="p">)</span>
        <span class="n">tri_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu_indices</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">hess_arr</span><span class="p">[</span><span class="n">tri_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">hess_arr</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">tri_idx</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">hess_arr</span>


    <span class="k">def</span> <span class="nf">_hessian_nb1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hessian of NB1 model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span><span class="p">:</span> <span class="c1"># lnalpha came in during fit</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span>

        <span class="n">a1</span> <span class="o">=</span> <span class="n">mu</span><span class="o">/</span><span class="n">alpha</span>
        <span class="n">dgpart</span> <span class="o">=</span> <span class="n">digamma</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">a1</span><span class="p">)</span> <span class="o">-</span> <span class="n">digamma</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
        <span class="n">prob</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span><span class="p">)</span>  <span class="c1"># equiv: a1 / (a1 + mu)</span>

        <span class="c1"># for dl/dparams dparams</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">hess_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="c1">#const_arr = a1*mu*(a1+y)/(mu+a1)**2</span>
        <span class="c1"># not all of dparams</span>
        <span class="n">dparams</span> <span class="o">=</span> <span class="n">exog</span> <span class="o">/</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span> <span class="o">+</span>
                                  <span class="n">dgpart</span><span class="p">)</span>

        <span class="n">dmudb</span> <span class="o">=</span> <span class="n">exog</span><span class="o">*</span><span class="n">mu</span>
        <span class="n">xmu_alpha</span> <span class="o">=</span> <span class="n">exog</span> <span class="o">*</span> <span class="n">a1</span>
        <span class="n">trigamma</span> <span class="o">=</span> <span class="p">(</span><span class="n">special</span><span class="o">.</span><span class="n">polygamma</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">a1</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span>
                    <span class="n">special</span><span class="o">.</span><span class="n">polygamma</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">a1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">hess_arr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                        <span class="n">dparams</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">dmudb</span><span class="p">[:,</span><span class="n">j</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span> <span class="o">+</span>
                        <span class="n">xmu_alpha</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">xmu_alpha</span><span class="p">[:,</span><span class="n">j</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">trigamma</span><span class="p">,</span>
                        <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="n">tri_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu_indices</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">hess_arr</span><span class="p">[</span><span class="n">tri_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">hess_arr</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">tri_idx</span><span class="p">]</span>

        <span class="c1"># for dl/dparams dalpha</span>
        <span class="c1"># da1 = -alpha**-2</span>
        <span class="n">dldpda</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">-</span><span class="n">a1</span> <span class="o">*</span> <span class="n">dparams</span> <span class="o">+</span> <span class="n">exog</span> <span class="o">*</span> <span class="n">a1</span> <span class="o">*</span>
                        <span class="p">(</span><span class="o">-</span><span class="n">trigamma</span><span class="o">*</span><span class="n">mu</span><span class="o">/</span><span class="n">alpha</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">prob</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">hess_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dldpda</span>
        <span class="n">hess_arr</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dldpda</span>

        <span class="n">log_alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span>
        <span class="n">alpha3</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">alpha2</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">mu</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">dada</span> <span class="o">=</span> <span class="p">((</span><span class="n">alpha3</span><span class="o">*</span><span class="n">mu</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">log_alpha</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">dgpart</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span>
                 <span class="mi">2</span><span class="o">*</span><span class="n">alpha3</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span>
                 <span class="mi">4</span><span class="o">*</span><span class="n">alpha2</span><span class="o">*</span><span class="n">mu</span><span class="o">*</span><span class="p">(</span><span class="n">log_alpha</span> <span class="o">+</span> <span class="n">dgpart</span><span class="p">)</span> <span class="o">+</span>
                 <span class="n">alpha2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">mu</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span>
                 <span class="mi">2</span><span class="o">*</span><span class="n">alpha</span><span class="o">*</span><span class="n">mu2</span><span class="o">*</span><span class="n">trigamma</span> <span class="o">+</span> <span class="n">mu2</span> <span class="o">*</span> <span class="n">trigamma</span> <span class="o">+</span> <span class="n">alpha2</span> <span class="o">*</span> <span class="n">mu2</span> <span class="o">*</span> <span class="n">trigamma</span> <span class="o">+</span>
                 <span class="mi">2</span><span class="o">*</span><span class="n">alpha</span><span class="o">*</span><span class="n">mu</span><span class="o">*</span><span class="p">(</span><span class="n">log_alpha</span> <span class="o">+</span> <span class="n">dgpart</span><span class="p">)</span>
                 <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">alpha</span><span class="o">**</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">alpha2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">alpha</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="n">hess_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dada</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">hess_arr</span>

    <span class="k">def</span> <span class="nf">_hessian_nb2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hessian of NB2 model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span><span class="p">:</span> <span class="c1"># lnalpha came in during fit</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">alpha</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span>
        <span class="n">prob</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">/</span> <span class="p">(</span><span class="n">a1</span> <span class="o">+</span> <span class="n">mu</span><span class="p">)</span>
        <span class="n">dgpart</span> <span class="o">=</span> <span class="n">digamma</span><span class="p">(</span><span class="n">a1</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">digamma</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>

        <span class="c1"># for dl/dparams dparams</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">hess_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">const_arr</span> <span class="o">=</span> <span class="n">a1</span><span class="o">*</span><span class="n">mu</span><span class="o">*</span><span class="p">(</span><span class="n">a1</span><span class="o">+</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">mu</span><span class="o">+</span><span class="n">a1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">hess_arr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">-</span><span class="n">exog</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">exog</span><span class="p">[:,</span><span class="n">j</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span>
                                       <span class="n">const_arr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="n">tri_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu_indices</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">hess_arr</span><span class="p">[</span><span class="n">tri_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">hess_arr</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">tri_idx</span><span class="p">]</span>

        <span class="c1"># for dl/dparams dalpha</span>
        <span class="n">da1</span> <span class="o">=</span> <span class="o">-</span><span class="n">alpha</span><span class="o">**-</span><span class="mi">2</span>
        <span class="n">dldpda</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mu</span><span class="o">*</span><span class="n">exog</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span><span class="o">*</span><span class="n">a1</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">mu</span><span class="o">+</span><span class="n">a1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">hess_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dldpda</span>
        <span class="n">hess_arr</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dldpda</span>

        <span class="c1"># for dl/dalpha dalpha</span>
        <span class="c1">#NOTE: polygamma(1,x) is the trigamma function</span>
        <span class="n">da2</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">alpha</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">dalpha</span> <span class="o">=</span> <span class="n">da1</span> <span class="o">*</span> <span class="p">(</span><span class="n">dgpart</span> <span class="o">+</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a1</span><span class="o">+</span><span class="n">mu</span><span class="p">))</span>
        <span class="n">dada</span> <span class="o">=</span> <span class="p">(</span><span class="n">da2</span> <span class="o">*</span> <span class="n">dalpha</span><span class="o">/</span><span class="n">da1</span> <span class="o">+</span> <span class="n">da1</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">special</span><span class="o">.</span><span class="n">polygamma</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">a1</span><span class="o">+</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span>
                    <span class="n">special</span><span class="o">.</span><span class="n">polygamma</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">a1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">a1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">a1</span> <span class="o">+</span> <span class="n">mu</span><span class="p">)</span> <span class="o">+</span>
                    <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">mu</span> <span class="o">+</span> <span class="n">a1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">hess_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dada</span>

        <span class="k">return</span> <span class="n">hess_arr</span>

    <span class="c1">#TODO: replace this with analytic where is it used?</span>
<div class="viewcode-block" id="NegativeBinomial.score_obs"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.NegativeBinomial.score_obs.html#statsmodels.discrete.discrete_model.NegativeBinomial.score_obs">[docs]</a>    <span class="k">def</span> <span class="nf">score_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="n">sc</span> <span class="o">=</span> <span class="n">approx_fprime_cs</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglikeobs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sc</span></div>

<div class="viewcode-block" id="NegativeBinomial.predict"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.NegativeBinomial.predict.html#statsmodels.discrete.discrete_model.NegativeBinomial.predict">[docs]</a>    <span class="nd">@Appender</span><span class="p">(</span><span class="n">Poisson</span><span class="o">.</span><span class="n">predict</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exposure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">which</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">linear</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_values</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">linear</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;linear keyword is deprecated, use which=&quot;linear&quot;&#39;</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">FutureWarning</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">linear</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">which</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span>

        <span class="c1"># avoid duplicate computation for get-distribution</span>
        <span class="k">if</span> <span class="n">which</span> <span class="o">==</span> <span class="s2">&quot;prob&quot;</span><span class="p">:</span>
            <span class="n">distr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_distribution</span><span class="p">(</span>
                <span class="n">params</span><span class="p">,</span>
                <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span>
                <span class="n">exposure</span><span class="o">=</span><span class="n">exposure</span><span class="p">,</span>
                <span class="n">offset</span><span class="o">=</span><span class="n">offset</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">y_values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">y_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y_values</span><span class="p">)</span>

            <span class="k">assert</span> <span class="n">y_values</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="n">y_values</span> <span class="o">=</span> <span class="n">y_values</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">distr</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">y_values</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">exposure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_predict_arrays</span><span class="p">(</span>
            <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span>
            <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span>
            <span class="n">exposure</span><span class="o">=</span><span class="n">exposure</span>
            <span class="p">)</span>

        <span class="n">fitted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="n">params</span><span class="p">[:</span><span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">linpred</span> <span class="o">=</span> <span class="n">fitted</span> <span class="o">+</span> <span class="n">exposure</span> <span class="o">+</span> <span class="n">offset</span>
        <span class="k">if</span> <span class="n">which</span> <span class="o">==</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">linpred</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">which</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;lin&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">linpred</span>
        <span class="k">elif</span> <span class="n">which</span> <span class="o">==</span> <span class="s2">&quot;var&quot;</span><span class="p">:</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">linpred</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglike_method</span> <span class="o">==</span> <span class="s1">&#39;geometric&#39;</span><span class="p">:</span>
                <span class="n">var_</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">mu</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglike_method</span> <span class="o">==</span> <span class="s1">&#39;nb2&#39;</span><span class="p">:</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglike_method</span> <span class="o">==</span> <span class="s1">&#39;nb1&#39;</span><span class="p">:</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">var_</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">mu</span><span class="o">**</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">var_</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;keyword which has to be &quot;mean&quot; and &quot;linear&quot;&#39;</span><span class="p">)</span></div>

    <span class="nd">@Appender</span><span class="p">(</span><span class="n">_get_start_params_null_docs</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_get_start_params_null</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">exposure</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">const</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">exposure</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">const</span><span class="p">)]</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">const</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">exposure</span><span class="p">)</span>
        <span class="n">resid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">-</span> <span class="n">mu</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_dispersion</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">resid</span><span class="p">,</span> <span class="n">df_resid</span><span class="o">=</span><span class="n">resid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_estimate_dispersion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">resid</span><span class="p">,</span> <span class="n">df_resid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">df_resid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df_resid</span> <span class="o">=</span> <span class="n">resid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglike_method</span> <span class="o">==</span> <span class="s1">&#39;nb2&#39;</span><span class="p">:</span>
            <span class="c1">#params.append(np.linalg.pinv(mu[:,None]).dot(resid**2 / mu - 1))</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">((</span><span class="n">resid</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">mu</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df_resid</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1">#self.loglike_method == &#39;nb1&#39;:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">resid</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df_resid</span>
        <span class="k">return</span> <span class="n">a</span>

<div class="viewcode-block" id="NegativeBinomial.fit"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.NegativeBinomial.fit.html#statsmodels.discrete.discrete_model.NegativeBinomial.fit">[docs]</a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bfgs&#39;</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span>
            <span class="n">full_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">cov_type</span><span class="o">=</span><span class="s1">&#39;nonrobust&#39;</span><span class="p">,</span> <span class="n">cov_kwds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">optim_kwds_prelim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="c1"># Note: do not let super handle robust covariance because it has</span>
        <span class="c1"># transformed params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># always define attribute</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglike_method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;nb&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;newton&#39;</span><span class="p">,</span>
                                                                   <span class="s1">&#39;ncg&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># in case same Model instance is refit</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglike_method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;nb&#39;</span><span class="p">):</span> <span class="c1"># method is newton/ncg</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># because we need to step in alpha space</span>

        <span class="k">if</span> <span class="n">start_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Use poisson fit as first guess.</span>
            <span class="c1">#TODO, Warning: this assumes exposure is logged</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">offset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">kwds_prelim</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;disp&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;skip_hessian&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;warn_convergence&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">optim_kwds_prelim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">kwds_prelim</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">optim_kwds_prelim</span><span class="p">)</span>
            <span class="n">mod_poi</span> <span class="o">=</span> <span class="n">Poisson</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;always&quot;</span><span class="p">)</span>
                <span class="n">res_poi</span> <span class="o">=</span> <span class="n">mod_poi</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">**</span><span class="n">kwds_prelim</span><span class="p">)</span>
            <span class="n">start_params</span> <span class="o">=</span> <span class="n">res_poi</span><span class="o">.</span><span class="n">params</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglike_method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;nb&#39;</span><span class="p">):</span>
                <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_dispersion</span><span class="p">(</span><span class="n">res_poi</span><span class="o">.</span><span class="n">predict</span><span class="p">(),</span> <span class="n">res_poi</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span>
                                              <span class="n">df_resid</span><span class="o">=</span><span class="n">res_poi</span><span class="o">.</span><span class="n">df_resid</span><span class="p">)</span>
                <span class="n">start_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start_params</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1"># transform user provided start_params dispersion, see #3918</span>
                <span class="n">start_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">start_params</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">start_params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">start_params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">callback</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># work around perfect separation callback #3895</span>
            <span class="n">callback</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">x</span><span class="p">:</span> <span class="n">x</span>

        <span class="n">mlefit</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">start_params</span><span class="o">=</span><span class="n">start_params</span><span class="p">,</span>
                             <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="n">disp</span><span class="p">,</span>
                             <span class="n">full_output</span><span class="o">=</span><span class="n">full_output</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">optim_kwds_prelim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mlefit</span><span class="o">.</span><span class="n">mle_settings</span><span class="p">[</span><span class="s2">&quot;optim_kwds_prelim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">optim_kwds_prelim</span>
        <span class="c1"># TODO: Fix NBin _check_perfect_pred</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglike_method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;nb&#39;</span><span class="p">):</span>
            <span class="c1"># mlefit is a wrapped counts results</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># do not need to transform anymore now</span>
            <span class="c1"># change from lnalpha to alpha</span>
            <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;newton&quot;</span><span class="p">,</span> <span class="s2">&quot;ncg&quot;</span><span class="p">]:</span>
                <span class="n">mlefit</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mlefit</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">nbinfit</span> <span class="o">=</span> <span class="n">NegativeBinomialResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mlefit</span><span class="o">.</span><span class="n">_results</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">NegativeBinomialResultsWrapper</span><span class="p">(</span><span class="n">nbinfit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">mlefit</span>

        <span class="k">if</span> <span class="n">cov_kwds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cov_kwds</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1">#TODO: make this unnecessary ?</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_get_robustcov_results</span><span class="p">(</span><span class="n">cov_type</span><span class="o">=</span><span class="n">cov_type</span><span class="p">,</span> <span class="n">use_self</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_t</span><span class="o">=</span><span class="n">use_t</span><span class="p">,</span> <span class="o">**</span><span class="n">cov_kwds</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="NegativeBinomial.fit_regularized"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.NegativeBinomial.fit_regularized.html#statsmodels.discrete.discrete_model.NegativeBinomial.fit_regularized">[docs]</a>    <span class="k">def</span> <span class="nf">fit_regularized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span>
            <span class="n">maxiter</span><span class="o">=</span><span class="s1">&#39;defined_by_method&#39;</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">trim_mode</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">auto_trim_tol</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">size_trim_tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
            <span class="n">qc_tol</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">_validate_l1_method</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglike_method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;nb&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>
                                                     <span class="n">alpha</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="c1"># do not penalize alpha if alpha is scalar</span>
            <span class="n">k_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_extra</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">k_params</span><span class="p">)</span>
            <span class="n">alpha</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># alpha for regularized poisson to get starting values</span>
        <span class="n">alpha_p</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_extra</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="n">alpha</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">start_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Use poisson fit as first guess.</span>
            <span class="c1">#TODO, Warning: this assumes exposure is logged</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">offset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">mod_poi</span> <span class="o">=</span> <span class="n">Poisson</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;always&quot;</span><span class="p">)</span>
                <span class="n">start_params</span> <span class="o">=</span> <span class="n">mod_poi</span><span class="o">.</span><span class="n">fit_regularized</span><span class="p">(</span>
                    <span class="n">start_params</span><span class="o">=</span><span class="n">start_params</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
                    <span class="n">full_output</span><span class="o">=</span><span class="n">full_output</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="n">alpha_p</span><span class="p">,</span> <span class="n">trim_mode</span><span class="o">=</span><span class="n">trim_mode</span><span class="p">,</span>
                    <span class="n">auto_trim_tol</span><span class="o">=</span><span class="n">auto_trim_tol</span><span class="p">,</span> <span class="n">size_trim_tol</span><span class="o">=</span><span class="n">size_trim_tol</span><span class="p">,</span>
                    <span class="n">qc_tol</span><span class="o">=</span><span class="n">qc_tol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">params</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglike_method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;nb&#39;</span><span class="p">):</span>
                <span class="n">start_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start_params</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

        <span class="n">cntfit</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CountModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fit_regularized</span><span class="p">(</span>
                <span class="n">start_params</span><span class="o">=</span><span class="n">start_params</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
                <span class="n">full_output</span><span class="o">=</span><span class="n">full_output</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="n">disp</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">trim_mode</span><span class="o">=</span><span class="n">trim_mode</span><span class="p">,</span> <span class="n">auto_trim_tol</span><span class="o">=</span><span class="n">auto_trim_tol</span><span class="p">,</span>
                <span class="n">size_trim_tol</span><span class="o">=</span><span class="n">size_trim_tol</span><span class="p">,</span> <span class="n">qc_tol</span><span class="o">=</span><span class="n">qc_tol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">discretefit</span> <span class="o">=</span> <span class="n">L1NegativeBinomialResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cntfit</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">L1NegativeBinomialResultsWrapper</span><span class="p">(</span><span class="n">discretefit</span><span class="p">)</span></div>

<div class="viewcode-block" id="NegativeBinomial.get_distribution"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.NegativeBinomial.get_distribution.html#statsmodels.discrete.discrete_model.NegativeBinomial.get_distribution">[docs]</a>    <span class="nd">@Appender</span><span class="p">(</span><span class="n">Poisson</span><span class="o">.</span><span class="n">get_distribution</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exposure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;get frozen instance of distribution</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span> <span class="n">exposure</span><span class="o">=</span><span class="n">exposure</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglike_method</span> <span class="o">==</span> <span class="s1">&#39;geometric&#39;</span><span class="p">:</span>
            <span class="c1"># distr = stats.geom(1 / (1 + mu[:, None]), loc=-1)</span>
            <span class="n">distr</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">geom</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">mu</span><span class="p">),</span> <span class="n">loc</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglike_method</span> <span class="o">==</span> <span class="s1">&#39;nb2&#39;</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglike_method</span> <span class="o">==</span> <span class="s1">&#39;nb1&#39;</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">q</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">p</span>
            <span class="n">size</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">mu</span><span class="o">**</span><span class="n">q</span>
            <span class="n">prob</span> <span class="o">=</span> <span class="n">size</span> <span class="o">/</span> <span class="p">(</span><span class="n">size</span> <span class="o">+</span> <span class="n">mu</span><span class="p">)</span>
            <span class="c1"># distr = nbinom(size[:, None], prob[:, None])</span>
            <span class="n">distr</span> <span class="o">=</span> <span class="n">nbinom</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">prob</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">distr</span></div></div>


<div class="viewcode-block" id="NegativeBinomialP"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.NegativeBinomialP.html#statsmodels.discrete.discrete_model.NegativeBinomialP">[docs]</a><span class="k">class</span> <span class="nc">NegativeBinomialP</span><span class="p">(</span><span class="n">CountModel</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Generalized Negative Binomial (NB-P) Model</span>

<span class="s2">    </span><span class="si">%(params)s</span>
<span class="s2">    </span><span class="si">%(extra_params)s</span>

<span class="s2">    Attributes</span>
<span class="s2">    ----------</span>
<span class="s2">    endog : ndarray</span>
<span class="s2">        A reference to the endogenous response variable</span>
<span class="s2">    exog : ndarray</span>
<span class="s2">        A reference to the exogenous design.</span>
<span class="s2">    p : scalar</span>
<span class="s2">        P denotes parameterizations for NB-P regression. p=1 for NB-1 and</span>
<span class="s2">        p=2 for NB-2. Default is p=1.</span>
<span class="s2">    &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="n">base</span><span class="o">.</span><span class="n">_model_params_doc</span><span class="p">,</span>
           <span class="s1">&#39;extra_params&#39;</span><span class="p">:</span>
<span class="w">               </span><span class="sd">&quot;&quot;&quot;p : scalar</span>
<span class="sd">        P denotes parameterizations for NB regression. p=1 for NB-1 and</span>
<span class="sd">        p=2 for NB-2. Default is p=2.</span>
<span class="sd">    offset : array_like</span>
<span class="sd">        Offset is added to the linear prediction with coefficient equal to 1.</span>
<span class="sd">    exposure : array_like</span>
<span class="sd">        Log(exposure) is added to the linear prediction with coefficient</span>
<span class="sd">        equal to 1.</span>
<span class="sd">        &quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">base</span><span class="o">.</span><span class="n">_missing_param_doc</span> <span class="o">+</span> <span class="n">_check_rank_doc</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">exposure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">check_rank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span>
                         <span class="n">exog</span><span class="p">,</span>
                         <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span>
                         <span class="n">exposure</span><span class="o">=</span><span class="n">exposure</span><span class="p">,</span>
                         <span class="n">missing</span><span class="o">=</span><span class="n">missing</span><span class="p">,</span>
                         <span class="n">check_rank</span><span class="o">=</span><span class="n">check_rank</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exog_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_extra</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_get_init_kwds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">kwds</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_get_init_kwds</span><span class="p">()</span>
        <span class="n">kwds</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span>
        <span class="k">return</span> <span class="n">kwds</span>

    <span class="k">def</span> <span class="nf">_get_exogs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<div class="viewcode-block" id="NegativeBinomialP.loglike"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.NegativeBinomialP.loglike.html#statsmodels.discrete.discrete_model.NegativeBinomialP.loglike">[docs]</a>    <span class="k">def</span> <span class="nf">loglike</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loglikelihood of Generalized Negative Binomial (NB-P) model</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        loglike : float</span>
<span class="sd">            The log-likelihood function of the model evaluated at `params`.</span>
<span class="sd">            See notes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loglikeobs</span><span class="p">(</span><span class="n">params</span><span class="p">))</span></div>

<div class="viewcode-block" id="NegativeBinomialP.loglikeobs"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.NegativeBinomialP.loglikeobs.html#statsmodels.discrete.discrete_model.NegativeBinomialP.loglikeobs">[docs]</a>    <span class="k">def</span> <span class="nf">loglikeobs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loglikelihood for observations of Generalized Negative Binomial (NB-P) model</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        loglike : ndarray</span>
<span class="sd">            The log likelihood for each observation of the model evaluated</span>
<span class="sd">            at `params`. See Notes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span>

        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">mu_p</span> <span class="o">=</span> <span class="n">mu</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">mu_p</span> <span class="o">/</span> <span class="n">alpha</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">a1</span>

        <span class="n">llf</span> <span class="o">=</span> <span class="p">(</span><span class="n">gammaln</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">a1</span><span class="p">)</span> <span class="o">-</span> <span class="n">gammaln</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">gammaln</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span> <span class="o">+</span>
               <span class="n">a1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="o">-</span>
               <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">a1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a2</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">llf</span></div>

<div class="viewcode-block" id="NegativeBinomialP.score_obs"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.NegativeBinomialP.score_obs.html#statsmodels.discrete.discrete_model.NegativeBinomialP.score_obs">[docs]</a>    <span class="k">def</span> <span class="nf">score_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generalized Negative Binomial (NB-P) model score (gradient) vector of the log-likelihood for each observations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        score : ndarray, 1-D</span>
<span class="sd">            The score vector of the model, i.e. the first derivative of the</span>
<span class="sd">            loglikelihood function, evaluated at `params`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span>

        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">mu_p</span> <span class="o">=</span> <span class="n">mu</span><span class="o">**</span><span class="n">p</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">mu_p</span> <span class="o">/</span> <span class="n">alpha</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">a1</span>
        <span class="n">a3</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">a1</span>
        <span class="n">a4</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">a1</span> <span class="o">/</span> <span class="n">mu</span>

        <span class="n">dgpart</span> <span class="o">=</span> <span class="n">digamma</span><span class="p">(</span><span class="n">a3</span><span class="p">)</span> <span class="o">-</span> <span class="n">digamma</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
        <span class="n">dgterm</span> <span class="o">=</span> <span class="n">dgpart</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a1</span> <span class="o">/</span> <span class="n">a2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">a3</span> <span class="o">/</span> <span class="n">a2</span>
        <span class="c1"># TODO: better name/interpretation for dgterm?</span>

        <span class="n">dparams</span> <span class="o">=</span> <span class="p">(</span><span class="n">a4</span> <span class="o">*</span> <span class="n">dgterm</span> <span class="o">-</span>
                   <span class="n">a3</span> <span class="o">/</span> <span class="n">a2</span> <span class="o">+</span>
                   <span class="n">y</span> <span class="o">/</span> <span class="n">mu</span><span class="p">)</span>
        <span class="n">dparams</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">dparams</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dalpha</span> <span class="o">=</span> <span class="o">-</span><span class="n">a1</span> <span class="o">/</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">dgterm</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">dparams</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">dalpha</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">),</span>
                              <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="NegativeBinomialP.score"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.NegativeBinomialP.score.html#statsmodels.discrete.discrete_model.NegativeBinomialP.score">[docs]</a>    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generalized Negative Binomial (NB-P) model score (gradient) vector of the log-likelihood</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        score : ndarray, 1-D</span>
<span class="sd">            The score vector of the model, i.e. the first derivative of the</span>
<span class="sd">            loglikelihood function, evaluated at `params`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">score_obs</span><span class="p">(</span><span class="n">params</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span><span class="p">:</span>
            <span class="n">score</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">score</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="k">return</span> <span class="n">score</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">score</span></div>

<div class="viewcode-block" id="NegativeBinomialP.score_factor"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.NegativeBinomialP.score_factor.html#statsmodels.discrete.discrete_model.NegativeBinomialP.score_factor">[docs]</a>    <span class="k">def</span> <span class="nf">score_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">endog</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generalized Negative Binomial (NB-P) model score (gradient) vector of the log-likelihood for each observations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array-like</span>
<span class="sd">            The parameters of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        score : ndarray, 1-D</span>
<span class="sd">            The score vector of the model, i.e. the first derivative of the</span>
<span class="sd">            loglikelihood function, evaluated at `params`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="k">if</span> <span class="n">endog</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">endog</span>

        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">mu_p</span> <span class="o">=</span> <span class="n">mu</span><span class="o">**</span><span class="n">p</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">mu_p</span> <span class="o">/</span> <span class="n">alpha</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">a1</span>
        <span class="n">a3</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">a1</span>
        <span class="n">a4</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">a1</span> <span class="o">/</span> <span class="n">mu</span>

        <span class="n">dgpart</span> <span class="o">=</span> <span class="n">digamma</span><span class="p">(</span><span class="n">a3</span><span class="p">)</span> <span class="o">-</span> <span class="n">digamma</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>

        <span class="n">dparams</span> <span class="o">=</span> <span class="p">((</span><span class="n">a4</span> <span class="o">*</span> <span class="n">dgpart</span> <span class="o">-</span>
                   <span class="n">a3</span> <span class="o">/</span> <span class="n">a2</span><span class="p">)</span> <span class="o">+</span>
                   <span class="n">y</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">a4</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a3</span> <span class="o">/</span> <span class="n">a2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a1</span> <span class="o">/</span> <span class="n">a2</span><span class="p">)))</span>
        <span class="n">dparams</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu</span> <span class="o">*</span> <span class="n">dparams</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dalpha</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">a1</span> <span class="o">/</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="n">dgpart</span> <span class="o">+</span>
                                 <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a1</span> <span class="o">/</span> <span class="n">a2</span><span class="p">)</span> <span class="o">+</span>
                                 <span class="mi">1</span> <span class="o">-</span> <span class="n">a3</span> <span class="o">/</span> <span class="n">a2</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">dparams</span><span class="p">,</span> <span class="n">dalpha</span></div>

<div class="viewcode-block" id="NegativeBinomialP.hessian"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.NegativeBinomialP.hessian.html#statsmodels.discrete.discrete_model.NegativeBinomialP.hessian">[docs]</a>    <span class="k">def</span> <span class="nf">hessian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generalized Negative Binomial (NB-P) model hessian maxtrix of the log-likelihood</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array_like</span>
<span class="sd">            The parameters of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        hessian : ndarray, 2-D</span>
<span class="sd">            The hessian matrix of the model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span>
        <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="n">mu_p</span> <span class="o">=</span> <span class="n">mu</span><span class="o">**</span><span class="n">p</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">mu_p</span> <span class="o">/</span> <span class="n">alpha</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">a1</span>
        <span class="n">a3</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">a1</span>
        <span class="n">a4</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">a1</span> <span class="o">/</span> <span class="n">mu</span>

        <span class="n">prob</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">/</span> <span class="n">a2</span>
        <span class="n">lprob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span>
        <span class="n">dgpart</span> <span class="o">=</span> <span class="n">digamma</span><span class="p">(</span><span class="n">a3</span><span class="p">)</span> <span class="o">-</span> <span class="n">digamma</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
        <span class="n">pgpart</span> <span class="o">=</span> <span class="n">polygamma</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">a3</span><span class="p">)</span> <span class="o">-</span> <span class="n">polygamma</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">a1</span><span class="p">)</span>

        <span class="n">dim</span> <span class="o">=</span> <span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">hess_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

        <span class="n">coeff</span> <span class="o">=</span> <span class="n">mu</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a3</span> <span class="o">/</span> <span class="n">a2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span>
                          <span class="n">a3</span> <span class="o">/</span> <span class="n">a2</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">a4</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">-</span>
                          <span class="n">y</span> <span class="o">/</span> <span class="n">mu</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span>
                          <span class="mi">2</span> <span class="o">*</span> <span class="n">a4</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span> <span class="o">/</span> <span class="n">a2</span> <span class="o">+</span>
                          <span class="n">p</span> <span class="o">*</span> <span class="n">a4</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">*</span> <span class="p">(</span><span class="n">lprob</span> <span class="o">+</span> <span class="n">dgpart</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span>
                          <span class="n">a4</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">*</span> <span class="p">(</span><span class="n">lprob</span> <span class="o">+</span> <span class="n">dgpart</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span>
                          <span class="n">a4</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pgpart</span><span class="p">)</span> <span class="o">+</span>
                         <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span> <span class="o">*</span> <span class="n">a3</span> <span class="o">/</span> <span class="n">a2</span> <span class="o">+</span>
                          <span class="n">y</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">+</span>
                          <span class="n">a4</span> <span class="o">*</span> <span class="p">(</span><span class="n">lprob</span> <span class="o">+</span> <span class="n">dgpart</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">mu</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>
            <span class="n">hess_arr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">[:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


        <span class="n">hess_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">[:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">a1</span> <span class="o">*</span>
                <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a3</span> <span class="o">/</span> <span class="n">a2</span><span class="p">)</span> <span class="o">/</span> <span class="n">a2</span> <span class="o">-</span>
                 <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">lprob</span> <span class="o">+</span> <span class="n">dgpart</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">+</span>
                 <span class="n">p</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">*</span> <span class="p">(</span><span class="n">a3</span> <span class="o">+</span> <span class="n">p</span> <span class="o">*</span> <span class="n">a1</span><span class="p">)</span> <span class="o">/</span> <span class="n">a2</span> <span class="o">-</span>
                 <span class="n">a4</span> <span class="o">*</span> <span class="n">pgpart</span><span class="p">)</span> <span class="o">/</span> <span class="n">alpha</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


        <span class="n">da2</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">lprob</span> <span class="o">+</span>
                     <span class="mi">2</span> <span class="o">*</span> <span class="n">dgpart</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">-</span>
                     <span class="mi">2</span> <span class="o">*</span> <span class="n">a3</span> <span class="o">/</span> <span class="n">a2</span>
                     <span class="o">+</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">pgpart</span>
                     <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">prob</span> <span class="o">+</span>
                     <span class="n">prob</span> <span class="o">*</span> <span class="n">a3</span> <span class="o">/</span> <span class="n">a2</span><span class="p">)</span> <span class="o">/</span> <span class="n">alpha</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">hess_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">da2</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="n">tri_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu_indices</span><span class="p">(</span><span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">hess_arr</span><span class="p">[</span><span class="n">tri_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">hess_arr</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">tri_idx</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">hess_arr</span></div>

<div class="viewcode-block" id="NegativeBinomialP.hessian_factor"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.NegativeBinomialP.hessian_factor.html#statsmodels.discrete.discrete_model.NegativeBinomialP.hessian_factor">[docs]</a>    <span class="k">def</span> <span class="nf">hessian_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generalized Negative Binomial (NB-P) model hessian maxtrix of the log-likelihood</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array-like</span>
<span class="sd">            The parameters of the model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        hessian : ndarray, 2-D</span>
<span class="sd">            The hessian matrix of the model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="n">mu_p</span> <span class="o">=</span> <span class="n">mu</span><span class="o">**</span><span class="n">p</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">mu_p</span> <span class="o">/</span> <span class="n">alpha</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">a1</span>
        <span class="n">a3</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">a1</span>
        <span class="n">a4</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">a1</span> <span class="o">/</span> <span class="n">mu</span>
        <span class="n">a5</span> <span class="o">=</span> <span class="n">a4</span> <span class="o">*</span> <span class="n">p</span> <span class="o">/</span> <span class="n">mu</span>

        <span class="n">dgpart</span> <span class="o">=</span> <span class="n">digamma</span><span class="p">(</span><span class="n">a3</span><span class="p">)</span> <span class="o">-</span> <span class="n">digamma</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>

        <span class="n">coeff</span> <span class="o">=</span> <span class="n">mu</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a3</span> <span class="o">/</span> <span class="n">a2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span>
                          <span class="n">a3</span> <span class="o">*</span> <span class="p">(</span><span class="n">a5</span> <span class="o">-</span> <span class="n">a4</span> <span class="o">/</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">a2</span> <span class="o">-</span>
                          <span class="n">y</span> <span class="o">/</span> <span class="n">mu</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span>
                          <span class="mi">2</span> <span class="o">*</span> <span class="n">a4</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span> <span class="o">/</span> <span class="n">a2</span> <span class="o">+</span>
                          <span class="n">a5</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span> <span class="o">+</span> <span class="n">dgpart</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span>
                          <span class="n">a4</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span> <span class="o">+</span> <span class="n">dgpart</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">-</span>
                          <span class="n">a4</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">polygamma</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">a1</span><span class="p">)</span> <span class="o">-</span> <span class="n">polygamma</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">a3</span><span class="p">)))</span> <span class="o">+</span>
                         <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span> <span class="o">*</span> <span class="n">a3</span> <span class="o">/</span> <span class="n">a2</span> <span class="o">+</span>
                          <span class="n">y</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">+</span>
                          <span class="n">a4</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span> <span class="o">+</span> <span class="n">dgpart</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">mu</span><span class="p">)</span>

        <span class="n">hfbb</span> <span class="o">=</span> <span class="n">coeff</span>

        <span class="n">hfba</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu</span> <span class="o">*</span> <span class="n">a1</span> <span class="o">*</span>
                <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a3</span> <span class="o">/</span> <span class="n">a2</span><span class="p">)</span> <span class="o">/</span> <span class="n">a2</span> <span class="o">-</span>
                 <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a1</span> <span class="o">/</span> <span class="n">a2</span><span class="p">)</span> <span class="o">+</span> <span class="n">dgpart</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">+</span>
                 <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">a3</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span> <span class="o">/</span> <span class="n">a2</span> <span class="o">+</span>
                 <span class="n">a4</span> <span class="o">*</span> <span class="p">(</span><span class="n">polygamma</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">a1</span><span class="p">)</span> <span class="o">-</span> <span class="n">polygamma</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">a3</span><span class="p">)))</span> <span class="o">/</span> <span class="n">alpha</span><span class="p">)</span>

        <span class="n">hfaa</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a1</span> <span class="o">/</span> <span class="n">a2</span><span class="p">)</span> <span class="o">+</span>
                     <span class="mi">2</span> <span class="o">*</span> <span class="n">dgpart</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">-</span>
                     <span class="mi">2</span> <span class="o">*</span> <span class="n">a3</span> <span class="o">/</span> <span class="n">a2</span> <span class="o">-</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">polygamma</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">a1</span><span class="p">)</span> <span class="o">+</span>
                     <span class="n">a1</span> <span class="o">*</span> <span class="n">polygamma</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">a3</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a1</span> <span class="o">/</span> <span class="n">a2</span> <span class="o">+</span>
                     <span class="n">a1</span> <span class="o">*</span> <span class="n">a3</span> <span class="o">/</span> <span class="n">a2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">alpha</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">hfbb</span><span class="p">,</span> <span class="n">hfba</span><span class="p">,</span> <span class="n">hfaa</span></div>

    <span class="nd">@Appender</span><span class="p">(</span><span class="n">_get_start_params_null_docs</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_get_start_params_null</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">exposure</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">const</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">exposure</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">const</span><span class="p">)]</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">const</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">exposure</span><span class="p">)</span>
        <span class="n">resid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">-</span> <span class="n">mu</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_dispersion</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">resid</span><span class="p">,</span> <span class="n">df_resid</span><span class="o">=</span><span class="n">resid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_estimate_dispersion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">resid</span><span class="p">,</span> <span class="n">df_resid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">df_resid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df_resid</span> <span class="o">=</span> <span class="n">resid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">((</span><span class="n">resid</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">mu</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df_resid</span>
        <span class="k">return</span> <span class="n">a</span>

<div class="viewcode-block" id="NegativeBinomialP.fit"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.NegativeBinomialP.fit.html#statsmodels.discrete.discrete_model.NegativeBinomialP.fit">[docs]</a>    <span class="nd">@Appender</span><span class="p">(</span><span class="n">DiscreteModel</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bfgs&#39;</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span>
            <span class="n">full_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_transparams</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">cov_type</span><span class="o">=</span><span class="s1">&#39;nonrobust&#39;</span><span class="p">,</span> <span class="n">cov_kwds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">optim_kwds_prelim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># TODO: Fix doc string</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        use_transparams : bool</span>
<span class="sd">            This parameter enable internal transformation to impose</span>
<span class="sd">            non-negativity. True to enable. Default is False.</span>
<span class="sd">            use_transparams=True imposes the no underdispersion (alpha &gt; 0)</span>
<span class="sd">            constraint. In case use_transparams=True and method=&quot;newton&quot; or</span>
<span class="sd">            &quot;ncg&quot; transformation is ignored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">use_transparams</span> <span class="ow">and</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;newton&#39;</span><span class="p">,</span> <span class="s1">&#39;ncg&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_transparams</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Parameter &quot;use_transparams&quot; is ignored&#39;</span><span class="p">,</span>
                              <span class="ne">RuntimeWarning</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">start_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">offset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">kwds_prelim</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;disp&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;skip_hessian&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;warn_convergence&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">optim_kwds_prelim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">kwds_prelim</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">optim_kwds_prelim</span><span class="p">)</span>
            <span class="n">mod_poi</span> <span class="o">=</span> <span class="n">Poisson</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;always&quot;</span><span class="p">)</span>
                <span class="n">res_poi</span> <span class="o">=</span> <span class="n">mod_poi</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">**</span><span class="n">kwds_prelim</span><span class="p">)</span>
            <span class="n">start_params</span> <span class="o">=</span> <span class="n">res_poi</span><span class="o">.</span><span class="n">params</span>
            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_dispersion</span><span class="p">(</span><span class="n">res_poi</span><span class="o">.</span><span class="n">predict</span><span class="p">(),</span> <span class="n">res_poi</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span>
                                          <span class="n">df_resid</span><span class="o">=</span><span class="n">res_poi</span><span class="o">.</span><span class="n">df_resid</span><span class="p">)</span>
            <span class="n">start_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start_params</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">callback</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># work around perfect separation callback #3895</span>
            <span class="n">callback</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">x</span><span class="p">:</span> <span class="n">x</span>

        <span class="n">mlefit</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">NegativeBinomialP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">start_params</span><span class="o">=</span><span class="n">start_params</span><span class="p">,</span>
                        <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="n">disp</span><span class="p">,</span>
                        <span class="n">full_output</span><span class="o">=</span><span class="n">full_output</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">optim_kwds_prelim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mlefit</span><span class="o">.</span><span class="n">mle_settings</span><span class="p">[</span><span class="s2">&quot;optim_kwds_prelim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">optim_kwds_prelim</span>
        <span class="k">if</span> <span class="n">use_transparams</span> <span class="ow">and</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;newton&quot;</span><span class="p">,</span> <span class="s2">&quot;ncg&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">mlefit</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mlefit</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">nbinfit</span> <span class="o">=</span> <span class="n">NegativeBinomialPResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mlefit</span><span class="o">.</span><span class="n">_results</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">NegativeBinomialPResultsWrapper</span><span class="p">(</span><span class="n">nbinfit</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cov_kwds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cov_kwds</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_get_robustcov_results</span><span class="p">(</span><span class="n">cov_type</span><span class="o">=</span><span class="n">cov_type</span><span class="p">,</span>
                                    <span class="n">use_self</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_t</span><span class="o">=</span><span class="n">use_t</span><span class="p">,</span> <span class="o">**</span><span class="n">cov_kwds</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="NegativeBinomialP.fit_regularized"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.NegativeBinomialP.fit_regularized.html#statsmodels.discrete.discrete_model.NegativeBinomialP.fit_regularized">[docs]</a>    <span class="nd">@Appender</span><span class="p">(</span><span class="n">DiscreteModel</span><span class="o">.</span><span class="n">fit_regularized</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit_regularized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span>
            <span class="n">maxiter</span><span class="o">=</span><span class="s1">&#39;defined_by_method&#39;</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">trim_mode</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">auto_trim_tol</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">size_trim_tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
            <span class="n">qc_tol</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">_validate_l1_method</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">alpha</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">k_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_extra</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">k_params</span><span class="p">)</span>
            <span class="n">alpha</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">alpha_p</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_extra</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="n">alpha</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_transparams</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">start_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">offset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">mod_poi</span> <span class="o">=</span> <span class="n">Poisson</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;always&quot;</span><span class="p">)</span>
                <span class="n">start_params</span> <span class="o">=</span> <span class="n">mod_poi</span><span class="o">.</span><span class="n">fit_regularized</span><span class="p">(</span>
                    <span class="n">start_params</span><span class="o">=</span><span class="n">start_params</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
                    <span class="n">full_output</span><span class="o">=</span><span class="n">full_output</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="n">alpha_p</span><span class="p">,</span> <span class="n">trim_mode</span><span class="o">=</span><span class="n">trim_mode</span><span class="p">,</span>
                    <span class="n">auto_trim_tol</span><span class="o">=</span><span class="n">auto_trim_tol</span><span class="p">,</span> <span class="n">size_trim_tol</span><span class="o">=</span><span class="n">size_trim_tol</span><span class="p">,</span>
                    <span class="n">qc_tol</span><span class="o">=</span><span class="n">qc_tol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">params</span>
            <span class="n">start_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start_params</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

        <span class="n">cntfit</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CountModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fit_regularized</span><span class="p">(</span>
                <span class="n">start_params</span><span class="o">=</span><span class="n">start_params</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
                <span class="n">full_output</span><span class="o">=</span><span class="n">full_output</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="n">disp</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">trim_mode</span><span class="o">=</span><span class="n">trim_mode</span><span class="p">,</span> <span class="n">auto_trim_tol</span><span class="o">=</span><span class="n">auto_trim_tol</span><span class="p">,</span>
                <span class="n">size_trim_tol</span><span class="o">=</span><span class="n">size_trim_tol</span><span class="p">,</span> <span class="n">qc_tol</span><span class="o">=</span><span class="n">qc_tol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">discretefit</span> <span class="o">=</span> <span class="n">L1NegativeBinomialResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cntfit</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">L1NegativeBinomialResultsWrapper</span><span class="p">(</span><span class="n">discretefit</span><span class="p">)</span></div>

<div class="viewcode-block" id="NegativeBinomialP.predict"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.NegativeBinomialP.predict.html#statsmodels.discrete.discrete_model.NegativeBinomialP.predict">[docs]</a>    <span class="nd">@Appender</span><span class="p">(</span><span class="n">Poisson</span><span class="o">.</span><span class="n">predict</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exposure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">which</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">y_values</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>

        <span class="k">if</span> <span class="n">exposure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exposure</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;exposure&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">exposure</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">exposure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">exposure</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;offset&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">fitted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="n">params</span><span class="p">[:</span><span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">linpred</span> <span class="o">=</span> <span class="n">fitted</span> <span class="o">+</span> <span class="n">exposure</span> <span class="o">+</span> <span class="n">offset</span>

        <span class="k">if</span> <span class="n">which</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">linpred</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">which</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">linpred</span>
        <span class="k">elif</span> <span class="n">which</span> <span class="o">==</span> <span class="s1">&#39;var&#39;</span><span class="p">:</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">linpred</span><span class="p">)</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span>  <span class="c1"># no `-1` as in GPP</span>
            <span class="n">var_</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">mean</span><span class="o">**</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">var_</span>
        <span class="k">elif</span> <span class="n">which</span> <span class="o">==</span> <span class="s1">&#39;prob&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">y_values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">y_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

            <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">exposure</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
            <span class="n">size</span><span class="p">,</span> <span class="n">prob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_params</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">mu</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">nbinom</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">y_values</span><span class="p">,</span> <span class="n">size</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">prob</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;keyword &quot;which&quot; = </span><span class="si">%s</span><span class="s1"> not recognized&#39;</span> <span class="o">%</span> <span class="n">which</span><span class="p">)</span></div>

<div class="viewcode-block" id="NegativeBinomialP.convert_params"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.NegativeBinomialP.convert_params.html#statsmodels.discrete.discrete_model.NegativeBinomialP.convert_params">[docs]</a>    <span class="k">def</span> <span class="nf">convert_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span>

        <span class="n">size</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">mu</span><span class="o">**</span><span class="n">p</span>
        <span class="n">prob</span> <span class="o">=</span> <span class="n">size</span> <span class="o">/</span> <span class="p">(</span><span class="n">size</span> <span class="o">+</span> <span class="n">mu</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">prob</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_deriv_score_obs_dendog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;derivative of score_obs w.r.t. endog</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : ndarray</span>
<span class="sd">            parameter at which score is evaluated</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        derivative : ndarray_2d</span>
<span class="sd">            The derivative of the score_obs with respect to endog.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">statsmodels.tools.numdiff</span> <span class="kn">import</span> <span class="n">_approx_fprime_cs_scalar</span>

        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">sf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_factor</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">endog</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span>

        <span class="n">dsf</span> <span class="o">=</span> <span class="n">_approx_fprime_cs_scalar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
        <span class="c1"># deriv is 2d vector</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="n">dsf</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="n">dsf</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;variance implied by the distribution</span>

<span class="sd">        internal use, will be refactored or removed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span>  <span class="c1"># no `-1` as in GPP</span>
        <span class="n">var_</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">mu</span><span class="o">**</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">var_</span>

    <span class="k">def</span> <span class="nf">_prob_nonzero</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Probability that count is not zero</span>

<span class="sd">        internal use in Censored model, will be refactored or removed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterization</span>
        <span class="n">prob_nz</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">mu</span><span class="o">**</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">prob_nz</span>

<div class="viewcode-block" id="NegativeBinomialP.get_distribution"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.NegativeBinomialP.get_distribution.html#statsmodels.discrete.discrete_model.NegativeBinomialP.get_distribution">[docs]</a>    <span class="nd">@Appender</span><span class="p">(</span><span class="n">Poisson</span><span class="o">.</span><span class="n">get_distribution</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exposure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;get frozen instance of distribution</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span> <span class="n">exposure</span><span class="o">=</span><span class="n">exposure</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
        <span class="n">size</span><span class="p">,</span> <span class="n">prob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_params</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">mu</span><span class="p">)</span>
        <span class="c1"># distr = nbinom(size[:, None], prob[:, None])</span>
        <span class="n">distr</span> <span class="o">=</span> <span class="n">nbinom</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">prob</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">distr</span></div></div>


<span class="c1">### Results Class ###</span>

<div class="viewcode-block" id="DiscreteResults"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.DiscreteResults.html#statsmodels.discrete.discrete_model.DiscreteResults">[docs]</a><span class="k">class</span> <span class="nc">DiscreteResults</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">LikelihoodModelResults</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_discrete_results_docs</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;one_line_description&quot;</span> <span class="p">:</span>
        <span class="s2">&quot;A results class for the discrete dependent variable models.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;extra_attr&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">mlefit</span><span class="p">,</span> <span class="n">cov_type</span><span class="o">=</span><span class="s1">&#39;nonrobust&#39;</span><span class="p">,</span> <span class="n">cov_kwds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">use_t</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1">#super(DiscreteResults, self).__init__(model, params,</span>
        <span class="c1">#        np.linalg.inv(-hessian), scale=1.)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;MLE&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">df_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_resid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">df_resid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nobs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mlefit</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">converged</span> <span class="o">=</span> <span class="n">mlefit</span><span class="o">.</span><span class="n">mle_retvals</span><span class="p">[</span><span class="s2">&quot;converged&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;cov_type&#39;</span><span class="p">):</span>
            <span class="c1"># do this only if super, i.e. mlefit did not already add cov_type</span>
            <span class="c1"># robust covariance</span>
            <span class="k">if</span> <span class="n">use_t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">use_t</span> <span class="o">=</span> <span class="n">use_t</span>
            <span class="k">if</span> <span class="n">cov_type</span> <span class="o">==</span> <span class="s1">&#39;nonrobust&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cov_type</span> <span class="o">=</span> <span class="s1">&#39;nonrobust&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cov_kwds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;description&#39;</span> <span class="p">:</span> <span class="s1">&#39;Standard Errors assume that the &#39;</span> <span class="o">+</span>
                                 <span class="s1">&#39;covariance matrix of the errors is correctly &#39;</span> <span class="o">+</span>
                                 <span class="s1">&#39;specified.&#39;</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cov_kwds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">cov_kwds</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="kn">from</span> <span class="nn">statsmodels.base.covtype</span> <span class="kn">import</span> <span class="n">get_robustcov_results</span>
                <span class="n">get_robustcov_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cov_type</span><span class="o">=</span><span class="n">cov_type</span><span class="p">,</span> <span class="n">use_self</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                           <span class="o">**</span><span class="n">cov_kwds</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># remove unpicklable methods</span>
        <span class="n">mle_settings</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;mle_settings&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mle_settings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;callback&#39;</span> <span class="ow">in</span> <span class="n">mle_settings</span><span class="p">:</span>
                <span class="n">mle_settings</span><span class="p">[</span><span class="s1">&#39;callback&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="s1">&#39;cov_params_func&#39;</span> <span class="ow">in</span> <span class="n">mle_settings</span><span class="p">:</span>
                <span class="n">mle_settings</span><span class="p">[</span><span class="s1">&#39;cov_params_func&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">prsquared</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        McFadden&#39;s pseudo-R-squared. `1 - (llf / llnull)`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">llf</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">llnull</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">llr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Likelihood ratio chi-squared statistic; `-2*(llnull - llf)`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llnull</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">llf</span><span class="p">)</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">llr_pvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The chi-squared probability of getting a log-likelihood ratio</span>
<span class="sd">        statistic greater than llr.  llr has a chi-squared distribution</span>
<span class="sd">        with degrees of freedom `df_model`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_model</span><span class="p">)</span>

<div class="viewcode-block" id="DiscreteResults.set_null_options"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.DiscreteResults.set_null_options.html#statsmodels.discrete.discrete_model.DiscreteResults.set_null_options">[docs]</a>    <span class="k">def</span> <span class="nf">set_null_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">llnull</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attach_results</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the fit options for the Null (constant-only) model.</span>

<span class="sd">        This resets the cache for related attributes which is potentially</span>
<span class="sd">        fragile. This only sets the option, the null model is estimated</span>
<span class="sd">        when llnull is accessed, if llnull is not yet in cache.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        llnull : {None, float}</span>
<span class="sd">            If llnull is not None, then the value will be directly assigned to</span>
<span class="sd">            the cached attribute &quot;llnull&quot;.</span>
<span class="sd">        attach_results : bool</span>
<span class="sd">            Sets an internal flag whether the results instance of the null</span>
<span class="sd">            model should be attached. By default without calling this method,</span>
<span class="sd">            thenull model results are not attached and only the loglikelihood</span>
<span class="sd">            value llnull is stored.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Additional keyword arguments used as fit keyword arguments for the</span>
<span class="sd">            null model. The override and model default values.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Modifies attributes of this instance, and so has no return.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># reset cache, note we need to add here anything that depends on</span>
        <span class="c1"># llnullor the null model. If something is missing, then the attribute</span>
        <span class="c1"># might be incorrect.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;llnull&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;llr&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;llr_pvalue&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;prsquared&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;res_null&#39;</span><span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_null</span>

        <span class="k">if</span> <span class="n">llnull</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s1">&#39;llnull&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">llnull</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attach_nullmodel</span> <span class="o">=</span> <span class="n">attach_results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_optim_kwds_null</span> <span class="o">=</span> <span class="n">kwargs</span></div>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">llnull</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Value of the constant-only loglikelihood</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="n">kwds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">_get_init_kwds</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;_null_drop_keys&#39;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="k">del</span> <span class="n">kwds</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="c1"># TODO: what parameters to pass to fit?</span>
        <span class="n">mod_null</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nobs</span><span class="p">),</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="c1"># TODO: consider catching and warning on convergence failure?</span>
        <span class="c1"># in the meantime, try hard to converge. see</span>
        <span class="c1"># TestPoissonConstrained1a.test_smoke</span>

        <span class="n">optim_kwds</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_optim_kwds_null&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="s1">&#39;start_params&#39;</span> <span class="ow">in</span> <span class="n">optim_kwds</span><span class="p">:</span>
            <span class="c1"># user provided</span>
            <span class="n">sp_null</span> <span class="o">=</span> <span class="n">optim_kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;start_params&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;_get_start_params_null&#39;</span><span class="p">):</span>
            <span class="c1"># get moment estimates if available</span>
            <span class="n">sp_null</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">_get_start_params_null</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sp_null</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">opt_kwds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;bfgs&#39;</span><span class="p">,</span> <span class="n">warn_convergence</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
                        <span class="n">disp</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">opt_kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">optim_kwds</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">optim_kwds</span><span class="p">:</span>
            <span class="n">res_null</span> <span class="o">=</span> <span class="n">mod_null</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">start_params</span><span class="o">=</span><span class="n">sp_null</span><span class="p">,</span> <span class="o">**</span><span class="n">opt_kwds</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># this should be a reasonably method case across versions</span>
            <span class="n">res_null</span> <span class="o">=</span> <span class="n">mod_null</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">start_params</span><span class="o">=</span><span class="n">sp_null</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nm&#39;</span><span class="p">,</span>
                                    <span class="n">warn_convergence</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                    <span class="n">maxiter</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">res_null</span> <span class="o">=</span> <span class="n">mod_null</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">start_params</span><span class="o">=</span><span class="n">res_null</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bfgs&#39;</span><span class="p">,</span>
                                    <span class="n">warn_convergence</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                    <span class="n">maxiter</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_attach_nullmodel&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">res_null</span> <span class="o">=</span> <span class="n">res_null</span>

        <span class="k">return</span> <span class="n">res_null</span><span class="o">.</span><span class="n">llf</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">fittedvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Linear predictor XB.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">resid_response</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Respnose residuals. The response residuals are defined as</span>
<span class="sd">        `endog - fittedvalues`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">resid_pearson</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pearson residuals defined as response residuals divided by standard</span>
<span class="sd">        deviation implied by the model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">var_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;var&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resid_response</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_</span><span class="p">)</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">aic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Akaike information criterion.  `-2*(llf - p)` where `p` is the number</span>
<span class="sd">        of regressors including the intercept.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">k_extra</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;k_extra&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llf</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_model</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">k_extra</span><span class="p">))</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">bic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Bayesian information criterion. `-2*llf + ln(nobs)*p` where `p` is the</span>
<span class="sd">        number of regressors including the intercept.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">k_extra</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;k_extra&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">llf</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nobs</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_model</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">k_extra</span><span class="p">)</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">im_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pinfer</span><span class="o">.</span><span class="n">im_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="DiscreteResults.info_criteria"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.DiscreteResults.info_criteria.html#statsmodels.discrete.discrete_model.DiscreteResults.info_criteria">[docs]</a>    <span class="k">def</span> <span class="nf">info_criteria</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crit</span><span class="p">,</span> <span class="n">dk_params</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return an information criterion for the model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        crit : string</span>
<span class="sd">            One of &#39;aic&#39;, &#39;bic&#39;, &#39;tic&#39; or &#39;gbic&#39;.</span>
<span class="sd">        dk_params : int or float</span>
<span class="sd">            Correction to the number of parameters used in the information</span>
<span class="sd">            criterion.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Value of information criterion.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Tic and gbic</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        Burnham KP, Anderson KR (2002). Model Selection and Multimodel</span>
<span class="sd">        Inference; Springer New York.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">crit</span> <span class="o">=</span> <span class="n">crit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">k_extra</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;k_extra&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">k_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_model</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">k_extra</span> <span class="o">+</span> <span class="n">dk_params</span>

        <span class="k">if</span> <span class="n">crit</span> <span class="o">==</span> <span class="s2">&quot;aic&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">llf</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">k_params</span>
        <span class="k">elif</span> <span class="n">crit</span> <span class="o">==</span> <span class="s2">&quot;bic&quot;</span><span class="p">:</span>
            <span class="n">nobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_model</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_resid</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">bic</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">llf</span> <span class="o">+</span> <span class="n">k_params</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">nobs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">bic</span>
        <span class="k">elif</span> <span class="n">crit</span> <span class="o">==</span> <span class="s2">&quot;tic&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pinfer</span><span class="o">.</span><span class="n">tic</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">crit</span> <span class="o">==</span> <span class="s2">&quot;gbic&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pinfer</span><span class="o">.</span><span class="n">gbic</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Name of information criterion not recognized.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DiscreteResults.score_test"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.DiscreteResults.score_test.html#statsmodels.discrete.discrete_model.DiscreteResults.score_test">[docs]</a>    <span class="k">def</span> <span class="nf">score_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exog_extra</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">params_constrained</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">hypothesis</span><span class="o">=</span><span class="s1">&#39;joint&#39;</span><span class="p">,</span> <span class="n">cov_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cov_kwds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">k_constraints</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">pinfer</span><span class="o">.</span><span class="n">score_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exog_extra</span><span class="o">=</span><span class="n">exog_extra</span><span class="p">,</span>
                                <span class="n">params_constrained</span><span class="o">=</span><span class="n">params_constrained</span><span class="p">,</span>
                                <span class="n">hypothesis</span><span class="o">=</span><span class="n">hypothesis</span><span class="p">,</span>
                                <span class="n">cov_type</span><span class="o">=</span><span class="n">cov_type</span><span class="p">,</span> <span class="n">cov_kwds</span><span class="o">=</span><span class="n">cov_kwds</span><span class="p">,</span>
                                <span class="n">k_constraints</span><span class="o">=</span><span class="n">k_constraints</span><span class="p">,</span>
                                <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>

    <span class="n">score_test</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">pinfer</span><span class="o">.</span><span class="n">score_test</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="DiscreteResults.get_prediction"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.DiscreteResults.get_prediction.html#statsmodels.discrete.discrete_model.DiscreteResults.get_prediction">[docs]</a>    <span class="k">def</span> <span class="nf">get_prediction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">transform</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">linear</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">row_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">agg_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute prediction results when endpoint transformation is valid.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        exog : array_like, optional</span>
<span class="sd">            The values for which you want to predict.</span>
<span class="sd">        transform : bool, optional</span>
<span class="sd">            If the model was fit via a formula, do you want to pass</span>
<span class="sd">            exog through the formula. Default is True. E.g., if you fit</span>
<span class="sd">            a model y ~ log(x1) + log(x2), and transform is True, then</span>
<span class="sd">            you can pass a data structure that contains x1 and x2 in</span>
<span class="sd">            their original form. Otherwise, you&#39;d need to log the data</span>
<span class="sd">            first.</span>
<span class="sd">        which : str</span>
<span class="sd">            Which statistic is to be predicted. Default is &quot;mean&quot;.</span>
<span class="sd">            The available statistics and options depend on the model.</span>
<span class="sd">            see the model.predict docstring</span>
<span class="sd">        linear : bool</span>
<span class="sd">            Linear has been replaced by the `which` keyword and will be</span>
<span class="sd">            deprecated.</span>
<span class="sd">            If linear is True, then `which` is ignored and the linear</span>
<span class="sd">            prediction is returned.</span>
<span class="sd">        row_labels : list of str or None</span>
<span class="sd">            If row_lables are provided, then they will replace the generated</span>
<span class="sd">            labels.</span>
<span class="sd">        average : bool</span>
<span class="sd">            If average is True, then the mean prediction is computed, that is,</span>
<span class="sd">            predictions are computed for individual exog and then the average</span>
<span class="sd">            over observation is used.</span>
<span class="sd">            If average is False, then the results are the predictions for all</span>
<span class="sd">            observations, i.e. same length as ``exog``.</span>
<span class="sd">        agg_weights : ndarray, optional</span>
<span class="sd">            Aggregation weights, only used if average is True.</span>
<span class="sd">            The weights are not normalized.</span>
<span class="sd">        y_values : None or nd_array</span>
<span class="sd">            Some predictive statistics like which=&quot;prob&quot; are computed at</span>
<span class="sd">            values of the response variable. If y_values is not None, then</span>
<span class="sd">            it will be used instead of the default set of y_values.</span>

<span class="sd">            **Warning:** ``which=&quot;prob&quot;`` for count models currently computes</span>
<span class="sd">            the pmf for all y=k up to max(endog). This can be a large array if</span>
<span class="sd">            the observed endog values are large.</span>
<span class="sd">            This will likely change so that the set of y_values will be chosen</span>
<span class="sd">            to limit the array size.</span>
<span class="sd">        **kwargs :</span>
<span class="sd">            Some models can take additional keyword arguments, such as offset,</span>
<span class="sd">            exposure or additional exog in multi-part models like zero inflated</span>
<span class="sd">            models.</span>
<span class="sd">            See the predict method of the model for the details.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        prediction_results : PredictionResults</span>
<span class="sd">            The prediction results instance contains prediction and prediction</span>
<span class="sd">            variance and can on demand calculate confidence intervals and</span>
<span class="sd">            summary dataframe for the prediction.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Status: new in 0.14, experimental</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">linear</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># compatibility with old keyword</span>
            <span class="n">which</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span>

        <span class="n">pred_kwds</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="c1"># y_values is explicit so we can add it to the docstring</span>
        <span class="k">if</span> <span class="n">y_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pred_kwds</span><span class="p">[</span><span class="s2">&quot;y_values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_values</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">get_prediction</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span>
            <span class="n">which</span><span class="o">=</span><span class="n">which</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span>
            <span class="n">row_labels</span><span class="o">=</span><span class="n">row_labels</span><span class="p">,</span>
            <span class="n">average</span><span class="o">=</span><span class="n">average</span><span class="p">,</span>
            <span class="n">agg_weights</span><span class="o">=</span><span class="n">agg_weights</span><span class="p">,</span>
            <span class="n">pred_kwds</span><span class="o">=</span><span class="n">pred_kwds</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="DiscreteResults.get_distribution"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.DiscreteResults.get_distribution.html#statsmodels.discrete.discrete_model.DiscreteResults.get_distribution">[docs]</a>    <span class="k">def</span> <span class="nf">get_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">exog</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_predict_exog</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">exog</span><span class="p">)</span>
        <span class="n">distr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_distribution</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
                                            <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span>
                                            <span class="o">**</span><span class="n">kwargs</span>
                                            <span class="p">)</span>
        <span class="k">return</span> <span class="n">distr</span></div>

    <span class="k">def</span> <span class="nf">_get_endog_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yname</span><span class="p">,</span> <span class="n">yname_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">yname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog_names</span>
        <span class="k">if</span> <span class="n">yname_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yname_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog_names</span>
        <span class="k">return</span> <span class="n">yname</span><span class="p">,</span> <span class="n">yname_list</span>

<div class="viewcode-block" id="DiscreteResults.get_margeff"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.DiscreteResults.get_margeff.html#statsmodels.discrete.discrete_model.DiscreteResults.get_margeff">[docs]</a>    <span class="k">def</span> <span class="nf">get_margeff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">at</span><span class="o">=</span><span class="s1">&#39;overall&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;dydx&#39;</span><span class="p">,</span> <span class="n">atexog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">dummy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get marginal effects of the fitted model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        at : str, optional</span>
<span class="sd">            Options are:</span>

<span class="sd">            - &#39;overall&#39;, The average of the marginal effects at each</span>
<span class="sd">              observation.</span>
<span class="sd">            - &#39;mean&#39;, The marginal effects at the mean of each regressor.</span>
<span class="sd">            - &#39;median&#39;, The marginal effects at the median of each regressor.</span>
<span class="sd">            - &#39;zero&#39;, The marginal effects at zero for each regressor.</span>
<span class="sd">            - &#39;all&#39;, The marginal effects at each observation. If `at` is all</span>
<span class="sd">              only margeff will be available from the returned object.</span>

<span class="sd">            Note that if `exog` is specified, then marginal effects for all</span>
<span class="sd">            variables not specified by `exog` are calculated using the `at`</span>
<span class="sd">            option.</span>
<span class="sd">        method : str, optional</span>
<span class="sd">            Options are:</span>

<span class="sd">            - &#39;dydx&#39; - dy/dx - No transformation is made and marginal effects</span>
<span class="sd">              are returned.  This is the default.</span>
<span class="sd">            - &#39;eyex&#39; - estimate elasticities of variables in `exog` --</span>
<span class="sd">              d(lny)/d(lnx)</span>
<span class="sd">            - &#39;dyex&#39; - estimate semi-elasticity -- dy/d(lnx)</span>
<span class="sd">            - &#39;eydx&#39; - estimate semi-elasticity -- d(lny)/dx</span>

<span class="sd">            Note that tranformations are done after each observation is</span>
<span class="sd">            calculated.  Semi-elasticities for binary variables are computed</span>
<span class="sd">            using the midpoint method. &#39;dyex&#39; and &#39;eyex&#39; do not make sense</span>
<span class="sd">            for discrete variables. For interpretations of these methods</span>
<span class="sd">            see notes below.</span>
<span class="sd">        atexog : array_like, optional</span>
<span class="sd">            Optionally, you can provide the exogenous variables over which to</span>
<span class="sd">            get the marginal effects.  This should be a dictionary with the key</span>
<span class="sd">            as the zero-indexed column number and the value of the dictionary.</span>
<span class="sd">            Default is None for all independent variables less the constant.</span>
<span class="sd">        dummy : bool, optional</span>
<span class="sd">            If False, treats binary variables (if present) as continuous.  This</span>
<span class="sd">            is the default.  Else if True, treats binary variables as</span>
<span class="sd">            changing from 0 to 1.  Note that any variable that is either 0 or 1</span>
<span class="sd">            is treated as binary.  Each binary variable is treated separately</span>
<span class="sd">            for now.</span>
<span class="sd">        count : bool, optional</span>
<span class="sd">            If False, treats count variables (if present) as continuous.  This</span>
<span class="sd">            is the default.  Else if True, the marginal effect is the</span>
<span class="sd">            change in probabilities when each observation is increased by one.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        DiscreteMargins : marginal effects instance</span>
<span class="sd">            Returns an object that holds the marginal effects, standard</span>
<span class="sd">            errors, confidence intervals, etc. See</span>
<span class="sd">            `statsmodels.discrete.discrete_margins.DiscreteMargins` for more</span>
<span class="sd">            information.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Interpretations of methods:</span>

<span class="sd">        - &#39;dydx&#39; - change in `endog` for a change in `exog`.</span>
<span class="sd">        - &#39;eyex&#39; - proportional change in `endog` for a proportional change</span>
<span class="sd">          in `exog`.</span>
<span class="sd">        - &#39;dyex&#39; - change in `endog` for a proportional change in `exog`.</span>
<span class="sd">        - &#39;eydx&#39; - proportional change in `endog` for a change in `exog`.</span>

<span class="sd">        When using after Poisson, returns the expected number of events per</span>
<span class="sd">        period, assuming that the model is loglinear.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Margins with offset are not available.&quot;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">statsmodels.discrete.discrete_margins</span> <span class="kn">import</span> <span class="n">DiscreteMargins</span>
        <span class="k">return</span> <span class="n">DiscreteMargins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">atexog</span><span class="p">,</span> <span class="n">dummy</span><span class="p">,</span> <span class="n">count</span><span class="p">))</span></div>

<div class="viewcode-block" id="DiscreteResults.get_influence"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.DiscreteResults.get_influence.html#statsmodels.discrete.discrete_model.DiscreteResults.get_influence">[docs]</a>    <span class="k">def</span> <span class="nf">get_influence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an instance of MLEInfluence with influence and outlier measures</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        infl : MLEInfluence instance</span>
<span class="sd">            The instance has methods to calculate the main influence and</span>
<span class="sd">            outlier measures as attributes.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        statsmodels.stats.outliers_influence.MLEInfluence</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">statsmodels.stats.outliers_influence</span> <span class="kn">import</span> <span class="n">MLEInfluence</span>
        <span class="k">return</span> <span class="n">MLEInfluence</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="DiscreteResults.summary"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.DiscreteResults.summary.html#statsmodels.discrete.discrete_model.DiscreteResults.summary">[docs]</a>    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.05</span><span class="p">,</span>
                <span class="n">yname_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Summarize the Regression Results.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        yname : str, optional</span>
<span class="sd">            The name of the endog variable in the tables. The default is `y`.</span>
<span class="sd">        xname : list[str], optional</span>
<span class="sd">            The names for the exogenous variables, default is &quot;var_xx&quot;.</span>
<span class="sd">            Must match the number of parameters in the model.</span>
<span class="sd">        title : str, optional</span>
<span class="sd">            Title for the top table. If not None, then this replaces the</span>
<span class="sd">            default title.</span>
<span class="sd">        alpha : float</span>
<span class="sd">            The significance level for the confidence intervals.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Summary</span>
<span class="sd">            Class that holds the summary tables and text, which can be printed</span>
<span class="sd">            or converted to various output formats.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        statsmodels.iolib.summary.Summary : Class that hold summary results.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">top_left</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Dep. Variable:&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;Model:&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]),</span>
                     <span class="p">(</span><span class="s1">&#39;Method:&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">]),</span>
                     <span class="p">(</span><span class="s1">&#39;Date:&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;Time:&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;converged:&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">mle_retvals</span><span class="p">[</span><span class="s1">&#39;converged&#39;</span><span class="p">]]),</span>
                    <span class="p">]</span>

        <span class="n">top_right</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;No. Observations:&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;Df Residuals:&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;Df Model:&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;Pseudo R-squ.:&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%#6.4g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">prsquared</span><span class="p">]),</span>
                     <span class="p">(</span><span class="s1">&#39;Log-Likelihood:&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;LL-Null:&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%#8.5g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">llnull</span><span class="p">]),</span>
                     <span class="p">(</span><span class="s1">&#39;LLR p-value:&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%#6.4g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">llr_pvalue</span><span class="p">])</span>
                     <span class="p">]</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;cov_type&#39;</span><span class="p">):</span>
            <span class="n">top_left</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Covariance Type:&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cov_type</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="s2">&quot;Regression Results&quot;</span>

        <span class="c1"># boiler plate</span>
        <span class="kn">from</span> <span class="nn">statsmodels.iolib.summary</span> <span class="kn">import</span> <span class="n">Summary</span>
        <span class="n">smry</span> <span class="o">=</span> <span class="n">Summary</span><span class="p">()</span>
        <span class="n">yname</span><span class="p">,</span> <span class="n">yname_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_endog_name</span><span class="p">(</span><span class="n">yname</span><span class="p">,</span> <span class="n">yname_list</span><span class="p">)</span>

        <span class="c1"># for top of table</span>
        <span class="n">smry</span><span class="o">.</span><span class="n">add_table_2cols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gleft</span><span class="o">=</span><span class="n">top_left</span><span class="p">,</span> <span class="n">gright</span><span class="o">=</span><span class="n">top_right</span><span class="p">,</span>
                             <span class="n">yname</span><span class="o">=</span><span class="n">yname</span><span class="p">,</span> <span class="n">xname</span><span class="o">=</span><span class="n">xname</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>

        <span class="c1"># for parameters, etc</span>
        <span class="n">smry</span><span class="o">.</span><span class="n">add_table_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yname</span><span class="o">=</span><span class="n">yname_list</span><span class="p">,</span> <span class="n">xname</span><span class="o">=</span><span class="n">xname</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                              <span class="n">use_t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_t</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;constraints&#39;</span><span class="p">):</span>
            <span class="n">smry</span><span class="o">.</span><span class="n">add_extra_txt</span><span class="p">([</span><span class="s1">&#39;Model has been estimated subject to linear &#39;</span>
                                <span class="s1">&#39;equality constraints.&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">smry</span></div>

<div class="viewcode-block" id="DiscreteResults.summary2"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.DiscreteResults.summary2.html#statsmodels.discrete.discrete_model.DiscreteResults.summary2">[docs]</a>    <span class="k">def</span> <span class="nf">summary2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.05</span><span class="p">,</span>
                 <span class="n">float_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.4f</span><span class="s2">&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Experimental function to summarize regression results.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        yname : str</span>
<span class="sd">            Name of the dependent variable (optional).</span>
<span class="sd">        xname : list[str], optional</span>
<span class="sd">            List of strings of length equal to the number of parameters</span>
<span class="sd">            Names of the independent variables (optional).</span>
<span class="sd">        title : str, optional</span>
<span class="sd">            Title for the top table. If not None, then this replaces the</span>
<span class="sd">            default title.</span>
<span class="sd">        alpha : float</span>
<span class="sd">            The significance level for the confidence intervals.</span>
<span class="sd">        float_format : str</span>
<span class="sd">            The print format for floats in parameters summary.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Summary</span>
<span class="sd">            Instance that contains the summary tables and text, which can be</span>
<span class="sd">            printed or converted to various output formats.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        statsmodels.iolib.summary2.Summary : Class that holds summary results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">statsmodels.iolib</span> <span class="kn">import</span> <span class="n">summary2</span>
        <span class="n">smry</span> <span class="o">=</span> <span class="n">summary2</span><span class="o">.</span><span class="n">Summary</span><span class="p">()</span>
        <span class="n">smry</span><span class="o">.</span><span class="n">add_base</span><span class="p">(</span><span class="n">results</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="n">float_format</span><span class="p">,</span>
                      <span class="n">xname</span><span class="o">=</span><span class="n">xname</span><span class="p">,</span> <span class="n">yname</span><span class="o">=</span><span class="n">yname</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;constraints&#39;</span><span class="p">):</span>
            <span class="n">smry</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="s1">&#39;Model has been estimated subject to linear &#39;</span>
                          <span class="s1">&#39;equality constraints.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">smry</span></div></div>


<div class="viewcode-block" id="CountResults"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.CountResults.html#statsmodels.discrete.discrete_model.CountResults">[docs]</a><span class="k">class</span> <span class="nc">CountResults</span><span class="p">(</span><span class="n">DiscreteResults</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_discrete_results_docs</span> <span class="o">%</span> <span class="p">{</span>
        <span class="s2">&quot;one_line_description&quot;</span><span class="p">:</span> <span class="s2">&quot;A results class for count data&quot;</span><span class="p">,</span>
        <span class="s2">&quot;extra_attr&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">resid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Residuals</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The residuals for Count models are defined as</span>

<span class="sd">        .. math:: y - p</span>

<span class="sd">        where :math:`p = \\exp(X\\beta)`. Any exposure and offset variables</span>
<span class="sd">        are also handled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>

<div class="viewcode-block" id="CountResults.get_diagnostic"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.CountResults.get_diagnostic.html#statsmodels.discrete.discrete_model.CountResults.get_diagnostic">[docs]</a>    <span class="k">def</span> <span class="nf">get_diagnostic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_max</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get instance of class with specification and diagnostic methods.</span>

<span class="sd">        experimental, API of Diagnostic classes will change</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CountDiagnostic instance</span>
<span class="sd">            The instance has methods to perform specification and diagnostic</span>
<span class="sd">            tesst and plots</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        statsmodels.statsmodels.discrete.diagnostic.CountDiagnostic</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">statsmodels.discrete.diagnostic</span> <span class="kn">import</span> <span class="n">CountDiagnostic</span>
        <span class="k">return</span> <span class="n">CountDiagnostic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_max</span><span class="o">=</span><span class="n">y_max</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="NegativeBinomialResults"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.NegativeBinomialResults.html#statsmodels.discrete.discrete_model.NegativeBinomialResults">[docs]</a><span class="k">class</span> <span class="nc">NegativeBinomialResults</span><span class="p">(</span><span class="n">CountResults</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_discrete_results_docs</span> <span class="o">%</span> <span class="p">{</span>
        <span class="s2">&quot;one_line_description&quot;</span><span class="p">:</span> <span class="s2">&quot;A results class for NegativeBinomial 1 and 2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;extra_attr&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">lnalpha</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Natural log of alpha&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">lnalpha_std_err</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Natural log of standardized error&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bse</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">aic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># + 1 because we estimate alpha</span>
        <span class="n">k_extra</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;k_extra&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llf</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_model</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_constant</span> <span class="o">+</span> <span class="n">k_extra</span><span class="p">))</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">bic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># + 1 because we estimate alpha</span>
        <span class="n">k_extra</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;k_extra&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">llf</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nobs</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_model</span> <span class="o">+</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">k_constant</span> <span class="o">+</span> <span class="n">k_extra</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">NegativeBinomialPResults</span><span class="p">(</span><span class="n">NegativeBinomialResults</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_discrete_results_docs</span> <span class="o">%</span> <span class="p">{</span>
        <span class="s2">&quot;one_line_description&quot;</span><span class="p">:</span> <span class="s2">&quot;A results class for NegativeBinomialP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;extra_attr&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>


<div class="viewcode-block" id="GeneralizedPoissonResults"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.GeneralizedPoissonResults.html#statsmodels.discrete.discrete_model.GeneralizedPoissonResults">[docs]</a><span class="k">class</span> <span class="nc">GeneralizedPoissonResults</span><span class="p">(</span><span class="n">NegativeBinomialResults</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_discrete_results_docs</span> <span class="o">%</span> <span class="p">{</span>
        <span class="s2">&quot;one_line_description&quot;</span><span class="p">:</span> <span class="s2">&quot;A results class for Generalized Poisson&quot;</span><span class="p">,</span>
        <span class="s2">&quot;extra_attr&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">_dispersion_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;parameterization&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">mu</span><span class="o">**</span><span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span></div>


<span class="k">class</span> <span class="nc">L1CountResults</span><span class="p">(</span><span class="n">DiscreteResults</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_discrete_results_docs</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;one_line_description&quot;</span> <span class="p">:</span>
            <span class="s2">&quot;A results class for count data fit by l1 regularization&quot;</span><span class="p">,</span>
            <span class="s2">&quot;extra_attr&quot;</span> <span class="p">:</span> <span class="n">_l1_results_attr</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">cntfit</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">L1CountResults</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">cntfit</span><span class="p">)</span>
        <span class="c1"># self.trimmed is a boolean array with T/F telling whether or not that</span>
        <span class="c1"># entry in params has been set zero&#39;d out.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trimmed</span> <span class="o">=</span> <span class="n">cntfit</span><span class="o">.</span><span class="n">mle_retvals</span><span class="p">[</span><span class="s1">&#39;trimmed&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nnz_params</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">trimmed</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="c1"># Set degrees of freedom.  In doing so,</span>
        <span class="c1"># adjust for extra parameter in NegativeBinomial nb1 and nb2</span>
        <span class="c1"># extra parameter is not included in df_model</span>
        <span class="n">k_extra</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;k_extra&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnz_params</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">k_extra</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_resid</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnz_params</span><span class="p">)</span> <span class="o">+</span> <span class="n">k_extra</span>


<span class="k">class</span> <span class="nc">PoissonResults</span><span class="p">(</span><span class="n">CountResults</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">predict_prob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exposure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">transform</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return predicted probability of each count level for each observation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n : array_like or int</span>
<span class="sd">            The counts for which you want the probabilities. If n is None</span>
<span class="sd">            then the probabilities for each count from 0 to max(y) are</span>
<span class="sd">            given.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ndarray</span>
<span class="sd">            A nobs x n array where len(`n`) columns are indexed by the count</span>
<span class="sd">            n. If n is None, then column 0 is the probability that each</span>
<span class="sd">            observation is 0, column 1 is the probability that each</span>
<span class="sd">            observation is 1, etc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span> <span class="n">exposure</span><span class="o">=</span><span class="n">exposure</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span>
                          <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span>
        <span class="c1"># uses broadcasting</span>
        <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">poisson</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">mu</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">resid_pearson</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pearson residuals</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Pearson residuals are defined to be</span>

<span class="sd">        .. math:: r_j = \\frac{(y - M_jp_j)}{\\sqrt{M_jp_j(1-p_j)}}</span>

<span class="sd">        where :math:`p_j=cdf(X\\beta)` and :math:`M_j` is the total number of</span>
<span class="sd">        observations sharing the covariate pattern :math:`j`.</span>

<span class="sd">        For now :math:`M_j` is always set to 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Pearson residuals</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>  <span class="c1"># fittedvalues is still linear</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_influence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an instance of MLEInfluence with influence and outlier measures</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        infl : MLEInfluence instance</span>
<span class="sd">            The instance has methods to calculate the main influence and</span>
<span class="sd">            outlier measures as attributes.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        statsmodels.stats.outliers_influence.MLEInfluence</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">statsmodels.stats.outliers_influence</span> <span class="kn">import</span> <span class="n">MLEInfluence</span>
        <span class="k">return</span> <span class="n">MLEInfluence</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_diagnostic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_max</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get instance of class with specification and diagnostic methods</span>

<span class="sd">        experimental, API of Diagnostic classes will change</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        PoissonDiagnostic instance</span>
<span class="sd">            The instance has methods to perform specification and diagnostic</span>
<span class="sd">            tesst and plots</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        statsmodels.statsmodels.discrete.diagnostic.PoissonDiagnostic</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">statsmodels.discrete.diagnostic</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">PoissonDiagnostic</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">PoissonDiagnostic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_max</span><span class="o">=</span><span class="n">y_max</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">L1PoissonResults</span><span class="p">(</span><span class="n">L1CountResults</span><span class="p">,</span> <span class="n">PoissonResults</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">L1NegativeBinomialResults</span><span class="p">(</span><span class="n">L1CountResults</span><span class="p">,</span> <span class="n">NegativeBinomialResults</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">L1GeneralizedPoissonResults</span><span class="p">(</span><span class="n">L1CountResults</span><span class="p">,</span> <span class="n">GeneralizedPoissonResults</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">OrderedResults</span><span class="p">(</span><span class="n">DiscreteResults</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_discrete_results_docs</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;one_line_description&quot;</span> <span class="p">:</span> <span class="s2">&quot;A results class for ordered discrete data.&quot;</span> <span class="p">,</span> <span class="s2">&quot;extra_attr&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>
    <span class="k">pass</span>

<div class="viewcode-block" id="BinaryResults"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.BinaryResults.html#statsmodels.discrete.discrete_model.BinaryResults">[docs]</a><span class="k">class</span> <span class="nc">BinaryResults</span><span class="p">(</span><span class="n">DiscreteResults</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_discrete_results_docs</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;one_line_description&quot;</span> <span class="p">:</span> <span class="s2">&quot;A results class for binary data&quot;</span><span class="p">,</span> <span class="s2">&quot;extra_attr&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>

<div class="viewcode-block" id="BinaryResults.pred_table"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.BinaryResults.pred_table.html#statsmodels.discrete.discrete_model.BinaryResults.pred_table">[docs]</a>    <span class="k">def</span> <span class="nf">pred_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">.5</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prediction table</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        threshold : scalar</span>
<span class="sd">            Number between 0 and 1. Threshold above which a prediction is</span>
<span class="sd">            considered 1 and below which a prediction is considered 0.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        pred_table[i,j] refers to the number of times &quot;i&quot; was observed and</span>
<span class="sd">        the model predicted &quot;j&quot;. Correct predictions are along the diagonal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="n">actual</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">endog</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="BinaryResults.summary"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.BinaryResults.summary.html#statsmodels.discrete.discrete_model.BinaryResults.summary">[docs]</a>    <span class="nd">@Appender</span><span class="p">(</span><span class="n">DiscreteResults</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.05</span><span class="p">,</span>
                <span class="n">yname_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">smry</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">BinaryResults</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">yname</span><span class="p">,</span> <span class="n">xname</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span>
                                                  <span class="n">yname_list</span><span class="p">)</span>
        <span class="n">fittedvalues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">)</span>
        <span class="n">absprederror</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span> <span class="o">-</span> <span class="n">fittedvalues</span><span class="p">)</span>
        <span class="n">predclose_sum</span> <span class="o">=</span> <span class="p">(</span><span class="n">absprederror</span> <span class="o">&lt;</span> <span class="mf">1e-4</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">predclose_frac</span> <span class="o">=</span> <span class="n">predclose_sum</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">fittedvalues</span><span class="p">)</span>

        <span class="c1"># add warnings/notes</span>
        <span class="n">etext</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">predclose_sum</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">fittedvalues</span><span class="p">):</span>  <span class="c1"># TODO: nobs?</span>
            <span class="n">wstr</span> <span class="o">=</span> <span class="s2">&quot;Complete Separation: The results show that there is&quot;</span>
            <span class="n">wstr</span> <span class="o">+=</span> <span class="s2">&quot;complete separation or perfect prediction.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">wstr</span> <span class="o">+=</span> <span class="s2">&quot;In this case the Maximum Likelihood Estimator does &quot;</span>
            <span class="n">wstr</span> <span class="o">+=</span> <span class="s2">&quot;not exist and the parameters</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">wstr</span> <span class="o">+=</span> <span class="s2">&quot;are not identified.&quot;</span>
            <span class="n">etext</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wstr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">predclose_frac</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>  <span class="c1"># TODO: get better diagnosis</span>
            <span class="n">wstr</span> <span class="o">=</span> <span class="s2">&quot;Possibly complete quasi-separation: A fraction &quot;</span>
            <span class="n">wstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%4.2f</span><span class="s2"> of observations can be</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">predclose_frac</span>
            <span class="n">wstr</span> <span class="o">+=</span> <span class="s2">&quot;perfectly predicted. This might indicate that there &quot;</span>
            <span class="n">wstr</span> <span class="o">+=</span> <span class="s2">&quot;is complete</span><span class="se">\n</span><span class="s2">quasi-separation. In this case some &quot;</span>
            <span class="n">wstr</span> <span class="o">+=</span> <span class="s2">&quot;parameters will not be identified.&quot;</span>
            <span class="n">etext</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wstr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">etext</span><span class="p">:</span>
            <span class="n">smry</span><span class="o">.</span><span class="n">add_extra_txt</span><span class="p">(</span><span class="n">etext</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">smry</span></div>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">resid_dev</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deviance residuals</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Deviance residuals are defined</span>

<span class="sd">        .. math:: d_j = \\pm\\left(2\\left[Y_j\\ln\\left(\\frac{Y_j}{M_jp_j}\\right) + (M_j - Y_j\\ln\\left(\\frac{M_j-Y_j}{M_j(1-p_j)} \\right) \\right] \\right)^{1/2}</span>

<span class="sd">        where</span>

<span class="sd">        :math:`p_j = cdf(X\\beta)` and :math:`M_j` is the total number of</span>
<span class="sd">        observations sharing the covariate pattern :math:`j`.</span>

<span class="sd">        For now :math:`M_j` is always set to 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#These are the deviance residuals</span>
        <span class="c1">#model = self.model</span>
        <span class="n">endog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span>
        <span class="c1">#exog = model.exog</span>
        <span class="c1"># M = # of individuals that share a covariate pattern</span>
        <span class="c1"># so M[i] = 2 for i = two share a covariate pattern</span>
        <span class="n">M</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
        <span class="c1">#Y_0 = np.where(exog == 0)</span>
        <span class="c1">#Y_M = np.where(exog == M)</span>
        <span class="c1">#NOTE: Common covariate patterns are not yet handled</span>
        <span class="n">res</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">endog</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">M</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)))</span> <span class="o">+</span> \
                <span class="n">endog</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">M</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">resid_pearson</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pearson residuals</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Pearson residuals are defined to be</span>

<span class="sd">        .. math:: r_j = \\frac{(y - M_jp_j)}{\\sqrt{M_jp_j(1-p_j)}}</span>

<span class="sd">        where :math:`p_j=cdf(X\\beta)` and :math:`M_j` is the total number of</span>
<span class="sd">        observations sharing the covariate pattern :math:`j`.</span>

<span class="sd">        For now :math:`M_j` is always set to 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Pearson residuals</span>
        <span class="c1">#model = self.model</span>
        <span class="n">endog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span>
        <span class="c1">#exog = model.exog</span>
        <span class="c1"># M = # of individuals that share a covariate pattern</span>
        <span class="c1"># so M[i] = 2 for i = two share a covariate pattern</span>
        <span class="c1"># use unique row pattern?</span>
        <span class="n">M</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">endog</span> <span class="o">-</span> <span class="n">M</span><span class="o">*</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">))</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">resid_response</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The response residuals</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Response residuals are defined to be</span>

<span class="sd">        .. math:: y - p</span>

<span class="sd">        where :math:`p=cdf(X\\beta)`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span></div>


<div class="viewcode-block" id="LogitResults"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.LogitResults.html#statsmodels.discrete.discrete_model.LogitResults">[docs]</a><span class="k">class</span> <span class="nc">LogitResults</span><span class="p">(</span><span class="n">BinaryResults</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_discrete_results_docs</span> <span class="o">%</span> <span class="p">{</span>
        <span class="s2">&quot;one_line_description&quot;</span><span class="p">:</span> <span class="s2">&quot;A results class for Logit Model&quot;</span><span class="p">,</span>
        <span class="s2">&quot;extra_attr&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">resid_generalized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generalized residuals</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The generalized residuals for the Logit model are defined</span>

<span class="sd">        .. math:: y - p</span>

<span class="sd">        where :math:`p=cdf(X\\beta)`. This is the same as the `resid_response`</span>
<span class="sd">        for the Logit model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Generalized residuals</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>

<div class="viewcode-block" id="LogitResults.get_influence"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.LogitResults.get_influence.html#statsmodels.discrete.discrete_model.LogitResults.get_influence">[docs]</a>    <span class="k">def</span> <span class="nf">get_influence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an instance of MLEInfluence with influence and outlier measures</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        infl : MLEInfluence instance</span>
<span class="sd">            The instance has methods to calculate the main influence and</span>
<span class="sd">            outlier measures as attributes.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        statsmodels.stats.outliers_influence.MLEInfluence</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">statsmodels.stats.outliers_influence</span> <span class="kn">import</span> <span class="n">MLEInfluence</span>
        <span class="k">return</span> <span class="n">MLEInfluence</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ProbitResults"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.ProbitResults.html#statsmodels.discrete.discrete_model.ProbitResults">[docs]</a><span class="k">class</span> <span class="nc">ProbitResults</span><span class="p">(</span><span class="n">BinaryResults</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_discrete_results_docs</span> <span class="o">%</span> <span class="p">{</span>
        <span class="s2">&quot;one_line_description&quot;</span><span class="p">:</span> <span class="s2">&quot;A results class for Probit Model&quot;</span><span class="p">,</span>
        <span class="s2">&quot;extra_attr&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">resid_generalized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generalized residuals</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The generalized residuals for the Probit model are defined</span>

<span class="sd">        .. math:: y\\frac{\\phi(X\\beta)}{\\Phi(X\\beta)}-(1-y)\\frac{\\phi(X\\beta)}{1-\\Phi(X\\beta)}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># generalized residuals</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="n">endog</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">endog</span>
        <span class="n">XB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">XB</span><span class="p">)</span>
        <span class="n">cdf</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">XB</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">endog</span> <span class="o">*</span> <span class="n">pdf</span><span class="o">/</span><span class="n">cdf</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">endog</span><span class="p">)</span><span class="o">*</span><span class="n">pdf</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">cdf</span><span class="p">)</span></div>

<span class="k">class</span> <span class="nc">L1BinaryResults</span><span class="p">(</span><span class="n">BinaryResults</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_discrete_results_docs</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;one_line_description&quot;</span> <span class="p">:</span>
    <span class="s2">&quot;Results instance for binary data fit by l1 regularization&quot;</span><span class="p">,</span>
    <span class="s2">&quot;extra_attr&quot;</span> <span class="p">:</span> <span class="n">_l1_results_attr</span><span class="p">}</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">bnryfit</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">L1BinaryResults</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">bnryfit</span><span class="p">)</span>
        <span class="c1"># self.trimmed is a boolean array with T/F telling whether or not that</span>
        <span class="c1"># entry in params has been set zero&#39;d out.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trimmed</span> <span class="o">=</span> <span class="n">bnryfit</span><span class="o">.</span><span class="n">mle_retvals</span><span class="p">[</span><span class="s1">&#39;trimmed&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nnz_params</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">trimmed</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnz_params</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_resid</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnz_params</span><span class="p">)</span>


<div class="viewcode-block" id="MultinomialResults"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.MultinomialResults.html#statsmodels.discrete.discrete_model.MultinomialResults">[docs]</a><span class="k">class</span> <span class="nc">MultinomialResults</span><span class="p">(</span><span class="n">DiscreteResults</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_discrete_results_docs</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;one_line_description&quot;</span> <span class="p">:</span>
            <span class="s2">&quot;A results class for multinomial data&quot;</span><span class="p">,</span> <span class="s2">&quot;extra_attr&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">mlefit</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MultinomialResults</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">mlefit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">J</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">J</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">K</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_maybe_convert_ynames_int</span><span class="p">(</span><span class="n">ynames</span><span class="p">):</span>
        <span class="c1"># see if they&#39;re integers</span>
        <span class="n">issue_warning</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;endog contains values are that not int-like. Uses string &#39;</span>
               <span class="s1">&#39;representation of value. Use integer-valued endog to &#39;</span>
               <span class="s1">&#39;suppress this warning.&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ynames</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ynames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">%</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">ynames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ynames</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">issue_warning</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">ynames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ynames</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">ynames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ynames</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">issue_warning</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">SpecificationWarning</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ynames</span>

    <span class="k">def</span> <span class="nf">_get_endog_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yname</span><span class="p">,</span> <span class="n">yname_list</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If all is False, the first variable name is dropped</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="k">if</span> <span class="n">yname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yname</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">endog_names</span>
        <span class="k">if</span> <span class="n">yname_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ynames</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">_ynames_map</span>
            <span class="n">ynames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_convert_ynames_int</span><span class="p">(</span><span class="n">ynames</span><span class="p">)</span>
            <span class="c1"># use range below to ensure sortedness</span>
            <span class="n">ynames</span> <span class="o">=</span> <span class="p">[</span><span class="n">ynames</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">J</span><span class="p">))]</span>
            <span class="n">ynames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">yname</span><span class="p">,</span> <span class="n">name</span><span class="p">])</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ynames</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">:</span>
                <span class="n">yname_list</span> <span class="o">=</span> <span class="n">ynames</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="c1"># assumes first variable is dropped</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">yname_list</span> <span class="o">=</span> <span class="n">ynames</span>
        <span class="k">return</span> <span class="n">yname</span><span class="p">,</span> <span class="n">yname_list</span>

<div class="viewcode-block" id="MultinomialResults.pred_table"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.MultinomialResults.pred_table.html#statsmodels.discrete.discrete_model.MultinomialResults.pred_table">[docs]</a>    <span class="k">def</span> <span class="nf">pred_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the J x J prediction table.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        pred_table[i,j] refers to the number of times &quot;i&quot; was observed and</span>
<span class="sd">        the model predicted &quot;j&quot;. Correct predictions are along the diagonal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ju</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">J</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># highest index</span>
        <span class="c1"># these are the actual, predicted indices</span>
        <span class="c1">#idx = lzip(self.model.endog, self.predict().argmax(1))</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">ju</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">ju</span><span class="p">),</span> <span class="p">[</span><span class="n">ju</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                              <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">bse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cov_params</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">bse</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">aic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llf</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_model</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">bic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">llf</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nobs</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_model</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<div class="viewcode-block" id="MultinomialResults.conf_int"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.MultinomialResults.conf_int.html#statsmodels.discrete.discrete_model.MultinomialResults.conf_int">[docs]</a>    <span class="k">def</span> <span class="nf">conf_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.05</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">confint</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">DiscreteResults</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">conf_int</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                                                            <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">confint</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultinomialResults.get_prediction"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.MultinomialResults.get_prediction.html#statsmodels.discrete.discrete_model.MultinomialResults.get_prediction">[docs]</a>    <span class="k">def</span> <span class="nf">get_prediction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Not implemented for Multinomial</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="MultinomialResults.margeff"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.MultinomialResults.margeff.html#statsmodels.discrete.discrete_model.MultinomialResults.margeff">[docs]</a>    <span class="k">def</span> <span class="nf">margeff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Use get_margeff instead&quot;</span><span class="p">)</span></div>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">resid_misclassified</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Residuals indicating which observations are misclassified.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The residuals for the multinomial model are defined as</span>

<span class="sd">        .. math:: argmax(y_i) \\neq argmax(p_i)</span>

<span class="sd">        where :math:`argmax(y_i)` is the index of the category for the</span>
<span class="sd">        endogenous variable and :math:`argmax(p_i)` is the index of the</span>
<span class="sd">        predicted probabilities for each category. That is, the residual</span>
<span class="sd">        is a binary indicator that is 0 if the category with the highest</span>
<span class="sd">        predicted probability is the same as that of the observed variable</span>
<span class="sd">        and 1 otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># it&#39;s 0 or 1 - 0 for correct prediction and 1 for a missed one</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">wendog</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<div class="viewcode-block" id="MultinomialResults.summary2"><a class="viewcode-back" href="../../../generated/statsmodels.discrete.discrete_model.MultinomialResults.summary2.html#statsmodels.discrete.discrete_model.MultinomialResults.summary2">[docs]</a>    <span class="k">def</span> <span class="nf">summary2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.4f</span><span class="s2">&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Experimental function to summarize regression results</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        alpha : float</span>
<span class="sd">            significance level for the confidence intervals</span>
<span class="sd">        float_format : str</span>
<span class="sd">            print format for floats in parameters summary</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        smry : Summary instance</span>
<span class="sd">            this holds the summary tables and text, which can be printed or</span>
<span class="sd">            converted to various output formats.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        statsmodels.iolib.summary2.Summary : class to hold summary results</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">statsmodels.iolib</span> <span class="kn">import</span> <span class="n">summary2</span>
        <span class="n">smry</span> <span class="o">=</span> <span class="n">summary2</span><span class="o">.</span><span class="n">Summary</span><span class="p">()</span>
        <span class="n">smry</span><span class="o">.</span><span class="n">add_dict</span><span class="p">(</span><span class="n">summary2</span><span class="o">.</span><span class="n">summary_model</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="c1"># One data frame per value of endog</span>
        <span class="n">eqn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">confint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_int</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">eqn</span><span class="p">):</span>
            <span class="n">coefs</span> <span class="o">=</span> <span class="n">summary2</span><span class="o">.</span><span class="n">summary_params</span><span class="p">((</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">bse</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">pvalues</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span>
                                             <span class="n">confint</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                                            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
            <span class="c1"># Header must show value of endog</span>
            <span class="n">level_str</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog_names</span> <span class="o">+</span> <span class="s1">&#39; = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">coefs</span><span class="p">[</span><span class="n">level_str</span><span class="p">]</span> <span class="o">=</span> <span class="n">coefs</span><span class="o">.</span><span class="n">index</span>
            <span class="n">coefs</span> <span class="o">=</span> <span class="n">coefs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]]</span>
            <span class="n">smry</span><span class="o">.</span><span class="n">add_df</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">float_format</span><span class="o">=</span><span class="n">float_format</span><span class="p">)</span>
            <span class="n">smry</span><span class="o">.</span><span class="n">add_title</span><span class="p">(</span><span class="n">results</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">smry</span></div></div>


<span class="k">class</span> <span class="nc">L1MultinomialResults</span><span class="p">(</span><span class="n">MultinomialResults</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_discrete_results_docs</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;one_line_description&quot;</span> <span class="p">:</span>
        <span class="s2">&quot;A results class for multinomial data fit by l1 regularization&quot;</span><span class="p">,</span>
        <span class="s2">&quot;extra_attr&quot;</span> <span class="p">:</span> <span class="n">_l1_results_attr</span><span class="p">}</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">mlefit</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">L1MultinomialResults</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">mlefit</span><span class="p">)</span>
        <span class="c1"># self.trimmed is a boolean array with T/F telling whether or not that</span>
        <span class="c1"># entry in params has been set zero&#39;d out.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trimmed</span> <span class="o">=</span> <span class="n">mlefit</span><span class="o">.</span><span class="n">mle_retvals</span><span class="p">[</span><span class="s1">&#39;trimmed&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nnz_params</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">trimmed</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="c1"># Note: J-1 constants</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnz_params</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">J</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_resid</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnz_params</span><span class="p">)</span>


<span class="c1">#### Results Wrappers ####</span>

<span class="k">class</span> <span class="nc">OrderedResultsWrapper</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">RegressionResultsWrapper</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="n">wrap</span><span class="o">.</span><span class="n">populate_wrapper</span><span class="p">(</span><span class="n">OrderedResultsWrapper</span><span class="p">,</span> <span class="n">OrderedResults</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CountResultsWrapper</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">RegressionResultsWrapper</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="n">wrap</span><span class="o">.</span><span class="n">populate_wrapper</span><span class="p">(</span><span class="n">CountResultsWrapper</span><span class="p">,</span> <span class="n">CountResults</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">NegativeBinomialResultsWrapper</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">RegressionResultsWrapper</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="n">wrap</span><span class="o">.</span><span class="n">populate_wrapper</span><span class="p">(</span><span class="n">NegativeBinomialResultsWrapper</span><span class="p">,</span>
                      <span class="n">NegativeBinomialResults</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">NegativeBinomialPResultsWrapper</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">RegressionResultsWrapper</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="n">wrap</span><span class="o">.</span><span class="n">populate_wrapper</span><span class="p">(</span><span class="n">NegativeBinomialPResultsWrapper</span><span class="p">,</span>
                      <span class="n">NegativeBinomialPResults</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GeneralizedPoissonResultsWrapper</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">RegressionResultsWrapper</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="n">wrap</span><span class="o">.</span><span class="n">populate_wrapper</span><span class="p">(</span><span class="n">GeneralizedPoissonResultsWrapper</span><span class="p">,</span>
                      <span class="n">GeneralizedPoissonResults</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PoissonResultsWrapper</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">RegressionResultsWrapper</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="n">wrap</span><span class="o">.</span><span class="n">populate_wrapper</span><span class="p">(</span><span class="n">PoissonResultsWrapper</span><span class="p">,</span> <span class="n">PoissonResults</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">L1CountResultsWrapper</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">RegressionResultsWrapper</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">L1PoissonResultsWrapper</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">RegressionResultsWrapper</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="n">wrap</span><span class="o">.</span><span class="n">populate_wrapper</span><span class="p">(</span><span class="n">L1PoissonResultsWrapper</span><span class="p">,</span> <span class="n">L1PoissonResults</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">L1NegativeBinomialResultsWrapper</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">RegressionResultsWrapper</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="n">wrap</span><span class="o">.</span><span class="n">populate_wrapper</span><span class="p">(</span><span class="n">L1NegativeBinomialResultsWrapper</span><span class="p">,</span>
                      <span class="n">L1NegativeBinomialResults</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">L1GeneralizedPoissonResultsWrapper</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">RegressionResultsWrapper</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="n">wrap</span><span class="o">.</span><span class="n">populate_wrapper</span><span class="p">(</span><span class="n">L1GeneralizedPoissonResultsWrapper</span><span class="p">,</span>
                      <span class="n">L1GeneralizedPoissonResults</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">BinaryResultsWrapper</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">RegressionResultsWrapper</span><span class="p">):</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;resid_dev&quot;</span><span class="p">:</span> <span class="s2">&quot;rows&quot;</span><span class="p">,</span>
              <span class="s2">&quot;resid_generalized&quot;</span><span class="p">:</span> <span class="s2">&quot;rows&quot;</span><span class="p">,</span>
              <span class="s2">&quot;resid_pearson&quot;</span><span class="p">:</span> <span class="s2">&quot;rows&quot;</span><span class="p">,</span>
              <span class="s2">&quot;resid_response&quot;</span><span class="p">:</span> <span class="s2">&quot;rows&quot;</span>
              <span class="p">}</span>
    <span class="n">_wrap_attrs</span> <span class="o">=</span> <span class="n">wrap</span><span class="o">.</span><span class="n">union_dicts</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">RegressionResultsWrapper</span><span class="o">.</span><span class="n">_wrap_attrs</span><span class="p">,</span>
                                   <span class="n">_attrs</span><span class="p">)</span>


<span class="n">wrap</span><span class="o">.</span><span class="n">populate_wrapper</span><span class="p">(</span><span class="n">BinaryResultsWrapper</span><span class="p">,</span> <span class="n">BinaryResults</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">L1BinaryResultsWrapper</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">RegressionResultsWrapper</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="n">wrap</span><span class="o">.</span><span class="n">populate_wrapper</span><span class="p">(</span><span class="n">L1BinaryResultsWrapper</span><span class="p">,</span> <span class="n">L1BinaryResults</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MultinomialResultsWrapper</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">RegressionResultsWrapper</span><span class="p">):</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;resid_misclassified&quot;</span><span class="p">:</span> <span class="s2">&quot;rows&quot;</span><span class="p">}</span>
    <span class="n">_wrap_attrs</span> <span class="o">=</span> <span class="n">wrap</span><span class="o">.</span><span class="n">union_dicts</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">RegressionResultsWrapper</span><span class="o">.</span><span class="n">_wrap_attrs</span><span class="p">,</span>
                                   <span class="n">_attrs</span><span class="p">)</span>
    <span class="n">_methods</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;conf_int&#39;</span><span class="p">:</span> <span class="s1">&#39;multivariate_confint&#39;</span><span class="p">}</span>
    <span class="n">_wrap_methods</span> <span class="o">=</span> <span class="n">wrap</span><span class="o">.</span><span class="n">union_dicts</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">RegressionResultsWrapper</span><span class="o">.</span><span class="n">_wrap_methods</span><span class="p">,</span>
                                     <span class="n">_methods</span><span class="p">)</span>


<span class="n">wrap</span><span class="o">.</span><span class="n">populate_wrapper</span><span class="p">(</span><span class="n">MultinomialResultsWrapper</span><span class="p">,</span> <span class="n">MultinomialResults</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">L1MultinomialResultsWrapper</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">RegressionResultsWrapper</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="n">wrap</span><span class="o">.</span><span class="n">populate_wrapper</span><span class="p">(</span><span class="n">L1MultinomialResultsWrapper</span><span class="p">,</span> <span class="n">L1MultinomialResults</span><span class="p">)</span>
</code></pre></div>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      Jun 26, 2023
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  
  
  <div class="md-footer-meta md-typeset">
    
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-footer-copyright__highlight">
        &#169; Copyright 2009-2023, Josef Perktold, Skipper Seabold, Jonathan Taylor, statsmodels-developers.
        
    </div>
  
    Created using
    <a href="https://www.sphinx-doc.org/" target="_blank" rel="noopener">Sphinx</a>
    7.0.1.
     and
    <a href="https://github.com/jbms/sphinx-immaterial/" target="_blank" rel="noopener">Sphinx-Immaterial</a>
  
</div>
      
        <div class="md-social">
  
    
    
    <a href="https://github.com/statsmodels/statsmodels/" target="_blank" rel="noopener" title="Source on github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://pypi.org/project/statsmodels/" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://doi.org/10.5281/zenodo.593847" target="_blank" rel="noopener" title="doi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M0 216C0 149.7 53.7 96 120 96h8c17.7 0 32 14.3 32 32s-14.3 32-32 32h-8c-30.9 0-56 25.1-56 56v8h64c35.3 0 64 28.7 64 64v64c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V216zm256 0c0-66.3 53.7-120 120-120h8c17.7 0 32 14.3 32 32s-14.3 32-32 32h-8c-30.9 0-56 25.1-56 56v8h64c35.3 0 64 28.7 64 64v64c0 35.3-28.7 64-64 64h-64c-35.3 0-64-28.7-64-64V216z"/></svg>
    </a>
  
</div>
      
    </div>
    
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike", "staticVersions": null, "versionPath": "../versions-v3.json"}}</script>
    
      
        <script src="../../../_static/sphinx_immaterial_theme.1b5b7a2d5891aec19.min.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
  </body>
</html>