


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../_static/favicon.ico">
    
    
  
      
        <title>statsmodels.tsa.stattools - statsmodels 0.15.0 (+309)</title>
      
    
  <link rel="icon" type="image/png" sizes="32x32" href="../../../_static/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../../../_static/icons/favicon-16x16.png">
  <link rel="manifest" href="../../../_static/icons/site.webmanifest">
  <link rel="mask-icon" href="../../../_static/icons/safari-pinned-tab.svg" color="#919191">
  <meta name="msapplication-TileColor" content="#2b5797">
  <meta name="msapplication-config" content="../../../_static/icons/browserconfig.xml">
  <link rel="stylesheet" href="../../../_static/stylesheets/examples.css">
  <link rel="stylesheet" href="../../../_static/stylesheets/deprecation.css">
    
      
        
        
          
          
          <meta name="theme-color" content="#4051b5">
        
      
      

    
    
    
      
        
        
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
        <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_immaterial_theme.e0b5691b38cca82da.min.css?v=b1736040" />
        <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=fd3f3429" />
        <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../index.html" title="statsmodels 0.15.0 (+309)" class="md-header__button md-logo" aria-label="statsmodels 0.15.0 (+309)" data-md-component="logo">
      <img src="../../../_static/statsmodels-logo-v2-bw.svg" alt="logo">
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            statsmodels 0.15.0 (+309)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              statsmodels.tsa.stattools
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/statsmodels/statsmodels/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    statsmodels
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../index.html" title="statsmodels 0.15.0 (+309)" class="md-nav__button md-logo" aria-label="statsmodels 0.15.0 (+309)" data-md-component="logo">
      <img src="../../../_static/statsmodels-logo-v2-bw.svg" alt="logo">
    </a>
    statsmodels 0.15.0 (+309)
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/statsmodels/statsmodels/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    statsmodels
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../../install.html" class="md-nav__link">
        <span title="/install.rst (reference label)" class="md-ellipsis">Installing statsmodels</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../../gettingstarted.html" class="md-nav__link">
        <span title="/gettingstarted.rst (reference label)" class="md-ellipsis">Getting started</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user-guide.html" class="md-nav__link">
        <span title="/user-guide.rst (reference label)" class="md-ellipsis">User Guide</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/index.html" class="md-nav__link">
        <span title="/examples/index.rst (reference label)" class="md-ellipsis">Examples</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api.html" class="md-nav__link">
        <span title="/api.rst (reference label)" class="md-ellipsis">API Reference</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../../about.html" class="md-nav__link">
        <span title="/about.rst (reference label)" class="md-ellipsis">About statsmodels</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dev/index.html" class="md-nav__link">
        <span title="/dev/index.rst (reference label)" class="md-ellipsis">Developer Page</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../../release/index.html" class="md-nav__link">
        <span title="/release/index.rst (reference label)" class="md-ellipsis">Release Notes</span>
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary">
  
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset" role="main">
                  


<h1>Source code for statsmodels.tsa.stattools</h1><div class="highlight"><pre>
<span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Statistical tools for time series analysis</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">statsmodels.compat.numpy</span> <span class="kn">import</span> <span class="n">lstsq</span>
<span class="kn">from</span> <span class="nn">statsmodels.compat.pandas</span> <span class="kn">import</span> <span class="n">deprecate_kwarg</span>
<span class="kn">from</span> <span class="nn">statsmodels.compat.python</span> <span class="kn">import</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">lzip</span>
<span class="kn">from</span> <span class="nn">statsmodels.compat.scipy</span> <span class="kn">import</span> <span class="n">_next_regular</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">LinAlgError</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">correlate</span>

<span class="kn">from</span> <span class="nn">statsmodels.regression.linear_model</span> <span class="kn">import</span> <span class="n">OLS</span><span class="p">,</span> <span class="n">yule_walker</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools.sm_exceptions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CollinearityWarning</span><span class="p">,</span>
    <span class="n">InfeasibleTestError</span><span class="p">,</span>
    <span class="n">InterpolationWarning</span><span class="p">,</span>
    <span class="n">MissingDataError</span><span class="p">,</span>
    <span class="n">ValueWarning</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools.tools</span> <span class="kn">import</span> <span class="n">Bunch</span><span class="p">,</span> <span class="n">add_constant</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools.validation</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">array_like</span><span class="p">,</span>
    <span class="n">bool_like</span><span class="p">,</span>
    <span class="n">dict_like</span><span class="p">,</span>
    <span class="n">float_like</span><span class="p">,</span>
    <span class="n">int_like</span><span class="p">,</span>
    <span class="n">string_like</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa._bds</span> <span class="kn">import</span> <span class="n">bds</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa._innovations</span> <span class="kn">import</span> <span class="n">innovations_algo</span><span class="p">,</span> <span class="n">innovations_filter</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.adfvalues</span> <span class="kn">import</span> <span class="n">mackinnoncrit</span><span class="p">,</span> <span class="n">mackinnonp</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.tsatools</span> <span class="kn">import</span> <span class="n">add_trend</span><span class="p">,</span> <span class="n">lagmat</span><span class="p">,</span> <span class="n">lagmat2ds</span>

<span class="n">ArrayLike1D</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;acovf&quot;</span><span class="p">,</span>
    <span class="s2">&quot;acf&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pacf&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pacf_yw&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pacf_ols&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ccovf&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ccf&quot;</span><span class="p">,</span>
    <span class="s2">&quot;q_stat&quot;</span><span class="p">,</span>
    <span class="s2">&quot;coint&quot;</span><span class="p">,</span>
    <span class="s2">&quot;arma_order_select_ic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;adfuller&quot;</span><span class="p">,</span>
    <span class="s2">&quot;kpss&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bds&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pacf_burg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;innovations_algo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;innovations_filter&quot;</span><span class="p">,</span>
    <span class="s2">&quot;levinson_durbin_pacf&quot;</span><span class="p">,</span>
    <span class="s2">&quot;levinson_durbin&quot;</span><span class="p">,</span>
    <span class="s2">&quot;zivot_andrews&quot;</span><span class="p">,</span>
    <span class="s2">&quot;range_unit_root_test&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">SQRTEPS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_autolag</span><span class="p">(</span>
    <span class="n">mod</span><span class="p">,</span>
    <span class="n">endog</span><span class="p">,</span>
    <span class="n">exog</span><span class="p">,</span>
    <span class="n">startlag</span><span class="p">,</span>
    <span class="n">maxlag</span><span class="p">,</span>
    <span class="n">method</span><span class="p">,</span>
    <span class="n">modargs</span><span class="o">=</span><span class="p">(),</span>
    <span class="n">fitargs</span><span class="o">=</span><span class="p">(),</span>
    <span class="n">regresults</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the results for the lag length that maximizes the info criterion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mod : Model class</span>
<span class="sd">        Model estimator class</span>
<span class="sd">    endog : array_like</span>
<span class="sd">        nobs array containing endogenous variable</span>
<span class="sd">    exog : array_like</span>
<span class="sd">        nobs by (startlag + maxlag) array containing lags and possibly other</span>
<span class="sd">        variables</span>
<span class="sd">    startlag : int</span>
<span class="sd">        The first zero-indexed column to hold a lag.  See Notes.</span>
<span class="sd">    maxlag : int</span>
<span class="sd">        The highest lag order for lag length selection.</span>
<span class="sd">    method : {&quot;aic&quot;, &quot;bic&quot;, &quot;t-stat&quot;}</span>
<span class="sd">        aic - Akaike Information Criterion</span>
<span class="sd">        bic - Bayes Information Criterion</span>
<span class="sd">        t-stat - Based on last lag</span>
<span class="sd">    modargs : tuple, optional</span>
<span class="sd">        args to pass to model.  See notes.</span>
<span class="sd">    fitargs : tuple, optional</span>
<span class="sd">        args to pass to fit.  See notes.</span>
<span class="sd">    regresults : bool, optional</span>
<span class="sd">        Flag indicating to return optional return results</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    icbest : float</span>
<span class="sd">        Best information criteria.</span>
<span class="sd">    bestlag : int</span>
<span class="sd">        The lag length that maximizes the information criterion.</span>
<span class="sd">    results : dict, optional</span>
<span class="sd">        Dictionary containing all estimation results</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Does estimation like mod(endog, exog[:,:i], *modargs).fit(*fitargs)</span>
<span class="sd">    where i goes from lagstart to lagstart+maxlag+1.  Therefore, lags are</span>
<span class="sd">    assumed to be in contiguous columns from low to high lag length with</span>
<span class="sd">    the highest lag in the last column.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: can tcol be replaced by maxlag + 2?</span>
    <span class="c1"># TODO: This could be changed to laggedRHS and exog keyword arguments if</span>
    <span class="c1">#    this will be more general.</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">startlag</span><span class="p">,</span> <span class="n">startlag</span> <span class="o">+</span> <span class="n">maxlag</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">mod_instance</span> <span class="o">=</span> <span class="n">mod</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">[:,</span> <span class="p">:</span><span class="n">lag</span><span class="p">],</span> <span class="o">*</span><span class="n">modargs</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="n">lag</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod_instance</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;aic&quot;</span><span class="p">:</span>
        <span class="n">icbest</span><span class="p">,</span> <span class="n">bestlag</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">v</span><span class="o">.</span><span class="n">aic</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;bic&quot;</span><span class="p">:</span>
        <span class="n">icbest</span><span class="p">,</span> <span class="n">bestlag</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">v</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;t-stat&quot;</span><span class="p">:</span>
        <span class="c1"># stop = stats.norm.ppf(.95)</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="mf">1.6448536269514722</span>
        <span class="c1"># Default values to ensure that always set</span>
        <span class="n">bestlag</span> <span class="o">=</span> <span class="n">startlag</span> <span class="o">+</span> <span class="n">maxlag</span>
        <span class="n">icbest</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">startlag</span> <span class="o">+</span> <span class="n">maxlag</span><span class="p">,</span> <span class="n">startlag</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">icbest</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">lag</span><span class="p">]</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">bestlag</span> <span class="o">=</span> <span class="n">lag</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">icbest</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">stop</span><span class="p">:</span>
                <span class="c1"># Break for first lag with a significant t-stat</span>
                <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Information Criterion </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> not understood.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">regresults</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">icbest</span><span class="p">,</span> <span class="n">bestlag</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">icbest</span><span class="p">,</span> <span class="n">bestlag</span><span class="p">,</span> <span class="n">results</span>


<span class="c1"># this needs to be converted to a class like HetGoldfeldQuandt,</span>
<span class="c1"># 3 different returns are a mess</span>
<span class="c1"># See:</span>
<span class="c1"># Ng and Perron(2001), Lag length selection and the construction of unit root</span>
<span class="c1"># tests with good size and power, Econometrica, Vol 69 (6) pp 1519-1554</span>
<span class="c1"># TODO: include drift keyword, only valid with regression == &quot;c&quot;</span>
<span class="c1"># just changes the distribution of the test statistic to a t distribution</span>
<span class="c1"># TODO: autolag is untested</span>
<div class="viewcode-block" id="adfuller">
<a class="viewcode-back" href="../../../generated/statsmodels.tsa.stattools.adfuller.html#statsmodels.tsa.stattools.adfuller">[docs]</a>
<span class="k">def</span> <span class="nf">adfuller</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">maxlag</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">regression</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">,</span>
    <span class="n">autolag</span><span class="o">=</span><span class="s2">&quot;AIC&quot;</span><span class="p">,</span>
    <span class="n">store</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">regresults</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Augmented Dickey-Fuller unit root test.</span>

<span class="sd">    The Augmented Dickey-Fuller test can be used to test for a unit root in a</span>
<span class="sd">    univariate process in the presence of serial correlation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like, 1d</span>
<span class="sd">        The data series to test.</span>
<span class="sd">    maxlag : {None, int}</span>
<span class="sd">        Maximum lag which is included in test, default value of</span>
<span class="sd">        12*(nobs/100)^{1/4} is used when ``None``.</span>
<span class="sd">    regression : {&quot;c&quot;,&quot;ct&quot;,&quot;ctt&quot;,&quot;n&quot;}</span>
<span class="sd">        Constant and trend order to include in regression.</span>

<span class="sd">        * &quot;c&quot; : constant only (default).</span>
<span class="sd">        * &quot;ct&quot; : constant and trend.</span>
<span class="sd">        * &quot;ctt&quot; : constant, and linear and quadratic trend.</span>
<span class="sd">        * &quot;n&quot; : no constant, no trend.</span>

<span class="sd">    autolag : {&quot;AIC&quot;, &quot;BIC&quot;, &quot;t-stat&quot;, None}</span>
<span class="sd">        Method to use when automatically determining the lag length among the</span>
<span class="sd">        values 0, 1, ..., maxlag.</span>

<span class="sd">        * If &quot;AIC&quot; (default) or &quot;BIC&quot;, then the number of lags is chosen</span>
<span class="sd">          to minimize the corresponding information criterion.</span>
<span class="sd">        * &quot;t-stat&quot; based choice of maxlag.  Starts with maxlag and drops a</span>
<span class="sd">          lag until the t-statistic on the last lag length is significant</span>
<span class="sd">          using a 5%-sized test.</span>
<span class="sd">        * If None, then the number of included lags is set to maxlag.</span>
<span class="sd">    store : bool</span>
<span class="sd">        If True, then a result instance is returned additionally to</span>
<span class="sd">        the adf statistic. Default is False.</span>
<span class="sd">    regresults : bool, optional</span>
<span class="sd">        If True, the full regression results are returned. Default is False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    adf : float</span>
<span class="sd">        The test statistic.</span>
<span class="sd">    pvalue : float</span>
<span class="sd">        MacKinnon&#39;s approximate p-value based on MacKinnon (1994, 2010).</span>
<span class="sd">    usedlag : int</span>
<span class="sd">        The number of lags used.</span>
<span class="sd">    nobs : int</span>
<span class="sd">        The number of observations used for the ADF regression and calculation</span>
<span class="sd">        of the critical values.</span>
<span class="sd">    critical values : dict</span>
<span class="sd">        Critical values for the test statistic at the 1 %, 5 %, and 10 %</span>
<span class="sd">        levels. Based on MacKinnon (2010).</span>
<span class="sd">    icbest : float</span>
<span class="sd">        The maximized information criterion if autolag is not None.</span>
<span class="sd">    resstore : ResultStore, optional</span>
<span class="sd">        A dummy class with results attached as attributes.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The null hypothesis of the Augmented Dickey-Fuller is that there is a unit</span>
<span class="sd">    root, with the alternative that there is no unit root. If the pvalue is</span>
<span class="sd">    above a critical size, then we cannot reject that there is a unit root.</span>

<span class="sd">    The p-values are obtained through regression surface approximation from</span>
<span class="sd">    MacKinnon 1994, but using the updated 2010 tables. If the p-value is close</span>
<span class="sd">    to significant, then the critical values should be used to judge whether</span>
<span class="sd">    to reject the null.</span>

<span class="sd">    The autolag option and maxlag for it are described in Greene.</span>

<span class="sd">    See the notebook `Stationarity and detrending (ADF/KPSS)</span>
<span class="sd">    &lt;../examples/notebooks/generated/stationarity_detrending_adf_kpss.html&gt;`__</span>
<span class="sd">    for an overview.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] W. Green.  &quot;Econometric Analysis,&quot; 5th ed., Pearson, 2003.</span>

<span class="sd">    .. [2] Hamilton, J.D.  &quot;Time Series Analysis&quot;.  Princeton, 1994.</span>

<span class="sd">    .. [3] MacKinnon, J.G. 1994.  &quot;Approximate asymptotic distribution functions for</span>
<span class="sd">        unit-root and cointegration tests.  `Journal of Business and Economic</span>
<span class="sd">        Statistics` 12, 167-76.</span>

<span class="sd">    .. [4] MacKinnon, J.G. 2010. &quot;Critical Values for Cointegration Tests.&quot;  Queen&quot;s</span>
<span class="sd">        University, Dept of Economics, Working Papers.  Available at</span>
<span class="sd">        http://ideas.repec.org/p/qed/wpaper/1227.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">array_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
    <span class="n">maxlag</span> <span class="o">=</span> <span class="n">int_like</span><span class="p">(</span><span class="n">maxlag</span><span class="p">,</span> <span class="s2">&quot;maxlag&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">regression</span> <span class="o">=</span> <span class="n">string_like</span><span class="p">(</span>
        <span class="n">regression</span><span class="p">,</span> <span class="s2">&quot;regression&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;ct&quot;</span><span class="p">,</span> <span class="s2">&quot;ctt&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">autolag</span> <span class="o">=</span> <span class="n">string_like</span><span class="p">(</span>
        <span class="n">autolag</span><span class="p">,</span> <span class="s2">&quot;autolag&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;aic&quot;</span><span class="p">,</span> <span class="s2">&quot;bic&quot;</span><span class="p">,</span> <span class="s2">&quot;t-stat&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">store</span> <span class="o">=</span> <span class="n">bool_like</span><span class="p">(</span><span class="n">store</span><span class="p">,</span> <span class="s2">&quot;store&quot;</span><span class="p">)</span>
    <span class="n">regresults</span> <span class="o">=</span> <span class="n">bool_like</span><span class="p">(</span><span class="n">regresults</span><span class="p">,</span> <span class="s2">&quot;regresults&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid input, x is constant&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">regresults</span><span class="p">:</span>
        <span class="n">store</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">trenddict</span> <span class="o">=</span> <span class="p">{</span><span class="kc">None</span><span class="p">:</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;ct&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;ctt&quot;</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">regression</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">regression</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">regression</span> <span class="o">=</span> <span class="n">trenddict</span><span class="p">[</span><span class="n">regression</span><span class="p">]</span>
    <span class="n">regression</span> <span class="o">=</span> <span class="n">regression</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">nobs</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">ntrend</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">regression</span><span class="p">)</span> <span class="k">if</span> <span class="n">regression</span> <span class="o">!=</span> <span class="s2">&quot;n&quot;</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">maxlag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># from Greene referencing Schwert 1989</span>
        <span class="n">maxlag</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mf">12.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">nobs</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">)))</span>
        <span class="c1"># -1 for the diff</span>
        <span class="n">maxlag</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nobs</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">ntrend</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">maxlag</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">maxlag</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;sample size is too short to use selected &quot;</span>
                <span class="s2">&quot;regression component&quot;</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">maxlag</span> <span class="o">&gt;</span> <span class="n">nobs</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">ntrend</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;maxlag must be less than (nobs/2 - 1 - ntrend) &quot;</span>
            <span class="s2">&quot;where n trend is the number of included &quot;</span>
            <span class="s2">&quot;deterministic regressors&quot;</span>
        <span class="p">)</span>
    <span class="n">xdiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">xdall</span> <span class="o">=</span> <span class="n">lagmat</span><span class="p">(</span><span class="n">xdiff</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">maxlag</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">original</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">)</span>
    <span class="n">nobs</span> <span class="o">=</span> <span class="n">xdall</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">xdall</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="n">nobs</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># replace 0 xdiff with level of x</span>
    <span class="n">xdshort</span> <span class="o">=</span> <span class="n">xdiff</span><span class="p">[</span><span class="o">-</span><span class="n">nobs</span><span class="p">:]</span>

    <span class="k">if</span> <span class="n">store</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">statsmodels.stats.diagnostic</span> <span class="kn">import</span> <span class="n">ResultsStore</span>

        <span class="n">resstore</span> <span class="o">=</span> <span class="n">ResultsStore</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">autolag</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">regression</span> <span class="o">!=</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span>
            <span class="n">fullRHS</span> <span class="o">=</span> <span class="n">add_trend</span><span class="p">(</span><span class="n">xdall</span><span class="p">,</span> <span class="n">regression</span><span class="p">,</span> <span class="n">prepend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fullRHS</span> <span class="o">=</span> <span class="n">xdall</span>
        <span class="n">startlag</span> <span class="o">=</span> <span class="n">fullRHS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xdall</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="c1"># 1 for level</span>
        <span class="c1"># search for lag length with smallest information criteria</span>
        <span class="c1"># Note: use the same number of observations to have comparable IC</span>
        <span class="c1"># aic and bic: smaller is better</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">regresults</span><span class="p">:</span>
            <span class="n">icbest</span><span class="p">,</span> <span class="n">bestlag</span> <span class="o">=</span> <span class="n">_autolag</span><span class="p">(</span>
                <span class="n">OLS</span><span class="p">,</span> <span class="n">xdshort</span><span class="p">,</span> <span class="n">fullRHS</span><span class="p">,</span> <span class="n">startlag</span><span class="p">,</span> <span class="n">maxlag</span><span class="p">,</span> <span class="n">autolag</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">icbest</span><span class="p">,</span> <span class="n">bestlag</span><span class="p">,</span> <span class="n">alres</span> <span class="o">=</span> <span class="n">_autolag</span><span class="p">(</span>
                <span class="n">OLS</span><span class="p">,</span>
                <span class="n">xdshort</span><span class="p">,</span>
                <span class="n">fullRHS</span><span class="p">,</span>
                <span class="n">startlag</span><span class="p">,</span>
                <span class="n">maxlag</span><span class="p">,</span>
                <span class="n">autolag</span><span class="p">,</span>
                <span class="n">regresults</span><span class="o">=</span><span class="n">regresults</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">resstore</span><span class="o">.</span><span class="n">autolag_results</span> <span class="o">=</span> <span class="n">alres</span>

        <span class="n">bestlag</span> <span class="o">-=</span> <span class="n">startlag</span>  <span class="c1"># convert to lag not column index</span>

        <span class="c1"># rerun ols with best autolag</span>
        <span class="n">xdall</span> <span class="o">=</span> <span class="n">lagmat</span><span class="p">(</span><span class="n">xdiff</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">bestlag</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">original</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">)</span>
        <span class="n">nobs</span> <span class="o">=</span> <span class="n">xdall</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xdall</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="n">nobs</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># replace 0 xdiff with level of x</span>
        <span class="n">xdshort</span> <span class="o">=</span> <span class="n">xdiff</span><span class="p">[</span><span class="o">-</span><span class="n">nobs</span><span class="p">:]</span>
        <span class="n">usedlag</span> <span class="o">=</span> <span class="n">bestlag</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">usedlag</span> <span class="o">=</span> <span class="n">maxlag</span>
        <span class="n">icbest</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">regression</span> <span class="o">!=</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span>
        <span class="n">resols</span> <span class="o">=</span> <span class="n">OLS</span><span class="p">(</span>
            <span class="n">xdshort</span><span class="p">,</span> <span class="n">add_trend</span><span class="p">(</span><span class="n">xdall</span><span class="p">[:,</span> <span class="p">:</span> <span class="n">usedlag</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">regression</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">resols</span> <span class="o">=</span> <span class="n">OLS</span><span class="p">(</span><span class="n">xdshort</span><span class="p">,</span> <span class="n">xdall</span><span class="p">[:,</span> <span class="p">:</span> <span class="n">usedlag</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

    <span class="n">adfstat</span> <span class="o">=</span> <span class="n">resols</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1">#    adfstat = (resols.params[0]-1.0)/resols.bse[0]</span>
    <span class="c1"># the &quot;asymptotically correct&quot; z statistic is obtained as</span>
    <span class="c1"># nobs/(1-np.sum(resols.params[1:-(trendorder+1)])) (resols.params[0] - 1)</span>
    <span class="c1"># I think this is the statistic that is used for series that are integrated</span>
    <span class="c1"># for orders higher than I(1), ie., not ADF but cointegration tests.</span>

    <span class="c1"># Get approx p-value and critical values</span>
    <span class="n">pvalue</span> <span class="o">=</span> <span class="n">mackinnonp</span><span class="p">(</span><span class="n">adfstat</span><span class="p">,</span> <span class="n">regression</span><span class="o">=</span><span class="n">regression</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">critvalues</span> <span class="o">=</span> <span class="n">mackinnoncrit</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">regression</span><span class="o">=</span><span class="n">regression</span><span class="p">,</span> <span class="n">nobs</span><span class="o">=</span><span class="n">nobs</span><span class="p">)</span>
    <span class="n">critvalues</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;1%&quot;</span><span class="p">:</span> <span class="n">critvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;5%&quot;</span><span class="p">:</span> <span class="n">critvalues</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="s2">&quot;10%&quot;</span><span class="p">:</span> <span class="n">critvalues</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">store</span><span class="p">:</span>
        <span class="n">resstore</span><span class="o">.</span><span class="n">resols</span> <span class="o">=</span> <span class="n">resols</span>
        <span class="n">resstore</span><span class="o">.</span><span class="n">maxlag</span> <span class="o">=</span> <span class="n">maxlag</span>
        <span class="n">resstore</span><span class="o">.</span><span class="n">usedlag</span> <span class="o">=</span> <span class="n">usedlag</span>
        <span class="n">resstore</span><span class="o">.</span><span class="n">adfstat</span> <span class="o">=</span> <span class="n">adfstat</span>
        <span class="n">resstore</span><span class="o">.</span><span class="n">critvalues</span> <span class="o">=</span> <span class="n">critvalues</span>
        <span class="n">resstore</span><span class="o">.</span><span class="n">nobs</span> <span class="o">=</span> <span class="n">nobs</span>
        <span class="n">resstore</span><span class="o">.</span><span class="n">H0</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The coefficient on the lagged level equals 1 - &quot;</span> <span class="s2">&quot;unit root&quot;</span>
        <span class="p">)</span>
        <span class="n">resstore</span><span class="o">.</span><span class="n">HA</span> <span class="o">=</span> <span class="s2">&quot;The coefficient on the lagged level &lt; 1 - stationary&quot;</span>
        <span class="n">resstore</span><span class="o">.</span><span class="n">icbest</span> <span class="o">=</span> <span class="n">icbest</span>
        <span class="n">resstore</span><span class="o">.</span><span class="n">_str</span> <span class="o">=</span> <span class="s2">&quot;Augmented Dickey-Fuller Test Results&quot;</span>
        <span class="k">return</span> <span class="n">adfstat</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">,</span> <span class="n">critvalues</span><span class="p">,</span> <span class="n">resstore</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">autolag</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">adfstat</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">,</span> <span class="n">usedlag</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="n">critvalues</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">adfstat</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">,</span> <span class="n">usedlag</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="n">critvalues</span><span class="p">,</span> <span class="n">icbest</span></div>



<div class="viewcode-block" id="acovf">
<a class="viewcode-back" href="../../../generated/statsmodels.tsa.stattools.acovf.html#statsmodels.tsa.stattools.acovf">[docs]</a>
<span class="nd">@deprecate_kwarg</span><span class="p">(</span><span class="s2">&quot;unbiased&quot;</span><span class="p">,</span> <span class="s2">&quot;adjusted&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">acovf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">adjusted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">demean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fft</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">nlag</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimate autocovariances.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Time series data. Must be 1d.</span>
<span class="sd">    adjusted : bool, default False</span>
<span class="sd">        If True, then denominators is n-k, otherwise n.</span>
<span class="sd">    demean : bool, default True</span>
<span class="sd">        If True, then subtract the mean x from each element of x.</span>
<span class="sd">    fft : bool, default True</span>
<span class="sd">        If True, use FFT convolution.  This method should be preferred</span>
<span class="sd">        for long time series.</span>
<span class="sd">    missing : str, default &quot;none&quot;</span>
<span class="sd">        A string in [&quot;none&quot;, &quot;raise&quot;, &quot;conservative&quot;, &quot;drop&quot;] specifying how</span>
<span class="sd">        the NaNs are to be treated. &quot;none&quot; performs no checks. &quot;raise&quot; raises</span>
<span class="sd">        an exception if NaN values are found. &quot;drop&quot; removes the missing</span>
<span class="sd">        observations and then estimates the autocovariances treating the</span>
<span class="sd">        non-missing as contiguous. &quot;conservative&quot; computes the autocovariance</span>
<span class="sd">        using nan-ops so that nans are removed when computing the mean</span>
<span class="sd">        and cross-products that are used to estimate the autocovariance.</span>
<span class="sd">        When using &quot;conservative&quot;, n is set to the number of non-missing</span>
<span class="sd">        observations.</span>
<span class="sd">    nlag : {int, None}, default None</span>
<span class="sd">        Limit the number of autocovariances returned.  Size of returned</span>
<span class="sd">        array is nlag + 1.  Setting nlag when fft is False uses a simple,</span>
<span class="sd">        direct estimator of the autocovariances that only computes the first</span>
<span class="sd">        nlag + 1 values. This can be much faster when the time series is long</span>
<span class="sd">        and only a small number of autocovariances are needed.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ndarray</span>
<span class="sd">        The estimated autocovariances.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Parzen, E., 1963. On spectral analysis with missing observations</span>
<span class="sd">           and amplitude modulation. Sankhya: The Indian Journal of</span>
<span class="sd">           Statistics, Series A, pp.383-392.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">adjusted</span> <span class="o">=</span> <span class="n">bool_like</span><span class="p">(</span><span class="n">adjusted</span><span class="p">,</span> <span class="s2">&quot;adjusted&quot;</span><span class="p">)</span>
    <span class="n">demean</span> <span class="o">=</span> <span class="n">bool_like</span><span class="p">(</span><span class="n">demean</span><span class="p">,</span> <span class="s2">&quot;demean&quot;</span><span class="p">)</span>
    <span class="n">fft</span> <span class="o">=</span> <span class="n">bool_like</span><span class="p">(</span><span class="n">fft</span><span class="p">,</span> <span class="s2">&quot;fft&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="n">string_like</span><span class="p">(</span>
        <span class="n">missing</span><span class="p">,</span> <span class="s2">&quot;missing&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;conservative&quot;</span><span class="p">,</span> <span class="s2">&quot;drop&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">nlag</span> <span class="o">=</span> <span class="n">int_like</span><span class="p">(</span><span class="n">nlag</span><span class="p">,</span> <span class="s2">&quot;nlag&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">array_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">missing</span> <span class="o">=</span> <span class="n">missing</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">missing</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
        <span class="n">deal_with_masked</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">deal_with_masked</span> <span class="o">=</span> <span class="n">has_missing</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">deal_with_masked</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">missing</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MissingDataError</span><span class="p">(</span><span class="s2">&quot;NaNs were encountered in the data&quot;</span><span class="p">)</span>
        <span class="n">notmask_bool</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># bool</span>
        <span class="k">if</span> <span class="n">missing</span> <span class="o">==</span> <span class="s2">&quot;conservative&quot;</span><span class="p">:</span>
            <span class="c1"># Must copy for thread safety</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">x</span><span class="p">[</span><span class="o">~</span><span class="n">notmask_bool</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># &quot;drop&quot;</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">notmask_bool</span><span class="p">]</span>  <span class="c1"># copies non-missing</span>
        <span class="n">notmask_int</span> <span class="o">=</span> <span class="n">notmask_bool</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># int</span>

    <span class="k">if</span> <span class="n">demean</span> <span class="ow">and</span> <span class="n">deal_with_masked</span><span class="p">:</span>
        <span class="c1"># whether &quot;drop&quot; or &quot;conservative&quot;:</span>
        <span class="n">xo</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">notmask_int</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">missing</span> <span class="o">==</span> <span class="s2">&quot;conservative&quot;</span><span class="p">:</span>
            <span class="n">xo</span><span class="p">[</span><span class="o">~</span><span class="n">notmask_bool</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">demean</span><span class="p">:</span>
        <span class="n">xo</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xo</span> <span class="o">=</span> <span class="n">x</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">lag_len</span> <span class="o">=</span> <span class="n">nlag</span>
    <span class="k">if</span> <span class="n">nlag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lag_len</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">nlag</span> <span class="o">&gt;</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;nlag must be smaller than nobs - 1&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">fft</span> <span class="ow">and</span> <span class="n">nlag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">acov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">lag_len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">acov</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">xo</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lag_len</span><span class="p">):</span>
            <span class="n">acov</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xo</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">xo</span><span class="p">[:</span> <span class="o">-</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">deal_with_masked</span> <span class="ow">or</span> <span class="n">missing</span> <span class="o">==</span> <span class="s2">&quot;drop&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">adjusted</span><span class="p">:</span>
                <span class="n">acov</span> <span class="o">/=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lag_len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">acov</span> <span class="o">/=</span> <span class="n">n</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">adjusted</span><span class="p">:</span>
                <span class="n">divisor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">lag_len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
                <span class="n">divisor</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">notmask_int</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lag_len</span><span class="p">):</span>
                    <span class="n">divisor</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">notmask_int</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span>
                        <span class="n">notmask_int</span><span class="p">[:</span> <span class="o">-</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
                    <span class="p">)</span>
                <span class="n">divisor</span><span class="p">[</span><span class="n">divisor</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">acov</span> <span class="o">/=</span> <span class="n">divisor</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># biased, missing data but npt &quot;drop&quot;</span>
                <span class="n">acov</span> <span class="o">/=</span> <span class="n">notmask_int</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">acov</span>

    <span class="k">if</span> <span class="n">adjusted</span> <span class="ow">and</span> <span class="n">deal_with_masked</span> <span class="ow">and</span> <span class="n">missing</span> <span class="o">==</span> <span class="s2">&quot;conservative&quot;</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">notmask_int</span><span class="p">,</span> <span class="n">notmask_int</span><span class="p">,</span> <span class="s2">&quot;full&quot;</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="n">d</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">adjusted</span><span class="p">:</span>
        <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">xi</span><span class="p">,</span> <span class="n">xi</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">elif</span> <span class="n">deal_with_masked</span><span class="p">:</span>
        <span class="c1"># biased and NaNs given and (&quot;drop&quot; or &quot;conservative&quot;)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">notmask_int</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># biased and no NaNs or missing==&quot;none&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fft</span><span class="p">:</span>
        <span class="n">nobs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xo</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">_next_regular</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">nobs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">Frf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">xo</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
        <span class="n">acov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">Frf</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">Frf</span><span class="p">))[:</span><span class="n">nobs</span><span class="p">]</span> <span class="o">/</span> <span class="n">d</span><span class="p">[</span><span class="n">nobs</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:]</span>
        <span class="n">acov</span> <span class="o">=</span> <span class="n">acov</span><span class="o">.</span><span class="n">real</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">acov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">xo</span><span class="p">,</span> <span class="n">xo</span><span class="p">,</span> <span class="s2">&quot;full&quot;</span><span class="p">)[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:]</span> <span class="o">/</span> <span class="n">d</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:]</span>

    <span class="k">if</span> <span class="n">nlag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Copy to allow gc of full array rather than view</span>
        <span class="k">return</span> <span class="n">acov</span><span class="p">[:</span> <span class="n">lag_len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">acov</span></div>



<div class="viewcode-block" id="q_stat">
<a class="viewcode-back" href="../../../generated/statsmodels.tsa.stattools.q_stat.html#statsmodels.tsa.stattools.q_stat">[docs]</a>
<span class="k">def</span> <span class="nf">q_stat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nobs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute Ljung-Box Q Statistic.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Array of autocorrelation coefficients.  Can be obtained from acf.</span>
<span class="sd">    nobs : int, optional</span>
<span class="sd">        Number of observations in the entire sample (ie., not just the length</span>
<span class="sd">        of the autocorrelation function results.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    q-stat : ndarray</span>
<span class="sd">        Ljung-Box Q-statistic for autocorrelation parameters.</span>
<span class="sd">    p-value : ndarray</span>
<span class="sd">        P-value of the Q statistic.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    statsmodels.stats.diagnostic.acorr_ljungbox</span>
<span class="sd">        Ljung-Box Q-test for autocorrelation in time series based</span>
<span class="sd">        on a time series rather than the estimated autocorrelation</span>
<span class="sd">        function.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Designed to be used with acf.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">array_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
    <span class="n">nobs</span> <span class="o">=</span> <span class="n">int_like</span><span class="p">(</span><span class="n">nobs</span><span class="p">,</span> <span class="s2">&quot;nobs&quot;</span><span class="p">)</span>

    <span class="n">ret</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">nobs</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">nobs</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
        <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">((</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">nobs</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">chi2</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">,</span> <span class="n">chi2</span></div>



<span class="c1"># NOTE: Changed unbiased to False</span>
<span class="c1"># see for example</span>
<span class="c1"># http://www.itl.nist.gov/div898/handbook/eda/section3/autocopl.htm</span>
<div class="viewcode-block" id="acf">
<a class="viewcode-back" href="../../../generated/statsmodels.tsa.stattools.acf.html#statsmodels.tsa.stattools.acf">[docs]</a>
<span class="k">def</span> <span class="nf">acf</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">adjusted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">nlags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">qstat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">fft</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">bartlett_confint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">missing</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the autocorrelation function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">       The time series data.</span>
<span class="sd">    adjusted : bool, default False</span>
<span class="sd">       If True, then denominators for autocovariance are n-k, otherwise n.</span>
<span class="sd">    nlags : int, optional</span>
<span class="sd">        Number of lags to return autocorrelation for. If not provided,</span>
<span class="sd">        uses min(10 * np.log10(nobs), nobs - 1). The returned value</span>
<span class="sd">        includes lag 0 (ie., 1) so size of the acf vector is (nlags + 1,).</span>
<span class="sd">    qstat : bool, default False</span>
<span class="sd">        If True, returns the Ljung-Box q statistic for each autocorrelation</span>
<span class="sd">        coefficient.  See q_stat for more information.</span>
<span class="sd">    fft : bool, default True</span>
<span class="sd">        If True, computes the ACF via FFT.</span>
<span class="sd">    alpha : scalar, default None</span>
<span class="sd">        If a number is given, the confidence intervals for the given level are</span>
<span class="sd">        returned. For instance if alpha=.05, 95 % confidence intervals are</span>
<span class="sd">        returned where the standard deviation is computed according to</span>
<span class="sd">        Bartlett&quot;s formula.</span>
<span class="sd">    bartlett_confint : bool, default True</span>
<span class="sd">        Confidence intervals for ACF values are generally placed at 2</span>
<span class="sd">        standard errors around r_k. The formula used for standard error</span>
<span class="sd">        depends upon the situation. If the autocorrelations are being used</span>
<span class="sd">        to test for randomness of residuals as part of the ARIMA routine,</span>
<span class="sd">        the standard errors are determined assuming the residuals are white</span>
<span class="sd">        noise. The approximate formula for any lag is that standard error</span>
<span class="sd">        of each r_k = 1/sqrt(N). See section 9.4 of [2] for more details on</span>
<span class="sd">        the 1/sqrt(N) result. For more elementary discussion, see section 5.3.2</span>
<span class="sd">        in [3].</span>
<span class="sd">        For the ACF of raw data, the standard error at a lag k is</span>
<span class="sd">        found as if the right model was an MA(k-1). This allows the possible</span>
<span class="sd">        interpretation that if all autocorrelations past a certain lag are</span>
<span class="sd">        within the limits, the model might be an MA of order defined by the</span>
<span class="sd">        last significant autocorrelation. In this case, a moving average</span>
<span class="sd">        model is assumed for the data and the standard errors for the</span>
<span class="sd">        confidence intervals should be generated using Bartlett&#39;s formula.</span>
<span class="sd">        For more details on Bartlett formula result, see section 7.2 in [2].</span>
<span class="sd">    missing : str, default &quot;none&quot;</span>
<span class="sd">        A string in [&quot;none&quot;, &quot;raise&quot;, &quot;conservative&quot;, &quot;drop&quot;] specifying how</span>
<span class="sd">        the NaNs are to be treated. &quot;none&quot; performs no checks. &quot;raise&quot; raises</span>
<span class="sd">        an exception if NaN values are found. &quot;drop&quot; removes the missing</span>
<span class="sd">        observations and then estimates the autocovariances treating the</span>
<span class="sd">        non-missing as contiguous. &quot;conservative&quot; computes the autocovariance</span>
<span class="sd">        using nan-ops so that nans are removed when computing the mean</span>
<span class="sd">        and cross-products that are used to estimate the autocovariance.</span>
<span class="sd">        When using &quot;conservative&quot;, n is set to the number of non-missing</span>
<span class="sd">        observations.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    acf : ndarray</span>
<span class="sd">        The autocorrelation function for lags 0, 1, ..., nlags. Shape</span>
<span class="sd">        (nlags+1,).</span>
<span class="sd">    confint : ndarray, optional</span>
<span class="sd">        Confidence intervals for the ACF at lags 0, 1, ..., nlags. Shape</span>
<span class="sd">        (nlags + 1, 2). Returned if alpha is not None.</span>
<span class="sd">    qstat : ndarray, optional</span>
<span class="sd">        The Ljung-Box Q-Statistic for lags 1, 2, ..., nlags (excludes lag</span>
<span class="sd">        zero). Returned if q_stat is True.</span>
<span class="sd">    pvalues : ndarray, optional</span>
<span class="sd">        The p-values associated with the Q-statistics for lags 1, 2, ...,</span>
<span class="sd">        nlags (excludes lag zero). Returned if q_stat is True.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The acf at lag 0 (ie., 1) is returned.</span>

<span class="sd">    For very long time series it is recommended to use fft convolution instead.</span>
<span class="sd">    When fft is False uses a simple, direct estimator of the autocovariances</span>
<span class="sd">    that only computes the first nlag + 1 values. This can be much faster when</span>
<span class="sd">    the time series is long and only a small number of autocovariances are</span>
<span class="sd">    needed.</span>

<span class="sd">    If adjusted is true, the denominator for the autocovariance is adjusted</span>
<span class="sd">    for the loss of data.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Parzen, E., 1963. On spectral analysis with missing observations</span>
<span class="sd">       and amplitude modulation. Sankhya: The Indian Journal of</span>
<span class="sd">       Statistics, Series A, pp.383-392.</span>
<span class="sd">    .. [2] Brockwell and Davis, 1987. Time Series Theory and Methods</span>
<span class="sd">    .. [3] Brockwell and Davis, 2010. Introduction to Time Series and</span>
<span class="sd">       Forecasting, 2nd edition.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">adjusted</span> <span class="o">=</span> <span class="n">bool_like</span><span class="p">(</span><span class="n">adjusted</span><span class="p">,</span> <span class="s2">&quot;adjusted&quot;</span><span class="p">)</span>
    <span class="n">nlags</span> <span class="o">=</span> <span class="n">int_like</span><span class="p">(</span><span class="n">nlags</span><span class="p">,</span> <span class="s2">&quot;nlags&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">qstat</span> <span class="o">=</span> <span class="n">bool_like</span><span class="p">(</span><span class="n">qstat</span><span class="p">,</span> <span class="s2">&quot;qstat&quot;</span><span class="p">)</span>
    <span class="n">fft</span> <span class="o">=</span> <span class="n">bool_like</span><span class="p">(</span><span class="n">fft</span><span class="p">,</span> <span class="s2">&quot;fft&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">float_like</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="n">string_like</span><span class="p">(</span>
        <span class="n">missing</span><span class="p">,</span> <span class="s2">&quot;missing&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;conservative&quot;</span><span class="p">,</span> <span class="s2">&quot;drop&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">array_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
    <span class="c1"># TODO: should this shrink for missing=&quot;drop&quot; and NaNs in x?</span>
    <span class="n">nobs</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">nlags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nlags</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">nobs</span><span class="p">)),</span> <span class="n">nobs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">avf</span> <span class="o">=</span> <span class="n">acovf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">adjusted</span><span class="o">=</span><span class="n">adjusted</span><span class="p">,</span> <span class="n">demean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fft</span><span class="o">=</span><span class="n">fft</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="n">missing</span><span class="p">)</span>
    <span class="n">acf</span> <span class="o">=</span> <span class="n">avf</span><span class="p">[:</span> <span class="n">nlags</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">avf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">qstat</span> <span class="ow">or</span> <span class="n">alpha</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">acf</span>
    <span class="n">_alpha</span> <span class="o">=</span> <span class="n">alpha</span> <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mf">0.05</span>
    <span class="k">if</span> <span class="n">bartlett_confint</span><span class="p">:</span>
        <span class="n">varacf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">acf</span><span class="p">)</span> <span class="o">/</span> <span class="n">nobs</span>
        <span class="n">varacf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">varacf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">nobs</span>
        <span class="n">varacf</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">acf</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">varacf</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">interval</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">_alpha</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varacf</span><span class="p">)</span>
    <span class="n">confint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lzip</span><span class="p">(</span><span class="n">acf</span> <span class="o">-</span> <span class="n">interval</span><span class="p">,</span> <span class="n">acf</span> <span class="o">+</span> <span class="n">interval</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">qstat</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">acf</span><span class="p">,</span> <span class="n">confint</span>
    <span class="n">qstat</span><span class="p">,</span> <span class="n">pvalue</span> <span class="o">=</span> <span class="n">q_stat</span><span class="p">(</span><span class="n">acf</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">nobs</span><span class="o">=</span><span class="n">nobs</span><span class="p">)</span>  <span class="c1"># drop lag 0</span>
    <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">acf</span><span class="p">,</span> <span class="n">confint</span><span class="p">,</span> <span class="n">qstat</span><span class="p">,</span> <span class="n">pvalue</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">acf</span><span class="p">,</span> <span class="n">qstat</span><span class="p">,</span> <span class="n">pvalue</span></div>


<div class="viewcode-block" id="pacf_yw">
<a class="viewcode-back" href="../../../generated/statsmodels.tsa.stattools.pacf_yw.html#statsmodels.tsa.stattools.pacf_yw">[docs]</a>
<span class="k">def</span> <span class="nf">pacf_yw</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">ArrayLike1D</span><span class="p">,</span>
    <span class="n">nlags</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;adjusted&quot;</span><span class="p">,</span> <span class="s2">&quot;mle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;adjusted&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Partial autocorrelation estimated with non-recursive yule_walker.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        The observations of time series for which pacf is calculated.</span>
<span class="sd">    nlags : int, optional</span>
<span class="sd">        Number of lags to return autocorrelation for. If not provided,</span>
<span class="sd">        uses min(10 * np.log10(nobs), nobs - 1).</span>
<span class="sd">    method : {&quot;adjusted&quot;, &quot;mle&quot;}, default &quot;adjusted&quot;</span>
<span class="sd">        The method for the autocovariance calculations in yule walker.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ndarray</span>
<span class="sd">        The partial autocorrelations, maxlag+1 elements.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    statsmodels.tsa.stattools.pacf</span>
<span class="sd">        Partial autocorrelation estimation.</span>
<span class="sd">    statsmodels.tsa.stattools.pacf_ols</span>
<span class="sd">        Partial autocorrelation estimation using OLS.</span>
<span class="sd">    statsmodels.tsa.stattools.pacf_burg</span>
<span class="sd">        Partial autocorrelation estimation using Burg&quot;s method.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This solves yule_walker for each desired lag and contains</span>
<span class="sd">    currently duplicate calculations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">array_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
    <span class="n">nlags</span> <span class="o">=</span> <span class="n">int_like</span><span class="p">(</span><span class="n">nlags</span><span class="p">,</span> <span class="s2">&quot;nlags&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">nobs</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">nlags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nlags</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">nobs</span><span class="p">)),</span> <span class="n">nobs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">method</span> <span class="o">=</span> <span class="n">string_like</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;adjusted&quot;</span><span class="p">,</span> <span class="s2">&quot;mle&quot;</span><span class="p">))</span>
    <span class="n">pacf</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span>
    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;once&quot;</span><span class="p">,</span> <span class="n">ValueWarning</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlags</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">pacf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yule_walker</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pacf</span><span class="p">)</span></div>



<div class="viewcode-block" id="pacf_burg">
<a class="viewcode-back" href="../../../generated/statsmodels.tsa.stattools.pacf_burg.html#statsmodels.tsa.stattools.pacf_burg">[docs]</a>
<span class="k">def</span> <span class="nf">pacf_burg</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">ArrayLike1D</span><span class="p">,</span> <span class="n">nlags</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">demean</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate Burg&quot;s partial autocorrelation estimator.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Observations of time series for which pacf is calculated.</span>
<span class="sd">    nlags : int, optional</span>
<span class="sd">        Number of lags to return autocorrelation for. If not provided,</span>
<span class="sd">        uses min(10 * np.log10(nobs), nobs - 1).</span>
<span class="sd">    demean : bool, optional</span>
<span class="sd">        Flag indicating to demean that data. Set to False if x has been</span>
<span class="sd">        previously demeaned.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pacf : ndarray</span>
<span class="sd">        Partial autocorrelations for lags 0, 1, ..., nlag.</span>
<span class="sd">    sigma2 : ndarray</span>
<span class="sd">        Residual variance estimates where the value in position m is the</span>
<span class="sd">        residual variance in an AR model that includes m lags.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    statsmodels.tsa.stattools.pacf</span>
<span class="sd">        Partial autocorrelation estimation.</span>
<span class="sd">    statsmodels.tsa.stattools.pacf_yw</span>
<span class="sd">         Partial autocorrelation estimation using Yule-Walker.</span>
<span class="sd">    statsmodels.tsa.stattools.pacf_ols</span>
<span class="sd">        Partial autocorrelation estimation using OLS.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Brockwell, P.J. and Davis, R.A., 2016. Introduction to time series</span>
<span class="sd">        and forecasting. Springer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">array_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">demean</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">nobs</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">nlags</span> <span class="k">if</span> <span class="n">nlags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">nobs</span><span class="p">)),</span> <span class="n">nobs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="n">nobs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;nlags must be smaller than nobs - 1&quot;</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">pacf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">x</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">x</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">u</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="n">pacf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">u</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">last_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">last_v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="n">last_u</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">u</span>
        <span class="n">last_v</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">last_u</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pacf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">last_v</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">last_v</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">pacf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">last_u</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pacf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">u</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">pacf</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">sigma2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pacf</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">d</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">nobs</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="n">pacf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Insert the 0 lag partial autocorrel</span>

    <span class="k">return</span> <span class="n">pacf</span><span class="p">,</span> <span class="n">sigma2</span></div>



<div class="viewcode-block" id="pacf_ols">
<a class="viewcode-back" href="../../../generated/statsmodels.tsa.stattools.pacf_ols.html#statsmodels.tsa.stattools.pacf_ols">[docs]</a>
<span class="nd">@deprecate_kwarg</span><span class="p">(</span><span class="s2">&quot;unbiased&quot;</span><span class="p">,</span> <span class="s2">&quot;adjusted&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">pacf_ols</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">ArrayLike1D</span><span class="p">,</span>
    <span class="n">nlags</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">efficient</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">adjusted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate partial autocorrelations via OLS.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Observations of time series for which pacf is calculated.</span>
<span class="sd">    nlags : int, optional</span>
<span class="sd">        Number of lags to return autocorrelation for. If not provided,</span>
<span class="sd">        uses min(10 * np.log10(nobs), nobs - 1).</span>
<span class="sd">    efficient : bool, optional</span>
<span class="sd">        If true, uses the maximum number of available observations to compute</span>
<span class="sd">        each partial autocorrelation. If not, uses the same number of</span>
<span class="sd">        observations to compute all pacf values.</span>
<span class="sd">    adjusted : bool, optional</span>
<span class="sd">        Adjust each partial autocorrelation by n / (n - lag).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ndarray</span>
<span class="sd">        The partial autocorrelations, (maxlag,) array corresponding to lags</span>
<span class="sd">        0, 1, ..., maxlag.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    statsmodels.tsa.stattools.pacf</span>
<span class="sd">        Partial autocorrelation estimation.</span>
<span class="sd">    statsmodels.tsa.stattools.pacf_yw</span>
<span class="sd">         Partial autocorrelation estimation using Yule-Walker.</span>
<span class="sd">    statsmodels.tsa.stattools.pacf_burg</span>
<span class="sd">        Partial autocorrelation estimation using Burg&quot;s method.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This solves a separate OLS estimation for each desired lag using method in</span>
<span class="sd">    [1]_. Setting efficient to True has two effects. First, it uses</span>
<span class="sd">    `nobs - lag` observations of estimate each pacf.  Second, it re-estimates</span>
<span class="sd">    the mean in each regression. If efficient is False, then the data are first</span>
<span class="sd">    demeaned, and then `nobs - maxlag` observations are used to estimate each</span>
<span class="sd">    partial autocorrelation.</span>

<span class="sd">    The inefficient estimator appears to have better finite sample properties.</span>
<span class="sd">    This option should only be used in time series that are covariance</span>
<span class="sd">    stationary.</span>

<span class="sd">    OLS estimation of the pacf does not guarantee that all pacf values are</span>
<span class="sd">    between -1 and 1.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Box, G. E., Jenkins, G. M., Reinsel, G. C., &amp; Ljung, G. M. (2015).</span>
<span class="sd">       Time series analysis: forecasting and control. John Wiley &amp; Sons, p. 66</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">array_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
    <span class="n">nlags</span> <span class="o">=</span> <span class="n">int_like</span><span class="p">(</span><span class="n">nlags</span><span class="p">,</span> <span class="s2">&quot;nlags&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">efficient</span> <span class="o">=</span> <span class="n">bool_like</span><span class="p">(</span><span class="n">efficient</span><span class="p">,</span> <span class="s2">&quot;efficient&quot;</span><span class="p">)</span>
    <span class="n">adjusted</span> <span class="o">=</span> <span class="n">bool_like</span><span class="p">(</span><span class="n">adjusted</span><span class="p">,</span> <span class="s2">&quot;adjusted&quot;</span><span class="p">)</span>
    <span class="n">nobs</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">nlags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nlags</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">nobs</span><span class="p">)),</span> <span class="n">nobs</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nlags</span> <span class="o">&gt;</span> <span class="n">nobs</span><span class="o">//</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;nlags must be smaller than nobs // 2 (</span><span class="si">{</span><span class="n">nobs</span><span class="o">//</span><span class="mi">2</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="n">pacf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nlags</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">pacf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">if</span> <span class="n">efficient</span><span class="p">:</span>
        <span class="n">xlags</span><span class="p">,</span> <span class="n">x0</span> <span class="o">=</span> <span class="n">lagmat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nlags</span><span class="p">,</span> <span class="n">original</span><span class="o">=</span><span class="s2">&quot;sep&quot;</span><span class="p">)</span>
        <span class="n">xlags</span> <span class="o">=</span> <span class="n">add_constant</span><span class="p">(</span><span class="n">xlags</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlags</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">lstsq</span><span class="p">(</span><span class="n">xlags</span><span class="p">[</span><span class="n">k</span><span class="p">:,</span> <span class="p">:</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">x0</span><span class="p">[</span><span class="n">k</span><span class="p">:],</span> <span class="n">rcond</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">pacf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="c1"># Create a single set of lags for multivariate OLS</span>
        <span class="n">xlags</span><span class="p">,</span> <span class="n">x0</span> <span class="o">=</span> <span class="n">lagmat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nlags</span><span class="p">,</span> <span class="n">original</span><span class="o">=</span><span class="s2">&quot;sep&quot;</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlags</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">lstsq</span><span class="p">(</span><span class="n">xlags</span><span class="p">[:,</span> <span class="p">:</span><span class="n">k</span><span class="p">],</span> <span class="n">x0</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># Last coefficient corresponds to PACF value (see [1])</span>
            <span class="n">pacf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">adjusted</span><span class="p">:</span>
        <span class="n">pacf</span> <span class="o">*=</span> <span class="n">nobs</span> <span class="o">/</span> <span class="p">(</span><span class="n">nobs</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nlags</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pacf</span></div>



<div class="viewcode-block" id="pacf">
<a class="viewcode-back" href="../../../generated/statsmodels.tsa.stattools.pacf.html#statsmodels.tsa.stattools.pacf">[docs]</a>
<span class="k">def</span> <span class="nf">pacf</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">ArrayLike1D</span><span class="p">,</span>
    <span class="n">nlags</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
        <span class="s2">&quot;yw&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ywadjusted&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ols&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ols-inefficient&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ols-adjusted&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ywm&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ywmle&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ld&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ldadjusted&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ldb&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ldbiased&quot;</span><span class="p">,</span>
        <span class="s2">&quot;burg&quot;</span><span class="p">,</span>
    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ywadjusted&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Partial autocorrelation estimate.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Observations of time series for which pacf is calculated.</span>
<span class="sd">    nlags : int, optional</span>
<span class="sd">        Number of lags to return autocorrelation for. If not provided,</span>
<span class="sd">        uses min(10 * np.log10(nobs), nobs // 2 - 1). The returned value</span>
<span class="sd">        includes lag 0 (ie., 1) so size of the pacf vector is (nlags + 1,).</span>
<span class="sd">    method : str, default &quot;ywunbiased&quot;</span>
<span class="sd">        Specifies which method for the calculations to use.</span>

<span class="sd">        - &quot;yw&quot; or &quot;ywadjusted&quot; : Yule-Walker with sample-size adjustment in</span>
<span class="sd">          denominator for acovf. Default.</span>
<span class="sd">        - &quot;ywm&quot; or &quot;ywmle&quot; : Yule-Walker without adjustment.</span>
<span class="sd">        - &quot;ols&quot; : regression of time series on lags of it and on constant.</span>
<span class="sd">        - &quot;ols-inefficient&quot; : regression of time series on lags using a single</span>
<span class="sd">          common sample to estimate all pacf coefficients.</span>
<span class="sd">        - &quot;ols-adjusted&quot; : regression of time series on lags with a bias</span>
<span class="sd">          adjustment.</span>
<span class="sd">        - &quot;ld&quot; or &quot;ldadjusted&quot; : Levinson-Durbin recursion with bias</span>
<span class="sd">          correction.</span>
<span class="sd">        - &quot;ldb&quot; or &quot;ldbiased&quot; : Levinson-Durbin recursion without bias</span>
<span class="sd">          correction.</span>
<span class="sd">        - &quot;burg&quot; :  Burg&quot;s partial autocorrelation estimator.</span>

<span class="sd">    alpha : float, optional</span>
<span class="sd">        If a number is given, the confidence intervals for the given level are</span>
<span class="sd">        returned. For instance if alpha=.05, 95 % confidence intervals are</span>
<span class="sd">        returned where the standard deviation is computed according to</span>
<span class="sd">        1/sqrt(len(x)).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pacf : ndarray</span>
<span class="sd">        The partial autocorrelations for lags 0, 1, ..., nlags. Shape</span>
<span class="sd">        (nlags+1,).</span>
<span class="sd">    confint : ndarray, optional</span>
<span class="sd">        Confidence intervals for the PACF at lags 0, 1, ..., nlags. Shape</span>
<span class="sd">        (nlags + 1, 2). Returned if alpha is not None.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    statsmodels.tsa.stattools.acf</span>
<span class="sd">        Estimate the autocorrelation function.</span>
<span class="sd">    statsmodels.tsa.stattools.pacf</span>
<span class="sd">        Partial autocorrelation estimation.</span>
<span class="sd">    statsmodels.tsa.stattools.pacf_yw</span>
<span class="sd">         Partial autocorrelation estimation using Yule-Walker.</span>
<span class="sd">    statsmodels.tsa.stattools.pacf_ols</span>
<span class="sd">        Partial autocorrelation estimation using OLS.</span>
<span class="sd">    statsmodels.tsa.stattools.pacf_burg</span>
<span class="sd">        Partial autocorrelation estimation using Burg&quot;s method.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Based on simulation evidence across a range of low-order ARMA models,</span>
<span class="sd">    the best methods based on root MSE are Yule-Walker (MLW), Levinson-Durbin</span>
<span class="sd">    (MLE) and Burg, respectively. The estimators with the lowest bias included</span>
<span class="sd">    included these three in addition to OLS and OLS-adjusted.</span>

<span class="sd">    Yule-Walker (adjusted) and Levinson-Durbin (adjusted) performed</span>
<span class="sd">    consistently worse than the other options.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nlags</span> <span class="o">=</span> <span class="n">int_like</span><span class="p">(</span><span class="n">nlags</span><span class="p">,</span> <span class="s2">&quot;nlags&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">methods</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;ols&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ols-inefficient&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ols-adjusted&quot;</span><span class="p">,</span>
        <span class="s2">&quot;yw&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ywa&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ld&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ywadjusted&quot;</span><span class="p">,</span>
        <span class="s2">&quot;yw_adjusted&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ywm&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ywmle&quot;</span><span class="p">,</span>
        <span class="s2">&quot;yw_mle&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lda&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ldadjusted&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ld_adjusted&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ldb&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ldbiased&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ld_biased&quot;</span><span class="p">,</span>
        <span class="s2">&quot;burg&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">array_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">maxdim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">method</span> <span class="o">=</span> <span class="n">string_like</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">methods</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">float_like</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">nobs</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">nlags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nlags</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">nobs</span><span class="p">)),</span> <span class="n">nobs</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">nlags</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nlags</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nlags</span> <span class="o">&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Can only compute partial correlations for lags up to 50</span><span class="si">% o</span><span class="s2">f the &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;sample size. The requested nlags </span><span class="si">{</span><span class="n">nlags</span><span class="si">}</span><span class="s2"> must be &lt; &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;ols&quot;</span><span class="p">,</span> <span class="s2">&quot;ols-inefficient&quot;</span><span class="p">,</span> <span class="s2">&quot;ols-adjusted&quot;</span><span class="p">):</span>
        <span class="n">efficient</span> <span class="o">=</span> <span class="s2">&quot;inefficient&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">method</span>
        <span class="n">adjusted</span> <span class="o">=</span> <span class="s2">&quot;adjusted&quot;</span> <span class="ow">in</span> <span class="n">method</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">pacf_ols</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="n">nlags</span><span class="p">,</span> <span class="n">efficient</span><span class="o">=</span><span class="n">efficient</span><span class="p">,</span> <span class="n">adjusted</span><span class="o">=</span><span class="n">adjusted</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;yw&quot;</span><span class="p">,</span> <span class="s2">&quot;ywa&quot;</span><span class="p">,</span> <span class="s2">&quot;ywadjusted&quot;</span><span class="p">,</span> <span class="s2">&quot;yw_adjusted&quot;</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">pacf_yw</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="n">nlags</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;adjusted&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;ywm&quot;</span><span class="p">,</span> <span class="s2">&quot;ywmle&quot;</span><span class="p">,</span> <span class="s2">&quot;yw_mle&quot;</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">pacf_yw</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="n">nlags</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;ld&quot;</span><span class="p">,</span> <span class="s2">&quot;lda&quot;</span><span class="p">,</span> <span class="s2">&quot;ldadjusted&quot;</span><span class="p">,</span> <span class="s2">&quot;ld_adjusted&quot;</span><span class="p">):</span>
        <span class="n">acv</span> <span class="o">=</span> <span class="n">acovf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">adjusted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ld_</span> <span class="o">=</span> <span class="n">levinson_durbin</span><span class="p">(</span><span class="n">acv</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="n">nlags</span><span class="p">,</span> <span class="n">isacov</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">ld_</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;burg&quot;</span><span class="p">:</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pacf_burg</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="n">nlags</span><span class="p">,</span> <span class="n">demean</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># inconsistent naming with ywmle</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># method in (&quot;ldb&quot;, &quot;ldbiased&quot;, &quot;ld_biased&quot;)</span>
        <span class="n">acv</span> <span class="o">=</span> <span class="n">acovf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">adjusted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ld_</span> <span class="o">=</span> <span class="n">levinson_durbin</span><span class="p">(</span><span class="n">acv</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="n">nlags</span><span class="p">,</span> <span class="n">isacov</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">ld_</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">varacf</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># for all lags &gt;=1</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varacf</span><span class="p">)</span>
        <span class="n">confint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lzip</span><span class="p">(</span><span class="n">ret</span> <span class="o">-</span> <span class="n">interval</span><span class="p">,</span> <span class="n">ret</span> <span class="o">+</span> <span class="n">interval</span><span class="p">))</span>
        <span class="n">confint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># fix confidence interval for lag 0 to varpacf=0</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">,</span> <span class="n">confint</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ret</span></div>



<div class="viewcode-block" id="ccovf">
<a class="viewcode-back" href="../../../generated/statsmodels.tsa.stattools.ccovf.html#statsmodels.tsa.stattools.ccovf">[docs]</a>
<span class="nd">@deprecate_kwarg</span><span class="p">(</span><span class="s2">&quot;unbiased&quot;</span><span class="p">,</span> <span class="s2">&quot;adjusted&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">ccovf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">adjusted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">demean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fft</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the cross-covariance between two series.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x, y : array_like</span>
<span class="sd">       The time series data to use in the calculation.</span>
<span class="sd">    adjusted : bool, optional</span>
<span class="sd">       If True, then denominators for cross-covariance are n-k, otherwise n.</span>
<span class="sd">    demean : bool, optional</span>
<span class="sd">        Flag indicating whether to demean x and y.</span>
<span class="sd">    fft : bool, default True</span>
<span class="sd">        If True, use FFT convolution.  This method should be preferred</span>
<span class="sd">        for long time series.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ndarray</span>
<span class="sd">        The estimated cross-covariance function: the element at index k</span>
<span class="sd">        is the covariance between {x[k], x[k+1], ..., x[n]} and {y[0], y[1], ..., y[m-k]},</span>
<span class="sd">        where n and m are the lengths of x and y, respectively.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">array_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">array_like</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)</span>
    <span class="n">adjusted</span> <span class="o">=</span> <span class="n">bool_like</span><span class="p">(</span><span class="n">adjusted</span><span class="p">,</span> <span class="s2">&quot;adjusted&quot;</span><span class="p">)</span>
    <span class="n">demean</span> <span class="o">=</span> <span class="n">bool_like</span><span class="p">(</span><span class="n">demean</span><span class="p">,</span> <span class="s2">&quot;demean&quot;</span><span class="p">)</span>
    <span class="n">fft</span> <span class="o">=</span> <span class="n">bool_like</span><span class="p">(</span><span class="n">fft</span><span class="p">,</span> <span class="s2">&quot;fft&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">demean</span><span class="p">:</span>
        <span class="n">xo</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">yo</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xo</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">yo</span> <span class="o">=</span> <span class="n">y</span>
    <span class="k">if</span> <span class="n">adjusted</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">n</span>

    <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;fft&quot;</span> <span class="k">if</span> <span class="n">fft</span> <span class="k">else</span> <span class="s2">&quot;direct&quot;</span>
    <span class="k">return</span> <span class="n">correlate</span><span class="p">(</span><span class="n">xo</span><span class="p">,</span> <span class="n">yo</span><span class="p">,</span> <span class="s2">&quot;full&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">/</span> <span class="n">d</span></div>



<div class="viewcode-block" id="ccf">
<a class="viewcode-back" href="../../../generated/statsmodels.tsa.stattools.ccf.html#statsmodels.tsa.stattools.ccf">[docs]</a>
<span class="nd">@deprecate_kwarg</span><span class="p">(</span><span class="s2">&quot;unbiased&quot;</span><span class="p">,</span> <span class="s2">&quot;adjusted&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">ccf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">adjusted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fft</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The cross-correlation function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x, y : array_like</span>
<span class="sd">        The time series data to use in the calculation.</span>
<span class="sd">    adjusted : bool</span>
<span class="sd">        If True, then denominators for cross-correlation are n-k, otherwise n.</span>
<span class="sd">    fft : bool, default True</span>
<span class="sd">        If True, use FFT convolution.  This method should be preferred</span>
<span class="sd">        for long time series.</span>
<span class="sd">    nlags : int, optional</span>
<span class="sd">        Number of lags to return cross-correlations for. If not provided,</span>
<span class="sd">        the number of lags equals len(x).</span>
<span class="sd">    alpha : float, optional</span>
<span class="sd">        If a number is given, the confidence intervals for the given level are</span>
<span class="sd">        returned. For instance if alpha=.05, 95 % confidence intervals are</span>
<span class="sd">        returned where the standard deviation is computed according to</span>
<span class="sd">        1/sqrt(len(x)).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ndarray</span>
<span class="sd">        The cross-correlation function of x and y: the element at index k</span>
<span class="sd">        is the correlation between {x[k], x[k+1], ..., x[n]} and {y[0], y[1], ..., y[m-k]},</span>
<span class="sd">        where n and m are the lengths of x and y, respectively.</span>
<span class="sd">    confint : ndarray, optional</span>
<span class="sd">        Confidence intervals for the CCF at lags 0, 1, ..., nlags-1 using the level given by</span>
<span class="sd">        alpha and the standard deviation calculated as 1/sqrt(len(x)) [1]. Shape (nlags, 2).</span>
<span class="sd">        Returned if alpha is not None.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    If adjusted is True, the denominator for the cross-correlation is adjusted.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Brockwell and Davis, 2016. Introduction to Time Series and</span>
<span class="sd">       Forecasting, 3rd edition, p. 242.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">array_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">array_like</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)</span>
    <span class="n">adjusted</span> <span class="o">=</span> <span class="n">bool_like</span><span class="p">(</span><span class="n">adjusted</span><span class="p">,</span> <span class="s2">&quot;adjusted&quot;</span><span class="p">)</span>
    <span class="n">fft</span> <span class="o">=</span> <span class="n">bool_like</span><span class="p">(</span><span class="n">fft</span><span class="p">,</span> <span class="s2">&quot;fft&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">cvf</span> <span class="o">=</span> <span class="n">ccovf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">adjusted</span><span class="o">=</span><span class="n">adjusted</span><span class="p">,</span> <span class="n">demean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fft</span><span class="o">=</span><span class="n">fft</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">cvf</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[:</span><span class="n">nlags</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">confint</span> <span class="o">=</span> <span class="n">ret</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">interval</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">,</span> <span class="n">confint</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ret</span></div>



<span class="c1"># moved from sandbox.tsa.examples.try_ld_nitime, via nitime</span>
<span class="c1"># TODO: check what to return, for testing and trying out returns everything</span>
<div class="viewcode-block" id="levinson_durbin">
<a class="viewcode-back" href="../../../generated/statsmodels.tsa.stattools.levinson_durbin.html#statsmodels.tsa.stattools.levinson_durbin">[docs]</a>
<span class="k">def</span> <span class="nf">levinson_durbin</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">isacov</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Levinson-Durbin recursion for autoregressive processes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s : array_like</span>
<span class="sd">        If isacov is False, then this is the time series. If iasacov is true</span>
<span class="sd">        then this is interpreted as autocovariance starting with lag 0.</span>
<span class="sd">    nlags : int, optional</span>
<span class="sd">        The largest lag to include in recursion or order of the autoregressive</span>
<span class="sd">        process.</span>
<span class="sd">    isacov : bool, optional</span>
<span class="sd">        Flag indicating whether the first argument, s, contains the</span>
<span class="sd">        autocovariances or the data series.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    sigma_v : float</span>
<span class="sd">        The estimate of the error variance.</span>
<span class="sd">    arcoefs : ndarray</span>
<span class="sd">        The estimate of the autoregressive coefficients for a model including</span>
<span class="sd">        nlags.</span>
<span class="sd">    pacf : ndarray</span>
<span class="sd">        The partial autocorrelation function.</span>
<span class="sd">    sigma : ndarray</span>
<span class="sd">        The entire sigma array from intermediate result, last value is sigma_v.</span>
<span class="sd">    phi : ndarray</span>
<span class="sd">        The entire phi array from intermediate result, last column contains</span>
<span class="sd">        autoregressive coefficients for AR(nlags).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function returns currently all results, but maybe we drop sigma and</span>
<span class="sd">    phi from the returns.</span>

<span class="sd">    If this function is called with the time series (isacov=False), then the</span>
<span class="sd">    sample autocovariance function is calculated with the default options</span>
<span class="sd">    (biased, no fft).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">array_like</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">)</span>
    <span class="n">nlags</span> <span class="o">=</span> <span class="n">int_like</span><span class="p">(</span><span class="n">nlags</span><span class="p">,</span> <span class="s2">&quot;nlags&quot;</span><span class="p">)</span>
    <span class="n">isacov</span> <span class="o">=</span> <span class="n">bool_like</span><span class="p">(</span><span class="n">isacov</span><span class="p">,</span> <span class="s2">&quot;isacov&quot;</span><span class="p">)</span>

    <span class="n">order</span> <span class="o">=</span> <span class="n">nlags</span>

    <span class="k">if</span> <span class="n">isacov</span><span class="p">:</span>
        <span class="n">sxx_m</span> <span class="o">=</span> <span class="n">s</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sxx_m</span> <span class="o">=</span> <span class="n">acovf</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">fft</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span> <span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># not tested</span>

    <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;d&quot;</span><span class="p">)</span>
    <span class="n">sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># initial points for the recursion</span>
    <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sxx_m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">sxx_m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">sig</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sxx_m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">sxx_m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">phi</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">sxx_m</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">sxx_m</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">k</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="p">)</span> <span class="o">/</span> <span class="n">sig</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="n">phi</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">phi</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">phi</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">sig</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">sig</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">phi</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">sigma_v</span> <span class="o">=</span> <span class="n">sig</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">arcoefs</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">pacf_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">pacf_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">return</span> <span class="n">sigma_v</span><span class="p">,</span> <span class="n">arcoefs</span><span class="p">,</span> <span class="n">pacf_</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">phi</span>  <span class="c1"># return everything</span></div>



<div class="viewcode-block" id="levinson_durbin_pacf">
<a class="viewcode-back" href="../../../generated/statsmodels.tsa.stattools.levinson_durbin_pacf.html#statsmodels.tsa.stattools.levinson_durbin_pacf">[docs]</a>
<span class="k">def</span> <span class="nf">levinson_durbin_pacf</span><span class="p">(</span><span class="n">pacf</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Levinson-Durbin algorithm that returns the acf and ar coefficients.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pacf : array_like</span>
<span class="sd">        Partial autocorrelation array for lags 0, 1, ... p.</span>
<span class="sd">    nlags : int, optional</span>
<span class="sd">        Number of lags in the AR model.  If omitted, returns coefficients from</span>
<span class="sd">        an AR(p) and the first p autocorrelations.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    arcoefs : ndarray</span>
<span class="sd">        AR coefficients computed from the partial autocorrelations.</span>
<span class="sd">    acf : ndarray</span>
<span class="sd">        The acf computed from the partial autocorrelations. Array returned</span>
<span class="sd">        contains the autocorrelations corresponding to lags 0, 1, ..., p.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Brockwell, P.J. and Davis, R.A., 2016. Introduction to time series</span>
<span class="sd">        and forecasting. Springer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pacf</span> <span class="o">=</span> <span class="n">array_like</span><span class="p">(</span><span class="n">pacf</span><span class="p">,</span> <span class="s2">&quot;pacf&quot;</span><span class="p">)</span>
    <span class="n">nlags</span> <span class="o">=</span> <span class="n">int_like</span><span class="p">(</span><span class="n">nlags</span><span class="p">,</span> <span class="s2">&quot;nlags&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pacf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pacf</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">pacf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The first entry of the pacf corresponds to lags 0 &quot;</span>
            <span class="s2">&quot;and so must be 1.&quot;</span>
        <span class="p">)</span>
    <span class="n">pacf</span> <span class="o">=</span> <span class="n">pacf</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">pacf</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">nlags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nlags</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Must provide at least as many values from the &quot;</span>
                <span class="s2">&quot;pacf as the number of lags.&quot;</span>
            <span class="p">)</span>
        <span class="n">pacf</span> <span class="o">=</span> <span class="n">pacf</span><span class="p">[:</span><span class="n">nlags</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">pacf</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">acf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">acf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pacf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">nu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumprod</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pacf</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">arcoefs</span> <span class="o">=</span> <span class="n">pacf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="n">arcoefs</span><span class="p">[:</span> <span class="o">-</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">arcoefs</span><span class="p">[:</span> <span class="o">-</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">prev</span> <span class="o">-</span> <span class="n">arcoefs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">prev</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">acf</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">arcoefs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">nu</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">prev</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">acf</span><span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="o">-</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">i</span><span class="p">)][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">acf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">arcoefs</span><span class="p">,</span> <span class="n">acf</span></div>



<div class="viewcode-block" id="breakvar_heteroskedasticity_test">
<a class="viewcode-back" href="../../../generated/statsmodels.tsa.stattools.breakvar_heteroskedasticity_test.html#statsmodels.tsa.stattools.breakvar_heteroskedasticity_test">[docs]</a>
<span class="k">def</span> <span class="nf">breakvar_heteroskedasticity_test</span><span class="p">(</span>
    <span class="n">resid</span><span class="p">,</span> <span class="n">subset_length</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">use_f</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test for heteroskedasticity of residuals</span>

<span class="sd">    Tests whether the sum-of-squares in the first subset of the sample is</span>
<span class="sd">    significantly different than the sum-of-squares in the last subset</span>
<span class="sd">    of the sample. Analogous to a Goldfeld-Quandt test. The null hypothesis</span>
<span class="sd">    is of no heteroskedasticity.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    resid : array_like</span>
<span class="sd">        Residuals of a time series model.</span>
<span class="sd">        The shape is 1d (nobs,) or 2d (nobs, nvars).</span>
<span class="sd">    subset_length : {int, float}</span>
<span class="sd">        Length of the subsets to test (h in Notes below).</span>
<span class="sd">        If a float in 0 &lt; subset_length &lt; 1, it is interpreted as fraction.</span>
<span class="sd">        Default is 1/3.</span>
<span class="sd">    alternative : str, &#39;increasing&#39;, &#39;decreasing&#39; or &#39;two-sided&#39;</span>
<span class="sd">        This specifies the alternative for the p-value calculation. Default</span>
<span class="sd">        is two-sided.</span>
<span class="sd">    use_f : bool, optional</span>
<span class="sd">        Whether or not to compare against the asymptotic distribution</span>
<span class="sd">        (chi-squared) or the approximate small-sample distribution (F).</span>
<span class="sd">        Default is True (i.e. default is to compare against an F</span>
<span class="sd">        distribution).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    test_statistic : {float, ndarray}</span>
<span class="sd">        Test statistic(s) H(h).</span>
<span class="sd">    p_value : {float, ndarray}</span>
<span class="sd">        p-value(s) of test statistic(s).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The null hypothesis is of no heteroskedasticity. That means different</span>
<span class="sd">    things depending on which alternative is selected:</span>

<span class="sd">    - Increasing: Null hypothesis is that the variance is not increasing</span>
<span class="sd">        throughout the sample; that the sum-of-squares in the later</span>
<span class="sd">        subsample is *not* greater than the sum-of-squares in the earlier</span>
<span class="sd">        subsample.</span>
<span class="sd">    - Decreasing: Null hypothesis is that the variance is not decreasing</span>
<span class="sd">        throughout the sample; that the sum-of-squares in the earlier</span>
<span class="sd">        subsample is *not* greater than the sum-of-squares in the later</span>
<span class="sd">        subsample.</span>
<span class="sd">    - Two-sided: Null hypothesis is that the variance is not changing</span>
<span class="sd">        throughout the sample. Both that the sum-of-squares in the earlier</span>
<span class="sd">        subsample is not greater than the sum-of-squares in the later</span>
<span class="sd">        subsample *and* that the sum-of-squares in the later subsample is</span>
<span class="sd">        not greater than the sum-of-squares in the earlier subsample.</span>

<span class="sd">    For :math:`h = [T/3]`, the test statistic is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        H(h) = \sum_{t=T-h+1}^T  \tilde v_t^2</span>
<span class="sd">        \Bigg / \sum_{t=1}^{h} \tilde v_t^2</span>

<span class="sd">    This statistic can be tested against an :math:`F(h,h)` distribution.</span>
<span class="sd">    Alternatively, :math:`h H(h)` is asymptotically distributed according</span>
<span class="sd">    to :math:`\chi_h^2`; this second test can be applied by passing</span>
<span class="sd">    `use_f=False` as an argument.</span>

<span class="sd">    See section 5.4 of [1]_ for the above formula and discussion, as well</span>
<span class="sd">    as additional details.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Harvey, Andrew C. 1990. *Forecasting, Structural Time Series*</span>
<span class="sd">            *Models and the Kalman Filter.* Cambridge University Press.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">squared_resid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">resid</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">squared_resid</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">squared_resid</span> <span class="o">=</span> <span class="n">squared_resid</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">nobs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">resid</span><span class="p">)</span>

    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">subset_length</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">nobs</span> <span class="o">*</span> <span class="n">subset_length</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">subset_length</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> <span class="ow">and</span> <span class="n">subset_length</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">subset_length</span>

    <span class="n">numer_resid</span> <span class="o">=</span> <span class="n">squared_resid</span><span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">:]</span>
    <span class="n">numer_dof</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">numer_resid</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">numer_squared_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">numer_resid</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dof</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">numer_dof</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dof</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Early subset of data for variable </span><span class="si">%d</span><span class="s2">&quot;</span>
                <span class="s2">&quot; has too few non-missing observations to&quot;</span>
                <span class="s2">&quot; calculate test statistic.&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">numer_squared_sum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="n">denom_resid</span> <span class="o">=</span> <span class="n">squared_resid</span><span class="p">[:</span><span class="n">h</span><span class="p">]</span>
    <span class="n">denom_dof</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">denom_resid</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">denom_squared_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">denom_resid</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dof</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">denom_dof</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dof</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Later subset of data for variable </span><span class="si">%d</span><span class="s2">&quot;</span>
                <span class="s2">&quot; has too few non-missing observations to&quot;</span>
                <span class="s2">&quot; calculate test statistic.&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">denom_squared_sum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="n">test_statistic</span> <span class="o">=</span> <span class="n">numer_squared_sum</span> <span class="o">/</span> <span class="n">denom_squared_sum</span>

    <span class="c1"># Setup functions to calculate the p-values</span>
    <span class="k">if</span> <span class="n">use_f</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">f</span>

        <span class="n">pval_lower</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">test_statistics</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span>  <span class="c1"># noqa:E731</span>
            <span class="n">test_statistics</span><span class="p">,</span> <span class="n">numer_dof</span><span class="p">,</span> <span class="n">denom_dof</span>
        <span class="p">)</span>
        <span class="n">pval_upper</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">test_statistics</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span>  <span class="c1"># noqa:E731</span>
            <span class="n">test_statistics</span><span class="p">,</span> <span class="n">numer_dof</span><span class="p">,</span> <span class="n">denom_dof</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">chi2</span>

        <span class="n">pval_lower</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">test_statistics</span><span class="p">:</span> <span class="n">chi2</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span>  <span class="c1"># noqa:E731</span>
            <span class="n">numer_dof</span> <span class="o">*</span> <span class="n">test_statistics</span><span class="p">,</span> <span class="n">denom_dof</span>
        <span class="p">)</span>
        <span class="n">pval_upper</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">test_statistics</span><span class="p">:</span> <span class="n">chi2</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span>  <span class="c1"># noqa:E731</span>
            <span class="n">numer_dof</span> <span class="o">*</span> <span class="n">test_statistics</span><span class="p">,</span> <span class="n">denom_dof</span>
        <span class="p">)</span>

    <span class="c1"># Calculate the one- or two-sided p-values</span>
    <span class="n">alternative</span> <span class="o">=</span> <span class="n">alternative</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">alternative</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;inc&quot;</span><span class="p">,</span> <span class="s2">&quot;increasing&quot;</span><span class="p">]:</span>
        <span class="n">p_value</span> <span class="o">=</span> <span class="n">pval_upper</span><span class="p">(</span><span class="n">test_statistic</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">alternative</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;decreasing&quot;</span><span class="p">]:</span>
        <span class="n">test_statistic</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">test_statistic</span>
        <span class="n">p_value</span> <span class="o">=</span> <span class="n">pval_upper</span><span class="p">(</span><span class="n">test_statistic</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">alternative</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;2-sided&quot;</span><span class="p">,</span> <span class="s2">&quot;two-sided&quot;</span><span class="p">]:</span>
        <span class="n">p_value</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span>
            <span class="n">pval_lower</span><span class="p">(</span><span class="n">test_statistic</span><span class="p">),</span> <span class="n">pval_upper</span><span class="p">(</span><span class="n">test_statistic</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid alternative.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_statistic</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">test_statistic</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">test_statistic</span><span class="p">,</span> <span class="n">p_value</span></div>



<div class="viewcode-block" id="grangercausalitytests">
<a class="viewcode-back" href="../../../generated/statsmodels.tsa.stattools.grangercausalitytests.html#statsmodels.tsa.stattools.grangercausalitytests">[docs]</a>
<span class="k">def</span> <span class="nf">grangercausalitytests</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">maxlag</span><span class="p">,</span> <span class="n">addconst</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Four tests for granger non causality of 2 time series.</span>

<span class="sd">    All four tests give similar results. `params_ftest` and `ssr_ftest` are</span>
<span class="sd">    equivalent based on F test which is identical to lmtest:grangertest in R.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        The data for testing whether the time series in the second column Granger</span>
<span class="sd">        causes the time series in the first column. Missing values are not</span>
<span class="sd">        supported.</span>
<span class="sd">    maxlag : {int, Iterable[int]}</span>
<span class="sd">        If an integer, computes the test for all lags up to maxlag. If an</span>
<span class="sd">        iterable, computes the tests only for the lags in maxlag.</span>
<span class="sd">    addconst : bool</span>
<span class="sd">        Include a constant in the model.</span>
<span class="sd">    verbose : bool</span>
<span class="sd">        Print results. Deprecated</span>

<span class="sd">        .. deprecated: 0.14</span>

<span class="sd">           verbose is deprecated and will be removed after 0.15 is released</span>



<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        All test results, dictionary keys are the number of lags. For each</span>
<span class="sd">        lag the values are a tuple, with the first element a dictionary with</span>
<span class="sd">        test statistic, pvalues, degrees of freedom, the second element are</span>
<span class="sd">        the OLS estimation results for the restricted model, the unrestricted</span>
<span class="sd">        model and the restriction (contrast) matrix for the parameter f_test.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    TODO: convert to class and attach results properly</span>

<span class="sd">    The Null hypothesis for grangercausalitytests is that the time series in</span>
<span class="sd">    the second column, x2, does NOT Granger cause the time series in the first</span>
<span class="sd">    column, x1. Grange causality means that past values of x2 have a</span>
<span class="sd">    statistically significant effect on the current value of x1, taking past</span>
<span class="sd">    values of x1 into account as regressors. We reject the null hypothesis</span>
<span class="sd">    that x2 does not Granger cause x1 if the pvalues are below a desired size</span>
<span class="sd">    of the test.</span>

<span class="sd">    The null hypothesis for all four test is that the coefficients</span>
<span class="sd">    corresponding to past values of the second time series are zero.</span>

<span class="sd">    `params_ftest`, `ssr_ftest` are based on F distribution</span>

<span class="sd">    `ssr_chi2test`, `lrtest` are based on chi-square distribution</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] https://en.wikipedia.org/wiki/Granger_causality</span>

<span class="sd">    .. [2] Greene: Econometric Analysis</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import statsmodels.api as sm</span>
<span class="sd">    &gt;&gt;&gt; from statsmodels.tsa.stattools import grangercausalitytests</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; data = sm.datasets.macrodata.load_pandas()</span>
<span class="sd">    &gt;&gt;&gt; data = data.data[[&quot;realgdp&quot;, &quot;realcons&quot;]].pct_change().dropna()</span>

<span class="sd">    All lags up to 4</span>

<span class="sd">    &gt;&gt;&gt; gc_res = grangercausalitytests(data, 4)</span>

<span class="sd">    Only lag 4</span>

<span class="sd">    &gt;&gt;&gt; gc_res = grangercausalitytests(data, [4])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">array_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;x contains NaN or inf values.&quot;</span><span class="p">)</span>
    <span class="n">addconst</span> <span class="o">=</span> <span class="n">bool_like</span><span class="p">(</span><span class="n">addconst</span><span class="p">,</span> <span class="s2">&quot;addconst&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="n">bool_like</span><span class="p">(</span><span class="n">verbose</span><span class="p">,</span> <span class="s2">&quot;verbose&quot;</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;verbose is deprecated since functions should not print results&quot;</span><span class="p">,</span>
            <span class="ne">FutureWarning</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># old default</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">maxlag</span> <span class="o">=</span> <span class="n">int_like</span><span class="p">(</span><span class="n">maxlag</span><span class="p">,</span> <span class="s2">&quot;maxlag&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">maxlag</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;maxlag must be a positive integer&quot;</span><span class="p">)</span>
        <span class="n">lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxlag</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">lag</span><span class="p">)</span> <span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="n">maxlag</span><span class="p">])</span>
        <span class="n">maxlag</span> <span class="o">=</span> <span class="n">lags</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">lags</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">lags</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;maxlag must be a non-empty list containing only &quot;</span>
                <span class="s2">&quot;positive integers&quot;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">maxlag</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">addconst</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Insufficient observations. Maximum allowable &quot;</span>
            <span class="s2">&quot;lag is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">addconst</span><span class="p">))</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">resli</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">mlg</span> <span class="ow">in</span> <span class="n">lags</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Granger Causality&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;number of lags (no zero)&quot;</span><span class="p">,</span> <span class="n">mlg</span><span class="p">)</span>
        <span class="n">mxlg</span> <span class="o">=</span> <span class="n">mlg</span>

        <span class="c1"># create lagmat of both time series</span>
        <span class="n">dta</span> <span class="o">=</span> <span class="n">lagmat2ds</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mxlg</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">dropex</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># add constant</span>
        <span class="k">if</span> <span class="n">addconst</span><span class="p">:</span>
            <span class="n">dtaown</span> <span class="o">=</span> <span class="n">add_constant</span><span class="p">(</span><span class="n">dta</span><span class="p">[:,</span> <span class="mi">1</span> <span class="p">:</span> <span class="p">(</span><span class="n">mxlg</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">prepend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">dtajoint</span> <span class="o">=</span> <span class="n">add_constant</span><span class="p">(</span><span class="n">dta</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">prepend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">dtajoint</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">dta</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">dtajoint</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">dtajoint</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">1</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="n">InfeasibleTestError</span><span class="p">(</span>
                    <span class="s2">&quot;The x values include a column with constant values and so&quot;</span>
                    <span class="s2">&quot; the test statistic cannot be computed.&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Not Implemented&quot;</span><span class="p">)</span>
            <span class="c1"># dtaown = dta[:, 1:mxlg]</span>
            <span class="c1"># dtajoint = dta[:, 1:]</span>

        <span class="c1"># Run ols on both models without and with lags of second variable</span>
        <span class="n">res2down</span> <span class="o">=</span> <span class="n">OLS</span><span class="p">(</span><span class="n">dta</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtaown</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">res2djoint</span> <span class="o">=</span> <span class="n">OLS</span><span class="p">(</span><span class="n">dta</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtajoint</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

        <span class="c1"># print results</span>
        <span class="c1"># for ssr based tests see:</span>
        <span class="c1"># http://support.sas.com/rnd/app/examples/ets/granger/index.htm</span>
        <span class="c1"># the other tests are made-up</span>

        <span class="c1"># Granger Causality test using ssr (F statistic)</span>
        <span class="k">if</span> <span class="n">res2djoint</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">k_constant</span><span class="p">:</span>
            <span class="n">tss</span> <span class="o">=</span> <span class="n">res2djoint</span><span class="o">.</span><span class="n">centered_tss</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tss</span> <span class="o">=</span> <span class="n">res2djoint</span><span class="o">.</span><span class="n">uncentered_tss</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">tss</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="ow">or</span> <span class="n">res2djoint</span><span class="o">.</span><span class="n">ssr</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">res2djoint</span><span class="o">.</span><span class="n">rsquared</span><span class="p">)</span>
            <span class="ow">or</span> <span class="p">(</span><span class="n">res2djoint</span><span class="o">.</span><span class="n">ssr</span> <span class="o">/</span> <span class="n">tss</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
            <span class="ow">or</span> <span class="n">res2djoint</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">dtajoint</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="n">InfeasibleTestError</span><span class="p">(</span>
                <span class="s2">&quot;The Granger causality test statistic cannot be computed &quot;</span>
                <span class="s2">&quot;because the VAR has a perfect fit of the data.&quot;</span>
            <span class="p">)</span>
        <span class="n">fgc1</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">res2down</span><span class="o">.</span><span class="n">ssr</span> <span class="o">-</span> <span class="n">res2djoint</span><span class="o">.</span><span class="n">ssr</span><span class="p">)</span>
            <span class="o">/</span> <span class="n">res2djoint</span><span class="o">.</span><span class="n">ssr</span>
            <span class="o">/</span> <span class="n">mxlg</span>
            <span class="o">*</span> <span class="n">res2djoint</span><span class="o">.</span><span class="n">df_resid</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;ssr based F test:         F=</span><span class="si">%-8.4f</span><span class="s2">, p=</span><span class="si">%-8.4f</span><span class="s2">, df_denom=</span><span class="si">%d</span><span class="s2">,&quot;</span>
                <span class="s2">&quot; df_num=</span><span class="si">%d</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span>
                    <span class="n">fgc1</span><span class="p">,</span>
                    <span class="n">stats</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">fgc1</span><span class="p">,</span> <span class="n">mxlg</span><span class="p">,</span> <span class="n">res2djoint</span><span class="o">.</span><span class="n">df_resid</span><span class="p">),</span>
                    <span class="n">res2djoint</span><span class="o">.</span><span class="n">df_resid</span><span class="p">,</span>
                    <span class="n">mxlg</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;ssr_ftest&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">fgc1</span><span class="p">,</span>
            <span class="n">stats</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">fgc1</span><span class="p">,</span> <span class="n">mxlg</span><span class="p">,</span> <span class="n">res2djoint</span><span class="o">.</span><span class="n">df_resid</span><span class="p">),</span>
            <span class="n">res2djoint</span><span class="o">.</span><span class="n">df_resid</span><span class="p">,</span>
            <span class="n">mxlg</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Granger Causality test using ssr (ch2 statistic)</span>
        <span class="n">fgc2</span> <span class="o">=</span> <span class="n">res2down</span><span class="o">.</span><span class="n">nobs</span> <span class="o">*</span> <span class="p">(</span><span class="n">res2down</span><span class="o">.</span><span class="n">ssr</span> <span class="o">-</span> <span class="n">res2djoint</span><span class="o">.</span><span class="n">ssr</span><span class="p">)</span> <span class="o">/</span> <span class="n">res2djoint</span><span class="o">.</span><span class="n">ssr</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;ssr based chi2 test:   chi2=</span><span class="si">%-8.4f</span><span class="s2">, p=</span><span class="si">%-8.4f</span><span class="s2">, &quot;</span>
                <span class="s2">&quot;df=</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fgc2</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">fgc2</span><span class="p">,</span> <span class="n">mxlg</span><span class="p">),</span> <span class="n">mxlg</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;ssr_chi2test&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">fgc2</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">fgc2</span><span class="p">,</span> <span class="n">mxlg</span><span class="p">),</span> <span class="n">mxlg</span><span class="p">)</span>

        <span class="c1"># likelihood ratio test pvalue:</span>
        <span class="n">lr</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">res2down</span><span class="o">.</span><span class="n">llf</span> <span class="o">-</span> <span class="n">res2djoint</span><span class="o">.</span><span class="n">llf</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;likelihood ratio test: chi2=</span><span class="si">%-8.4f</span><span class="s2">, p=</span><span class="si">%-8.4f</span><span class="s2">, df=</span><span class="si">%d</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">lr</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">lr</span><span class="p">,</span> <span class="n">mxlg</span><span class="p">),</span> <span class="n">mxlg</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;lrtest&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lr</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">lr</span><span class="p">,</span> <span class="n">mxlg</span><span class="p">),</span> <span class="n">mxlg</span><span class="p">)</span>

        <span class="c1"># F test that all lag coefficients of exog are zero</span>
        <span class="n">rconstr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">mxlg</span><span class="p">,</span> <span class="n">mxlg</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">mxlg</span><span class="p">,</span> <span class="n">mxlg</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">mxlg</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="p">)</span>
        <span class="n">ftres</span> <span class="o">=</span> <span class="n">res2djoint</span><span class="o">.</span><span class="n">f_test</span><span class="p">(</span><span class="n">rconstr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;parameter F test:         F=</span><span class="si">%-8.4f</span><span class="s2">, p=</span><span class="si">%-8.4f</span><span class="s2">, df_denom=</span><span class="si">%d</span><span class="s2">,&quot;</span>
                <span class="s2">&quot; df_num=</span><span class="si">%d</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">ftres</span><span class="o">.</span><span class="n">fvalue</span><span class="p">,</span> <span class="n">ftres</span><span class="o">.</span><span class="n">pvalue</span><span class="p">,</span> <span class="n">ftres</span><span class="o">.</span><span class="n">df_denom</span><span class="p">,</span> <span class="n">ftres</span><span class="o">.</span><span class="n">df_num</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;params_ftest&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">ftres</span><span class="o">.</span><span class="n">fvalue</span><span class="p">)[()],</span>
            <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">ftres</span><span class="o">.</span><span class="n">pvalue</span><span class="p">)[()],</span>
            <span class="n">ftres</span><span class="o">.</span><span class="n">df_denom</span><span class="p">,</span>
            <span class="n">ftres</span><span class="o">.</span><span class="n">df_num</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">resli</span><span class="p">[</span><span class="n">mxlg</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="p">[</span><span class="n">res2down</span><span class="p">,</span> <span class="n">res2djoint</span><span class="p">,</span> <span class="n">rconstr</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">resli</span></div>



<div class="viewcode-block" id="coint">
<a class="viewcode-back" href="../../../generated/statsmodels.tsa.stattools.coint.html#statsmodels.tsa.stattools.coint">[docs]</a>
<span class="k">def</span> <span class="nf">coint</span><span class="p">(</span>
    <span class="n">y0</span><span class="p">,</span>
    <span class="n">y1</span><span class="p">,</span>
    <span class="n">trend</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;aeg&quot;</span><span class="p">,</span>
    <span class="n">maxlag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">autolag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;aic&quot;</span><span class="p">,</span>
    <span class="n">return_results</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test for no-cointegration of a univariate equation.</span>

<span class="sd">    The null hypothesis is no cointegration. Variables in y0 and y1 are</span>
<span class="sd">    assumed to be integrated of order 1, I(1).</span>

<span class="sd">    This uses the augmented Engle-Granger two-step cointegration test.</span>
<span class="sd">    Constant or trend is included in 1st stage regression, i.e. in</span>
<span class="sd">    cointegrating equation.</span>

<span class="sd">    **Warning:** The autolag default has changed compared to statsmodels 0.8.</span>
<span class="sd">    In 0.8 autolag was always None, no the keyword is used and defaults to</span>
<span class="sd">    &quot;aic&quot;. Use `autolag=None` to avoid the lag search.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y0 : array_like</span>
<span class="sd">        The first element in cointegrated system. Must be 1-d.</span>
<span class="sd">    y1 : array_like</span>
<span class="sd">        The remaining elements in cointegrated system.</span>
<span class="sd">    trend : str {&quot;c&quot;, &quot;ct&quot;}</span>
<span class="sd">        The trend term included in regression for cointegrating equation.</span>

<span class="sd">        * &quot;c&quot; : constant.</span>
<span class="sd">        * &quot;ct&quot; : constant and linear trend.</span>
<span class="sd">        * also available quadratic trend &quot;ctt&quot;, and no constant &quot;n&quot;.</span>

<span class="sd">    method : {&quot;aeg&quot;}</span>
<span class="sd">        Only &quot;aeg&quot; (augmented Engle-Granger) is available.</span>
<span class="sd">    maxlag : None or int</span>
<span class="sd">        Argument for `adfuller`, largest or given number of lags.</span>
<span class="sd">    autolag : str</span>
<span class="sd">        Argument for `adfuller`, lag selection criterion.</span>

<span class="sd">        * If None, then maxlag lags are used without lag search.</span>
<span class="sd">        * If &quot;AIC&quot; (default) or &quot;BIC&quot;, then the number of lags is chosen</span>
<span class="sd">          to minimize the corresponding information criterion.</span>
<span class="sd">        * &quot;t-stat&quot; based choice of maxlag.  Starts with maxlag and drops a</span>
<span class="sd">          lag until the t-statistic on the last lag length is significant</span>
<span class="sd">          using a 5%-sized test.</span>
<span class="sd">    return_results : bool</span>
<span class="sd">        For future compatibility, currently only tuple available.</span>
<span class="sd">        If True, then a results instance is returned. Otherwise, a tuple</span>
<span class="sd">        with the test outcome is returned. Set `return_results=False` to</span>
<span class="sd">        avoid future changes in return.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    coint_t : float</span>
<span class="sd">        The t-statistic of unit-root test on residuals.</span>
<span class="sd">    pvalue : float</span>
<span class="sd">        MacKinnon&quot;s approximate, asymptotic p-value based on MacKinnon (1994).</span>
<span class="sd">    crit_value : dict</span>
<span class="sd">        Critical values for the test statistic at the 1 %, 5 %, and 10 %</span>
<span class="sd">        levels based on regression curve. This depends on the number of</span>
<span class="sd">        observations.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The Null hypothesis is that there is no cointegration, the alternative</span>
<span class="sd">    hypothesis is that there is cointegrating relationship. If the pvalue is</span>
<span class="sd">    small, below a critical size, then we can reject the hypothesis that there</span>
<span class="sd">    is no cointegrating relationship.</span>

<span class="sd">    P-values and critical values are obtained through regression surface</span>
<span class="sd">    approximation from MacKinnon 1994 and 2010.</span>

<span class="sd">    If the two series are almost perfectly collinear, then computing the</span>
<span class="sd">    test is numerically unstable. However, the two series will be cointegrated</span>
<span class="sd">    under the maintained assumption that they are integrated. In this case</span>
<span class="sd">    the t-statistic will be set to -inf and the pvalue to zero.</span>

<span class="sd">    TODO: We could handle gaps in data by dropping rows with nans in the</span>
<span class="sd">    Auxiliary regressions. Not implemented yet, currently assumes no nans</span>
<span class="sd">    and no gaps in time series.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] MacKinnon, J.G. 1994  &quot;Approximate Asymptotic Distribution Functions</span>
<span class="sd">       for Unit-Root and Cointegration Tests.&quot; Journal of Business &amp; Economics</span>
<span class="sd">       Statistics, 12.2, 167-76.</span>
<span class="sd">    .. [2] MacKinnon, J.G. 2010.  &quot;Critical Values for Cointegration Tests.&quot;</span>
<span class="sd">       Queen&quot;s University, Dept of Economics Working Papers 1227.</span>
<span class="sd">       http://ideas.repec.org/p/qed/wpaper/1227.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="n">array_like</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="s2">&quot;y0&quot;</span><span class="p">)</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">array_like</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="s2">&quot;y1&quot;</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">trend</span> <span class="o">=</span> <span class="n">string_like</span><span class="p">(</span><span class="n">trend</span><span class="p">,</span> <span class="s2">&quot;trend&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;ct&quot;</span><span class="p">,</span> <span class="s2">&quot;ctt&quot;</span><span class="p">))</span>
    <span class="n">string_like</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;aeg&quot;</span><span class="p">,))</span>
    <span class="n">maxlag</span> <span class="o">=</span> <span class="n">int_like</span><span class="p">(</span><span class="n">maxlag</span><span class="p">,</span> <span class="s2">&quot;maxlag&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">autolag</span> <span class="o">=</span> <span class="n">string_like</span><span class="p">(</span>
        <span class="n">autolag</span><span class="p">,</span> <span class="s2">&quot;autolag&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;aic&quot;</span><span class="p">,</span> <span class="s2">&quot;bic&quot;</span><span class="p">,</span> <span class="s2">&quot;t-stat&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">return_results</span> <span class="o">=</span> <span class="n">bool_like</span><span class="p">(</span><span class="n">return_results</span><span class="p">,</span> <span class="s2">&quot;return_results&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">nobs</span><span class="p">,</span> <span class="n">k_vars</span> <span class="o">=</span> <span class="n">y1</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">k_vars</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># add 1 for y0</span>

    <span class="k">if</span> <span class="n">trend</span> <span class="o">==</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span>
        <span class="n">xx</span> <span class="o">=</span> <span class="n">y1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xx</span> <span class="o">=</span> <span class="n">add_trend</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">trend</span><span class="o">=</span><span class="n">trend</span><span class="p">,</span> <span class="n">prepend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">res_co</span> <span class="o">=</span> <span class="n">OLS</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">xx</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">res_co</span><span class="o">.</span><span class="n">rsquared</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">SQRTEPS</span><span class="p">:</span>
        <span class="n">res_adf</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span>
            <span class="n">res_co</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">maxlag</span><span class="o">=</span><span class="n">maxlag</span><span class="p">,</span> <span class="n">autolag</span><span class="o">=</span><span class="n">autolag</span><span class="p">,</span> <span class="n">regression</span><span class="o">=</span><span class="s2">&quot;n&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;y0 and y1 are (almost) perfectly colinear.&quot;</span>
            <span class="s2">&quot;Cointegration test is not reliable in this case.&quot;</span><span class="p">,</span>
            <span class="n">CollinearityWarning</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Edge case where series are too similar</span>
        <span class="n">res_adf</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,)</span>

    <span class="c1"># no constant or trend, see egranger in Stata and MacKinnon</span>
    <span class="k">if</span> <span class="n">trend</span> <span class="o">==</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span>
        <span class="n">crit</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>  <span class="c1"># 2010 critical values not available</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">crit</span> <span class="o">=</span> <span class="n">mackinnoncrit</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">k_vars</span><span class="p">,</span> <span class="n">regression</span><span class="o">=</span><span class="n">trend</span><span class="p">,</span> <span class="n">nobs</span><span class="o">=</span><span class="n">nobs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1">#  nobs - 1, the -1 is to match egranger in Stata, I do not know why.</span>
        <span class="c1">#  TODO: check nobs or df = nobs - k</span>

    <span class="n">pval_asy</span> <span class="o">=</span> <span class="n">mackinnonp</span><span class="p">(</span><span class="n">res_adf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">regression</span><span class="o">=</span><span class="n">trend</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">k_vars</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res_adf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pval_asy</span><span class="p">,</span> <span class="n">crit</span></div>



<span class="k">def</span> <span class="nf">_safe_arma_fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">model_kw</span><span class="p">,</span> <span class="n">trend</span><span class="p">,</span> <span class="n">fit_kw</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="o">**</span><span class="n">model_kw</span><span class="p">,</span> <span class="n">trend</span><span class="o">=</span><span class="n">trend</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
            <span class="n">start_params</span><span class="o">=</span><span class="n">start_params</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_kw</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">LinAlgError</span><span class="p">:</span>
        <span class="c1"># SVD convergence failure on badly misspecified models</span>
        <span class="k">return</span>

    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">start_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># do not recurse again</span>
            <span class="c1"># user supplied start_params only get one chance</span>
            <span class="k">return</span>
        <span class="c1"># try a little harder, should be handled in fit really</span>
        <span class="k">elif</span> <span class="s2">&quot;initial&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">error</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">&quot;initial&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
            <span class="n">start_params</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">trend</span> <span class="o">==</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span>
                <span class="n">start_params</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">]</span> <span class="o">+</span> <span class="n">start_params</span>
            <span class="k">return</span> <span class="n">_safe_arma_fit</span><span class="p">(</span>
                <span class="n">y</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">model_kw</span><span class="p">,</span> <span class="n">trend</span><span class="p">,</span> <span class="n">fit_kw</span><span class="p">,</span> <span class="n">start_params</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span>
    <span class="k">except</span><span class="p">:</span>  <span class="c1"># no idea what happened</span>
        <span class="k">return</span>


<div class="viewcode-block" id="arma_order_select_ic">
<a class="viewcode-back" href="../../../generated/statsmodels.tsa.stattools.arma_order_select_ic.html#statsmodels.tsa.stattools.arma_order_select_ic">[docs]</a>
<span class="k">def</span> <span class="nf">arma_order_select_ic</span><span class="p">(</span>
    <span class="n">y</span><span class="p">,</span> <span class="n">max_ar</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">max_ma</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ic</span><span class="o">=</span><span class="s2">&quot;bic&quot;</span><span class="p">,</span> <span class="n">trend</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">model_kw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fit_kw</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute information criteria for many ARMA models.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y : array_like</span>
<span class="sd">        Array of time-series data.</span>
<span class="sd">    max_ar : int</span>
<span class="sd">        Maximum number of AR lags to use. Default 4.</span>
<span class="sd">    max_ma : int</span>
<span class="sd">        Maximum number of MA lags to use. Default 2.</span>
<span class="sd">    ic : str, list</span>
<span class="sd">        Information criteria to report. Either a single string or a list</span>
<span class="sd">        of different criteria is possible.</span>
<span class="sd">    trend : str</span>
<span class="sd">        The trend to use when fitting the ARMA models.</span>
<span class="sd">    model_kw : dict</span>
<span class="sd">        Keyword arguments to be passed to the ``ARMA`` model.</span>
<span class="sd">    fit_kw : dict</span>
<span class="sd">        Keyword arguments to be passed to ``ARMA.fit``.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Bunch</span>
<span class="sd">        Dict-like object with attribute access. Each ic is an attribute with a</span>
<span class="sd">        DataFrame for the results. The AR order used is the row index. The ma</span>
<span class="sd">        order used is the column index. The minimum orders are available as</span>
<span class="sd">        ``ic_min_order``.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This method can be used to tentatively identify the order of an ARMA</span>
<span class="sd">    process, provided that the time series is stationary and invertible. This</span>
<span class="sd">    function computes the full exact MLE estimate of each model and can be,</span>
<span class="sd">    therefore a little slow. An implementation using approximate estimates</span>
<span class="sd">    will be provided in the future. In the meantime, consider passing</span>
<span class="sd">    {method : &quot;css&quot;} to fit_kw.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; from statsmodels.tsa.arima_process import arma_generate_sample</span>
<span class="sd">    &gt;&gt;&gt; import statsmodels.api as sm</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>

<span class="sd">    &gt;&gt;&gt; arparams = np.array([.75, -.25])</span>
<span class="sd">    &gt;&gt;&gt; maparams = np.array([.65, .35])</span>
<span class="sd">    &gt;&gt;&gt; arparams = np.r_[1, -arparams]</span>
<span class="sd">    &gt;&gt;&gt; maparam = np.r_[1, maparams]</span>
<span class="sd">    &gt;&gt;&gt; nobs = 250</span>
<span class="sd">    &gt;&gt;&gt; np.random.seed(2014)</span>
<span class="sd">    &gt;&gt;&gt; y = arma_generate_sample(arparams, maparams, nobs)</span>
<span class="sd">    &gt;&gt;&gt; res = sm.tsa.arma_order_select_ic(y, ic=[&quot;aic&quot;, &quot;bic&quot;], trend=&quot;n&quot;)</span>
<span class="sd">    &gt;&gt;&gt; res.aic_min_order</span>
<span class="sd">    &gt;&gt;&gt; res.bic_min_order</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">max_ar</span> <span class="o">=</span> <span class="n">int_like</span><span class="p">(</span><span class="n">max_ar</span><span class="p">,</span> <span class="s2">&quot;max_ar&quot;</span><span class="p">)</span>
    <span class="n">max_ma</span> <span class="o">=</span> <span class="n">int_like</span><span class="p">(</span><span class="n">max_ma</span><span class="p">,</span> <span class="s2">&quot;max_ma&quot;</span><span class="p">)</span>
    <span class="n">trend</span> <span class="o">=</span> <span class="n">string_like</span><span class="p">(</span><span class="n">trend</span><span class="p">,</span> <span class="s2">&quot;trend&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">))</span>
    <span class="n">model_kw</span> <span class="o">=</span> <span class="n">dict_like</span><span class="p">(</span><span class="n">model_kw</span><span class="p">,</span> <span class="s2">&quot;model_kw&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fit_kw</span> <span class="o">=</span> <span class="n">dict_like</span><span class="p">(</span><span class="n">fit_kw</span><span class="p">,</span> <span class="s2">&quot;fit_kw&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ar_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_ar</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">ma_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_ma</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">ic</span> <span class="o">=</span> <span class="p">[</span><span class="n">ic</span><span class="p">]</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Need a list or a tuple for ic if not a string.&quot;</span><span class="p">)</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">ic</span><span class="p">),</span> <span class="n">max_ar</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max_ma</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">model_kw</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">model_kw</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">model_kw</span>
    <span class="n">fit_kw</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">fit_kw</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">fit_kw</span>
    <span class="n">y_arr</span> <span class="o">=</span> <span class="n">array_like</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">contiguous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ar</span> <span class="ow">in</span> <span class="n">ar_range</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ma</span> <span class="ow">in</span> <span class="n">ma_range</span><span class="p">:</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="n">_safe_arma_fit</span><span class="p">(</span><span class="n">y_arr</span><span class="p">,</span> <span class="p">(</span><span class="n">ar</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ma</span><span class="p">),</span> <span class="n">model_kw</span><span class="p">,</span> <span class="n">trend</span><span class="p">,</span> <span class="n">fit_kw</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mod</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[:,</span> <span class="n">ar</span><span class="p">,</span> <span class="n">ma</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">continue</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">criteria</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ic</span><span class="p">):</span>
                <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">ar</span><span class="p">,</span> <span class="n">ma</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">criteria</span><span class="p">)</span>

    <span class="n">dfs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">ma_range</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">ar_range</span><span class="p">)</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">results</span>
    <span class="p">]</span>

    <span class="n">res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span> <span class="n">dfs</span><span class="p">))</span>

    <span class="c1"># add the minimums to the results dict</span>
    <span class="n">min_res</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">result</span><span class="p">))</span>
        <span class="n">ncols</span> <span class="o">=</span> <span class="n">delta</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
        <span class="n">min_res</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_min_order&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">loc</span> <span class="o">//</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">loc</span> <span class="o">%</span> <span class="n">ncols</span><span class="p">)})</span>
    <span class="n">res</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">min_res</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Bunch</span><span class="p">(</span><span class="o">**</span><span class="n">res</span><span class="p">)</span></div>



<span class="k">def</span> <span class="nf">has_missing</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns True if &quot;data&quot; contains missing entries, otherwise False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>


<div class="viewcode-block" id="kpss">
<a class="viewcode-back" href="../../../generated/statsmodels.tsa.stattools.kpss.html#statsmodels.tsa.stattools.kpss">[docs]</a>
<span class="k">def</span> <span class="nf">kpss</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">regression</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;ct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span>
    <span class="n">nlags</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;legacy&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="n">store</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Kwiatkowski-Phillips-Schmidt-Shin test for stationarity.</span>

<span class="sd">    Computes the Kwiatkowski-Phillips-Schmidt-Shin (KPSS) test for the null</span>
<span class="sd">    hypothesis that x is level or trend stationary.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like, 1d</span>
<span class="sd">        The data series to test.</span>
<span class="sd">    regression : str{&quot;c&quot;, &quot;ct&quot;}</span>
<span class="sd">        The null hypothesis for the KPSS test.</span>

<span class="sd">        * &quot;c&quot; : The data is stationary around a constant (default).</span>
<span class="sd">        * &quot;ct&quot; : The data is stationary around a trend.</span>
<span class="sd">    nlags : {str, int}, optional</span>
<span class="sd">        Indicates the number of lags to be used. If &quot;auto&quot; (default), lags</span>
<span class="sd">        is calculated using the data-dependent method of Hobijn et al. (1998).</span>
<span class="sd">        See also Andrews (1991), Newey &amp; West (1994), and Schwert (1989). If</span>
<span class="sd">        set to &quot;legacy&quot;,  uses int(12 * (n / 100)**(1 / 4)) , as outlined in</span>
<span class="sd">        Schwert (1989).</span>
<span class="sd">    store : bool</span>
<span class="sd">        If True, then a result instance is returned additionally to</span>
<span class="sd">        the KPSS statistic (default is False).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    kpss_stat : float</span>
<span class="sd">        The KPSS test statistic.</span>
<span class="sd">    p_value : float</span>
<span class="sd">        The p-value of the test. The p-value is interpolated from</span>
<span class="sd">        Table 1 in Kwiatkowski et al. (1992), and a boundary point</span>
<span class="sd">        is returned if the test statistic is outside the table of</span>
<span class="sd">        critical values, that is, if the p-value is outside the</span>
<span class="sd">        interval (0.01, 0.1).</span>
<span class="sd">    lags : int</span>
<span class="sd">        The truncation lag parameter.</span>
<span class="sd">    crit : dict</span>
<span class="sd">        The critical values at 10%, 5%, 2.5% and 1%. Based on</span>
<span class="sd">        Kwiatkowski et al. (1992).</span>
<span class="sd">    resstore : (optional) instance of ResultStore</span>
<span class="sd">        An instance of a dummy class with results attached as attributes.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    To estimate sigma^2 the Newey-West estimator is used. If lags is &quot;legacy&quot;,</span>
<span class="sd">    the truncation lag parameter is set to int(12 * (n / 100) ** (1 / 4)),</span>
<span class="sd">    as outlined in Schwert (1989). The p-values are interpolated from</span>
<span class="sd">    Table 1 of Kwiatkowski et al. (1992). If the computed statistic is</span>
<span class="sd">    outside the table of critical values, then a warning message is</span>
<span class="sd">    generated.</span>

<span class="sd">    Missing values are not handled.</span>

<span class="sd">    See the notebook `Stationarity and detrending (ADF/KPSS)</span>
<span class="sd">    &lt;../examples/notebooks/generated/stationarity_detrending_adf_kpss.html&gt;`__</span>
<span class="sd">    for an overview.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Andrews, D.W.K. (1991). Heteroskedasticity and autocorrelation</span>
<span class="sd">       consistent covariance matrix estimation. Econometrica, 59: 817-858.</span>

<span class="sd">    .. [2] Hobijn, B., Frances, B.H., &amp; Ooms, M. (2004). Generalizations of the</span>
<span class="sd">       KPSS-test for stationarity. Statistica Neerlandica, 52: 483-502.</span>

<span class="sd">    .. [3] Kwiatkowski, D., Phillips, P.C.B., Schmidt, P., &amp; Shin, Y. (1992).</span>
<span class="sd">       Testing the null hypothesis of stationarity against the alternative of a</span>
<span class="sd">       unit root. Journal of Econometrics, 54: 159-178.</span>

<span class="sd">    .. [4] Newey, W.K., &amp; West, K.D. (1994). Automatic lag selection in</span>
<span class="sd">       covariance matrix estimation. Review of Economic Studies, 61: 631-653.</span>

<span class="sd">    .. [5] Schwert, G. W. (1989). Tests for unit roots: A Monte Carlo</span>
<span class="sd">       investigation. Journal of Business and Economic Statistics, 7 (2):</span>
<span class="sd">       147-159.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">array_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
    <span class="n">regression</span> <span class="o">=</span> <span class="n">string_like</span><span class="p">(</span><span class="n">regression</span><span class="p">,</span> <span class="s2">&quot;regression&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;ct&quot;</span><span class="p">))</span>
    <span class="n">store</span> <span class="o">=</span> <span class="n">bool_like</span><span class="p">(</span><span class="n">store</span><span class="p">,</span> <span class="s2">&quot;store&quot;</span><span class="p">)</span>

    <span class="n">nobs</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">hypo</span> <span class="o">=</span> <span class="n">regression</span>

    <span class="c1"># if m is not one, n != m * n</span>
    <span class="k">if</span> <span class="n">nobs</span> <span class="o">!=</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;x of shape </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> not understood&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">hypo</span> <span class="o">==</span> <span class="s2">&quot;ct&quot;</span><span class="p">:</span>
        <span class="c1"># p. 162 Kwiatkowski et al. (1992): y_t = beta * t + r_t + e_t,</span>
        <span class="c1"># where beta is the trend, r_t a random walk and e_t a stationary</span>
        <span class="c1"># error term.</span>
        <span class="n">resids</span> <span class="o">=</span> <span class="n">OLS</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">add_constant</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nobs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">resid</span>
        <span class="n">crit</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.119</span><span class="p">,</span> <span class="mf">0.146</span><span class="p">,</span> <span class="mf">0.176</span><span class="p">,</span> <span class="mf">0.216</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># hypo == &quot;c&quot;</span>
        <span class="c1"># special case of the model above, where beta = 0 (so the null</span>
        <span class="c1"># hypothesis is that the data is stationary around r_0).</span>
        <span class="n">resids</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">crit</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.347</span><span class="p">,</span> <span class="mf">0.463</span><span class="p">,</span> <span class="mf">0.574</span><span class="p">,</span> <span class="mf">0.739</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">nlags</span> <span class="o">==</span> <span class="s2">&quot;legacy&quot;</span><span class="p">:</span>
        <span class="n">nlags</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mf">12.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">nobs</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">)))</span>
        <span class="n">nlags</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nlags</span><span class="p">,</span> <span class="n">nobs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">nlags</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span> <span class="ow">or</span> <span class="n">nlags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nlags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># TODO: Remove before 0.14 is released</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;None is not a valid value for nlags. It must be an integer, &quot;</span>
                <span class="s2">&quot;&#39;auto&#39; or &#39;legacy&#39;. None will raise starting in 0.14&quot;</span><span class="p">,</span>
                <span class="ne">FutureWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c1"># autolag method of Hobijn et al. (1998)</span>
        <span class="n">nlags</span> <span class="o">=</span> <span class="n">_kpss_autolag</span><span class="p">(</span><span class="n">resids</span><span class="p">,</span> <span class="n">nobs</span><span class="p">)</span>
        <span class="n">nlags</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nlags</span><span class="p">,</span> <span class="n">nobs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nlags</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;nvals must be &#39;auto&#39; or &#39;legacy&#39; when not an int&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nlags</span> <span class="o">=</span> <span class="n">int_like</span><span class="p">(</span><span class="n">nlags</span><span class="p">,</span> <span class="s2">&quot;nlags&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">nlags</span> <span class="o">&gt;=</span> <span class="n">nobs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;lags (</span><span class="si">{</span><span class="n">nlags</span><span class="si">}</span><span class="s2">) must be &lt; number of observations (</span><span class="si">{</span><span class="n">nobs</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>

    <span class="n">pvals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>

    <span class="n">eta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">resids</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">nobs</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># eq. 11, p. 165</span>
    <span class="n">s_hat</span> <span class="o">=</span> <span class="n">_sigma_est_kpss</span><span class="p">(</span><span class="n">resids</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="n">nlags</span><span class="p">)</span>

    <span class="n">kpss_stat</span> <span class="o">=</span> <span class="n">eta</span> <span class="o">/</span> <span class="n">s_hat</span>
    <span class="n">p_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">kpss_stat</span><span class="p">,</span> <span class="n">crit</span><span class="p">,</span> <span class="n">pvals</span><span class="p">)</span>

    <span class="n">warn_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">The test statistic is outside of the range of p-values available in the</span>
<span class="s2">look-up table. The actual p-value is </span><span class="si">{direction}</span><span class="s2"> than the p-value returned.</span>
<span class="s2">&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">p_value</span> <span class="o">==</span> <span class="n">pvals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="n">warn_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s2">&quot;smaller&quot;</span><span class="p">),</span>
            <span class="n">InterpolationWarning</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">p_value</span> <span class="o">==</span> <span class="n">pvals</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="n">warn_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s2">&quot;greater&quot;</span><span class="p">),</span>
            <span class="n">InterpolationWarning</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">crit_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;10%&quot;</span><span class="p">:</span> <span class="n">crit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;5%&quot;</span><span class="p">:</span> <span class="n">crit</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;2.5%&quot;</span><span class="p">:</span> <span class="n">crit</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;1%&quot;</span><span class="p">:</span> <span class="n">crit</span><span class="p">[</span><span class="mi">3</span><span class="p">]}</span>

    <span class="k">if</span> <span class="n">store</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">statsmodels.stats.diagnostic</span> <span class="kn">import</span> <span class="n">ResultsStore</span>

        <span class="n">rstore</span> <span class="o">=</span> <span class="n">ResultsStore</span><span class="p">()</span>
        <span class="n">rstore</span><span class="o">.</span><span class="n">lags</span> <span class="o">=</span> <span class="n">nlags</span>
        <span class="n">rstore</span><span class="o">.</span><span class="n">nobs</span> <span class="o">=</span> <span class="n">nobs</span>

        <span class="n">stationary_type</span> <span class="o">=</span> <span class="s2">&quot;level&quot;</span> <span class="k">if</span> <span class="n">hypo</span> <span class="o">==</span> <span class="s2">&quot;c&quot;</span> <span class="k">else</span> <span class="s2">&quot;trend&quot;</span>
        <span class="n">rstore</span><span class="o">.</span><span class="n">H0</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;The series is </span><span class="si">{</span><span class="n">stationary_type</span><span class="si">}</span><span class="s2"> stationary&quot;</span>
        <span class="n">rstore</span><span class="o">.</span><span class="n">HA</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;The series is not </span><span class="si">{</span><span class="n">stationary_type</span><span class="si">}</span><span class="s2"> stationary&quot;</span>

        <span class="k">return</span> <span class="n">kpss_stat</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">crit_dict</span><span class="p">,</span> <span class="n">rstore</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">kpss_stat</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">nlags</span><span class="p">,</span> <span class="n">crit_dict</span></div>



<span class="k">def</span> <span class="nf">_sigma_est_kpss</span><span class="p">(</span><span class="n">resids</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="n">lags</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes equation 10, p. 164 of Kwiatkowski et al. (1992). This is the</span>
<span class="sd">    consistent estimator for the variance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">resids</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lags</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">resids_prod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">resids</span><span class="p">[</span><span class="n">i</span><span class="p">:],</span> <span class="n">resids</span><span class="p">[:</span> <span class="n">nobs</span> <span class="o">-</span> <span class="n">i</span><span class="p">])</span>
        <span class="n">s_hat</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">resids_prod</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="p">(</span><span class="n">lags</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">s_hat</span> <span class="o">/</span> <span class="n">nobs</span>


<span class="k">def</span> <span class="nf">_kpss_autolag</span><span class="p">(</span><span class="n">resids</span><span class="p">,</span> <span class="n">nobs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the number of lags for covariance matrix estimation in KPSS test</span>
<span class="sd">    using method of Hobijn et al (1998). See also Andrews (1991), Newey &amp; West</span>
<span class="sd">    (1994), and Schwert (1989). Assumes Bartlett / Newey-West kernel.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">covlags</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">nobs</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="mf">9.0</span><span class="p">))</span>
    <span class="n">s0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">resids</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">nobs</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">covlags</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">resids_prod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">resids</span><span class="p">[</span><span class="n">i</span><span class="p">:],</span> <span class="n">resids</span><span class="p">[:</span> <span class="n">nobs</span> <span class="o">-</span> <span class="n">i</span><span class="p">])</span>
        <span class="n">resids_prod</span> <span class="o">/=</span> <span class="n">nobs</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">s0</span> <span class="o">+=</span> <span class="n">resids_prod</span>
        <span class="n">s1</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">resids_prod</span>
    <span class="n">s_hat</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">/</span> <span class="n">s0</span>
    <span class="n">pwr</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">3.0</span>
    <span class="n">gamma_hat</span> <span class="o">=</span> <span class="mf">1.1447</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">s_hat</span> <span class="o">*</span> <span class="n">s_hat</span><span class="p">,</span> <span class="n">pwr</span><span class="p">)</span>
    <span class="n">autolags</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">gamma_hat</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">nobs</span><span class="p">,</span> <span class="n">pwr</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">autolags</span>


<div class="viewcode-block" id="range_unit_root_test">
<a class="viewcode-back" href="../../../generated/statsmodels.tsa.stattools.range_unit_root_test.html#statsmodels.tsa.stattools.range_unit_root_test">[docs]</a>
<span class="k">def</span> <span class="nf">range_unit_root_test</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Range unit-root test for stationarity.</span>

<span class="sd">    Computes the Range Unit-Root (RUR) test for the null</span>
<span class="sd">    hypothesis that x is stationary.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like, 1d</span>
<span class="sd">        The data series to test.</span>
<span class="sd">    store : bool</span>
<span class="sd">        If True, then a result instance is returned additionally to</span>
<span class="sd">        the RUR statistic (default is False).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rur_stat : float</span>
<span class="sd">        The RUR test statistic.</span>
<span class="sd">    p_value : float</span>
<span class="sd">        The p-value of the test. The p-value is interpolated from</span>
<span class="sd">        Table 1 in Aparicio et al. (2006), and a boundary point</span>
<span class="sd">        is returned if the test statistic is outside the table of</span>
<span class="sd">        critical values, that is, if the p-value is outside the</span>
<span class="sd">        interval (0.01, 0.1).</span>
<span class="sd">    crit : dict</span>
<span class="sd">        The critical values at 10%, 5%, 2.5% and 1%. Based on</span>
<span class="sd">        Aparicio et al. (2006).</span>
<span class="sd">    resstore : (optional) instance of ResultStore</span>
<span class="sd">        An instance of a dummy class with results attached as attributes.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The p-values are interpolated from</span>
<span class="sd">    Table 1 of Aparicio et al. (2006). If the computed statistic is</span>
<span class="sd">    outside the table of critical values, then a warning message is</span>
<span class="sd">    generated.</span>

<span class="sd">    Missing values are not handled.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Aparicio, F., Escribano A., Sipols, A.E. (2006). Range Unit-Root (RUR)</span>
<span class="sd">        tests: robust against nonlinearities, error distributions, structural breaks</span>
<span class="sd">        and outliers. Journal of Time Series Analysis, 27 (4): 545-576.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">array_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
    <span class="n">store</span> <span class="o">=</span> <span class="n">bool_like</span><span class="p">(</span><span class="n">store</span><span class="p">,</span> <span class="s2">&quot;store&quot;</span><span class="p">)</span>

    <span class="n">nobs</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># if m is not one, n != m * n</span>
    <span class="k">if</span> <span class="n">nobs</span> <span class="o">!=</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;x of shape </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> not understood&quot;</span><span class="p">)</span>

    <span class="c1"># Table from [1] has been replicated using 200,000 samples</span>
    <span class="c1"># Critical values for new n_obs values have been identified</span>
    <span class="n">pvals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="mi">4000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">crit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">[</span><span class="mf">0.6626</span><span class="p">,</span> <span class="mf">0.8126</span><span class="p">,</span> <span class="mf">0.9192</span><span class="p">,</span> <span class="mf">1.0712</span><span class="p">,</span> <span class="mf">2.4863</span><span class="p">,</span> <span class="mf">2.7312</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.7977</span><span class="p">,</span> <span class="mf">0.9274</span><span class="p">,</span> <span class="mf">1.0478</span><span class="p">,</span> <span class="mf">1.1964</span><span class="p">,</span> <span class="mf">2.6821</span><span class="p">,</span> <span class="mf">2.9613</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.9070</span><span class="p">,</span> <span class="mf">1.0243</span><span class="p">,</span> <span class="mf">1.1412</span><span class="p">,</span> <span class="mf">1.2888</span><span class="p">,</span> <span class="mf">2.8317</span><span class="p">,</span> <span class="mf">3.1393</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.9543</span><span class="p">,</span> <span class="mf">1.0768</span><span class="p">,</span> <span class="mf">1.1869</span><span class="p">,</span> <span class="mf">1.3294</span><span class="p">,</span> <span class="mf">2.8915</span><span class="p">,</span> <span class="mf">3.2049</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.9833</span><span class="p">,</span> <span class="mf">1.0984</span><span class="p">,</span> <span class="mf">1.2101</span><span class="p">,</span> <span class="mf">1.3494</span><span class="p">,</span> <span class="mf">2.9308</span><span class="p">,</span> <span class="mf">3.2482</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.9982</span><span class="p">,</span> <span class="mf">1.1137</span><span class="p">,</span> <span class="mf">1.2242</span><span class="p">,</span> <span class="mf">1.3632</span><span class="p">,</span> <span class="mf">2.9571</span><span class="p">,</span> <span class="mf">3.2842</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.0494</span><span class="p">,</span> <span class="mf">1.1643</span><span class="p">,</span> <span class="mf">1.2712</span><span class="p">,</span> <span class="mf">1.4076</span><span class="p">,</span> <span class="mf">3.0207</span><span class="p">,</span> <span class="mf">3.3584</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.0846</span><span class="p">,</span> <span class="mf">1.1959</span><span class="p">,</span> <span class="mf">1.2988</span><span class="p">,</span> <span class="mf">1.4344</span><span class="p">,</span> <span class="mf">3.0653</span><span class="p">,</span> <span class="mf">3.4073</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.1121</span><span class="p">,</span> <span class="mf">1.2200</span><span class="p">,</span> <span class="mf">1.3230</span><span class="p">,</span> <span class="mf">1.4556</span><span class="p">,</span> <span class="mf">3.0948</span><span class="p">,</span> <span class="mf">3.4439</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.1204</span><span class="p">,</span> <span class="mf">1.2295</span><span class="p">,</span> <span class="mf">1.3303</span><span class="p">,</span> <span class="mf">1.4656</span><span class="p">,</span> <span class="mf">3.1054</span><span class="p">,</span> <span class="mf">3.4632</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.1309</span><span class="p">,</span> <span class="mf">1.2347</span><span class="p">,</span> <span class="mf">1.3378</span><span class="p">,</span> <span class="mf">1.4693</span><span class="p">,</span> <span class="mf">3.1165</span><span class="p">,</span> <span class="mf">3.4717</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.1377</span><span class="p">,</span> <span class="mf">1.2402</span><span class="p">,</span> <span class="mf">1.3408</span><span class="p">,</span> <span class="mf">1.4729</span><span class="p">,</span> <span class="mf">3.1252</span><span class="p">,</span> <span class="mf">3.4807</span><span class="p">],</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Interpolation for nobs</span>
    <span class="n">inter_crit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">crit</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">crit</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">crit</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
        <span class="n">inter_crit</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">nobs</span><span class="p">)</span>

    <span class="c1"># Calculate RUR stat</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">exp_max</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">expanding</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">exp_min</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">expanding</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="p">(</span><span class="n">xs</span> <span class="o">&gt;</span> <span class="n">exp_max</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="n">xs</span> <span class="o">&lt;</span> <span class="n">exp_min</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="n">rur_stat</span> <span class="o">=</span> <span class="n">count</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pvals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pvals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">rur_stat</span> <span class="o">&lt;</span> <span class="n">inter_crit</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="n">p_value</span> <span class="o">=</span> <span class="n">pvals</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

    <span class="n">warn_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">The test statistic is outside of the range of p-values available in the</span>
<span class="s2">look-up table. The actual p-value is </span><span class="si">{direction}</span><span class="s2"> than the p-value returned.</span>
<span class="s2">&quot;&quot;&quot;</span>
    <span class="n">direction</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">p_value</span> <span class="o">==</span> <span class="n">pvals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="s2">&quot;smaller&quot;</span>
    <span class="k">elif</span> <span class="n">p_value</span> <span class="o">==</span> <span class="n">pvals</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="s2">&quot;larger&quot;</span>

    <span class="k">if</span> <span class="n">direction</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="n">warn_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">),</span>
            <span class="n">InterpolationWarning</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">crit_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;10%&quot;</span><span class="p">:</span> <span class="n">inter_crit</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="s2">&quot;5%&quot;</span><span class="p">:</span> <span class="n">inter_crit</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="s2">&quot;2.5%&quot;</span><span class="p">:</span> <span class="n">inter_crit</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s2">&quot;1%&quot;</span><span class="p">:</span> <span class="n">inter_crit</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">store</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">statsmodels.stats.diagnostic</span> <span class="kn">import</span> <span class="n">ResultsStore</span>

        <span class="n">rstore</span> <span class="o">=</span> <span class="n">ResultsStore</span><span class="p">()</span>
        <span class="n">rstore</span><span class="o">.</span><span class="n">nobs</span> <span class="o">=</span> <span class="n">nobs</span>

        <span class="n">rstore</span><span class="o">.</span><span class="n">H0</span> <span class="o">=</span> <span class="s2">&quot;The series is not stationary&quot;</span>
        <span class="n">rstore</span><span class="o">.</span><span class="n">HA</span> <span class="o">=</span> <span class="s2">&quot;The series is stationary&quot;</span>

        <span class="k">return</span> <span class="n">rur_stat</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">crit_dict</span><span class="p">,</span> <span class="n">rstore</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rur_stat</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">crit_dict</span></div>



<span class="k">class</span> <span class="nc">ZivotAndrewsUnitRoot</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class wrapper for Zivot-Andrews structural-break unit-root test</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Critical values for the three different models specified for the</span>
<span class="sd">        Zivot-Andrews unit-root test.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The p-values are generated through Monte Carlo simulation using</span>
<span class="sd">        100,000 replications and 2000 data points.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_za_critical_values</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># constant-only model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_c</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.78442</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.100</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.83192</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.200</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.68139</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.300</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.58461</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.400</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.51308</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.45043</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.600</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.39924</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.700</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.36023</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.800</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.33219</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.900</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.30294</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">1.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.27644</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">2.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.03340</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">5.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.81067</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">7.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.67636</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">10.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.56618</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">12.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.48130</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">15.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.40507</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">17.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.33947</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">20.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.28155</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">22.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.22683</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">25.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.17830</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">27.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.13101</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">30.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.08586</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">32.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.04455</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">35.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.00380</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">37.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.96144</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">40.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.92078</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">42.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.88178</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">45.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.84503</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">47.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.80549</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">50.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.77031</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">52.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.73209</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">55.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.69600</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">57.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.65985</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">60.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.62126</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">65.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.54580</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">70.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.46848</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">75.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.38533</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">80.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.29112</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">85.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.17832</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">90.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.04165</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">92.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.95146</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">95.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.83179</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">96.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.76465</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">97.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.68624</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">98.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.57884</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">99.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.40044</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">99.900</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.88932</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_za_critical_values</span><span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_c</span><span class="p">)</span>
        <span class="c1"># trend-only model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="o">-</span><span class="mf">83.9094</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.100</span><span class="p">,</span> <span class="o">-</span><span class="mf">13.8837</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.200</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.13205</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.300</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.32564</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.400</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.60803</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.38794</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.600</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.26585</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.700</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.18734</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.800</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.12756</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.900</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.07984</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">1.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.03421</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">2.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.65634</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">5.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.40580</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">7.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.25214</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">10.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.13678</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">12.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.03765</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">15.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.95185</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">17.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.87945</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">20.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.81295</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">22.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.75273</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">25.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.69836</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">27.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.64785</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">30.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.59819</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">32.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.55146</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">35.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.50522</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">37.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.45987</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">40.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.41672</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">42.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.37465</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">45.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.33394</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">47.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.29393</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">50.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.25316</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">52.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.21244</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">55.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.17124</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">57.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.13211</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">60.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.09204</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">65.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.01135</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">70.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.92897</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">75.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.83614</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">80.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.73893</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">85.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.62840</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">90.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.49611</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">92.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.41337</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">95.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.30820</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">96.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.25797</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">97.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.19648</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">98.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.11320</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">99.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.99138</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">99.900</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.67466</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_za_critical_values</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="p">)</span>
        <span class="c1"># constant + trend model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ct</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="o">-</span><span class="mf">38.17800</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.100</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.43107</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.200</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.07279</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.300</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.95496</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.400</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.86254</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.77081</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.600</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.72541</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.700</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.68406</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.800</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.65163</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.900</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.60419</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">1.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.57556</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">2.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.29704</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">5.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.07332</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">7.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.93003</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">10.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.82668</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">12.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.73711</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">15.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.66020</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">17.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.58970</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">20.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.52855</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">22.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.47100</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">25.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.42011</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">27.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.37387</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">30.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.32705</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">32.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.28126</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">35.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.23793</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">37.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.19822</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">40.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.15800</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">42.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.11946</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">45.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.08064</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">47.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.04286</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">50.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.00489</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">52.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.96837</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">55.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.93200</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">57.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.89496</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">60.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.85577</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">65.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.77795</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">70.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.69794</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">75.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.61852</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">80.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.52485</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">85.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.41665</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">90.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.28527</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">92.500</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.19724</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">95.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.08769</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">96.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.03088</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">97.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.96091</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">98.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.85581</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">99.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.71015</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">99.900</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.28767</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_za_critical_values</span><span class="p">[</span><span class="s2">&quot;ct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ct</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_za_crit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stat</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Linear interpolation for Zivot-Andrews p-values and critical values</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        stat : float</span>
<span class="sd">            The ZA test statistic</span>
<span class="sd">        model : {&quot;c&quot;,&quot;t&quot;,&quot;ct&quot;}</span>
<span class="sd">            The model used when computing the ZA statistic. &quot;c&quot; is default.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pvalue : float</span>
<span class="sd">            The interpolated p-value</span>
<span class="sd">        cvdict : dict</span>
<span class="sd">            Critical values for the test statistic at the 1%, 5%, and 10%</span>
<span class="sd">            levels</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The p-values are linear interpolated from the quantiles of the</span>
<span class="sd">        simulated ZA test statistic distribution</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_za_critical_values</span><span class="p">[</span><span class="n">model</span><span class="p">]</span>
        <span class="n">pcnts</span> <span class="o">=</span> <span class="n">table</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">table</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c1"># ZA cv table contains quantiles multiplied by 100</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">pcnts</span><span class="p">)</span> <span class="o">/</span> <span class="mf">100.0</span>
        <span class="n">cv</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]</span>
        <span class="n">crit_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">cv</span><span class="p">,</span> <span class="n">pcnts</span><span class="p">,</span> <span class="n">stats</span><span class="p">)</span>
        <span class="n">cvdict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;1%&quot;</span><span class="p">:</span> <span class="n">crit_value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;5%&quot;</span><span class="p">:</span> <span class="n">crit_value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s2">&quot;10%&quot;</span><span class="p">:</span> <span class="n">crit_value</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">pvalue</span><span class="p">,</span> <span class="n">cvdict</span>

    <span class="k">def</span> <span class="nf">_quick_ols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Minimal implementation of LS estimator for internal use</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xpxi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">exog</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">exog</span><span class="p">))</span>
        <span class="n">xpy</span> <span class="o">=</span> <span class="n">exog</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">endog</span><span class="p">)</span>
        <span class="n">nobs</span><span class="p">,</span> <span class="n">k_exog</span> <span class="o">=</span> <span class="n">exog</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">xpxi</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">xpy</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">endog</span> <span class="o">-</span> <span class="n">exog</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">sigma2</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">nobs</span> <span class="o">-</span> <span class="n">k_exog</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">b</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">sigma2</span> <span class="o">*</span> <span class="n">xpxi</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_format_regression_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">series</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="n">const</span><span class="p">,</span> <span class="n">trend</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">lags</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the endog/exog data for the auxiliary regressions</span>
<span class="sd">        from the original (standardized) series under test.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># first-diff y and standardize for numerical stability</span>
        <span class="n">endog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">endog</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">endog</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">endog</span><span class="p">))</span>
        <span class="n">series</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">series</span><span class="p">))</span>
        <span class="c1"># reserve exog space</span>
        <span class="n">exog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">endog</span><span class="p">[</span><span class="n">lags</span><span class="p">:]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cols</span> <span class="o">+</span> <span class="n">lags</span><span class="p">))</span>
        <span class="n">exog</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">const</span>
        <span class="c1"># lagged y and dy</span>
        <span class="n">exog</span><span class="p">[:,</span> <span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">series</span><span class="p">[</span><span class="n">lags</span> <span class="p">:</span> <span class="p">(</span><span class="n">nobs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">exog</span><span class="p">[:,</span> <span class="n">cols</span><span class="p">:]</span> <span class="o">=</span> <span class="n">lagmat</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">lags</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)[</span>
            <span class="n">lags</span> <span class="p">:</span> <span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lags</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">endog</span><span class="p">,</span> <span class="n">exog</span>

    <span class="k">def</span> <span class="nf">_update_regression_exog</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">regression</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="n">const</span><span class="p">,</span> <span class="n">trend</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">lags</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the exog array for the next regression.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cutoff</span> <span class="o">=</span> <span class="n">period</span> <span class="o">-</span> <span class="p">(</span><span class="n">lags</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">regression</span> <span class="o">!=</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span>
            <span class="n">exog</span><span class="p">[:</span><span class="n">cutoff</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">exog</span><span class="p">[</span><span class="n">cutoff</span><span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">const</span>
            <span class="n">exog</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">trend</span><span class="p">[(</span><span class="n">lags</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="p">:</span> <span class="p">(</span><span class="n">nobs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">regression</span> <span class="o">==</span> <span class="s2">&quot;ct&quot;</span><span class="p">:</span>
                <span class="n">exog</span><span class="p">[:</span><span class="n">cutoff</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">exog</span><span class="p">[</span><span class="n">cutoff</span><span class="p">:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">trend</span><span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="p">(</span><span class="n">nobs</span> <span class="o">-</span> <span class="n">period</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exog</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">trend</span><span class="p">[(</span><span class="n">lags</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="p">:</span> <span class="p">(</span><span class="n">nobs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="n">exog</span><span class="p">[:</span> <span class="p">(</span><span class="n">cutoff</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">exog</span><span class="p">[(</span><span class="n">cutoff</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">trend</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="p">(</span><span class="n">nobs</span> <span class="o">-</span> <span class="n">period</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">exog</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">maxlag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">regression</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">autolag</span><span class="o">=</span><span class="s2">&quot;AIC&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Zivot-Andrews structural-break unit-root test.</span>

<span class="sd">        The Zivot-Andrews test tests for a unit root in a univariate process</span>
<span class="sd">        in the presence of serial correlation and a single structural break.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            The data series to test.</span>
<span class="sd">        trim : float</span>
<span class="sd">            The percentage of series at begin/end to exclude from break-period</span>
<span class="sd">            calculation in range [0, 0.333] (default=0.15).</span>
<span class="sd">        maxlag : int</span>
<span class="sd">            The maximum lag which is included in test, default is</span>
<span class="sd">            12*(nobs/100)^{1/4} (Schwert, 1989).</span>
<span class="sd">        regression : {&quot;c&quot;,&quot;t&quot;,&quot;ct&quot;}</span>
<span class="sd">            Constant and trend order to include in regression.</span>

<span class="sd">            * &quot;c&quot; : constant only (default).</span>
<span class="sd">            * &quot;t&quot; : trend only.</span>
<span class="sd">            * &quot;ct&quot; : constant and trend.</span>
<span class="sd">        autolag : {&quot;AIC&quot;, &quot;BIC&quot;, &quot;t-stat&quot;, None}</span>
<span class="sd">            The method to select the lag length when using automatic selection.</span>

<span class="sd">            * if None, then maxlag lags are used,</span>
<span class="sd">            * if &quot;AIC&quot; (default) or &quot;BIC&quot;, then the number of lags is chosen</span>
<span class="sd">              to minimize the corresponding information criterion,</span>
<span class="sd">            * &quot;t-stat&quot; based choice of maxlag.  Starts with maxlag and drops a</span>
<span class="sd">              lag until the t-statistic on the last lag length is significant</span>
<span class="sd">              using a 5%-sized test.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        zastat : float</span>
<span class="sd">            The test statistic.</span>
<span class="sd">        pvalue : float</span>
<span class="sd">            The pvalue based on MC-derived critical values.</span>
<span class="sd">        cvdict : dict</span>
<span class="sd">            The critical values for the test statistic at the 1%, 5%, and 10%</span>
<span class="sd">            levels.</span>
<span class="sd">        baselag : int</span>
<span class="sd">            The number of lags used for period regressions.</span>
<span class="sd">        bpidx : int</span>
<span class="sd">            The index of x corresponding to endogenously calculated break period</span>
<span class="sd">            with values in the range [0..nobs-1].</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        H0 = unit root with a single structural break</span>

<span class="sd">        Algorithm follows Baum (2004/2015) approximation to original</span>
<span class="sd">        Zivot-Andrews method. Rather than performing an autolag regression at</span>
<span class="sd">        each candidate break period (as per the original paper), a single</span>
<span class="sd">        autolag regression is run up-front on the base model (constant + trend</span>
<span class="sd">        with no dummies) to determine the best lag length. This lag length is</span>
<span class="sd">        then used for all subsequent break-period regressions. This results in</span>
<span class="sd">        significant run time reduction but also slightly more pessimistic test</span>
<span class="sd">        statistics than the original Zivot-Andrews method, although no attempt</span>
<span class="sd">        has been made to characterize the size/power trade-off.</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        .. [1] Baum, C.F. (2004). ZANDREWS: Stata module to calculate</span>
<span class="sd">           Zivot-Andrews unit root test in presence of structural break,&quot;</span>
<span class="sd">           Statistical Software Components S437301, Boston College Department</span>
<span class="sd">           of Economics, revised 2015.</span>

<span class="sd">        .. [2] Schwert, G.W. (1989). Tests for unit roots: A Monte Carlo</span>
<span class="sd">           investigation. Journal of Business &amp; Economic Statistics, 7:</span>
<span class="sd">           147-159.</span>

<span class="sd">        .. [3] Zivot, E., and Andrews, D.W.K. (1992). Further evidence on the</span>
<span class="sd">           great crash, the oil-price shock, and the unit-root hypothesis.</span>
<span class="sd">           Journal of Business &amp; Economic Studies, 10: 251-270.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">array_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
        <span class="n">trim</span> <span class="o">=</span> <span class="n">float_like</span><span class="p">(</span><span class="n">trim</span><span class="p">,</span> <span class="s2">&quot;trim&quot;</span><span class="p">)</span>
        <span class="n">maxlag</span> <span class="o">=</span> <span class="n">int_like</span><span class="p">(</span><span class="n">maxlag</span><span class="p">,</span> <span class="s2">&quot;maxlag&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">regression</span> <span class="o">=</span> <span class="n">string_like</span><span class="p">(</span>
            <span class="n">regression</span><span class="p">,</span> <span class="s2">&quot;regression&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;ct&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">autolag</span> <span class="o">=</span> <span class="n">string_like</span><span class="p">(</span>
            <span class="n">autolag</span><span class="p">,</span> <span class="s2">&quot;autolag&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;aic&quot;</span><span class="p">,</span> <span class="s2">&quot;bic&quot;</span><span class="p">,</span> <span class="s2">&quot;t-stat&quot;</span><span class="p">),</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">trim</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">trim</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;trim value must be a float in range [0, 1/3)&quot;</span><span class="p">)</span>
        <span class="n">nobs</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">autolag</span><span class="p">:</span>
            <span class="n">adf_res</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">maxlag</span><span class="o">=</span><span class="n">maxlag</span><span class="p">,</span> <span class="n">regression</span><span class="o">=</span><span class="s2">&quot;ct&quot;</span><span class="p">,</span> <span class="n">autolag</span><span class="o">=</span><span class="n">autolag</span>
            <span class="p">)</span>
            <span class="n">baselags</span> <span class="o">=</span> <span class="n">adf_res</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">maxlag</span><span class="p">:</span>
            <span class="n">baselags</span> <span class="o">=</span> <span class="n">maxlag</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">baselags</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">12.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">nobs</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">))</span>
        <span class="n">trimcnt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nobs</span> <span class="o">*</span> <span class="n">trim</span><span class="p">)</span>
        <span class="n">start_period</span> <span class="o">=</span> <span class="n">trimcnt</span>
        <span class="n">end_period</span> <span class="o">=</span> <span class="n">nobs</span> <span class="o">-</span> <span class="n">trimcnt</span>
        <span class="k">if</span> <span class="n">regression</span> <span class="o">==</span> <span class="s2">&quot;ct&quot;</span><span class="p">:</span>
            <span class="n">basecols</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">basecols</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="c1"># normalize constant and trend terms for stability</span>
        <span class="n">c_const</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nobs</span><span class="p">)</span>
        <span class="n">t_const</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">nobs</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">t_const</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="n">nobs</span> <span class="o">**</span> <span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1"># format the auxiliary regression data</span>
        <span class="n">endog</span><span class="p">,</span> <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_regression_data</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="n">c_const</span><span class="p">,</span> <span class="n">t_const</span><span class="p">,</span> <span class="n">basecols</span><span class="p">,</span> <span class="n">baselags</span>
        <span class="p">)</span>
        <span class="c1"># iterate through the time periods</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">end_period</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">bp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_period</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">end_period</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># update intercept dummy / trend / trend dummy</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_regression_exog</span><span class="p">(</span>
                <span class="n">exog</span><span class="p">,</span>
                <span class="n">regression</span><span class="p">,</span>
                <span class="n">bp</span><span class="p">,</span>
                <span class="n">nobs</span><span class="p">,</span>
                <span class="n">c_const</span><span class="p">,</span>
                <span class="n">t_const</span><span class="p">,</span>
                <span class="n">basecols</span><span class="p">,</span>
                <span class="n">baselags</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># check exog rank on first iteration</span>
            <span class="k">if</span> <span class="n">bp</span> <span class="o">==</span> <span class="n">start_period</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">o</span> <span class="o">=</span> <span class="n">OLS</span><span class="p">(</span><span class="n">endog</span><span class="p">[</span><span class="n">baselags</span><span class="p">:],</span> <span class="n">exog</span><span class="p">,</span> <span class="n">hasconst</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">df_model</span> <span class="o">&lt;</span> <span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;ZA: auxiliary exog matrix is not full rank.</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="s2">&quot;  cols (exc intercept) = </span><span class="si">{}</span><span class="s2">  rank = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">df_model</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="n">stats</span><span class="p">[</span><span class="n">bp</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="n">basecols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stats</span><span class="p">[</span><span class="n">bp</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quick_ols</span><span class="p">(</span><span class="n">endog</span><span class="p">[</span><span class="n">baselags</span><span class="p">:],</span> <span class="n">exog</span><span class="p">)[</span>
                    <span class="n">basecols</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="p">]</span>
        <span class="c1"># return best seen</span>
        <span class="n">zastat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
        <span class="n">bpidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">crit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_za_crit</span><span class="p">(</span><span class="n">zastat</span><span class="p">,</span> <span class="n">regression</span><span class="p">)</span>
        <span class="n">pval</span> <span class="o">=</span> <span class="n">crit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cvdict</span> <span class="o">=</span> <span class="n">crit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">zastat</span><span class="p">,</span> <span class="n">pval</span><span class="p">,</span> <span class="n">cvdict</span><span class="p">,</span> <span class="n">baselags</span><span class="p">,</span> <span class="n">bpidx</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">maxlag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">regression</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">autolag</span><span class="o">=</span><span class="s2">&quot;AIC&quot;</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="n">trim</span><span class="p">,</span> <span class="n">maxlag</span><span class="o">=</span><span class="n">maxlag</span><span class="p">,</span> <span class="n">regression</span><span class="o">=</span><span class="n">regression</span><span class="p">,</span> <span class="n">autolag</span><span class="o">=</span><span class="n">autolag</span>
        <span class="p">)</span>


<span class="n">zivot_andrews</span> <span class="o">=</span> <span class="n">ZivotAndrewsUnitRoot</span><span class="p">()</span>
<span class="n">zivot_andrews</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">zivot_andrews</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="vm">__doc__</span>
</code></pre></div>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      Jun 14, 2024
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  
  
  <div class="md-footer-meta md-typeset">
    
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-footer-copyright__highlight">
        &#169; Copyright 2009-2023, Josef Perktold, Skipper Seabold, Jonathan Taylor, statsmodels-developers.
        
    </div>
  
    Created using
    <a href="https://www.sphinx-doc.org/" target="_blank" rel="noopener">Sphinx</a>
    7.3.7.
     and
    <a href="https://github.com/jbms/sphinx-immaterial/" target="_blank" rel="noopener">Sphinx-Immaterial</a>
  
</div>
      
        <div class="md-social">
  
    
    
    <a href="https://github.com/statsmodels/statsmodels/" target="_blank" rel="noopener" title="Source on github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://pypi.org/project/statsmodels/" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://doi.org/10.5281/zenodo.593847" target="_blank" rel="noopener" title="doi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M0 216C0 149.7 53.7 96 120 96h8c17.7 0 32 14.3 32 32s-14.3 32-32 32h-8c-30.9 0-56 25.1-56 56v8h64c35.3 0 64 28.7 64 64v64c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V216zm256 0c0-66.3 53.7-120 120-120h8c17.7 0 32 14.3 32 32s-14.3 32-32 32h-8c-30.9 0-56 25.1-56 56v8h64c35.3 0 64 28.7 64 64v64c0 35.3-28.7 64-64 64h-64c-35.3 0-64-28.7-64-64V216z"/></svg>
    </a>
  
</div>
      
    </div>
    
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike", "staticVersions": null, "versionPath": "../versions-v3.json"}}</script>
    
      
        <script src="../../../_static/sphinx_immaterial_theme.f9d9eeeb247ace16c.min.js?v=8ec58cb5"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
  </body>
</html>