


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../../_static/favicon.ico">
    
    
  
      
        <title>statsmodels.sandbox.stats.multicomp - statsmodels 0.15.0 (+617)</title>
      
    
  <link rel="icon" type="image/png" sizes="32x32" href="../../../../_static/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../../../../_static/icons/favicon-16x16.png">
  <link rel="manifest" href="../../../../_static/icons/site.webmanifest">
  <link rel="mask-icon" href="../../../../_static/icons/safari-pinned-tab.svg" color="#919191">
  <meta name="msapplication-TileColor" content="#2b5797">
  <meta name="msapplication-config" content="../../../../_static/icons/browserconfig.xml">
  <link rel="stylesheet" href="../../../../_static/stylesheets/examples.css">
  <link rel="stylesheet" href="../../../../_static/stylesheets/deprecation.css">
    
      
        
        
          
          
          <meta name="theme-color" content="#4051b5">
        
      
      

    
    
    
      
        
        
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
        <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx_immaterial_theme.02cb18745d09eea51.min.css?v=ff456132" />
        <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css?v=fd3f3429" />
        <link rel="stylesheet" type="text/css" href="../../../../_static/plot_directive.css" />
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../index.html" title="statsmodels 0.15.0 (+617)" class="md-header__button md-logo" aria-label="statsmodels 0.15.0 (+617)" data-md-component="logo">
      <img src="../../../../_static/statsmodels-logo-v2-bw.svg" alt="logo">
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            statsmodels 0.15.0 (+617)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              statsmodels.sandbox.stats.multicomp
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/statsmodels/statsmodels/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    statsmodels
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../index.html" title="statsmodels 0.15.0 (+617)" class="md-nav__button md-logo" aria-label="statsmodels 0.15.0 (+617)" data-md-component="logo">
      <img src="../../../../_static/statsmodels-logo-v2-bw.svg" alt="logo">
    </a>
    statsmodels 0.15.0 (+617)
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/statsmodels/statsmodels/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    statsmodels
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../install.html" class="md-nav__link">
        <span title="/install.rst (reference label)" class="md-ellipsis">Installing statsmodels</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../gettingstarted.html" class="md-nav__link">
        <span title="/gettingstarted.rst (reference label)" class="md-ellipsis">Getting started</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user-guide.html" class="md-nav__link">
        <span title="/user-guide.rst (reference label)" class="md-ellipsis">User Guide</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/index.html" class="md-nav__link">
        <span title="/examples/index.rst (reference label)" class="md-ellipsis">Examples</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../api.html" class="md-nav__link">
        <span title="/api.rst (reference label)" class="md-ellipsis">API Reference</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../about.html" class="md-nav__link">
        <span title="/about.rst (reference label)" class="md-ellipsis">About statsmodels</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev/index.html" class="md-nav__link">
        <span title="/dev/index.rst (reference label)" class="md-ellipsis">Developer Page</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../release/index.html" class="md-nav__link">
        <span title="/release/index.rst (reference label)" class="md-ellipsis">Release Notes</span>
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary">
  
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset" role="main">
                  


<h1>Source code for statsmodels.sandbox.stats.multicomp</h1><div class="highlight"><pre>
<span></span><code><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">from pystatsmodels mailinglist 20100524</span>

<span class="sd">Notes:</span>
<span class="sd"> - unfinished, unverified, but most parts seem to work in MonteCarlo</span>
<span class="sd"> - one example taken from lecture notes looks ok</span>
<span class="sd"> - needs cases with non-monotonic inequality for test to see difference between</span>
<span class="sd">   one-step, step-up and step-down procedures</span>
<span class="sd"> - FDR does not look really better then Bonferoni in the MC examples that I tried</span>
<span class="sd">update:</span>
<span class="sd"> - now tested against R, stats and multtest,</span>
<span class="sd">   I have all of their methods for p-value correction</span>
<span class="sd"> - getting Hommel was impossible until I found reference for pvalue correction</span>
<span class="sd"> - now, since I have p-values correction, some of the original tests (rej/norej)</span>
<span class="sd">   implementation is not really needed anymore. I think I keep it for reference.</span>
<span class="sd">   Test procedure for Hommel in development session log</span>
<span class="sd"> - I have not updated other functions and classes in here.</span>
<span class="sd">   - multtest has some good helper function according to docs</span>
<span class="sd"> - still need to update references, the real papers</span>
<span class="sd"> - fdr with estimated true hypothesis still missing</span>
<span class="sd"> - multiple comparison procedures incomplete or missing</span>
<span class="sd"> - I will get multiple comparison for now only for independent case, which might</span>
<span class="sd">   be conservative in correlated case (?).</span>


<span class="sd">some References:</span>

<span class="sd">Gibbons, Jean Dickinson and Chakraborti Subhabrata, 2003, Nonparametric Statistical</span>
<span class="sd">Inference, Fourth Edition, Marcel Dekker</span>
<span class="sd">    p.363: 10.4 THE KRUSKAL-WALLIS ONE-WAY ANOVA TEST AND MULTIPLE COMPARISONS</span>
<span class="sd">    p.367: multiple comparison for kruskal formula used in multicomp.kruskal</span>

<span class="sd">Sheskin, David J., 2004, Handbook of Parametric and Nonparametric Statistical</span>
<span class="sd">Procedures, 3rd ed., Chapman&amp;Hall/CRC</span>
<span class="sd">    Test 21: The Single-Factor Between-Subjects Analysis of Variance</span>
<span class="sd">    Test 22: The Kruskal-Wallis One-Way Analysis of Variance by Ranks Test</span>

<span class="sd">Zwillinger, Daniel and Stephen Kokoska, 2000, CRC standard probability and</span>
<span class="sd">statistics tables and formulae, Chapman&amp;Hall/CRC</span>
<span class="sd">    14.9 WILCOXON RANKSUM (MANN WHITNEY) TEST</span>


<span class="sd">S. Paul Wright, Adjusted P-Values for Simultaneous Inference, Biometrics</span>
<span class="sd">    Vol. 48, No. 4 (Dec., 1992), pp. 1005-1013, International Biometric Society</span>
<span class="sd">    Stable URL: http://www.jstor.org/stable/2532694</span>
<span class="sd"> (p-value correction for Hommel in appendix)</span>

<span class="sd">for multicomparison</span>

<span class="sd">new book &quot;multiple comparison in R&quot;</span>
<span class="sd">Hsu is a good reference but I do not have it.</span>


<span class="sd">Author: Josef Pktd and example from H Raja and rewrite from Vincent Davis</span>


<span class="sd">TODO</span>
<span class="sd">----</span>
<span class="sd">* name of function multipletests, rename to something like pvalue_correction?</span>


<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.compat.python</span><span class="w"> </span><span class="kn">import</span> <span class="n">lrange</span><span class="p">,</span> <span class="n">lzip</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numpy.testing</span><span class="w"> </span><span class="kn">import</span> <span class="n">assert_almost_equal</span><span class="p">,</span> <span class="n">assert_equal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">interpolate</span><span class="p">,</span> <span class="n">stats</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.graphics</span><span class="w"> </span><span class="kn">import</span> <span class="n">utils</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.iolib.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimpleTable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.tools.sm_exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">ValueWarning</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Studentized Range in SciPy 1.7+</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">studentized_range</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.libqsturng</span><span class="w"> </span><span class="kn">import</span> <span class="n">psturng</span><span class="p">,</span> <span class="n">qsturng</span>

    <span class="n">studentized_range_tuple</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;studentized_range&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ppf&quot;</span><span class="p">,</span> <span class="s2">&quot;sf&quot;</span><span class="p">])</span>
    <span class="n">studentized_range</span> <span class="o">=</span> <span class="n">studentized_range_tuple</span><span class="p">(</span><span class="n">ppf</span><span class="o">=</span><span class="n">qsturng</span><span class="p">,</span> <span class="n">sf</span><span class="o">=</span><span class="n">psturng</span><span class="p">)</span>


<span class="n">qcrit</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  2     3     4     5     6     7     8     9     10</span>
<span class="s2">5   3.64 5.70   4.60 6.98   5.22 7.80   5.67 8.42   6.03 8.91   6.33 9.32   6.58 9.67   6.80 9.97   6.99 10.24</span>
<span class="s2">6   3.46 5.24   4.34 6.33   4.90 7.03   5.30 7.56   5.63 7.97   5.90 8.32   6.12 8.61   6.32 8.87   6.49 9.10</span>
<span class="s2">7   3.34 4.95   4.16 5.92   4.68 6.54   5.06 7.01   5.36 7.37   5.61 7.68   5.82 7.94   6.00 8.17   6.16 8.37</span>
<span class="s2">8   3.26 4.75   4.04 5.64   4.53 6.20   4.89 6.62   5.17 6.96   5.40 7.24       5.60 7.47   5.77 7.68   5.92 7.86</span>
<span class="s2">9   3.20 4.60   3.95 5.43   4.41 5.96   4.76 6.35   5.02 6.66   5.24 6.91       5.43 7.13   5.59 7.33   5.74 7.49</span>
<span class="s2">10  3.15 4.48   3.88 5.27   4.33 5.77   4.65 6.14   4.91 6.43   5.12 6.67       5.30 6.87   5.46 7.05   5.60 7.21</span>
<span class="s2">11  3.11 4.39   3.82 5.15   4.26 5.62   4.57 5.97   4.82 6.25   5.03 6.48 5.20 6.67   5.35 6.84   5.49 6.99</span>
<span class="s2">12  3.08 4.32   3.77 5.05   4.20 5.50   4.51 5.84   4.75 6.10   4.95 6.32 5.12 6.51   5.27 6.67   5.39 6.81</span>
<span class="s2">13  3.06 4.26   3.73 4.96   4.15 5.40   4.45 5.73   4.69 5.98   4.88 6.19 5.05 6.37   5.19 6.53   5.32 6.67</span>
<span class="s2">14  3.03 4.21   3.70 4.89   4.11 5.32   4.41 5.63   4.64 5.88   4.83 6.08 4.99 6.26   5.13 6.41   5.25 6.54</span>
<span class="s2">15  3.01 4.17   3.67 4.84   4.08 5.25   4.37 5.56   4.59 5.80   4.78 5.99 4.94 6.16   5.08 6.31   5.20 6.44</span>
<span class="s2">16  3.00 4.13   3.65 4.79   4.05 5.19   4.33 5.49   4.56 5.72   4.74 5.92 4.90 6.08   5.03 6.22   5.15 6.35</span>
<span class="s2">17  2.98 4.10   3.63 4.74   4.02 5.14   4.30 5.43   4.52 5.66   4.70 5.85 4.86 6.01   4.99 6.15   5.11 6.27</span>
<span class="s2">18  2.97 4.07   3.61 4.70   4.00 5.09   4.28 5.38   4.49 5.60   4.67 5.79 4.82 5.94   4.96 6.08   5.07 6.20</span>
<span class="s2">19  2.96 4.05   3.59 4.67   3.98 5.05   4.25 5.33   4.47 5.55   4.65 5.73 4.79 5.89   4.92 6.02   5.04 6.14</span>
<span class="s2">20  2.95 4.02   3.58 4.64   3.96 5.02   4.23 5.29   4.45 5.51   4.62 5.69 4.77 5.84   4.90 5.97   5.01 6.09</span>
<span class="s2">24  2.92 3.96   3.53 4.55   3.90 4.91   4.17 5.17   4.37 5.37   4.54 5.54 4.68 5.69   4.81 5.81   4.92 5.92</span>
<span class="s2">30  2.89 3.89   3.49 4.45   3.85 4.80   4.10 5.05   4.30 5.24   4.46 5.40 4.60 5.54   4.72 5.65   4.82 5.76</span>
<span class="s2">40  2.86 3.82   3.44 4.37   3.79 4.70   4.04 4.93   4.23 5.11   4.39 5.26 4.52 5.39   4.63 5.50   4.73 5.60</span>
<span class="s2">60  2.83 3.76   3.40 4.28   3.74 4.59   3.98 4.82   4.16 4.99   4.31 5.13 4.44 5.25   4.55 5.36   4.65 5.45</span>
<span class="s2">120   2.80 3.70   3.36 4.20   3.68 4.50   3.92 4.71   4.10 4.87   4.24 5.01 4.36 5.12   4.47 5.21   4.56 5.30</span>
<span class="s2">infinity  2.77 3.64   3.31 4.12   3.63 4.40   3.86 4.60   4.03 4.76   4.17 4.88   4.29 4.99   4.39 5.08   4.47 5.16</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">qcrit</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;infinity&quot;</span><span class="p">,</span> <span class="s2">&quot;9999&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)]</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="c1"># c[c==9999] = np.inf</span>
<span class="n">ccols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
<span class="n">crows</span> <span class="o">=</span> <span class="n">c</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">cv005</span> <span class="o">=</span> <span class="n">c</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
<span class="n">cv001</span> <span class="o">=</span> <span class="n">c</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>


<div class="viewcode-block" id="get_tukeyQcrit">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.get_tukeyQcrit.html#statsmodels.sandbox.stats.multicomp.get_tukeyQcrit">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_tukeyQcrit</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    return critical values for Tukey&#39;s HSD (Q)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    k : int in {2, ..., 10}</span>
<span class="sd">        number of tests</span>
<span class="sd">    df : int</span>
<span class="sd">        degrees of freedom of error term</span>
<span class="sd">    alpha : {0.05, 0.01}</span>
<span class="sd">        type 1 error, 1-confidence level</span>



<span class="sd">    not enough error checking for limitations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">alpha</span> <span class="o">==</span> <span class="mf">0.05</span><span class="p">:</span>
        <span class="n">intp</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">crows</span><span class="p">,</span> <span class="n">cv005</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">alpha</span> <span class="o">==</span> <span class="mf">0.01</span><span class="p">:</span>
        <span class="n">intp</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">crows</span><span class="p">,</span> <span class="n">cv001</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;only implemented for alpha equal to 0.01 and 0.05&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">intp</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">get_tukeyQcrit2</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    return critical values for Tukey&#39;s HSD (Q)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    k : int in {2, ..., 10}</span>
<span class="sd">        number of tests</span>
<span class="sd">    df : int</span>
<span class="sd">        degrees of freedom of error term</span>
<span class="sd">    alpha : {0.05, 0.01}</span>
<span class="sd">        type 1 error, 1-confidence level</span>



<span class="sd">    not enough error checking for limitations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">studentized_range</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_tukey_pvalue</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    return adjusted p-values for Tukey&#39;s HSD</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    k : int in {2, ..., 10}</span>
<span class="sd">        number of tests</span>
<span class="sd">    df : int</span>
<span class="sd">        degrees of freedom of error term</span>
<span class="sd">    q : scalar, array_like; q &gt;= 0</span>
<span class="sd">        quantile value of Studentized Range</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">studentized_range</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">Tukeythreegene</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">third</span><span class="p">):</span>
    <span class="c1"># Performing the Tukey HSD post-hoc test for three genes</span>
    <span class="c1"># qwb = xlrd.open_workbook(&#39;F:/Lab/bioinformatics/qcrittable.xls&#39;)</span>
    <span class="c1"># #opening the workbook containing the q crit table</span>
    <span class="c1"># qwb.sheet_names()</span>
    <span class="c1"># qcrittable = qwb.sheet_by_name(u&#39;Sheet1&#39;)</span>

    <span class="c1"># means of the three arrays</span>
    <span class="n">firstmean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">first</span><span class="p">)</span>
    <span class="n">secondmean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">second</span><span class="p">)</span>
    <span class="n">thirdmean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">third</span><span class="p">)</span>

    <span class="c1"># standard deviations of the threearrays</span>
    <span class="n">firststd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">first</span><span class="p">)</span>
    <span class="n">secondstd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">second</span><span class="p">)</span>
    <span class="n">thirdstd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">third</span><span class="p">)</span>

    <span class="c1"># standard deviation squared of the three arrays</span>
    <span class="n">firsts2</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">firststd</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">seconds2</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">secondstd</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">thirds2</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">thirdstd</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># numerator for mean square error</span>
    <span class="n">mserrornum</span> <span class="o">=</span> <span class="n">firsts2</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">seconds2</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">thirds2</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="c1"># denominator for mean square error</span>
    <span class="n">mserrorden</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">first</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">second</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">third</span><span class="p">))</span> <span class="o">-</span> <span class="mi">3</span>
    <span class="n">mserror</span> <span class="o">=</span> <span class="n">mserrornum</span> <span class="o">/</span> <span class="n">mserrorden</span>  <span class="c1"># mean square error</span>

    <span class="n">standarderror</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mserror</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">first</span><span class="p">))</span>
    <span class="c1"># standard error, which is square root of mserror and</span>
    <span class="c1"># the number of samples in a group</span>

    <span class="c1"># various degrees of freedom</span>
    <span class="n">dftotal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">first</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">second</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">third</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">dfgroups</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">dferror</span> <span class="o">=</span> <span class="n">dftotal</span> <span class="o">-</span> <span class="n">dfgroups</span>  <span class="c1"># noqa: F841</span>

    <span class="n">qcrit</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># fix arbitrary#qcrittable.cell(dftotal, 3).value</span>
    <span class="n">qcrit</span> <span class="o">=</span> <span class="n">get_tukeyQcrit</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dftotal</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="c1"># getting the q critical value, for degrees of freedom total and 3 groups</span>

    <span class="n">qtest3to1</span> <span class="o">=</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">thirdmean</span> <span class="o">-</span> <span class="n">firstmean</span><span class="p">))</span> <span class="o">/</span> <span class="n">standarderror</span>
    <span class="c1"># calculating q test statistic values</span>
    <span class="n">qtest3to2</span> <span class="o">=</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">thirdmean</span> <span class="o">-</span> <span class="n">secondmean</span><span class="p">))</span> <span class="o">/</span> <span class="n">standarderror</span>
    <span class="n">qtest2to1</span> <span class="o">=</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">secondmean</span> <span class="o">-</span> <span class="n">firstmean</span><span class="p">))</span> <span class="o">/</span> <span class="n">standarderror</span>

    <span class="n">conclusion</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># print(qcrit</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">qtest3to1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">qtest3to2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">qtest2to1</span><span class="p">)</span>

    <span class="c1"># testing all q test statistic values to q critical values</span>
    <span class="k">if</span> <span class="n">qtest3to1</span> <span class="o">&gt;</span> <span class="n">qcrit</span><span class="p">:</span>
        <span class="n">conclusion</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;3to1null&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">conclusion</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;3to1alt&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">qtest3to2</span> <span class="o">&gt;</span> <span class="n">qcrit</span><span class="p">:</span>
        <span class="n">conclusion</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;3to2null&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">conclusion</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;3to2alt&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">qtest2to1</span> <span class="o">&gt;</span> <span class="n">qcrit</span><span class="p">:</span>
        <span class="n">conclusion</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;2to1null&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">conclusion</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;2to1alt&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">conclusion</span>


<span class="c1"># rewrite by Vincent</span>
<span class="k">def</span><span class="w"> </span><span class="nf">Tukeythreegene2</span><span class="p">(</span><span class="n">genes</span><span class="p">):</span>  <span class="c1"># Performing the Tukey HSD post-hoc test for three genes</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;gend is a list, ie [first, second, third]&quot;&quot;&quot;</span>
    <span class="c1">#   qwb = xlrd.open_workbook(&#39;F:/Lab/bioinformatics/qcrittable.xls&#39;)</span>
    <span class="c1"># opening the workbook containing the q crit table</span>
    <span class="c1">#   qwb.sheet_names()</span>
    <span class="c1">#   qcrittable = qwb.sheet_by_name(u&#39;Sheet1&#39;)</span>

    <span class="n">means</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">stds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">gene</span> <span class="ow">in</span> <span class="n">genes</span><span class="p">:</span>
        <span class="n">means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">gene</span><span class="p">))</span>
        <span class="n">std</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">gene</span><span class="p">))</span>  <span class="c1"># noqa:F821  See GH#5756</span>

    <span class="c1"># firstmean = np.mean(first) #means of the three arrays</span>
    <span class="c1"># secondmean = np.mean(second)</span>
    <span class="c1"># thirdmean = np.mean(third)</span>

    <span class="c1"># firststd = np.std(first) #standard deviations of the three arrays</span>
    <span class="c1"># secondstd = np.std(second)</span>
    <span class="c1"># thirdstd = np.std(third)</span>

    <span class="n">stds2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">std</span> <span class="ow">in</span> <span class="n">stds</span><span class="p">:</span>
        <span class="n">stds2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="c1"># firsts2 = math.pow(firststd,2) #standard deviation squared of the three arrays</span>
    <span class="c1"># seconds2 = math.pow(secondstd,2)</span>
    <span class="c1"># thirds2 = math.pow(thirdstd,2)</span>

    <span class="c1"># Unused result, comented out</span>
    <span class="c1"># mserrornum = firsts2*2+seconds2*2+thirds2*2 #numerator for mean square error</span>
    <span class="c1"># mserrornum = sum(stds2)*2</span>
    <span class="c1"># mserrorden = (len(genes[0])+len(genes[1])+len(genes[2]))-3 #denominator for mean square error</span>
    <span class="c1"># mserrornum/mserrorden #mean square error</span>


<div class="viewcode-block" id="catstack">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.catstack.html#statsmodels.sandbox.stats.multicomp.catstack">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">catstack</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">k</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">args</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">labels</span></div>



<div class="viewcode-block" id="maxzero">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.maxzero.html#statsmodels.sandbox.stats.multicomp.maxzero">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">maxzero</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;find all up zero crossings and return the index of the highest</span>

<span class="sd">    Not used anymore</span>


<span class="sd">    &gt;&gt;&gt; np.random.seed(12345)</span>
<span class="sd">    &gt;&gt;&gt; x = np.random.randn(8)</span>
<span class="sd">    &gt;&gt;&gt; x</span>
<span class="sd">    array([-0.20470766,  0.47894334, -0.51943872, -0.5557303 ,  1.96578057,</span>
<span class="sd">            1.39340583,  0.09290788,  0.28174615])</span>
<span class="sd">    &gt;&gt;&gt; maxzero(x)</span>
<span class="sd">    (4, array([1, 4]))</span>


<span class="sd">    no up-zero-crossing at end</span>

<span class="sd">    &gt;&gt;&gt; np.random.seed(0)</span>
<span class="sd">    &gt;&gt;&gt; x = np.random.randn(8)</span>
<span class="sd">    &gt;&gt;&gt; x</span>
<span class="sd">    array([ 1.76405235,  0.40015721,  0.97873798,  2.2408932 ,  1.86755799,</span>
<span class="sd">           -0.97727788,  0.95008842, -0.15135721])</span>
<span class="sd">    &gt;&gt;&gt; maxzero(x)</span>
<span class="sd">    (None, array([6]))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">cond1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span>
    <span class="n">cond2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="c1"># allzeros = np.nonzero(np.sign(x[:-1])*np.sign(x[1:]) &lt;= 0)[0] + 1</span>
    <span class="n">allzeros</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">cond1</span> <span class="o">&amp;</span> <span class="n">cond2</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">maxz</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">allzeros</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">maxz</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">maxz</span><span class="p">,</span> <span class="n">allzeros</span></div>



<div class="viewcode-block" id="maxzerodown">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.maxzerodown.html#statsmodels.sandbox.stats.multicomp.maxzerodown">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">maxzerodown</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;find all up zero crossings and return the index of the highest</span>

<span class="sd">    Not used anymore</span>

<span class="sd">    &gt;&gt;&gt; np.random.seed(12345)</span>
<span class="sd">    &gt;&gt;&gt; x = np.random.randn(8)</span>
<span class="sd">    &gt;&gt;&gt; x</span>
<span class="sd">    array([-0.20470766,  0.47894334, -0.51943872, -0.5557303 ,  1.96578057,</span>
<span class="sd">            1.39340583,  0.09290788,  0.28174615])</span>
<span class="sd">    &gt;&gt;&gt; maxzero(x)</span>
<span class="sd">    (4, array([1, 4]))</span>


<span class="sd">    no up-zero-crossing at end</span>

<span class="sd">    &gt;&gt;&gt; np.random.seed(0)</span>
<span class="sd">    &gt;&gt;&gt; x = np.random.randn(8)</span>
<span class="sd">    &gt;&gt;&gt; x</span>
<span class="sd">    array([ 1.76405235,  0.40015721,  0.97873798,  2.2408932 ,  1.86755799,</span>
<span class="sd">           -0.97727788,  0.95008842, -0.15135721])</span>
<span class="sd">    &gt;&gt;&gt; maxzero(x)</span>
<span class="sd">    (None, array([6]))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">cond1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="n">cond2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">&lt;</span> <span class="mi">0</span>
    <span class="c1"># allzeros = np.nonzero(np.sign(x[:-1])*np.sign(x[1:]) &lt;= 0)[0] + 1</span>
    <span class="n">allzeros</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">cond1</span> <span class="o">&amp;</span> <span class="n">cond2</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">maxz</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">allzeros</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">maxz</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">maxz</span><span class="p">,</span> <span class="n">allzeros</span></div>



<div class="viewcode-block" id="rejectionline">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.rejectionline.html#statsmodels.sandbox.stats.multicomp.rejectionline">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">rejectionline</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;reference line for rejection in multiple tests</span>

<span class="sd">    Not used anymore</span>

<span class="sd">    from: section 3.2, page 60</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">frej</span> <span class="o">=</span> <span class="n">t</span> <span class="o">/</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">+</span> <span class="n">alpha</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">frej</span></div>



<span class="c1"># I do not remember what I changed or why 2 versions,</span>
<span class="c1"># this follows german diss ???  with rline</span>
<span class="c1"># this might be useful if the null hypothesis is not &quot;all effects are zero&quot;</span>
<span class="c1"># rename to _bak and working again on fdrcorrection0</span>
<span class="k">def</span><span class="w"> </span><span class="nf">fdrcorrection_bak</span><span class="p">(</span><span class="n">pvals</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;indep&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reject False discovery rate correction for pvalues</span>

<span class="sd">    Old version, to be deleted</span>


<span class="sd">    missing: methods that estimate fraction of true hypotheses</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.multitest</span><span class="w"> </span><span class="kn">import</span> <span class="n">_ecdf</span> <span class="k">as</span> <span class="n">ecdf</span>

    <span class="n">pvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pvals</span><span class="p">)</span>

    <span class="n">pvals_sortind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">pvals</span><span class="p">)</span>
    <span class="n">pvals_sorted</span> <span class="o">=</span> <span class="n">pvals</span><span class="p">[</span><span class="n">pvals_sortind</span><span class="p">]</span>
    <span class="n">pecdf</span> <span class="o">=</span> <span class="n">ecdf</span><span class="p">(</span><span class="n">pvals_sorted</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;indep&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;poscorr&quot;</span><span class="p">]:</span>
        <span class="n">rline</span> <span class="o">=</span> <span class="n">pvals_sorted</span> <span class="o">/</span> <span class="n">alpha</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;negcorr&quot;</span><span class="p">]:</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pvals</span><span class="p">)))</span>
        <span class="n">rline</span> <span class="o">=</span> <span class="n">pvals_sorted</span> <span class="o">/</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">cm</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;onegcorr&quot;</span><span class="p">]:</span>  <span class="c1"># what&#39;s this ? german diss</span>
        <span class="n">rline</span> <span class="o">=</span> <span class="n">pvals_sorted</span> <span class="o">/</span> <span class="p">(</span><span class="n">pvals_sorted</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">+</span> <span class="n">alpha</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;oth&quot;</span><span class="p">,</span> <span class="s2">&quot;o2negcorr&quot;</span><span class="p">]:</span>  <span class="c1"># other invalid, cut-paste</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pvals</span><span class="p">)))</span>
        <span class="n">rline</span> <span class="o">=</span> <span class="n">pvals_sorted</span> <span class="o">/</span> <span class="n">alpha</span> <span class="o">/</span> <span class="n">cm</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;method not available&quot;</span><span class="p">)</span>

    <span class="n">reject</span> <span class="o">=</span> <span class="n">pecdf</span> <span class="o">&gt;=</span> <span class="n">rline</span>
    <span class="k">if</span> <span class="n">reject</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">rejectmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">reject</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rejectmax</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">reject</span><span class="p">[:</span><span class="n">rejectmax</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">reject</span><span class="p">[</span><span class="n">pvals_sortind</span><span class="o">.</span><span class="n">argsort</span><span class="p">()]</span>


<div class="viewcode-block" id="mcfdr">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.mcfdr.html#statsmodels.sandbox.stats.multicomp.mcfdr">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">mcfdr</span><span class="p">(</span><span class="n">nrepl</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">nobs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">ntests</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ntrue</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;MonteCarlo to test fdrcorrection&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.multitest</span><span class="w"> </span><span class="kn">import</span> <span class="n">fdrcorrection</span> <span class="k">as</span> <span class="n">fdrcorrection0</span>

    <span class="c1"># Unused result, commented out</span>
    <span class="c1"># ntests - ntrue</span>
    <span class="n">locs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ntrue</span> <span class="o">+</span> <span class="p">[</span><span class="n">mu</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">ntests</span> <span class="o">-</span> <span class="n">ntrue</span><span class="p">))</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrepl</span><span class="p">):</span>
        <span class="c1"># rvs = locs + stats.norm.rvs(size=(nobs, ntests))</span>
        <span class="n">rvs</span> <span class="o">=</span> <span class="n">locs</span> <span class="o">+</span> <span class="n">randmvn</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">nobs</span><span class="p">,</span> <span class="n">ntests</span><span class="p">))</span>
        <span class="n">tt</span><span class="p">,</span> <span class="n">tpval</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_1samp</span><span class="p">(</span><span class="n">rvs</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">fdrcorrection_bak</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">tpval</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;i&quot;</span><span class="p">)</span>
        <span class="n">res0</span> <span class="o">=</span> <span class="n">fdrcorrection0</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">tpval</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
        <span class="c1"># res and res0 give the same results</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">res</span><span class="p">[:</span><span class="n">ntrue</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">ntrue</span><span class="p">:])]</span>
            <span class="o">+</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">res0</span><span class="p">[:</span><span class="n">ntrue</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">res0</span><span class="p">[</span><span class="n">ntrue</span><span class="p">:])]</span>
            <span class="o">+</span> <span class="n">res</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">tpval</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="o">+</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">tpval</span><span class="p">[:</span><span class="n">ntrue</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">alpha</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">tpval</span><span class="p">[</span><span class="n">ntrue</span><span class="p">:]</span> <span class="o">&lt;</span> <span class="n">alpha</span><span class="p">)]</span>
            <span class="o">+</span> <span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">tpval</span><span class="p">[:</span><span class="n">ntrue</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">alpha</span> <span class="o">/</span> <span class="n">ntests</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">tpval</span><span class="p">[</span><span class="n">ntrue</span><span class="p">:]</span> <span class="o">&lt;</span> <span class="n">alpha</span> <span class="o">/</span> <span class="n">ntests</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results</span><span class="p">)</span></div>



<div class="viewcode-block" id="randmvn">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.randmvn.html#statsmodels.sandbox.stats.multicomp.randmvn">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">randmvn</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">standardize</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;create random draws from equi-correlated multivariate normal distribution</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rho : float</span>
<span class="sd">        correlation coefficient</span>
<span class="sd">    size : tuple of int</span>
<span class="sd">        size is interpreted (nobs, nvars) where each row</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rvs : ndarray</span>
<span class="sd">        nobs by nvars where each row is a independent random draw of nvars-</span>
<span class="sd">        dimensional correlated rvs</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nobs</span><span class="p">,</span> <span class="n">nvars</span> <span class="o">=</span> <span class="n">size</span>
    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">rho</span> <span class="ow">and</span> <span class="n">rho</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">rvs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nobs</span><span class="p">,</span> <span class="n">nvars</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">rvs2</span> <span class="o">=</span> <span class="n">rvs</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">rho</span><span class="p">)</span> <span class="o">+</span> <span class="n">rvs</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">rho</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">rvs2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nobs</span><span class="p">,</span> <span class="n">nvars</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">rho</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rho</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">nvars</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;rho has to be larger than -1./(nvars-1)&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">rho</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">nvars</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">rho</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">nvars</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>  <span class="c1"># barely positive definite</span>
        <span class="c1"># use Cholesky</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nvars</span><span class="p">,</span> <span class="n">nvars</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">rho</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nvars</span><span class="p">)</span>
        <span class="n">rvs2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nobs</span><span class="p">,</span> <span class="n">nvars</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cholesky</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">standardize</span><span class="p">:</span>
        <span class="n">rvs2</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">zscore</span><span class="p">(</span><span class="n">rvs2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rvs2</span></div>



<span class="c1"># ============================</span>
<span class="c1">#</span>
<span class="c1"># Part 2: Multiple comparisons and independent samples tests</span>
<span class="c1">#</span>
<span class="c1"># ============================</span>


<div class="viewcode-block" id="tiecorrect">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.tiecorrect.html#statsmodels.sandbox.stats.multicomp.tiecorrect">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">tiecorrect</span><span class="p">(</span><span class="n">xranks</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    should be equivalent of scipy.stats.tiecorrect</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># casting to int rounds down, but not relevant for this case</span>
    <span class="n">rankbincount</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xranks</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
    <span class="n">nties</span> <span class="o">=</span> <span class="n">rankbincount</span><span class="p">[</span><span class="n">rankbincount</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">ntot</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xranks</span><span class="p">))</span>
    <span class="n">tiecorrection</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">nties</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="n">nties</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="n">ntot</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="n">ntot</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tiecorrection</span></div>



<div class="viewcode-block" id="GroupsStats">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.GroupsStats.html#statsmodels.sandbox.stats.multicomp.GroupsStats">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">GroupsStats</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    statistics by groups (another version)</span>

<span class="sd">    groupstats as a class with lazy evaluation (not yet - decorators are still</span>
<span class="sd">    missing)</span>

<span class="sd">    written this time as equivalent of scipy.stats.rankdata</span>
<span class="sd">    gs = GroupsStats(X, useranks=True)</span>
<span class="sd">    assert_almost_equal(gs.groupmeanfilter, stats.rankdata(X[:,0]), 15)</span>

<span class="sd">    TODO: incomplete doc strings</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">useranks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">uni</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">intlab</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;descriptive statistics by groups</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : ndarray, 2d</span>
<span class="sd">            first column data, second column group labels</span>
<span class="sd">        useranks : bool</span>
<span class="sd">            if true, then use ranks as data corresponding to the</span>
<span class="sd">            scipy.stats.rankdata definition (start at 1, ties get mean)</span>
<span class="sd">        uni, intlab : arrays (optional)</span>
<span class="sd">            to avoid call to unique, these can be given as inputs</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">intlab</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">uni</span><span class="p">,</span> <span class="n">intlab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">uni</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">uni</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">useranks</span> <span class="o">=</span> <span class="n">useranks</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">uni</span> <span class="o">=</span> <span class="n">uni</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intlab</span> <span class="o">=</span> <span class="n">intlab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupnobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">intlab</span><span class="p">)</span>

        <span class="c1"># temporary until separated and made all lazy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runbasic</span><span class="p">(</span><span class="n">useranks</span><span class="o">=</span><span class="n">useranks</span><span class="p">)</span>

<div class="viewcode-block" id="GroupsStats.runbasic_old">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.GroupsStats.runbasic_old.html#statsmodels.sandbox.stats.multicomp.GroupsStats.runbasic_old">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">runbasic_old</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">useranks</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;runbasic_old&quot;&quot;&quot;</span>
        <span class="c1"># check: refactoring screwed up case useranks=True</span>

        <span class="c1"># groupxsum = np.bincount(intlab, weights=X[:,0])</span>
        <span class="c1"># groupxmean = groupxsum * 1.0 / groupnobs</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="k">if</span> <span class="n">useranks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># rankraw</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupsum</span> <span class="o">=</span> <span class="n">groupranksum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intlab</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xx</span><span class="p">)</span>
        <span class="c1"># print(&#39;groupranksum&#39;, groupranksum, groupranksum.shape, self.groupnobs.shape</span>
        <span class="c1"># start at 1 for stats.rankdata :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupmean</span> <span class="o">=</span> <span class="n">grouprankmean</span> <span class="o">=</span> <span class="n">groupranksum</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupnobs</span>  <span class="c1"># + 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupmeanfilter</span> <span class="o">=</span> <span class="n">grouprankmean</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">intlab</span><span class="p">]</span></div>

        <span class="c1"># return grouprankmean[intlab]</span>

<div class="viewcode-block" id="GroupsStats.runbasic">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.GroupsStats.runbasic.html#statsmodels.sandbox.stats.multicomp.GroupsStats.runbasic">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">runbasic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">useranks</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;runbasic&quot;&quot;&quot;</span>
        <span class="c1"># check: refactoring screwed up case useranks=True</span>

        <span class="c1"># groupxsum = np.bincount(intlab, weights=X[:,0])</span>
        <span class="c1"># groupxmean = groupxsum * 1.0 / groupnobs</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="k">if</span> <span class="n">useranks</span><span class="p">:</span>
            <span class="n">xuni</span><span class="p">,</span> <span class="n">xintlab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ranksraw</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># rankraw</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xx</span> <span class="o">=</span> <span class="n">GroupsStats</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">ranksraw</span><span class="p">,</span> <span class="n">xintlab</span><span class="p">]),</span> <span class="n">useranks</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span><span class="o">.</span><span class="n">groupmeanfilter</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupsum</span> <span class="o">=</span> <span class="n">groupranksum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intlab</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xx</span><span class="p">)</span>
        <span class="c1"># print(&#39;groupranksum&#39;, groupranksum, groupranksum.shape, self.groupnobs.shape</span>
        <span class="c1"># start at 1 for stats.rankdata :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupmean</span> <span class="o">=</span> <span class="n">grouprankmean</span> <span class="o">=</span> <span class="n">groupranksum</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupnobs</span>  <span class="c1"># + 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupmeanfilter</span> <span class="o">=</span> <span class="n">grouprankmean</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">intlab</span><span class="p">]</span></div>

        <span class="c1"># return grouprankmean[intlab]</span>

<div class="viewcode-block" id="GroupsStats.groupdemean">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.GroupsStats.groupdemean.html#statsmodels.sandbox.stats.multicomp.GroupsStats.groupdemean">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">groupdemean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;groupdemean&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">xx</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupmeanfilter</span></div>


<div class="viewcode-block" id="GroupsStats.groupsswithin">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.GroupsStats.groupsswithin.html#statsmodels.sandbox.stats.multicomp.GroupsStats.groupsswithin">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">groupsswithin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;groupsswithin&quot;&quot;&quot;</span>
        <span class="n">xtmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupdemean</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intlab</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">xtmp</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="GroupsStats.groupvarwithin">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.GroupsStats.groupvarwithin.html#statsmodels.sandbox.stats.multicomp.GroupsStats.groupvarwithin">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">groupvarwithin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;groupvarwithin&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupsswithin</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groupnobs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># .sum()</span></div>
</div>



<div class="viewcode-block" id="TukeyHSDResults">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.TukeyHSDResults.html#statsmodels.sandbox.stats.multicomp.TukeyHSDResults">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TukeyHSDResults</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Results from Tukey HSD test, with additional plot methods</span>

<span class="sd">    Can also compute and plot additional post-hoc evaluations using this</span>
<span class="sd">    results class.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    reject : array of boolean, True if we reject Null for group pair</span>
<span class="sd">    meandiffs : pairwise mean differences</span>
<span class="sd">    confint : confidence interval for pairwise mean differences</span>
<span class="sd">    std_pairs : standard deviation of pairwise mean differences</span>
<span class="sd">    q_crit : critical value of studentized range statistic at given alpha</span>
<span class="sd">    halfwidths : half widths of simultaneous confidence interval</span>
<span class="sd">    pvalues : adjusted p-values from the HSD test</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    halfwidths is only available after call to `plot_simultaneous`.</span>

<span class="sd">    Other attributes contain information about the data from the</span>
<span class="sd">    MultiComparison instance: data, df_total, groups, groupsunique, variance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mc_object</span><span class="p">,</span>
        <span class="n">results_table</span><span class="p">,</span>
        <span class="n">q_crit</span><span class="p">,</span>
        <span class="n">reject</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">meandiffs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">std_pairs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">confint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">df_total</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">reject2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">variance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pvalues</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">group_t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">group_c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_multicomp</span> <span class="o">=</span> <span class="n">mc_object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_results_table</span> <span class="o">=</span> <span class="n">results_table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q_crit</span> <span class="o">=</span> <span class="n">q_crit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reject</span> <span class="o">=</span> <span class="n">reject</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meandiffs</span> <span class="o">=</span> <span class="n">meandiffs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">std_pairs</span> <span class="o">=</span> <span class="n">std_pairs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">confint</span> <span class="o">=</span> <span class="n">confint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_total</span> <span class="o">=</span> <span class="n">df_total</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reject2</span> <span class="o">=</span> <span class="n">reject2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">=</span> <span class="n">variance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pvalues</span> <span class="o">=</span> <span class="n">pvalues</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_t</span> <span class="o">=</span> <span class="n">group_t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_c</span> <span class="o">=</span> <span class="n">group_c</span>
        <span class="c1"># Taken out of _multicomp for ease of access for unknowledgeable users</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multicomp</span><span class="o">.</span><span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multicomp</span><span class="o">.</span><span class="n">groups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupsunique</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multicomp</span><span class="o">.</span><span class="n">groupsunique</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">df_total</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># or should it be np.isscalar</span>
            <span class="c1"># assume we have Games-Howell, unequal var case</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_qcrit_hsd</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_qcrit_hsd</span> <span class="o">=</span> <span class="n">q_crit</span>

        <span class="n">nobs_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multicomp</span><span class="o">.</span><span class="n">groupstats</span><span class="o">.</span><span class="n">groupnobs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_total_hsd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nobs_group</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results_table</span><span class="p">)</span>

<div class="viewcode-block" id="TukeyHSDResults.summary">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.TukeyHSDResults.summary.html#statsmodels.sandbox.stats.multicomp.TukeyHSDResults.summary">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Summary table that can be printed&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results_table</span></div>


<div class="viewcode-block" id="TukeyHSDResults.summary_frame">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.TukeyHSDResults.summary_frame.html#statsmodels.sandbox.stats.multicomp.TukeyHSDResults.summary_frame">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">summary_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Summary DataFrame</span>

<span class="sd">        The group columns are labeled as &quot;group_t&quot; and &quot;group_c&quot; with mean</span>
<span class="sd">        difference defined as treatment minus control.</span>
<span class="sd">        This should be less confusing than numeric labels group1 and group2.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pandas.DataFrame</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The number of columns will likely increase in a future version of</span>
<span class="sd">        statsmodels. Do not use numeric indices for the DataFrame in order</span>
<span class="sd">        to be robust to the addition of columns.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s2">&quot;group_t&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_t</span><span class="p">,</span>
            <span class="s2">&quot;group_c&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_c</span><span class="p">,</span>
            <span class="s2">&quot;meandiff&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">meandiffs</span><span class="p">,</span>
            <span class="s2">&quot;p-adj&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pvalues</span><span class="p">,</span>
            <span class="s2">&quot;lower&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">confint</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;upper&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">confint</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="s2">&quot;reject&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">reject</span><span class="p">,</span>
            <span class="p">})</span>
        <span class="k">return</span> <span class="n">frame</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_get_q_crit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsd</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">n_means</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groupsunique</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>
            <span class="n">use_attr</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">hsd</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_attr</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qcrit_hsd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">q_crit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qcrit_hsd</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># compute it</span>
                <span class="n">q_crit</span> <span class="o">=</span> <span class="n">get_tukeyQcrit2</span><span class="p">(</span><span class="n">n_means</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_total_hsd</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">use_attr</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_qcrit_hsd</span> <span class="o">=</span> <span class="n">q_crit</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;not yet&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">q_crit</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_simultaneous_ci</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute simultaneous confidence intervals for comparison of means.&quot;&quot;&quot;</span>

        <span class="n">q_crit_hsd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_q_crit</span><span class="p">(</span><span class="n">hsd</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">halfwidths</span> <span class="o">=</span> <span class="n">simultaneous_ci</span><span class="p">(</span>
            <span class="n">q_crit_hsd</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_multicomp</span><span class="o">.</span><span class="n">groupstats</span><span class="o">.</span><span class="n">groupnobs</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_multicomp</span><span class="o">.</span><span class="n">pairindices</span><span class="p">,</span>
        <span class="p">)</span>

<div class="viewcode-block" id="TukeyHSDResults.plot_simultaneous">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.TukeyHSDResults.plot_simultaneous.html#statsmodels.sandbox.stats.multicomp.TukeyHSDResults.plot_simultaneous">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_simultaneous</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">comparison_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot a universal confidence interval of each group mean</span>

<span class="sd">        Visualize significant differences in a plot with one confidence</span>
<span class="sd">        interval per group instead of all pairwise confidence intervals.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        comparison_name : str, optional</span>
<span class="sd">            if provided, plot_intervals will color code all groups that are</span>
<span class="sd">            significantly different from the comparison_name red, and will</span>
<span class="sd">            color code insignificant groups gray. Otherwise, all intervals will</span>
<span class="sd">            just be plotted in black.</span>
<span class="sd">        ax : matplotlib axis, optional</span>
<span class="sd">            An axis handle on which to attach the plot.</span>
<span class="sd">        figsize : tuple, optional</span>
<span class="sd">            tuple for the size of the figure generated</span>
<span class="sd">        xlabel : str, optional</span>
<span class="sd">            Name to be displayed on x axis</span>
<span class="sd">        ylabel : str, optional</span>
<span class="sd">            Name to be displayed on y axis</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Figure</span>
<span class="sd">            handle to figure object containing interval plots</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Multiple comparison tests are nice, but lack a good way to be</span>
<span class="sd">        visualized. If you have, say, 6 groups, showing a graph of the means</span>
<span class="sd">        between each group will require 15 confidence intervals.</span>
<span class="sd">        Instead, we can visualize inter-group differences with a single</span>
<span class="sd">        interval for each group mean. Hochberg et al. [1] first proposed this</span>
<span class="sd">        idea and used Tukey&#39;s Q critical value to compute the interval widths.</span>
<span class="sd">        Unlike plotting the differences in the means and their respective</span>
<span class="sd">        confidence intervals, any two pairs can be compared for significance</span>
<span class="sd">        by looking for overlap.</span>

<span class="sd">        The derivation in Hochberg and Tamhane is under the equal variance</span>
<span class="sd">        assumption. We use the same computation in the case of unequal</span>
<span class="sd">        variances, however, with replacement of the common pooled variance</span>
<span class="sd">        by the unequal estimates of the whithin group variances.</span>
<span class="sd">        This provides a plot that looks more informative and plausible in the</span>
<span class="sd">        case where there are large differences in variances. In the equal</span>
<span class="sd">        sample size and equal variance case, the confidence intervals computed</span>
<span class="sd">        by the two methods, equal and unequal variance, are very close to</span>
<span class="sd">        each other in larger samples.</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        .. [*] Hochberg, Y., and A. C. Tamhane. Multiple Comparison Procedures.</span>
<span class="sd">               Hoboken, NJ: John Wiley &amp; Sons, 1987.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from statsmodels.examples.try_tukey_hsd import cylinders, cyl_labels</span>
<span class="sd">        &gt;&gt;&gt; from statsmodels.stats.multicomp import MultiComparison</span>
<span class="sd">        &gt;&gt;&gt; cardata = MultiComparison(cylinders, cyl_labels)</span>
<span class="sd">        &gt;&gt;&gt; results = cardata.tukeyhsd()</span>
<span class="sd">        &gt;&gt;&gt; results.plot_simultaneous()</span>
<span class="sd">        &lt;matplotlib.figure.Figure at 0x...&gt;</span>

<span class="sd">        This example shows an example plot comparing significant differences</span>
<span class="sd">        in group means. Significant differences at the alpha=0.05 level can be</span>
<span class="sd">        identified by intervals that do not overlap (i.e. USA vs Japan,</span>
<span class="sd">        USA vs Germany).</span>

<span class="sd">        &gt;&gt;&gt; results.plot_simultaneous(comparison_name=&quot;USA&quot;)</span>
<span class="sd">        &lt;matplotlib.figure.Figure at 0x...&gt;</span>

<span class="sd">        Optionally provide one of the group names to color code the plot to</span>
<span class="sd">        highlight group means different from comparison_name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">create_mpl_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">figsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">figsize</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;halfwidths&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_simultaneous_ci</span><span class="p">()</span>
        <span class="n">means</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multicomp</span><span class="o">.</span><span class="n">groupstats</span><span class="o">.</span><span class="n">groupmean</span>

        <span class="n">sigidx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nsigidx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">minrange</span> <span class="o">=</span> <span class="p">[</span><span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">halfwidths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">))]</span>
        <span class="n">maxrange</span> <span class="o">=</span> <span class="p">[</span><span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">halfwidths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">))]</span>

        <span class="k">if</span> <span class="n">comparison_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
                <span class="n">means</span><span class="p">,</span>
                <span class="n">lrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">)),</span>
                <span class="n">xerr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">halfwidths</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                <span class="n">ecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">comparison_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupsunique</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;comparison_name not found in group names.&quot;</span><span class="p">)</span>
            <span class="n">midx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groupsunique</span> <span class="o">==</span> <span class="n">comparison_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">)):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupsunique</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">comparison_name</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">min</span><span class="p">(</span><span class="n">maxrange</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">maxrange</span><span class="p">[</span><span class="n">midx</span><span class="p">])</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="n">minrange</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">minrange</span><span class="p">[</span><span class="n">midx</span><span class="p">])</span>
                    <span class="o">&lt;</span> <span class="mi">0</span>
                <span class="p">):</span>
                    <span class="n">sigidx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nsigidx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="c1"># Plot the main comparison</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
                <span class="n">means</span><span class="p">[</span><span class="n">midx</span><span class="p">],</span>
                <span class="n">midx</span><span class="p">,</span>
                <span class="n">xerr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">halfwidths</span><span class="p">[</span><span class="n">midx</span><span class="p">],</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span>
                <span class="n">ecolor</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="p">[</span><span class="n">minrange</span><span class="p">[</span><span class="n">midx</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multicomp</span><span class="o">.</span><span class="n">ngroups</span><span class="p">],</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;0.7&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="p">[</span><span class="n">maxrange</span><span class="p">[</span><span class="n">midx</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multicomp</span><span class="o">.</span><span class="n">ngroups</span><span class="p">],</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;0.7&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Plot those that are significantly different</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sigidx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
                    <span class="n">means</span><span class="p">[</span><span class="n">sigidx</span><span class="p">],</span>
                    <span class="n">sigidx</span><span class="p">,</span>
                    <span class="n">xerr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">halfwidths</span><span class="p">[</span><span class="n">sigidx</span><span class="p">],</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span>
                    <span class="n">ecolor</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="c1"># Plot those that are not significantly different</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nsigidx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
                    <span class="n">means</span><span class="p">[</span><span class="n">nsigidx</span><span class="p">],</span>
                    <span class="n">nsigidx</span><span class="p">,</span>
                    <span class="n">xerr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">halfwidths</span><span class="p">[</span><span class="n">nsigidx</span><span class="p">],</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;0.5&quot;</span><span class="p">,</span>
                    <span class="n">ecolor</span><span class="o">=</span><span class="s2">&quot;0.5&quot;</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Multiple Comparisons Between All Pairs (Tukey)&quot;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">maxrange</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">minrange</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multicomp</span><span class="o">.</span><span class="n">ngroups</span><span class="p">])</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">minrange</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">maxrange</span><span class="p">)</span> <span class="o">+</span> <span class="n">r</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">])</span>
        <span class="n">ylbls</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupsunique</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">ylbls</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span> <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span> <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span></div>
</div>



<div class="viewcode-block" id="MultiComparison">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.MultiComparison.html#statsmodels.sandbox.stats.multicomp.MultiComparison">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MultiComparison</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests for multiple comparisons</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : ndarray</span>
<span class="sd">        independent data samples</span>
<span class="sd">    groups : ndarray</span>
<span class="sd">        group labels corresponding to each data point</span>
<span class="sd">    group_order : list[str], optional</span>
<span class="sd">        the desired order for the group mean results to be reported in. If</span>
<span class="sd">        not specified, results are reported in increasing order.</span>
<span class="sd">        If group_order does not contain all labels that are in groups, then</span>
<span class="sd">        only those observations are kept that have a label in group_order.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">group_order</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;data has </span><span class="si">%d</span><span class="s2"> elements and groups has </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>

        <span class="c1"># Allow for user-provided sorting of groups</span>
        <span class="k">if</span> <span class="n">group_order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groupsunique</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupintlab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># check if group_order has any names not in groups</span>
            <span class="k">for</span> <span class="n">grp</span> <span class="ow">in</span> <span class="n">group_order</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">grp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;group_order value &#39;</span><span class="si">%s</span><span class="s2">&#39; not found in groups&quot;</span> <span class="o">%</span> <span class="n">grp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groupsunique</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">group_order</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groupintlab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="nb">int</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groupintlab</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="o">-</span><span class="mi">999</span><span class="p">)</span>  <span class="c1"># instead of a nan</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupsunique</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">==</span> <span class="n">name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">groupintlab</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groupsunique</span> <span class="o">==</span> <span class="n">name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="c1"># raise ValueError(&#39;group_order does not contain all groups&#39;)</span>
                <span class="c1"># warn and keep only observations with label in group_order</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>

                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;group_order does not contain all groups:&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot; dropping observations&quot;</span><span class="p">,</span>
                    <span class="n">ValueWarning</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">mask_keep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupintlab</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">999</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">groupintlab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupintlab</span><span class="p">[</span><span class="n">mask_keep</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">mask_keep</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">mask_keep</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groupsunique</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;2 or more groups required for multiple comparisons&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">datali</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">==</span> <span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupsunique</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pairindices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu_indices</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groupsunique</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># tuple</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ngroups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groupsunique</span><span class="p">)</span>

<div class="viewcode-block" id="MultiComparison.getranks">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.MultiComparison.getranks.html#statsmodels.sandbox.stats.multicomp.MultiComparison.getranks">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">getranks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;convert data to rankdata and attach</span>


<span class="sd">        This creates rankdata as it is used for non-parametric tests, where</span>
<span class="sd">        in the case of ties the average rank is assigned.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># bug: the next should use self.groupintlab instead of self.groups</span>
        <span class="c1"># update: looks fixed</span>
        <span class="c1"># self.ranks = GroupsStats(np.column_stack([self.data, self.groups]),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ranks</span> <span class="o">=</span> <span class="n">GroupsStats</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupintlab</span><span class="p">]),</span> <span class="n">useranks</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rankdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranks</span><span class="o">.</span><span class="n">groupmeanfilter</span></div>


<div class="viewcode-block" id="MultiComparison.kruskal">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.MultiComparison.kruskal.html#statsmodels.sandbox.stats.multicomp.MultiComparison.kruskal">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">kruskal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pairs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">multimethod</span><span class="o">=</span><span class="s2">&quot;T&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        pairwise comparison for kruskal-wallis test</span>

<span class="sd">        This is just a reimplementation of scipy.stats.kruskal and does</span>
<span class="sd">        not yet use a multiple comparison correction.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getranks</span><span class="p">()</span>
        <span class="n">tot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nobs</span>
        <span class="n">meanranks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranks</span><span class="o">.</span><span class="n">groupmean</span>
        <span class="n">groupnobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranks</span><span class="o">.</span><span class="n">groupnobs</span>

        <span class="c1"># simultaneous/separate treatment of multiple tests</span>
        <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">tot</span> <span class="o">*</span> <span class="p">(</span><span class="n">tot</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">12.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">stats</span><span class="o">.</span><span class="n">tiecorrect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rankdata</span><span class="p">)</span>  <span class="c1"># (xranks)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MultiComparison.kruskal&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pairindices</span><span class="p">):</span>
            <span class="c1"># pdiff = np.abs(mrs[i] - mrs[j])</span>
            <span class="n">pdiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">meanranks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">meanranks</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="n">se</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                <span class="n">f</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">groupnobs</span><span class="p">[[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]])</span>
            <span class="p">)</span>  <span class="c1"># np.array([8,8]))) #Fixme groupnobs[[i,j]] ))</span>
            <span class="n">Q</span> <span class="o">=</span> <span class="n">pdiff</span> <span class="o">/</span> <span class="n">se</span>

            <span class="c1"># TODO : print(statments, fix</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">pdiff</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">pdiff</span> <span class="o">/</span> <span class="n">se</span><span class="p">,</span> <span class="n">pdiff</span> <span class="o">/</span> <span class="n">se</span> <span class="o">&gt;</span> <span class="mf">2.6310</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span></div>


<div class="viewcode-block" id="MultiComparison.allpairtest">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.MultiComparison.allpairtest.html#statsmodels.sandbox.stats.multicomp.MultiComparison.allpairtest">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">allpairtest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testfunc</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;bonf&quot;</span><span class="p">,</span> <span class="n">pvalidx</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;run a pairwise test on all pairs with multiple test correction</span>

<span class="sd">        The statistical test given in testfunc is calculated for all pairs</span>
<span class="sd">        and the p-values are adjusted by methods in multipletests. The p-value</span>
<span class="sd">        correction is generic and based only on the p-values, and does not</span>
<span class="sd">        take any special structure of the hypotheses into account.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        testfunc : function</span>
<span class="sd">            A test function for two (independent) samples. It is assumed that</span>
<span class="sd">            the return value on position pvalidx is the p-value.</span>
<span class="sd">        alpha : float</span>
<span class="sd">            familywise error rate</span>
<span class="sd">        method : str</span>
<span class="sd">            This specifies the method for the p-value correction. Any method</span>
<span class="sd">            of multipletests is possible.</span>
<span class="sd">        pvalidx : int (default: 1)</span>
<span class="sd">            position of the p-value in the return of testfunc</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sumtab : SimpleTable instance</span>
<span class="sd">            summary table for printing</span>

<span class="sd">        errors:  TODO: check if this is still wrong, I think it&#39;s fixed.</span>
<span class="sd">        results from multipletests are in different order</span>
<span class="sd">        pval_corrected can be larger than 1 ???</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.multitest</span><span class="w"> </span><span class="kn">import</span> <span class="n">multipletests</span>

        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pairindices</span><span class="p">):</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">testfunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datali</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">datali</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="n">reject</span><span class="p">,</span> <span class="n">pvals_corrected</span><span class="p">,</span> <span class="n">alphacSidak</span><span class="p">,</span> <span class="n">alphacBonf</span> <span class="o">=</span> <span class="n">multipletests</span><span class="p">(</span>
            <span class="n">res</span><span class="p">[:,</span> <span class="n">pvalidx</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span>
        <span class="p">)</span>
        <span class="c1"># print(np.column_stack([res[:,0],res[:,1], reject, pvals_corrected])</span>

        <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairindices</span>
        <span class="k">if</span> <span class="n">pvals_corrected</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">resarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="n">lzip</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">groupsunique</span><span class="p">[</span><span class="n">i1</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">groupsunique</span><span class="p">[</span><span class="n">i2</span><span class="p">],</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">res</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">res</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">),</span>
                    <span class="n">reject</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">dtype</span><span class="o">=</span><span class="p">[</span>
                    <span class="p">(</span><span class="s2">&quot;group1&quot;</span><span class="p">,</span> <span class="nb">object</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;group2&quot;</span><span class="p">,</span> <span class="nb">object</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;stat&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;pval&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;reject&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">),</span>
                <span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">resarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="n">lzip</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">groupsunique</span><span class="p">[</span><span class="n">i1</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">groupsunique</span><span class="p">[</span><span class="n">i2</span><span class="p">],</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">res</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">res</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">pvals_corrected</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
                    <span class="n">reject</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">dtype</span><span class="o">=</span><span class="p">[</span>
                    <span class="p">(</span><span class="s2">&quot;group1&quot;</span><span class="p">,</span> <span class="nb">object</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;group2&quot;</span><span class="p">,</span> <span class="nb">object</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;stat&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;pval&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;pval_corr&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;reject&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">),</span>
                <span class="p">],</span>
            <span class="p">)</span>
        <span class="n">results_table</span> <span class="o">=</span> <span class="n">SimpleTable</span><span class="p">(</span><span class="n">resarr</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">resarr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
        <span class="n">results_table</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Test Multiple Comparison </span><span class="si">%s</span><span class="s2"> </span><span class="se">\n</span><span class="si">%s%4.2f</span><span class="s2"> method=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">testfunc</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="s2">&quot;FWER=&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="p">,</span>
            <span class="n">method</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">alphacSidak=</span><span class="si">%4.2f</span><span class="s2">, alphacBonf=</span><span class="si">%5.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">alphacSidak</span><span class="p">,</span> <span class="n">alphacBonf</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">results_table</span><span class="p">,</span>
            <span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">reject</span><span class="p">,</span> <span class="n">pvals_corrected</span><span class="p">,</span> <span class="n">alphacSidak</span><span class="p">,</span> <span class="n">alphacBonf</span><span class="p">),</span>
            <span class="n">resarr</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="MultiComparison.tukeyhsd">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.MultiComparison.tukeyhsd.html#statsmodels.sandbox.stats.multicomp.MultiComparison.tukeyhsd">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">tukeyhsd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">use_var</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tukey&#39;s range test to compare means of all pairs of groups</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        alpha : float, optional</span>
<span class="sd">            Value of FWER at which to calculate HSD.</span>
<span class="sd">        use_var : {&quot;unequal&quot;, &quot;equal&quot;}</span>
<span class="sd">            If ``use_var`` is &quot;equal&quot;, then the Tukey-hsd pvalues are returned.</span>
<span class="sd">            Tukey-hsd assumes that (within) variances are the same across groups.</span>
<span class="sd">            If ``use_var`` is &quot;unequal&quot;, then the Games-Howell pvalues are</span>
<span class="sd">            returned. This uses Welch&#39;s t-test for unequal variances with</span>
<span class="sd">            Satterthwait&#39;s corrected degrees of freedom for each pairwise</span>
<span class="sd">            comparison.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        results : TukeyHSDResults instance</span>
<span class="sd">            A results class containing relevant data and some post-hoc</span>
<span class="sd">            calculations</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        .. versionadded:: 0.15</span>
<span class="sd">   `       The `use_var` keyword and option for Games-Howell test.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupstats</span> <span class="o">=</span> <span class="n">GroupsStats</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupintlab</span><span class="p">]),</span> <span class="n">useranks</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="n">gmeans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupstats</span><span class="o">.</span><span class="n">groupmean</span>
        <span class="n">gnobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupstats</span><span class="o">.</span><span class="n">groupnobs</span>
        <span class="k">if</span> <span class="n">use_var</span> <span class="o">==</span> <span class="s1">&#39;unequal&#39;</span><span class="p">:</span>
            <span class="n">var_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupstats</span><span class="o">.</span><span class="n">groupvarwithin</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">use_var</span> <span class="o">==</span> <span class="s1">&#39;equal&#39;</span><span class="p">:</span>
            <span class="n">var_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groupstats</span><span class="o">.</span><span class="n">groupdemean</span><span class="p">(),</span> <span class="n">ddof</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">gmeans</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;use_var should be &quot;unequal&quot; or &quot;equal&quot;&#39;</span><span class="p">)</span>

        <span class="c1"># res contains: 0:(idx1, idx2), 1:reject, 2:meandiffs, 3: std_pairs,</span>
        <span class="c1"># 4:confint, 5:q_crit, 6:df_total, 7:reject2, 8: pvals</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">tukeyhsd</span><span class="p">(</span><span class="n">gmeans</span><span class="p">,</span> <span class="n">gnobs</span><span class="p">,</span> <span class="n">var_</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">q_crit</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="n">resarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">lzip</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">groupsunique</span><span class="p">[</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">groupsunique</span><span class="p">[</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span>
                <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">4</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="mi">4</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">4</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">4</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">),</span>
                <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">),</span>
            <span class="n">dtype</span><span class="o">=</span><span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;group1&quot;</span><span class="p">,</span> <span class="nb">object</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;group2&quot;</span><span class="p">,</span> <span class="nb">object</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;meandiff&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;p-adj&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;reject&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">),</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="n">results_table</span> <span class="o">=</span> <span class="n">SimpleTable</span><span class="p">(</span><span class="n">resarr</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">resarr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
        <span class="n">results_table</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Multiple Comparison of Means - Tukey HSD, &quot;</span> <span class="o">+</span> <span class="s2">&quot;FWER=</span><span class="si">%4.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">alpha</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">TukeyHSDResults</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>  <span class="c1"># mc_object, attached as _multicomp</span>
            <span class="n">results_table</span><span class="p">,</span>
            <span class="n">res</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>  <span class="c1"># q_crit, positional</span>
            <span class="n">reject</span><span class="o">=</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">meandiffs</span><span class="o">=</span><span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">std_pairs</span><span class="o">=</span><span class="n">res</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
            <span class="n">confint</span><span class="o">=</span><span class="n">res</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
            <span class="n">df_total</span><span class="o">=</span><span class="n">res</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
            <span class="n">reject2</span><span class="o">=</span><span class="n">res</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>
            <span class="n">variance</span><span class="o">=</span><span class="n">var_</span><span class="p">,</span>
            <span class="n">pvalues</span><span class="o">=</span><span class="n">res</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
            <span class="n">group_t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">groupsunique</span><span class="p">[</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span>
            <span class="n">group_c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">groupsunique</span><span class="p">[</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
            <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="rankdata">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.rankdata.html#statsmodels.sandbox.stats.multicomp.rankdata">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">rankdata</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;rankdata, equivalent to scipy.stats.rankdata</span>

<span class="sd">    just a different implementation, I have not yet compared speed</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">uni</span><span class="p">,</span> <span class="n">intlab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">groupnobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">intlab</span><span class="p">)</span>
    <span class="c1"># Unused result, commented out</span>
    <span class="c1"># groupxsum = np.bincount(intlab, weights=X[:, 0])</span>
    <span class="c1"># groupxsum * 1.0 / groupnobs</span>

    <span class="n">rankraw</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
    <span class="n">groupranksum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">intlab</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">rankraw</span><span class="p">)</span>
    <span class="c1"># start at 1 for stats.rankdata :</span>
    <span class="n">grouprankmean</span> <span class="o">=</span> <span class="n">groupranksum</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">groupnobs</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">grouprankmean</span><span class="p">[</span><span class="n">intlab</span><span class="p">]</span></div>



<span class="c1"># new</span>


<div class="viewcode-block" id="compare_ordered">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.compare_ordered.html#statsmodels.sandbox.stats.multicomp.compare_ordered">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">compare_ordered</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;simple ordered sequential comparison of means</span>

<span class="sd">    vals : array_like</span>
<span class="sd">        means or rankmeans for independent groups</span>

<span class="sd">    incomplete, no return, not used yet</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
    <span class="n">sortind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
    <span class="n">sortind</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
    <span class="n">ntests</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
    <span class="c1"># alphacSidak = 1 - np.power((1. - alphaf), 1./ntests)</span>
    <span class="c1"># alphacBonf = alphaf / float(ntests)</span>
    <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu_indices</span><span class="p">(</span><span class="n">ntests</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># v1,v2 have wrong sequence</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span></div>



<div class="viewcode-block" id="varcorrection_unbalanced">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.varcorrection_unbalanced.html#statsmodels.sandbox.stats.multicomp.varcorrection_unbalanced">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">varcorrection_unbalanced</span><span class="p">(</span><span class="n">nobs_all</span><span class="p">,</span> <span class="n">srange</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;correction factor for variance with unequal sample sizes</span>

<span class="sd">    this is just a harmonic mean</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nobs_all : array_like</span>
<span class="sd">        The number of observations for each sample</span>
<span class="sd">    srange : bool</span>
<span class="sd">        if true, then the correction is divided by the number of samples</span>
<span class="sd">        for the variance of the studentized range statistic</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    correction : float</span>
<span class="sd">        Correction factor for variance.</span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    variance correction factor is</span>

<span class="sd">    1/k * sum_i 1/n_i</span>

<span class="sd">    where k is the number of samples and summation is over i=0,...,k-1.</span>
<span class="sd">    If all n_i are the same, then the correction factor is 1.</span>

<span class="sd">    This needs to be multiplied by the joint variance estimate, means square</span>
<span class="sd">    error, MSE. To obtain the correction factor for the standard deviation,</span>
<span class="sd">    square root needs to be taken.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nobs_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">nobs_all</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">srange</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">nobs_all</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">nobs_all</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">nobs_all</span><span class="p">)</span></div>



<div class="viewcode-block" id="varcorrection_pairs_unbalanced">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.varcorrection_pairs_unbalanced.html#statsmodels.sandbox.stats.multicomp.varcorrection_pairs_unbalanced">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">varcorrection_pairs_unbalanced</span><span class="p">(</span><span class="n">nobs_all</span><span class="p">,</span> <span class="n">srange</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;correction factor for variance with unequal sample sizes for all pairs</span>

<span class="sd">    this is just a harmonic mean</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nobs_all : array_like</span>
<span class="sd">        The number of observations for each sample</span>
<span class="sd">    srange : bool</span>
<span class="sd">        if true, then the correction is divided by 2 for the variance of</span>
<span class="sd">        the studentized range statistic</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    correction : ndarray</span>
<span class="sd">        Correction factor for variance.</span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    variance correction factor is</span>

<span class="sd">    1/k * sum_i 1/n_i</span>

<span class="sd">    where k is the number of samples and summation is over i=0,...,k-1.</span>
<span class="sd">    If all n_i are the same, then the correction factor is 1.</span>

<span class="sd">    This needs to be multiplies by the joint variance estimate, means square</span>
<span class="sd">    error, MSE. To obtain the correction factor for the standard deviation,</span>
<span class="sd">    square root needs to be taken.</span>

<span class="sd">    For the studentized range statistic, the resulting factor has to be</span>
<span class="sd">    divided by 2.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: test and replace with broadcasting</span>
    <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">nobs_all</span><span class="p">,</span> <span class="n">nobs_all</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">srange</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">n1</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">n2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">n1</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">n2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span></div>



<div class="viewcode-block" id="varcorrection_unequal">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.varcorrection_unequal.html#statsmodels.sandbox.stats.multicomp.varcorrection_unequal">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">varcorrection_unequal</span><span class="p">(</span><span class="n">var_all</span><span class="p">,</span> <span class="n">nobs_all</span><span class="p">,</span> <span class="n">df_all</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;return joint variance from samples with unequal variances and unequal</span>
<span class="sd">    sample sizes</span>

<span class="sd">    something is wrong</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    var_all : array_like</span>
<span class="sd">        The variance for each sample</span>
<span class="sd">    nobs_all : array_like</span>
<span class="sd">        The number of observations for each sample</span>
<span class="sd">    df_all : array_like</span>
<span class="sd">        degrees of freedom for each sample</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    varjoint : float</span>
<span class="sd">        joint variance.</span>
<span class="sd">    dfjoint : float</span>
<span class="sd">        joint Satterthwait&#39;s degrees of freedom</span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    (copy, paste not correct)</span>
<span class="sd">    variance is</span>

<span class="sd">    1/k * sum_i 1/n_i</span>

<span class="sd">    where k is the number of samples and summation is over i=0,...,k-1.</span>
<span class="sd">    If all n_i are the same, then the correction factor is 1/n.</span>

<span class="sd">    This needs to be multiplies by the joint variance estimate, means square</span>
<span class="sd">    error, MSE. To obtain the correction factor for the standard deviation,</span>
<span class="sd">    square root needs to be taken.</span>

<span class="sd">    This is for variance of mean difference not of studentized range.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">var_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">var_all</span><span class="p">)</span>
    <span class="n">var_over_n</span> <span class="o">=</span> <span class="n">var_all</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">nobs_all</span>  <span class="c1"># avoid integer division</span>
    <span class="n">varjoint</span> <span class="o">=</span> <span class="n">var_over_n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="n">dfjoint</span> <span class="o">=</span> <span class="n">varjoint</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">var_over_n</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">df_all</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">varjoint</span><span class="p">,</span> <span class="n">dfjoint</span></div>



<div class="viewcode-block" id="varcorrection_pairs_unequal">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.varcorrection_pairs_unequal.html#statsmodels.sandbox.stats.multicomp.varcorrection_pairs_unequal">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">varcorrection_pairs_unequal</span><span class="p">(</span><span class="n">var_all</span><span class="p">,</span> <span class="n">nobs_all</span><span class="p">,</span> <span class="n">df_all</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;return joint variance from samples with unequal variances and unequal</span>
<span class="sd">    sample sizes for all pairs</span>

<span class="sd">    something is wrong</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    var_all : array_like</span>
<span class="sd">        The variance for each sample</span>
<span class="sd">    nobs_all : array_like</span>
<span class="sd">        The number of observations for each sample</span>
<span class="sd">    df_all : array_like</span>
<span class="sd">        degrees of freedom for each sample</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    varjoint : ndarray</span>
<span class="sd">        joint variance.</span>
<span class="sd">    dfjoint : ndarray</span>
<span class="sd">        joint Satterthwait&#39;s degrees of freedom</span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    (copy, paste not correct)</span>
<span class="sd">    variance is</span>

<span class="sd">    1/k * sum_i 1/n_i</span>

<span class="sd">    where k is the number of samples and summation is over i=0,...,k-1.</span>
<span class="sd">    If all n_i are the same, then the correction factor is 1.</span>

<span class="sd">    This needs to be multiplies by the joint variance estimate, means square</span>
<span class="sd">    error, MSE. To obtain the correction factor for the standard deviation,</span>
<span class="sd">    square root needs to be taken.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: test and replace with broadcasting</span>
    <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">var_all</span><span class="p">,</span> <span class="n">var_all</span><span class="p">)</span>
    <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">nobs_all</span><span class="p">,</span> <span class="n">nobs_all</span><span class="p">)</span>
    <span class="n">df1</span><span class="p">,</span> <span class="n">df2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">df_all</span><span class="p">,</span> <span class="n">df_all</span><span class="p">)</span>

    <span class="n">varjoint</span> <span class="o">=</span> <span class="n">v1</span> <span class="o">/</span> <span class="n">n1</span> <span class="o">+</span> <span class="n">v2</span> <span class="o">/</span> <span class="n">n2</span>
    <span class="n">dfjoint</span> <span class="o">=</span> <span class="n">varjoint</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">((</span><span class="n">v1</span> <span class="o">/</span> <span class="n">n1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">df1</span> <span class="o">+</span> <span class="p">(</span><span class="n">v2</span> <span class="o">/</span> <span class="n">n2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">df2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">varjoint</span><span class="p">,</span> <span class="n">dfjoint</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">tukeyhsd</span><span class="p">(</span><span class="n">mean_all</span><span class="p">,</span> <span class="n">nobs_all</span><span class="p">,</span> <span class="n">var_all</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">q_crit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;simultaneous Tukey HSD</span>


<span class="sd">    check: instead of sorting, I use absolute value of pairwise differences</span>
<span class="sd">    in means. That&#39;s irrelevant for the test, but maybe reporting actual</span>
<span class="sd">    differences would be better.</span>
<span class="sd">    CHANGED: meandiffs are with sign, studentized range uses abs</span>

<span class="sd">    q_crit added for testing</span>

<span class="sd">    TODO: error in variance calculation when nobs_all is scalar, missing 1/n</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mean_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">mean_all</span><span class="p">)</span>
    <span class="c1"># check if or when other ones need to be arrays</span>

    <span class="n">n_means</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mean_all</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">nobs_all</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># assumes balanced samples with df = n - 1, n_i = n</span>
        <span class="n">df_total</span> <span class="o">=</span> <span class="n">n_means</span> <span class="o">*</span> <span class="n">df</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_means</span><span class="p">)</span> <span class="o">*</span> <span class="n">df</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="n">df_pairs_</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">nobs_all</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">var_all</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1"># balanced sample sizes and homogenous variance</span>
        <span class="n">var_pairs</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">var_all</span> <span class="o">/</span> <span class="n">nobs_all</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n_means</span><span class="p">,</span> <span class="n">n_means</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">var_all</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># unequal sample sizes and homogenous variance</span>
        <span class="n">var_pairs</span> <span class="o">=</span> <span class="n">var_all</span> <span class="o">*</span> <span class="n">varcorrection_pairs_unbalanced</span><span class="p">(</span><span class="n">nobs_all</span><span class="p">,</span> <span class="n">srange</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">var_all</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">var_pairs</span><span class="p">,</span> <span class="n">df_pairs_</span> <span class="o">=</span> <span class="n">varcorrection_pairs_unequal</span><span class="p">(</span><span class="n">var_all</span><span class="p">,</span> <span class="n">nobs_all</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
        <span class="n">var_pairs</span> <span class="o">/=</span> <span class="mf">2.</span>
        <span class="c1"># check division by two for studentized range</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;not supposed to be here&quot;</span><span class="p">)</span>

    <span class="c1"># meandiffs_ = mean_all[:,None] - mean_all</span>
    <span class="n">meandiffs_</span> <span class="o">=</span> <span class="n">mean_all</span> <span class="o">-</span> <span class="n">mean_all</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>  <span class="c1"># reverse sign, check with R example</span>
    <span class="n">std_pairs_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_pairs</span><span class="p">)</span>

    <span class="c1"># select all pairs from upper triangle of matrix</span>
    <span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu_indices</span><span class="p">(</span><span class="n">n_means</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">meandiffs</span> <span class="o">=</span> <span class="n">meandiffs_</span><span class="p">[</span><span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span><span class="p">]</span>
    <span class="n">std_pairs</span> <span class="o">=</span> <span class="n">std_pairs_</span><span class="p">[</span><span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">df_pairs_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df_total</span> <span class="o">=</span> <span class="n">df_pairs_</span><span class="p">[</span><span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span><span class="p">]</span>

    <span class="n">st_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">meandiffs</span><span class="p">)</span> <span class="o">/</span> <span class="n">std_pairs</span>  <span class="c1"># studentized range statistic</span>

    <span class="c1"># df_total_ = np.maximum(df_total, 5)  # TODO: smallest df in table</span>

    <span class="k">if</span> <span class="n">q_crit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">q_crit</span> <span class="o">=</span> <span class="n">get_tukeyQcrit2</span><span class="p">(</span><span class="n">n_means</span><span class="p">,</span> <span class="n">df_total</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>

    <span class="n">pvalues</span> <span class="o">=</span> <span class="n">get_tukey_pvalue</span><span class="p">(</span><span class="n">n_means</span><span class="p">,</span> <span class="n">df_total</span><span class="p">,</span> <span class="n">st_range</span><span class="p">)</span>
    <span class="c1"># we need pvalues to be atleast_1d for iteration. see #6132</span>
    <span class="n">pvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">pvalues</span><span class="p">)</span>

    <span class="n">reject</span> <span class="o">=</span> <span class="n">st_range</span> <span class="o">&gt;</span> <span class="n">q_crit</span>
    <span class="n">crit_int</span> <span class="o">=</span> <span class="n">std_pairs</span> <span class="o">*</span> <span class="n">q_crit</span>
    <span class="n">reject2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">meandiffs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">crit_int</span>

    <span class="n">confint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">meandiffs</span> <span class="o">-</span> <span class="n">crit_int</span><span class="p">,</span> <span class="n">meandiffs</span> <span class="o">+</span> <span class="n">crit_int</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span><span class="p">),</span>
        <span class="n">reject</span><span class="p">,</span>
        <span class="n">meandiffs</span><span class="p">,</span>
        <span class="n">std_pairs</span><span class="p">,</span>
        <span class="n">confint</span><span class="p">,</span>
        <span class="n">q_crit</span><span class="p">,</span>
        <span class="n">df_total</span><span class="p">,</span>
        <span class="n">reject2</span><span class="p">,</span>
        <span class="n">pvalues</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">simultaneous_ci</span><span class="p">(</span><span class="n">q_crit</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">groupnobs</span><span class="p">,</span> <span class="n">pairindices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute simultaneous confidence intervals for comparison of means.</span>

<span class="sd">    q_crit value is generated from tukey hsd test. Variance is considered</span>
<span class="sd">    across all groups. Returned halfwidths can be thought of as uncertainty</span>
<span class="sd">    intervals around each group mean. They allow for simultaneous</span>
<span class="sd">    comparison of pairwise significance among any pairs (by checking for</span>
<span class="sd">    overlap)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q_crit : float</span>
<span class="sd">        The Q critical value studentized range statistic from Tukey&#39;s HSD</span>
<span class="sd">    var : float</span>
<span class="sd">        The group variance</span>
<span class="sd">    groupnobs : array_like object</span>
<span class="sd">        Number of observations contained in each group.</span>
<span class="sd">    pairindices : tuple of lists, optional</span>
<span class="sd">        Indices corresponding to the upper triangle of matrix. Computed</span>
<span class="sd">        here if not supplied</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    halfwidths : ndarray</span>
<span class="sd">        Half the width of each confidence interval for each group given in</span>
<span class="sd">        groupnobs</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    MultiComparison : statistics class providing significance tests</span>
<span class="sd">    tukeyhsd : among other things, computes q_crit value</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [*] Hochberg, Y., and A. C. Tamhane. Multiple Comparison Procedures.</span>
<span class="sd">           Hoboken, NJ: John Wiley &amp; Sons, 1987.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set initial variables</span>
    <span class="n">ng</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">groupnobs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pairindices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pairindices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu_indices</span><span class="p">(</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Compute dij for all pairwise comparisons ala hochberg p. 95</span>
    <span class="n">gvar</span> <span class="o">=</span> <span class="n">var</span> <span class="o">/</span> <span class="n">groupnobs</span>

    <span class="n">d12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">gvar</span><span class="p">[</span><span class="n">pairindices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">gvar</span><span class="p">[</span><span class="n">pairindices</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

    <span class="c1"># Create the full d matrix given all known dij vals</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ng</span><span class="p">,</span> <span class="n">ng</span><span class="p">))</span>
    <span class="n">d</span><span class="p">[</span><span class="n">pairindices</span><span class="p">]</span> <span class="o">=</span> <span class="n">d12</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">d</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>

    <span class="c1"># Compute the two global sums from hochberg eq 3.32</span>
    <span class="n">sum1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">d12</span><span class="p">)</span>
    <span class="n">sum2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ng</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="p">((</span><span class="n">ng</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">sum2</span> <span class="o">-</span> <span class="n">sum1</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">ng</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">ng</span> <span class="o">-</span> <span class="mf">2.0</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">sum1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.0</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">q_crit</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">w</span>


<div class="viewcode-block" id="distance_st_range">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.distance_st_range.html#statsmodels.sandbox.stats.multicomp.distance_st_range">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">distance_st_range</span><span class="p">(</span><span class="n">mean_all</span><span class="p">,</span> <span class="n">nobs_all</span><span class="p">,</span> <span class="n">var_all</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">triu</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;pairwise distance matrix, outsourced from tukeyhsd</span>



<span class="sd">    CHANGED: meandiffs are with sign, studentized range uses abs</span>

<span class="sd">    q_crit added for testing</span>

<span class="sd">    TODO: error in variance calculation when nobs_all is scalar, missing 1/n</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mean_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">mean_all</span><span class="p">)</span>
    <span class="c1"># check if or when other ones need to be arrays</span>

    <span class="n">n_means</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mean_all</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">nobs_all</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">nobs_all</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">var_all</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1"># balanced sample sizes and homogenous variance</span>
        <span class="n">var_pairs</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">var_all</span> <span class="o">/</span> <span class="n">nobs_all</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n_means</span><span class="p">,</span> <span class="n">n_means</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">var_all</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># unequal sample sizes and homogenous variance</span>
        <span class="n">var_pairs</span> <span class="o">=</span> <span class="n">var_all</span> <span class="o">*</span> <span class="n">varcorrection_pairs_unbalanced</span><span class="p">(</span><span class="n">nobs_all</span><span class="p">,</span> <span class="n">srange</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">var_all</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">var_pairs</span><span class="p">,</span> <span class="n">df_sum</span> <span class="o">=</span> <span class="n">varcorrection_pairs_unequal</span><span class="p">(</span><span class="n">var_all</span><span class="p">,</span> <span class="n">nobs_all</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
        <span class="n">var_pairs</span> <span class="o">/=</span> <span class="mf">2.</span>
        <span class="c1"># check division by two for studentized range</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;not supposed to be here&quot;</span><span class="p">)</span>

    <span class="c1"># meandiffs_ = mean_all[:,None] - mean_all</span>
    <span class="n">meandiffs</span> <span class="o">=</span> <span class="n">mean_all</span> <span class="o">-</span> <span class="n">mean_all</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>  <span class="c1"># reverse sign, check with R example</span>
    <span class="n">std_pairs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_pairs</span><span class="p">)</span>

    <span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu_indices</span><span class="p">(</span><span class="n">n_means</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">triu</span><span class="p">:</span>
        <span class="c1"># select all pairs from upper triangle of matrix</span>
        <span class="n">meandiffs</span> <span class="o">=</span> <span class="n">meandiffs_</span><span class="p">[</span><span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span><span class="p">]</span>  <span class="c1"># noqa: F821  See GH#5756</span>
        <span class="n">std_pairs</span> <span class="o">=</span> <span class="n">std_pairs_</span><span class="p">[</span><span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span><span class="p">]</span>  <span class="c1"># noqa: F821  See GH#5756</span>

    <span class="n">st_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">meandiffs</span><span class="p">)</span> <span class="o">/</span> <span class="n">std_pairs</span>  <span class="c1"># studentized range statistic</span>

    <span class="k">return</span> <span class="n">st_range</span><span class="p">,</span> <span class="n">meandiffs</span><span class="p">,</span> <span class="n">std_pairs</span><span class="p">,</span> <span class="p">(</span><span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span><span class="p">)</span>  <span class="c1"># return square arrays</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">contrast_allpairs</span><span class="p">(</span><span class="n">nm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;contrast or restriction matrix for all pairs of nm variables</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nm : int</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    contr : ndarray, 2d, (nm*(nm-1)/2, nm)</span>
<span class="sd">       contrast matrix for all pairwise comparisons</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">contr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nm</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nm</span><span class="p">):</span>
            <span class="n">contr_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nm</span><span class="p">)</span>
            <span class="n">contr_row</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">contr_row</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">contr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">contr_row</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">contr</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">contrast_all_one</span><span class="p">(</span><span class="n">nm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;contrast or restriction matrix for all against first comparison</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nm : int</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    contr : ndarray, 2d, (nm-1, nm)</span>
<span class="sd">       contrast matrix for all against first comparisons</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">contr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nm</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nm</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">contr</span>


<span class="k">def</span><span class="w"> </span><span class="nf">contrast_diff_mean</span><span class="p">(</span><span class="n">nm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;contrast or restriction matrix for all against mean comparison</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nm : int</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    contr : ndarray, 2d, (nm-1, nm)</span>
<span class="sd">       contrast matrix for all against mean comparisons</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nm</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nm</span><span class="p">,</span> <span class="n">nm</span><span class="p">))</span> <span class="o">/</span> <span class="n">nm</span>


<span class="k">def</span><span class="w"> </span><span class="nf">tukey_pvalues</span><span class="p">(</span><span class="n">std_range</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;compute tukey p-values by numerical integration of multivariate-t distribution</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># corrected but very slow with warnings about integration</span>
    <span class="c1"># need to increase maxiter or similar</span>
    <span class="c1"># nm = len(std_range)</span>
    <span class="n">contr</span> <span class="o">=</span> <span class="n">contrast_allpairs</span><span class="p">(</span><span class="n">nm</span><span class="p">)</span>
    <span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">contr</span><span class="p">,</span> <span class="n">contr</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="n">tstat</span> <span class="o">=</span> <span class="n">std_range</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">corr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># need len of all pairs</span>
    <span class="k">return</span> <span class="n">multicontrast_pvalues</span><span class="p">(</span><span class="n">tstat</span><span class="p">,</span> <span class="n">corr</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">multicontrast_pvalues</span><span class="p">(</span><span class="n">tstat</span><span class="p">,</span> <span class="n">tcorr</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;pvalues for simultaneous tests</span>

<span class="sd">    currently only for t distribution, normal distribution not added yet</span>
<span class="sd">    alternative is ignored</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.sandbox.distributions.multivariate</span><span class="w"> </span><span class="kn">import</span> <span class="n">mvstdtprob</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">dist</span> <span class="o">==</span> <span class="s2">&quot;t&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;df has to be specified for the t-distribution&quot;</span><span class="p">)</span>
    <span class="n">tstat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tstat</span><span class="p">)</span>
    <span class="n">ntests</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tstat</span><span class="p">)</span>
    <span class="n">cc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">tstat</span><span class="p">)</span>
    <span class="n">pval_global</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">mvstdtprob</span><span class="p">(</span><span class="o">-</span><span class="n">cc</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">tcorr</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
    <span class="n">pvals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ti</span> <span class="ow">in</span> <span class="n">cc</span><span class="p">:</span>
        <span class="n">ti</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ntests</span><span class="p">)</span>
        <span class="n">pvals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">mvstdtprob</span><span class="p">(</span><span class="o">-</span><span class="n">cc</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">tcorr</span><span class="p">,</span> <span class="n">df</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">pval_global</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pvals</span><span class="p">)</span>


<div class="viewcode-block" id="StepDown">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.StepDown.html#statsmodels.sandbox.stats.multicomp.StepDown">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">StepDown</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a class for step down methods</span>

<span class="sd">    This is currently for simple tree subset descend, similar to homogeneous_subsets,</span>
<span class="sd">    but checks all leave-one-out subsets instead of assuming an ordered set.</span>
<span class="sd">    Comment in SAS manual:</span>
<span class="sd">    SAS only uses interval subsets of the sorted list, which is sufficient for range</span>
<span class="sd">    tests (maybe also equal variance and balanced sample sizes are required).</span>
<span class="sd">    For F-test based critical distances, the restriction to intervals is not sufficient.</span>

<span class="sd">    This version uses a single critical value of the studentized range distribution</span>
<span class="sd">    for all comparisons, and is therefore a step-down version of Tukey HSD.</span>
<span class="sd">    The class is written so it can be subclassed, where the get_distance_matrix and</span>
<span class="sd">    get_crit are overwritten to obtain other step-down procedures such as REGW.</span>

<span class="sd">    iter_subsets can be overwritten, to get a recursion as in the many to one comparison</span>
<span class="sd">    with a control such as in Dunnet&#39;s test.</span>


<span class="sd">    A one-sided right tail test is not covered because the direction of the inequality</span>
<span class="sd">    is hard coded in check_set.  Also Peritz&#39;s check of partitions is not possible, but</span>
<span class="sd">    I have not seen it mentioned in any more recent references.</span>
<span class="sd">    I have only partially read the step-down procedure for closed tests by Westfall.</span>

<span class="sd">    One change to make it more flexible, is to separate out the decision on a subset,</span>
<span class="sd">    also because the F-based tests, FREGW in SPSS, take information from all elements of</span>
<span class="sd">    a set and not just pairwise comparisons. I have not looked at the details of</span>
<span class="sd">    the F-based tests such as Sheffe yet. It looks like running an F-test on equality</span>
<span class="sd">    of means in each subset. This would also outsource how pairwise conditions are</span>
<span class="sd">    combined, any larger or max. This would also imply that the distance matrix cannot</span>
<span class="sd">    be calculated in advance for tests like the F-based ones.</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">nobs_all</span><span class="p">,</span> <span class="n">var_all</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_vals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nobs_all</span> <span class="o">=</span> <span class="n">nobs_all</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_all</span> <span class="o">=</span> <span class="n">var_all</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span>
        <span class="c1"># the following has been moved to run</span>
        <span class="c1"># self.cache_result = {}</span>
        <span class="c1"># self.crit = self.getcrit(0.5)   #decide where to set alpha, moved to run</span>
        <span class="c1"># self.accepted = []  #store accepted sets, not unique</span>

<div class="viewcode-block" id="StepDown.get_crit">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.StepDown.get_crit.html#statsmodels.sandbox.stats.multicomp.StepDown.get_crit">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_crit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get_tukeyQcrit</span>

<span class="sd">        currently tukey Q, add others</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">q_crit</span> <span class="o">=</span> <span class="n">get_tukeyQcrit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_vals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">q_crit</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_vals</span><span class="p">)</span></div>


<div class="viewcode-block" id="StepDown.get_distance_matrix">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.StepDown.get_distance_matrix.html#statsmodels.sandbox.stats.multicomp.StepDown.get_distance_matrix">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_distance_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;studentized range statistic&quot;&quot;&quot;</span>
        <span class="c1"># make into property, decorate</span>
        <span class="n">dres</span> <span class="o">=</span> <span class="n">distance_st_range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nobs_all</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_all</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance_matrix</span> <span class="o">=</span> <span class="n">dres</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="StepDown.iter_subsets">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.StepDown.iter_subsets.html#statsmodels.sandbox.stats.multicomp.StepDown.iter_subsets">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">iter_subsets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterate substeps&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)):</span>
            <span class="n">idxsub</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
            <span class="n">idxsub</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">idxsub</span></div>


<div class="viewcode-block" id="StepDown.check_set">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.StepDown.check_set.html#statsmodels.sandbox.stats.multicomp.StepDown.check_set">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;check whether pairwise distances of indices satisfy condition&quot;&quot;&quot;</span>
        <span class="n">indtup</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">indtup</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_result</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_result</span><span class="p">[</span><span class="n">indtup</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">set_distance_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance_matrix</span><span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">indices</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">indices</span>
            <span class="p">]</span>
            <span class="n">n_elements</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">set_distance_matrix</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">crit</span><span class="p">[</span><span class="n">n_elements</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]):</span>
                <span class="n">res</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cache_result</span><span class="p">[</span><span class="n">indtup</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span>
            <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="StepDown.stepdown">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.StepDown.stepdown.html#statsmodels.sandbox.stats.multicomp.StepDown.stepdown">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">stepdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;stepdown&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_set</span><span class="p">(</span><span class="n">indices</span><span class="p">):</span>  <span class="c1"># larger than critical distance</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># step down into subsets if more than 2 elements</span>
                <span class="k">for</span> <span class="n">subs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_subsets</span><span class="p">(</span><span class="n">indices</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stepdown</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rejected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">indices</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accepted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">indices</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">indices</span></div>


<div class="viewcode-block" id="StepDown.run">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.StepDown.run.html#statsmodels.sandbox.stats.multicomp.StepDown.run">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;main function to run the test,</span>

<span class="sd">        could be done in __call__ instead</span>
<span class="sd">        this could have all the initialization code</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache_result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_crit</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>  <span class="c1"># decide where to set alpha, moved to run</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accepted</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># store accepted sets, not unique</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rejected</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_distance_matrix</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stepdown</span><span class="p">(</span><span class="n">lrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_vals</span><span class="p">))</span>

        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accepted</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">sd</span><span class="o">.</span><span class="n">rejected</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="homogeneous_subsets">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.homogeneous_subsets.html#statsmodels.sandbox.stats.multicomp.homogeneous_subsets">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">homogeneous_subsets</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">dcrit</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;recursively check all pairs of vals for minimum distance</span>

<span class="sd">    step down method as in Newman-Keuls and Ryan procedures. This is not a</span>
<span class="sd">    closed procedure since not all partitions are checked.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    vals : array_like</span>
<span class="sd">        values that are pairwise compared</span>
<span class="sd">    dcrit : array_like or float</span>
<span class="sd">        critical distance for rejecting, either float, or 2-dimensional array</span>
<span class="sd">        with distances on the upper triangle.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rejs : list of pairs</span>
<span class="sd">        list of pair-indices with (strictly) larger than critical difference</span>
<span class="sd">    nrejs : list of pairs</span>
<span class="sd">        list of pair-indices with smaller than critical difference</span>
<span class="sd">    lli : list of tuples</span>
<span class="sd">        list of subsets with smaller than critical difference</span>
<span class="sd">    res : tree</span>
<span class="sd">        result of all comparisons (for checking)</span>


<span class="sd">    this follows description in SPSS notes on Post-Hoc Tests</span>

<span class="sd">    Because of the recursive structure, some comparisons are made several</span>
<span class="sd">    times, but only unique pairs or sets are returned.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; m = [0, 2, 2.5, 3, 6, 8, 9, 9.5,10 ]</span>
<span class="sd">    &gt;&gt;&gt; rej, nrej, ssli, res = homogeneous_subsets(m, 2)</span>
<span class="sd">    &gt;&gt;&gt; set_partition(ssli)</span>
<span class="sd">    ([(5, 6, 7, 8), (1, 2, 3), (4,)], [0])</span>
<span class="sd">    &gt;&gt;&gt; [np.array(m)[list(pp)] for pp in set_partition(ssli)[0]]</span>
<span class="sd">    [array([  8. ,   9. ,   9.5,  10. ]), array([ 2. ,  2.5,  3. ]), array([ 6.])]</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nvals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
    <span class="n">indices_</span> <span class="o">=</span> <span class="n">lrange</span><span class="p">(</span><span class="n">nvals</span><span class="p">)</span>
    <span class="n">rejected</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">subsetsli</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dcrit</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">dcrit</span> <span class="o">=</span> <span class="n">dcrit</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nvals</span><span class="p">,</span> <span class="n">nvals</span><span class="p">))</span>  <span class="c1"># example numbers for experimenting</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">subsets</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">indices_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;recursive function for constructing homogeneous subset</span>

<span class="sd">        registers rejected and subsetli in outer scope</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">indices_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indices_</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">dcrit</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span>
            <span class="n">rejected</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">indices_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indices_</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">subsets</span><span class="p">(</span><span class="n">vals</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">indices_</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
                <span class="n">subsets</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">indices_</span><span class="p">[</span><span class="mi">1</span><span class="p">:]),</span>
                <span class="p">(</span><span class="n">indices_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indices_</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subsetsli</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">indices_</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">indices_</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">subsets</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">indices_</span><span class="p">)</span>

    <span class="n">all_pairs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nvals</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nvals</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
    <span class="n">rejs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">rejected</span><span class="p">)</span>
    <span class="n">not_rejected</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_pairs</span><span class="p">)</span> <span class="o">-</span> <span class="n">rejs</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">rejs</span><span class="p">),</span> <span class="n">not_rejected</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">subsetsli</span><span class="p">)),</span> <span class="n">res</span></div>



<div class="viewcode-block" id="set_partition">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.set_partition.html#statsmodels.sandbox.stats.multicomp.set_partition">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_partition</span><span class="p">(</span><span class="n">ssli</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;extract a partition from a list of tuples</span>

<span class="sd">    this should be correctly called select largest disjoint sets.</span>
<span class="sd">    Begun and Gabriel 1981 do not seem to be bothered by sets of accepted</span>
<span class="sd">    hypothesis with joint elements,</span>
<span class="sd">    e.g. maximal_accepted_sets = { {1,2,3}, {2,3,4} }</span>

<span class="sd">    This creates a set partition from a list of sets given as tuples.</span>
<span class="sd">    It tries to find the partition with the largest sets. That is, sets are</span>
<span class="sd">    included after being sorted by length.</span>

<span class="sd">    If the list does not include the singletons, then it will be only a</span>
<span class="sd">    partial partition. Missing items are singletons (I think).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; li</span>
<span class="sd">    [(5, 6, 7, 8), (1, 2, 3), (4, 5), (0, 1)]</span>
<span class="sd">    &gt;&gt;&gt; set_partition(li)</span>
<span class="sd">    ([(5, 6, 7, 8), (1, 2, 3)], [0, 4])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">part</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ssli</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="c1"># print(s,</span>
        <span class="n">s_</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">s_</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">part</span><span class="p">):</span>
            <span class="c1"># print(&#39;inside:&#39;, s</span>
            <span class="n">part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="c1"># else: print(part</span>

    <span class="n">missing</span> <span class="o">=</span> <span class="nb">list</span><span class="p">({</span><span class="n">i</span> <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">ssli</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">}</span> <span class="o">-</span> <span class="p">{</span><span class="n">i</span> <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">part</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">part</span><span class="p">,</span> <span class="n">missing</span></div>



<div class="viewcode-block" id="set_remove_subs">
<a class="viewcode-back" href="../../../../generated/statsmodels.sandbox.stats.multicomp.set_remove_subs.html#statsmodels.sandbox.stats.multicomp.set_remove_subs">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_remove_subs</span><span class="p">(</span><span class="n">ssli</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;remove sets that are subsets of another set from a list of tuples</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ssli : list of tuples</span>
<span class="sd">        each tuple is considered as a set</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    part : list of tuples</span>
<span class="sd">        new list with subset tuples removed, it is sorted by set-length of tuples. The</span>
<span class="sd">        list contains original tuples, duplicate elements are not removed.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; set_remove_subs([(0, 1), (1, 2), (1, 2, 3), (0,)])</span>
<span class="sd">    [(1, 2, 3), (0, 1)]</span>
<span class="sd">    &gt;&gt;&gt; set_remove_subs([(0, 1), (1, 2), (1,1, 1, 2, 3), (0,)])</span>
<span class="sd">    [(1, 1, 1, 2, 3), (0, 1)]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: maybe convert all tuples to sets immediately, but I do not need the extra efficiency</span>
    <span class="n">part</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ssli</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">)))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="c1"># print(s,</span>
        <span class="c1"># s_ = set(s).copy()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">part</span><span class="p">):</span>
            <span class="c1"># print(&#39;inside:&#39;, s</span>
            <span class="n">part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="c1"># else: print(part</span>

    <span class="c1">##    missing = list(set(i for ll in ssli for i in ll)</span>
    <span class="c1">##                   - set(i for ll in part for i in ll))</span>
    <span class="k">return</span> <span class="n">part</span></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.multitest</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">fdrcorrection</span> <span class="k">as</span> <span class="n">fdrcorrection0</span><span class="p">,</span>
        <span class="n">fdrcorrection_twostage</span><span class="p">,</span>
        <span class="n">multipletests</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">examples</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;tukey&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tukeycrit&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fdr&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fdrmc&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bonf&quot;</span><span class="p">,</span>
        <span class="s2">&quot;randmvn&quot;</span><span class="p">,</span>
        <span class="s2">&quot;multicompdev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;None&quot;</span><span class="p">,</span>
    <span class="p">]</span>  <span class="c1"># [-1]</span>

    <span class="k">if</span> <span class="s2">&quot;tukey&quot;</span> <span class="ow">in</span> <span class="n">examples</span><span class="p">:</span>
        <span class="c1"># Example Tukey</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">Tukeythreegene</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">))</span>

    <span class="c1"># Example FDR</span>
    <span class="c1"># ------------</span>
    <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;fdr&quot;</span> <span class="ow">in</span> <span class="n">examples</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;bonf&quot;</span> <span class="ow">in</span> <span class="n">examples</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.ex_multicomp</span><span class="w"> </span><span class="kn">import</span> <span class="n">example_fdr_bonferroni</span>

        <span class="n">example_fdr_bonferroni</span><span class="p">()</span>

    <span class="k">if</span> <span class="s2">&quot;fdrmc&quot;</span> <span class="ow">in</span> <span class="n">examples</span><span class="p">:</span>
        <span class="n">mcres</span> <span class="o">=</span> <span class="n">mcfdr</span><span class="p">(</span>
            <span class="n">nobs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">nrepl</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">ntests</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ntrue</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="mf">0.3</span>
        <span class="p">)</span>
        <span class="n">mcmeans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mcres</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">mcmeans</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">mcmeans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">mcmeans</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">mcmeans</span><span class="p">[:</span><span class="mi">4</span><span class="p">],</span> <span class="n">mcmeans</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>

    <span class="k">if</span> <span class="s2">&quot;randmvn&quot;</span> <span class="ow">in</span> <span class="n">examples</span><span class="p">:</span>
        <span class="n">rvsmvn</span> <span class="o">=</span> <span class="n">randmvn</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="p">(</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">rvsmvn</span><span class="p">,</span> <span class="n">rowvar</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">rvsmvn</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

    <span class="k">if</span> <span class="s2">&quot;tukeycrit&quot;</span> <span class="ow">in</span> <span class="n">examples</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">get_tukeyQcrit</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">),</span> <span class="mf">5.60</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">get_tukeyQcrit</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span> <span class="mf">7.47</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;multicompdev&quot;</span> <span class="ow">in</span> <span class="n">examples</span><span class="p">:</span>
        <span class="c1"># development of kruskal-wallis multiple-comparison</span>
        <span class="c1"># example from matlab file exchange</span>

        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">[</span><span class="mf">7.68</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.69</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.70</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.70</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.72</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.73</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.73</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.76</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.71</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.73</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.74</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.74</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.78</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.78</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.80</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.81</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.74</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.75</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.77</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.78</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.80</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.81</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.84</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.71</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.71</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.74</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.79</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.81</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.85</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.87</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">7.91</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">xli</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>
        <span class="n">xranks</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">rankdata</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">xranksli</span> <span class="o">=</span> <span class="p">[</span><span class="n">xranks</span><span class="p">[</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>
        <span class="n">xnobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">xval</span><span class="p">)</span> <span class="k">for</span> <span class="n">xval</span> <span class="ow">in</span> <span class="n">xli</span><span class="p">])</span>
        <span class="n">meanranks</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">xranksli</span><span class="p">]</span>
        <span class="n">sumranks</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">xranksli</span><span class="p">]</span>
        <span class="c1"># equivalent function</span>
        <span class="c1"># from scipy import special</span>
        <span class="c1"># -np.sqrt(2.)*special.erfcinv(2-0.5) == stats.norm.isf(0.25)</span>
        <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="mf">0.67448975019608171</span><span class="p">)</span>
        <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">isf</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>

        <span class="n">mrs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">meanranks</span><span class="p">)</span>
        <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu_indices</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">sorted rank differences&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">mrs</span><span class="p">[</span><span class="n">v2</span><span class="p">]</span> <span class="o">-</span> <span class="n">mrs</span><span class="p">[</span><span class="n">v1</span><span class="p">])</span>
        <span class="n">diffidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">mrs</span><span class="p">[</span><span class="n">v2</span><span class="p">]</span> <span class="o">-</span> <span class="n">mrs</span><span class="p">[</span><span class="n">v1</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">mrs</span><span class="p">[</span><span class="n">v2</span><span class="p">[</span><span class="n">diffidx</span><span class="p">]]</span> <span class="o">-</span> <span class="n">mrs</span><span class="p">[</span><span class="n">v1</span><span class="p">[</span><span class="n">diffidx</span><span class="p">]]</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">kruskal for all pairs&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">v2</span><span class="p">[</span><span class="n">diffidx</span><span class="p">],</span> <span class="n">v1</span><span class="p">[</span><span class="n">diffidx</span><span class="p">]):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">kruskal</span><span class="p">(</span><span class="n">xli</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">xli</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
            <span class="n">mwu</span><span class="p">,</span> <span class="n">mwupval</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">xli</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">xli</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">use_continuity</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">mwu</span><span class="p">,</span> <span class="n">mwupval</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">mwupval</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="mf">0.05</span> <span class="o">/</span> <span class="mf">6.0</span><span class="p">,</span> <span class="n">mwupval</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="mf">0.1</span> <span class="o">/</span> <span class="mf">6.0</span><span class="p">)</span>

        <span class="n">uni</span><span class="p">,</span> <span class="n">intlab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">groupnobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">intlab</span><span class="p">)</span>
        <span class="n">groupxsum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">intlab</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">groupxmean</span> <span class="o">=</span> <span class="n">groupxsum</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">groupnobs</span>

        <span class="n">rankraw</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
        <span class="n">groupranksum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">intlab</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">rankraw</span><span class="p">)</span>
        <span class="c1"># start at 1 for stats.rankdata :</span>
        <span class="n">grouprankmean</span> <span class="o">=</span> <span class="n">groupranksum</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">groupnobs</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">assert_almost_equal</span><span class="p">(</span><span class="n">grouprankmean</span><span class="p">[</span><span class="n">intlab</span><span class="p">],</span> <span class="n">stats</span><span class="o">.</span><span class="n">rankdata</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]),</span> <span class="mi">15</span><span class="p">)</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">GroupsStats</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">useranks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">groupmeanfilter and grouprankmeans&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">groupmeanfilter</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">grouprankmean</span><span class="p">[</span><span class="n">intlab</span><span class="p">])</span>
        <span class="c1"># the following has changed</span>
        <span class="c1"># assert_almost_equal(gs.groupmeanfilter, stats.rankdata(X[:,0]), 15)</span>

        <span class="n">xuni</span><span class="p">,</span> <span class="n">xintlab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">gs2</span> <span class="o">=</span> <span class="n">GroupsStats</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">xintlab</span><span class="p">]),</span> <span class="n">useranks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># assert_almost_equal(gs2.groupmeanfilter, stats.rankdata(X[:,0]), 15)</span>

        <span class="n">rankbincount</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">xranks</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
        <span class="n">nties</span> <span class="o">=</span> <span class="n">rankbincount</span><span class="p">[</span><span class="n">rankbincount</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">ntot</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xranks</span><span class="p">))</span>
        <span class="n">tiecorrection</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">nties</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="n">nties</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="n">ntot</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="n">ntot</span><span class="p">)</span>
        <span class="n">assert_almost_equal</span><span class="p">(</span><span class="n">tiecorrection</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">tiecorrect</span><span class="p">(</span><span class="n">xranks</span><span class="p">),</span> <span class="mi">15</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">tiecorrection for data and ranks&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">tiecorrection</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">tiecorrect</span><span class="p">(</span><span class="n">xranks</span><span class="p">))</span>

        <span class="n">tot</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mi">500</span>  <span class="c1"># 168</span>
        <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">tot</span> <span class="o">*</span> <span class="p">(</span><span class="n">tot</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">12.0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="p">(</span><span class="mf">6.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">tot</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)))</span>
        <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">tot</span> <span class="o">*</span> <span class="p">(</span><span class="n">tot</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">12.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">stats</span><span class="o">.</span><span class="n">tiecorrect</span><span class="p">(</span><span class="n">xranks</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">pairs of mean rank differences&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">v2</span><span class="p">[</span><span class="n">diffidx</span><span class="p">],</span> <span class="n">v1</span><span class="p">[</span><span class="n">diffidx</span><span class="p">]):</span>
            <span class="c1"># pdiff = np.abs(mrs[i] - mrs[j])</span>
            <span class="n">pdiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">meanranks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">meanranks</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="n">se</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                <span class="n">f</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">xnobs</span><span class="p">[[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]])</span>
            <span class="p">)</span>  <span class="c1"># np.array([8,8]))) #Fixme groupnobs[[i,j]] ))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">pdiff</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">pdiff</span> <span class="o">/</span> <span class="n">se</span><span class="p">,</span> <span class="n">pdiff</span> <span class="o">/</span> <span class="n">se</span> <span class="o">&gt;</span> <span class="mf">2.6310</span><span class="p">)</span>

        <span class="n">multicomp</span> <span class="o">=</span> <span class="n">MultiComparison</span><span class="p">(</span><span class="o">*</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">multicomp</span><span class="o">.</span><span class="n">kruskal</span><span class="p">()</span>
        <span class="n">gsr</span> <span class="o">=</span> <span class="n">GroupsStats</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">useranks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">examples for kruskal multicomparison&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span>
            <span class="n">skw</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">kruskal</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
            <span class="n">mc2</span> <span class="o">=</span> <span class="n">MultiComparison</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x1</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x2</span><span class="p">))]</span>
            <span class="p">)</span>
            <span class="n">newskw</span> <span class="o">=</span> <span class="n">mc2</span><span class="o">.</span><span class="n">kruskal</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">skw</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">skw</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">skw</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">newskw</span><span class="p">,</span> <span class="p">(</span><span class="n">newskw</span> <span class="o">/</span> <span class="n">skw</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

        <span class="n">tablett</span><span class="p">,</span> <span class="n">restt</span><span class="p">,</span> <span class="n">arrtt</span> <span class="o">=</span> <span class="n">multicomp</span><span class="o">.</span><span class="n">allpairtest</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">)</span>
        <span class="n">tablemw</span><span class="p">,</span> <span class="n">resmw</span><span class="p">,</span> <span class="n">arrmw</span> <span class="o">=</span> <span class="n">multicomp</span><span class="o">.</span><span class="n">allpairtest</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">tablett</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">tablemw</span><span class="p">)</span>
        <span class="n">tablemwhs</span><span class="p">,</span> <span class="n">resmw</span><span class="p">,</span> <span class="n">arrmw</span> <span class="o">=</span> <span class="n">multicomp</span><span class="o">.</span><span class="n">allpairtest</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;hs&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">tablemwhs</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;last&quot;</span> <span class="ow">in</span> <span class="n">examples</span><span class="p">:</span>
        <span class="n">xli</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># Xrvs = np.array(catstack(xli))</span>
        <span class="n">xrvs</span><span class="p">,</span> <span class="n">xrvsgr</span> <span class="o">=</span> <span class="n">catstack</span><span class="p">(</span><span class="n">xli</span><span class="p">)</span>
        <span class="n">multicompr</span> <span class="o">=</span> <span class="n">MultiComparison</span><span class="p">(</span><span class="n">xrvs</span><span class="p">,</span> <span class="n">xrvsgr</span><span class="p">)</span>
        <span class="n">tablett</span><span class="p">,</span> <span class="n">restt</span><span class="p">,</span> <span class="n">arrtt</span> <span class="o">=</span> <span class="n">multicompr</span><span class="o">.</span><span class="n">allpairtest</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">tablett</span><span class="p">)</span>

        <span class="n">xli</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]]</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">catstack</span><span class="p">(</span><span class="n">xli</span><span class="p">)</span>
        <span class="n">gs4</span> <span class="o">=</span> <span class="n">GroupsStats</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">labels</span><span class="p">]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">gs4</span><span class="o">.</span><span class="n">groupvarwithin</span><span class="p">())</span>

    <span class="c1"># test_tukeyhsd() #moved to test_multi.py</span>

    <span class="n">gmeans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">7.71375</span><span class="p">,</span> <span class="mf">7.76125</span><span class="p">,</span> <span class="mf">7.78428571</span><span class="p">,</span> <span class="mf">7.79875</span><span class="p">])</span>
    <span class="n">gnobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
    <span class="n">sd</span> <span class="o">=</span> <span class="n">StepDown</span><span class="p">(</span><span class="n">gmeans</span><span class="p">,</span> <span class="n">gnobs</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="p">[</span><span class="mi">27</span><span class="p">])</span>

    <span class="c1"># example from BKY</span>
    <span class="n">pvals</span> <span class="o">=</span> <span class="p">[</span>
        <span class="mf">0.0001</span><span class="p">,</span>
        <span class="mf">0.0004</span><span class="p">,</span>
        <span class="mf">0.0019</span><span class="p">,</span>
        <span class="mf">0.0095</span><span class="p">,</span>
        <span class="mf">0.0201</span><span class="p">,</span>
        <span class="mf">0.0278</span><span class="p">,</span>
        <span class="mf">0.0298</span><span class="p">,</span>
        <span class="mf">0.0344</span><span class="p">,</span>
        <span class="mf">0.0459</span><span class="p">,</span>
        <span class="mf">0.3240</span><span class="p">,</span>
        <span class="mf">0.4262</span><span class="p">,</span>
        <span class="mf">0.5719</span><span class="p">,</span>
        <span class="mf">0.6528</span><span class="p">,</span>
        <span class="mf">0.7590</span><span class="p">,</span>
        <span class="mf">1.000</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="c1"># same number of rejection as in BKY paper:</span>
    <span class="c1"># single step-up:4, two-stage:8, iterated two-step:9</span>
    <span class="c1"># also alpha_star is the same as theirs for TST</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">fdrcorrection0</span><span class="p">(</span><span class="n">pvals</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;indep&quot;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">fdrcorrection_twostage</span><span class="p">(</span><span class="n">pvals</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
    <span class="n">res_tst</span> <span class="o">=</span> <span class="n">fdrcorrection_twostage</span><span class="p">(</span><span class="n">pvals</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">assert_almost_equal</span><span class="p">(</span>
        <span class="p">[</span><span class="mf">0.047619</span><span class="p">,</span> <span class="mf">0.0649</span><span class="p">],</span> <span class="n">res_tst</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="mi">2</span><span class="p">],</span> <span class="mi">3</span>
    <span class="p">)</span>  <span class="c1"># alpha_star for stage 2</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">res_tst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">fdrcorrection_twostage</span><span class="p">(</span><span class="n">pvals</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;fdr_gbs&quot;</span><span class="p">,</span> <span class="n">multipletests</span><span class="p">(</span><span class="n">pvals</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;fdr_gbs&quot;</span><span class="p">))</span>
    <span class="c1"># multicontrast_pvalues(tstat, tcorr, df)</span>
    <span class="n">tukey_pvalues</span><span class="p">(</span><span class="mf">3.649</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
</code></pre></div>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      Feb 19, 2025
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  
  
  <div class="md-footer-meta md-typeset">
    
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-footer-copyright__highlight">
        &#169; Copyright 2009-2025, Josef Perktold, Skipper Seabold, Jonathan Taylor, statsmodels-developers.
        
    </div>
  
    Created using
    <a href="https://www.sphinx-doc.org/" target="_blank" rel="noopener">Sphinx</a>
    7.3.7.
     and
    <a href="https://github.com/jbms/sphinx-immaterial/" target="_blank" rel="noopener">Sphinx-Immaterial</a>
  
</div>
      
        <div class="md-social">
  
    
    
    <a href="https://github.com/statsmodels/statsmodels/" target="_blank" rel="noopener" title="Source on github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://pypi.org/project/statsmodels/" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://doi.org/10.5281/zenodo.593847" target="_blank" rel="noopener" title="doi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M0 216C0 149.7 53.7 96 120 96h8c17.7 0 32 14.3 32 32s-14.3 32-32 32h-8c-30.9 0-56 25.1-56 56v8h64c35.3 0 64 28.7 64 64v64c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V216zm256 0c0-66.3 53.7-120 120-120h8c17.7 0 32 14.3 32 32s-14.3 32-32 32h-8c-30.9 0-56 25.1-56 56v8h64c35.3 0 64 28.7 64 64v64c0 35.3-28.7 64-64 64h-64c-35.3 0-64-28.7-64-64V216z"/></svg>
    </a>
  
</div>
      
    </div>
    
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": [], "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike", "staticVersions": null, "versionPath": "../versions-v3.json"}}</script>
    
      
        <script src="../../../../_static/sphinx_immaterial_theme.f9d9eeeb247ace16c.min.js?v=8ec58cb5"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
  </body>
</html>