

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Testing &#8212; statsmodels 0.9.0 documentation</title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../_static/statsmodels_hybi_favico.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Naming Conventions" href="naming_conventions.html" />
    <link rel="prev" title="Maintainer Notes" href="maintainer_notes.html" />
<link rel="stylesheet" href="../_static/examples.css" type="text/css" />
<link rel="stylesheet" href="../_static/facebox.css" type="text/css" />
<script type="text/javascript" src="../_static/scripts.js">
</script>
<script type="text/javascript" src="../_static/facebox.js">
</script>
<script type="text/javascript">
$.facebox.settings.closeImage = "../_static/closelabel.png"
$.facebox.settings.loadingImage = "../_static/loading.gif"
</script>

  </head><body>
<div class="headerwrap">
    <div class = "header">
        
        <a href = "../index.html">
<img src="../_static/statsmodels_hybi_banner.png" alt="Logo"
    style="padding-left: 15px"/></a>
        
    </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="naming_conventions.html" title="Naming Conventions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="maintainer_notes.html" title="Maintainer Notes"
             accesskey="P">previous</a> |</li>
<li><a href ="../install.html">Install</a></li> &nbsp;|&nbsp;
<li><a href="https://groups.google.com/forum/?hl=en#!forum/pystatsmodels">Support</a></li> &nbsp;|&nbsp;
<li><a href="https://github.com/statsmodels/statsmodels/issues">Bugs</a></li> &nbsp;|&nbsp;
<li><a href="index.html">Develop</a></li> &nbsp;|&nbsp;
<li><a href="../examples/index.html">Examples</a></li> &nbsp;|&nbsp;
<li><a href="../faq.html">FAQ</a></li> &nbsp;|&nbsp;

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Developer Page</a> |</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            




  <div class="section" id="testing">
<span id="id1"></span><h1>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="test-driven-development">
<h2>Test Driven Development<a class="headerlink" href="#test-driven-development" title="Permalink to this headline">¶</a></h2>
<p>We strive to follow a <a class="reference external" href="https://en.wikipedia.org/wiki/Test-driven_development">Test Driven Development (TDD)</a> pattern.
All models or statistical functions that are added to the main code base are to have
tests versus an existing statistical package, if possible.</p>
</div>
<div class="section" id="introduction-to-nose">
<h2>Introduction to Nose<a class="headerlink" href="#introduction-to-nose" title="Permalink to this headline">¶</a></h2>
<p>Like many packages, statsmodels uses the <a class="reference external" href="http://nose.readthedocs.io/en/latest/">Nose testing system</a> and the convenient extensions in <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/routines.testing.html">numpy.testing</a>. Nose itself is an extension of <a class="reference external" href="https://docs.python.org/3.2/library/unittest.html#module-unittest" title="(in Python v3.2)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Python's</span> <span class="pre">unittest</span></code></a>. Nose will find any file, directory, function, or class name that matches the regular expression <code class="docutils literal notranslate"><span class="pre">(?:^|[b_./-])[Tt]est</span></code>. This is mainly functions that begin with test* and classes that begin with Test*.</p>
</div>
<div class="section" id="running-the-test-suite">
<span id="run-tests"></span><h2>Running the Test Suite<a class="headerlink" href="#running-the-test-suite" title="Permalink to this headline">¶</a></h2>
<p>You can run all the tests by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sm</span><span class="o">.</span><span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
<p>You can test submodules by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sm</span><span class="o">.</span><span class="n">discrete</span><span class="o">.</span><span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-write-a-test">
<h2>How To Write A Test<a class="headerlink" href="#how-to-write-a-test" title="Permalink to this headline">¶</a></h2>
<p>NumPy provides a good introduction to unit testing with Nose and NumPy extensions <a class="reference external" href="https://github.com/numpy/numpy/blob/master/doc/TESTS.rst.txt">here</a>. It is worth a read for some more details.
Here, we will document a few conventions we follow that are worth mentioning. Often we want to test
a whole model at once rather than just one function, for example. The following is a pared down
version test_discrete.py. In this case, several different models with different options need to be
tested. The tests look something like</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numpy.testing</span> <span class="kn">import</span> <span class="n">assert_almost_equal</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="kn">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">results.results_discrete</span> <span class="kn">import</span> <span class="n">Spector</span>

<span class="k">class</span> <span class="nc">CheckDiscreteResults</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    res2 are the results. res1 are the values from statsmodels</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">assert_almost_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res1</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">res2</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    <span class="n">decimal_tvalues</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="k">def</span> <span class="nf">test_tvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">assert_almost_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res1</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">res2</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">decimal_tvalues</span><span class="p">)</span>

    <span class="c1"># ... as many more tests as there are common results</span>

<span class="k">class</span> <span class="nc">TestProbitNewton</span><span class="p">(</span><span class="n">CheckDiscreteResults</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests the Probit model using Newton&#39;s method for fitting.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setup_class</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="c1"># set up model</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">spector</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="n">data</span><span class="o">.</span><span class="n">exog</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">exog</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">res1</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">Probit</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">endog</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">exog</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;newton&#39;</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># set up results</span>
        <span class="n">res2</span> <span class="o">=</span> <span class="n">Spector</span><span class="p">()</span>
        <span class="n">res2</span><span class="o">.</span><span class="n">probit</span><span class="p">()</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">res2</span> <span class="o">=</span> <span class="n">res2</span>

        <span class="c1"># set up precision</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">decimal_tvalues</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="k">def</span> <span class="nf">test_model_specifc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">assert_almost_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res1</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">res2</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">nose</span>
    <span class="n">nose</span><span class="o">.</span><span class="n">runmodule</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[</span><span class="vm">__file__</span><span class="p">,</span> <span class="s1">&#39;-vvs&#39;</span><span class="p">,</span> <span class="s1">&#39;-x&#39;</span><span class="p">,</span> <span class="s1">&#39;--pdb&#39;</span><span class="p">],</span> <span class="nb">exit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>The main workhorse is the <cite>CheckDiscreteResults</cite> class. Notice that we can set the level of precision
for <cite>tvalues</cite> to be different than the default in the subclass  <cite>TestProbitNewton</cite>. All of the test
classes have a <cite>setupClass</cite> <a class="reference external" href="https://docs.python.org/3.2/library/functions.html#classmethod" title="(in Python v3.2)"><code class="docutils literal notranslate"><span class="pre">classmethod</span></code></a>. Otherwise, Nose would reinstantiate the class
before every single test method. If the fitting of the model is time consuming, then this is clearly
undesirable. Finally, we have a script at the bottom so that we can run the tests should be running
the Python file.</p>
</div>
<div class="section" id="test-results">
<h2>Test Results<a class="headerlink" href="#test-results" title="Permalink to this headline">¶</a></h2>
<p>The test results are the final piece of the above example. For many tests, especially those for the
models, there are many results against which you would like to test. It makes sense then to separate
the hard-coded results from the actual tests to make the tests more readable. If there are only a few
results it’s not necessary to separate the results. We often take results from some other statistical
package. It is important to document where you got the results from and why they might differ from
the results that we get. Each tests folder has a results subdirectory. Consider the folder structure
for the discrete models:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tests</span><span class="o">/</span>
    <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
    <span class="n">test_discrete</span><span class="o">.</span><span class="n">py</span>
    <span class="n">results</span><span class="o">/</span>
        <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
        <span class="n">results_discrete</span><span class="o">.</span><span class="n">py</span>
        <span class="n">nbinom_resids</span><span class="o">.</span><span class="n">csv</span>
</pre></div>
</div>
<p>It is up to you how best to structure the results. In the discrete model example, you will notice
that there are result classes based around particular datasets with a method for loading different
model results for that dataset. You can also include text files that hold results to be loaded by
results classes if it is easier than putting them in the class itself.</p>
</div>
</div>





          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Testing</a><ul>
<li><a class="reference internal" href="#test-driven-development">Test Driven Development</a></li>
<li><a class="reference internal" href="#introduction-to-nose">Introduction to Nose</a></li>
<li><a class="reference internal" href="#running-the-test-suite">Running the Test Suite</a></li>
<li><a class="reference internal" href="#how-to-write-a-test">How To Write A Test</a></li>
<li><a class="reference internal" href="#test-results">Test Results</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="maintainer_notes.html"
                        title="previous chapter">Maintainer Notes</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="naming_conventions.html"
                        title="next chapter">Naming Conventions</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/dev/test_notes.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2009-2017, Josef Perktold, Skipper Seabold, Jonathan Taylor, statsmodels-developers.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.4.
    </div>
  </body>
</html>