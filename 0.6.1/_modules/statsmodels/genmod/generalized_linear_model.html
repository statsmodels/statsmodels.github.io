
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>statsmodels.genmod.generalized_linear_model &mdash; statsmodels 0.6.1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.6.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/statsmodels_hybi_favico.ico"/>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="top" title="statsmodels 0.6.1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" />
<link rel="stylesheet" href="../../_static/facebox.css" type="text/css" />
<link rel="stylesheet" href="../_static/examples.css" type="text/css" />
<script type="text/javascript" src="../../../_static/scripts.js">
</script>
<script type="text/javascript" src="../../../_static/facebox.js">
</script>

  </head>
  <body role="document">
<div class="headerwrap">
    <div class = "header">
        
        <a href = "../../../index.html">
<img src="../../../_static/statsmodels_hybi_banner.png" alt="Logo"
    style="padding-left: 15px"/></a>
        
    </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
<li><a href ="../../../install.html">Install</a></li> &nbsp;|&nbsp;
<li><a href="https://groups.google.com/group/pystatsmodels?hl=en">Support</a></li> &nbsp;|&nbsp;
<li><a href="https://github.com/statsmodels/statsmodels/issues">Bugs</a></li> &nbsp;|&nbsp;
<li><a href="../../../dev/index.html">Develop</a></li> &nbsp;|&nbsp;
<li><a href="../../../examples/index.html">Examples</a></li> &nbsp;|&nbsp;
<li><a href="../../../faq.html">FAQ</a></li> &nbsp;|&nbsp;

          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> |</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            




  <h1>Source code for statsmodels.genmod.generalized_linear_model</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Generalized linear models currently supports estimation using the one-parameter</span>
<span class="sd">exponential families</span>

<span class="sd">References</span>
<span class="sd">----------</span>
<span class="sd">Gill, Jeff. 2000. Generalized Linear Models: A Unified Approach.</span>
<span class="sd">    SAGE QASS Series.</span>

<span class="sd">Green, PJ. 1984.  &quot;Iteratively reweighted least squares for maximum</span>
<span class="sd">    likelihood estimation, and some robust and resistant alternatives.&quot;</span>
<span class="sd">    Journal of the Royal Statistical Society, Series B, 46, 149-192.</span>

<span class="sd">Hardin, J.W. and Hilbe, J.M. 2007.  &quot;Generalized Linear Models and</span>
<span class="sd">    Extensions.&quot;  2nd ed.  Stata Press, College Station, TX.</span>

<span class="sd">McCullagh, P. and Nelder, J.A.  1989.  &quot;Generalized Linear Models.&quot; 2nd ed.</span>
<span class="sd">    Chapman &amp; Hall, Boca Rotan.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">families</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools.decorators</span> <span class="kn">import</span> <span class="n">cache_readonly</span><span class="p">,</span> <span class="n">resettable_cache</span>

<span class="kn">import</span> <span class="nn">statsmodels.base.model</span> <span class="kn">as</span> <span class="nn">base</span>
<span class="kn">import</span> <span class="nn">statsmodels.regression.linear_model</span> <span class="kn">as</span> <span class="nn">lm</span>
<span class="kn">import</span> <span class="nn">statsmodels.base.wrapper</span> <span class="kn">as</span> <span class="nn">wrap</span>
<span class="kn">from</span> <span class="nn">statsmodels.compat.numpy</span> <span class="kn">import</span> <span class="n">np_matrix_rank</span>

<span class="kn">from</span> <span class="nn">statsmodels.tools.sm_exceptions</span> <span class="kn">import</span> <span class="n">PerfectSeparationError</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;GLM&#39;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_check_convergence</span><span class="p">(</span><span class="n">criterion</span><span class="p">,</span> <span class="n">iteration</span><span class="p">,</span> <span class="n">tol</span><span class="p">):</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">criterion</span><span class="p">[</span><span class="n">iteration</span><span class="p">]</span> <span class="o">-</span> <span class="n">criterion</span><span class="p">[</span><span class="n">iteration</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">)</span>


<div class="viewcode-block" id="GLM"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLM.html#statsmodels.genmod.generalized_linear_model.GLM">[docs]</a><span class="k">class</span> <span class="nc">GLM</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">LikelihoodModel</span><span class="p">):</span>
    <span class="n">__doc__</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    Generalized Linear Models class</span>

<span class="s">    GLM inherits from statsmodels.base.model.LikelihoodModel</span>

<span class="s">    Parameters</span>
<span class="s">    -----------</span>
<span class="s">    endog : array-like</span>
<span class="s">        1d array of endogenous response variable.  This array can be 1d or 2d.</span>
<span class="s">        Binomial family models accept a 2d array with two columns. If</span>
<span class="s">        supplied, each observation is expected to be [success, failure].</span>
<span class="s">    exog : array-like</span>
<span class="s">        A nobs x k array where `nobs` is the number of observations and `k`</span>
<span class="s">        is the number of regressors. An intercept is not included by default</span>
<span class="s">        and should be added by the user (models specified using a formula</span>
<span class="s">        include an intercept by default). See `statsmodels.tools.add_constant`.</span>
<span class="s">    family : family class instance</span>
<span class="s">        The default is Gaussian.  To specify the binomial distribution</span>
<span class="s">        family = sm.family.Binomial()</span>
<span class="s">        Each family can take a link instance as an argument.  See</span>
<span class="s">        statsmodels.family.family for more information.</span>
<span class="s">    </span><span class="si">%(extra_params)s</span><span class="s"></span>

<span class="s">    Attributes</span>
<span class="s">    -----------</span>
<span class="s">    df_model : float</span>
<span class="s">        `p` - 1, where `p` is the number of regressors including the intercept.</span>
<span class="s">    df_resid : float</span>
<span class="s">        The number of observation `n` minus the number of regressors `p`.</span>
<span class="s">    endog : array</span>
<span class="s">        See Parameters.</span>
<span class="s">    exog : array</span>
<span class="s">        See Parameters.</span>
<span class="s">    family : family class instance</span>
<span class="s">        A pointer to the distribution family of the model.</span>
<span class="s">    mu : array</span>
<span class="s">        The estimated mean response of the transformed variable.</span>
<span class="s">    normalized_cov_params : array</span>
<span class="s">        `p` x `p` normalized covariance of the design / exogenous data.</span>
<span class="s">    pinv_wexog : array</span>
<span class="s">        For GLM this is just the pseudo inverse of the original design.</span>
<span class="s">    scale : float</span>
<span class="s">        The estimate of the scale / dispersion.  Available after fit is called.</span>
<span class="s">    scaletype : str</span>
<span class="s">        The scaling used for fitting the model.  Available after fit is called.</span>
<span class="s">    weights : array</span>
<span class="s">        The value of the weights after the last iteration of fit.</span>

<span class="s">    Examples</span>
<span class="s">    --------</span>
<span class="s">    &gt;&gt;&gt; import statsmodels.api as sm</span>
<span class="s">    &gt;&gt;&gt; data = sm.datasets.scotland.load()</span>
<span class="s">    &gt;&gt;&gt; data.exog = sm.add_constant(data.exog)</span>

<span class="s">    Instantiate a gamma family model with the default link function.</span>

<span class="s">    &gt;&gt;&gt; gamma_model = sm.GLM(data.endog, data.exog,</span>
<span class="s">    ...                      family=sm.families.Gamma())</span>

<span class="s">    &gt;&gt;&gt; gamma_results = gamma_model.fit()</span>
<span class="s">    &gt;&gt;&gt; gamma_results.params</span>
<span class="s">    array([-0.01776527,  0.00004962,  0.00203442, -0.00007181,  0.00011185,</span>
<span class="s">           -0.00000015, -0.00051868, -0.00000243])</span>
<span class="s">    &gt;&gt;&gt; gamma_results.scale</span>
<span class="s">    0.0035842831734919055</span>
<span class="s">    &gt;&gt;&gt; gamma_results.deviance</span>
<span class="s">    0.087388516416999198</span>
<span class="s">    &gt;&gt;&gt; gamma_results.pearson_chi2</span>
<span class="s">    0.086022796163805704</span>
<span class="s">    &gt;&gt;&gt; gamma_results.llf</span>
<span class="s">    -83.017202161073527</span>

<span class="s">    See also</span>
<span class="s">    --------</span>
<span class="s">    statsmodels.genmod.families.family</span>
<span class="s">    :ref:`families`</span>
<span class="s">    :ref:`links`</span>

<span class="s">    Notes</span>
<span class="s">    -----</span>
<span class="s">    Only the following combinations make sense for family and link ::</span>

<span class="s">                   + ident log logit probit cloglog pow opow nbinom loglog logc</span>
<span class="s">      Gaussian     |   x    x                        x</span>
<span class="s">      inv Gaussian |   x    x                        x</span>
<span class="s">      binomial     |   x    x    x     x       x     x    x           x      x</span>
<span class="s">      Poission     |   x    x                        x</span>
<span class="s">      neg binomial |   x    x                        x          x</span>
<span class="s">      gamma        |   x    x                        x</span>

<span class="s">    Not all of these link functions are currently available.</span>

<span class="s">    Endog and exog are references so that if the data they refer to are already</span>
<span class="s">    arrays and these arrays are changed, endog and exog will change.</span>


<span class="s">    **Attributes**</span>

<span class="s">    df_model : float</span>
<span class="s">        Model degrees of freedom is equal to p - 1, where p is the number</span>
<span class="s">        of regressors.  Note that the intercept is not reported as a</span>
<span class="s">        degree of freedom.</span>
<span class="s">    df_resid : float</span>
<span class="s">        Residual degrees of freedom is equal to the number of observation n</span>
<span class="s">        minus the number of regressors p.</span>
<span class="s">    endog : array</span>
<span class="s">        See above.  Note that endog is a reference to the data so that if</span>
<span class="s">        data is already an array and it is changed, then `endog` changes</span>
<span class="s">        as well.</span>
<span class="s">    exposure : array-like</span>
<span class="s">        Include ln(exposure) in model with coefficient constrained to 1. Can</span>
<span class="s">        only be used if the link is the logarithm function.</span>
<span class="s">    exog : array</span>
<span class="s">        See above.  Note that endog is a reference to the data so that if</span>
<span class="s">        data is already an array and it is changed, then `endog` changes</span>
<span class="s">        as well.</span>
<span class="s">    iteration : int</span>
<span class="s">        The number of iterations that fit has run.  Initialized at 0.</span>
<span class="s">    family : family class instance</span>
<span class="s">        The distribution family of the model. Can be any family in</span>
<span class="s">        statsmodels.families.  Default is Gaussian.</span>
<span class="s">    mu : array</span>
<span class="s">        The mean response of the transformed variable.  `mu` is the value of</span>
<span class="s">        the inverse of the link function at lin_pred, where lin_pred is the linear</span>
<span class="s">        predicted value of the WLS fit of the transformed variable.  `mu` is</span>
<span class="s">        only available after fit is called.  See</span>
<span class="s">        statsmodels.families.family.fitted of the distribution family for more</span>
<span class="s">        information.</span>
<span class="s">    normalized_cov_params : array</span>
<span class="s">        The p x p normalized covariance of the design / exogenous data.</span>
<span class="s">        This is approximately equal to (X.T X)^(-1)</span>
<span class="s">    offset : array-like</span>
<span class="s">        Include offset in model with coefficient constrained to 1.</span>
<span class="s">    pinv_wexog : array</span>
<span class="s">        The pseudoinverse of the design / exogenous data array.  Note that</span>
<span class="s">        GLM has no whiten method, so this is just the pseudo inverse of the</span>
<span class="s">        design.</span>
<span class="s">        The pseudoinverse is approximately equal to (X.T X)^(-1)X.T</span>
<span class="s">    scale : float</span>
<span class="s">        The estimate of the scale / dispersion of the model fit.  Only</span>
<span class="s">        available after fit is called.  See GLM.fit and GLM.estimate_scale</span>
<span class="s">        for more information.</span>
<span class="s">    scaletype : str</span>
<span class="s">        The scaling used for fitting the model.  This is only available after</span>
<span class="s">        fit is called.  The default is None.  See GLM.fit for more information.</span>
<span class="s">    weights : array</span>
<span class="s">        The value of the weights after the last iteration of fit.  Only</span>
<span class="s">        available after fit is called.  See statsmodels.families.family for</span>
<span class="s">        the specific distribution weighting functions.</span>
<span class="s">    &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">{</span><span class="s">&#39;extra_params&#39;</span> <span class="p">:</span> <span class="n">base</span><span class="o">.</span><span class="n">_missing_param_doc</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">exposure</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">missing</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">exposure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">exposure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">exposure</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>  <span class="c"># this should probably be done upstream</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GLM</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="n">missing</span><span class="p">,</span>
                                  <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">exposure</span><span class="o">=</span><span class="n">exposure</span><span class="p">,</span>
                                  <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_inputs</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exposure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;offset&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exposure</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;exposure&#39;</span><span class="p">)</span>
        <span class="c">#things to remove_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_attr</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&#39;weights&#39;</span><span class="p">,</span> <span class="s">&#39;pinv_wexog&#39;</span><span class="p">,</span> <span class="s">&#39;mu&#39;</span><span class="p">,</span> <span class="s">&#39;data_weights&#39;</span><span class="p">,</span>
                                <span class="s">&#39;_offset_exposure&#39;</span><span class="p">])</span>
        <span class="c"># register kwds for __init__, offset and exposure are added by super</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;family&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="GLM.initialize"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLM.initialize.html#statsmodels.genmod.generalized_linear_model.GLM.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a generalized linear model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#TODO: intended for public use?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;fittedvalues&#39;</span> <span class="p">:</span> <span class="p">[],</span>
                        <span class="s">&#39;params&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span>
                        <span class="s">&#39;deviance&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pinv_wexog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalized_cov_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pinv_wexog</span><span class="p">,</span>
                                            <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pinv_wexog</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df_model</span> <span class="o">=</span> <span class="n">np_matrix_rank</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_resid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">np_matrix_rank</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_check_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">family</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">exposure</span><span class="p">,</span> <span class="n">endog</span><span class="p">):</span>

        <span class="c"># Default family is Gaussian</span>
        <span class="k">if</span> <span class="n">family</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">family</span> <span class="o">=</span> <span class="n">families</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">family</span> <span class="o">=</span> <span class="n">family</span>

        <span class="k">if</span> <span class="n">exposure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">link</span><span class="p">,</span> <span class="n">families</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">Log</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;exposure can only be used with the log &quot;</span>
                                 <span class="s">&quot;link function&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">exposure</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">endog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;exposure is not the same length as endog&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">offset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">endog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;offset is not the same length as endog&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="GLM.loglike"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLM.loglike.html#statsmodels.genmod.generalized_linear_model.GLM.loglike">[docs]</a>    <span class="k">def</span> <span class="nf">loglike</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loglikelihood function.</span>

<span class="sd">        Each distribution family has its own loglikelihood function.</span>
<span class="sd">        See statsmodels.families.family</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">loglike</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GLM.score_obs"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLM.score_obs.html#statsmodels.genmod.generalized_linear_model.GLM.score_obs">[docs]</a>    <span class="k">def</span> <span class="nf">score_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;score first derivative of the loglikelihood for each observation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : ndarray</span>
<span class="sd">            parameter at which score is evaluated</span>
<span class="sd">        scale : None or float</span>
<span class="sd">            If scale is None, then the default scale will be calculated.</span>
<span class="sd">            Default scale is defined by `self.scaletype` and set in fit.</span>
<span class="sd">            If scale is not None, then it is used as a fixed scale.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        score_obs : ndarray, 2d</span>
<span class="sd">            The first derivative of the loglikelihood function evaluated at</span>
<span class="sd">            params for each observation.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">score_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_factor</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">score_factor</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>

</div>
<div class="viewcode-block" id="GLM.score"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLM.score.html#statsmodels.genmod.generalized_linear_model.GLM.score">[docs]</a>    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;score, first derivative of the loglikelihood function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : ndarray</span>
<span class="sd">            parameter at which score is evaluated</span>
<span class="sd">        scale : None or float</span>
<span class="sd">            If scale is None, then the default scale will be calculated.</span>
<span class="sd">            Default scale is defined by `self.scaletype` and set in fit.</span>
<span class="sd">            If scale is not None, then it is used as a fixed scale.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        score : ndarray_1d</span>
<span class="sd">            The first derivative of the loglikelihood function calculated as</span>
<span class="sd">            the sum of `score_obs`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_obs</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GLM.score_factor"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLM.score_factor.html#statsmodels.genmod.generalized_linear_model.GLM.score_factor">[docs]</a>    <span class="k">def</span> <span class="nf">score_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;weights for score for each observation</span>

<span class="sd">        This can be considered as score residuals.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : ndarray</span>
<span class="sd">            parameter at which Hessian is evaluated</span>
<span class="sd">        scale : None or float</span>
<span class="sd">            If scale is None, then the default scale will be calculated.</span>
<span class="sd">            Default scale is defined by `self.scaletype` and set in fit.</span>
<span class="sd">            If scale is not None, then it is used as a fixed scale.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        score_factor : ndarray_1d</span>
<span class="sd">            A 1d weight vector used in the calculation of the score_obs.</span>
<span class="sd">            The score_obs are obtained by `score_factor[:, None] * exog`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_scale</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>

        <span class="n">score_factor</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">deriv</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
        <span class="n">score_factor</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">variance</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
        <span class="n">score_factor</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_weights</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">scale</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">score_factor</span> <span class="o">/=</span> <span class="n">scale</span>

        <span class="k">return</span> <span class="n">score_factor</span>

</div>
<div class="viewcode-block" id="GLM.hessian_factor"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLM.hessian_factor.html#statsmodels.genmod.generalized_linear_model.GLM.hessian_factor">[docs]</a>    <span class="k">def</span> <span class="nf">hessian_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Weights for calculating Hessian</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : ndarray</span>
<span class="sd">            parameter at which Hessian is evaluated</span>
<span class="sd">        scale : None or float</span>
<span class="sd">            If scale is None, then the default scale will be calculated.</span>
<span class="sd">            Default scale is defined by `self.scaletype` and set in fit.</span>
<span class="sd">            If scale is not None, then it is used as a fixed scale.</span>
<span class="sd">        observed : bool</span>
<span class="sd">            If True, then the observed Hessian is returned. If false then the</span>
<span class="sd">            expected information matrix is returned.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        hessian_factor : ndarray, 1d</span>
<span class="sd">            A 1d weight vector used in the calculation of the Hessian.</span>
<span class="sd">            The hessian is obtained by `(exog.T * hessian_factor).dot(exog)`</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># calculating eim_factor</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_scale</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>

        <span class="n">eim_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">deriv</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">variance</span><span class="p">(</span><span class="n">mu</span><span class="p">))</span>
        <span class="n">eim_factor</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_weights</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">observed</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">scale</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">eim_factor</span> <span class="o">/=</span> <span class="n">scale</span>
            <span class="k">return</span> <span class="n">eim_factor</span>

        <span class="c"># calculating oim_factor, eim_factor is with scale=1</span>

        <span class="n">score_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_factor</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">eim_factor</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">score_factor</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;something wrong&#39;</span><span class="p">)</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">variance</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">deriv2</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
        <span class="n">tmp</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">deriv</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">deriv</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="n">score_factor</span> <span class="o">*</span> <span class="n">eim_factor</span> <span class="o">*</span> <span class="n">tmp</span>
        <span class="c"># correct for duplicatee data_weights in oim_factor and score_factor</span>
        <span class="n">tmp</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_weights</span>
        <span class="n">oim_factor</span> <span class="o">=</span> <span class="n">eim_factor</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">tmp</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tmp</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;something wrong&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">scale</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">oim_factor</span> <span class="o">/=</span> <span class="n">scale</span>

        <span class="k">return</span> <span class="n">oim_factor</span>

</div>
<div class="viewcode-block" id="GLM.hessian"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLM.hessian.html#statsmodels.genmod.generalized_linear_model.GLM.hessian">[docs]</a>    <span class="k">def</span> <span class="nf">hessian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Hessian, second derivative of loglikelihood function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : ndarray</span>
<span class="sd">            parameter at which Hessian is evaluated</span>
<span class="sd">        scale : None or float</span>
<span class="sd">            If scale is None, then the default scale will be calculated.</span>
<span class="sd">            Default scale is defined by `self.scaletype` and set in fit.</span>
<span class="sd">            If scale is not None, then it is used as a fixed scale.</span>
<span class="sd">        observed : bool</span>
<span class="sd">            If True, then the observed Hessian is returned. If false then the</span>
<span class="sd">            expected information matrix is returned.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        hessian : ndarray</span>
<span class="sd">            Hessian, i.e. observed information, or expected information matrix.</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hessian_factor</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">)</span>
        <span class="n">hess</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">factor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">hess</span>

</div>
<div class="viewcode-block" id="GLM.information"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLM.information.html#statsmodels.genmod.generalized_linear_model.GLM.information">[docs]</a>    <span class="k">def</span> <span class="nf">information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fisher information matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hessian</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GLM.score_test"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLM.score_test.html#statsmodels.genmod.generalized_linear_model.GLM.score_test">[docs]</a>    <span class="k">def</span> <span class="nf">score_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params_constrained</span><span class="p">,</span> <span class="n">k_constraints</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                   <span class="n">exog_extra</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;score test for restrictions or for omitted variables</span>

<span class="sd">        The covariance matrix for the score is based on the Hessian, i.e.</span>
<span class="sd">        observed information matrix or optionally on the expected information</span>
<span class="sd">        matrix..</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params_constrained : array_like</span>
<span class="sd">            estimated parameter of the restricted model. This can be the</span>
<span class="sd">            parameter estimate for the current when testing for omitted</span>
<span class="sd">            variables.</span>
<span class="sd">        k_constraints : int or None</span>
<span class="sd">            Number of constraints that were used in the estimation of params</span>
<span class="sd">            restricted relative to the number of exog in the model.</span>
<span class="sd">            This must be provided if no exog_extra are given. If exog_extra is</span>
<span class="sd">            not None, then k_constraints is assumed to be zero if it is None.</span>
<span class="sd">        exog_extra : None or array_like</span>
<span class="sd">            Explanatory variables that are jointly tested for inclusion in the</span>
<span class="sd">            model, i.e. omitted variables.</span>
<span class="sd">        observed : bool</span>
<span class="sd">            If True, then the observed Hessian is used in calculating the</span>
<span class="sd">            covariance matrix of the score. If false then the expected</span>
<span class="sd">            information matrix is used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        chi2_stat : float</span>
<span class="sd">            chisquare statistic for the score test</span>
<span class="sd">        p-value : float</span>
<span class="sd">            P-value of the score test based on the chisquare distribution.</span>
<span class="sd">        df : int</span>
<span class="sd">            Degrees of freedom used in the p-value calculation. This is equal</span>
<span class="sd">            to the number of constraints.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        not yet verified for case with scale not equal to 1.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">exog_extra</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k_constraints</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;if exog_extra is None, then k_constraints&#39;</span>
                                 <span class="s">&#39;needs to be given&#39;</span><span class="p">)</span>

            <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">params_constrained</span><span class="p">)</span>
            <span class="n">hessian</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hessian</span><span class="p">(</span><span class="n">params_constrained</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c">#exog_extra = np.asarray(exog_extra)</span>
            <span class="k">if</span> <span class="n">k_constraints</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">k_constraints</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span> <span class="n">exog_extra</span><span class="p">))</span>
            <span class="n">k_constraints</span> <span class="o">+=</span> <span class="n">ex</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">score_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_factor</span><span class="p">(</span><span class="n">params_constrained</span><span class="p">)</span>
            <span class="n">score</span> <span class="o">=</span> <span class="p">(</span><span class="n">score_factor</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">ex</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">hessian_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hessian_factor</span><span class="p">(</span><span class="n">params_constrained</span><span class="p">,</span>
                                                 <span class="n">observed</span><span class="o">=</span><span class="n">observed</span><span class="p">)</span>
            <span class="n">hessian</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">hessian_factor</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>


        <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
        <span class="c"># TODO check sign, why minus?</span>
        <span class="n">chi2stat</span> <span class="o">=</span> <span class="o">-</span><span class="n">score</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">hessian</span><span class="p">,</span> <span class="n">score</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">]))</span>
        <span class="n">pval</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">chi2stat</span><span class="p">,</span> <span class="n">k_constraints</span><span class="p">)</span>
        <span class="c"># return a stats results instance instead?  Contrast?</span>
        <span class="k">return</span> <span class="n">chi2stat</span><span class="p">,</span> <span class="n">pval</span><span class="p">,</span> <span class="n">k_constraints</span>

</div>
    <span class="k">def</span> <span class="nf">_update_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp_result</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">history</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method to update history during iterative fit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">history</span><span class="p">[</span><span class="s">&#39;params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_result</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
        <span class="n">history</span><span class="p">[</span><span class="s">&#39;deviance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">deviance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">,</span> <span class="n">mu</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">history</span>

<div class="viewcode-block" id="GLM.estimate_scale"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLM.estimate_scale.html#statsmodels.genmod.generalized_linear_model.GLM.estimate_scale">[docs]</a>    <span class="k">def</span> <span class="nf">estimate_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimates the dispersion/scale.</span>

<span class="sd">        Type of scale can be chose in the fit method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mu : array</span>
<span class="sd">            mu is the mean response estimate</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Estimate of scale</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The default scale for Binomial and Poisson families is 1.  The default</span>
<span class="sd">        for the other families is Pearson&#39;s Chi-Square estimate.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        statsmodels.glm.fit for more information</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaletype</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="p">,</span> <span class="p">(</span><span class="n">families</span><span class="o">.</span><span class="n">Binomial</span><span class="p">,</span> <span class="n">families</span><span class="o">.</span><span class="n">Poisson</span><span class="p">)):</span>
                <span class="k">return</span> <span class="mf">1.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">resid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">-</span> <span class="n">mu</span>
                <span class="k">return</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">resid</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">variance</span><span class="p">(</span><span class="n">mu</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                        <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_resid</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scaletype</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scaletype</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scaletype</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaletype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;x2&#39;</span><span class="p">:</span>
                <span class="n">resid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">-</span> <span class="n">mu</span>
                <span class="k">return</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">resid</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">variance</span><span class="p">(</span><span class="n">mu</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                        <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_resid</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaletype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;dev&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">deviance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">,</span> <span class="n">mu</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">df_resid</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Scale </span><span class="si">%s</span><span class="s"> with type </span><span class="si">%s</span><span class="s"> not understood&quot;</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scaletype</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scaletype</span><span class="p">)))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Scale </span><span class="si">%s</span><span class="s"> with type </span><span class="si">%s</span><span class="s"> not understood&quot;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scaletype</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scaletype</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="GLM.predict"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLM.predict.html#statsmodels.genmod.generalized_linear_model.GLM.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">exposure</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">linear</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return predicted values for a design matrix</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : array-like</span>
<span class="sd">            Parameters / coefficients of a GLM.</span>
<span class="sd">        exog : array-like, optional</span>
<span class="sd">            Design / exogenous data. Is exog is None, model exog is used.</span>
<span class="sd">        exposure : array-like, optional</span>
<span class="sd">            Exposure time values, only can be used with the log link</span>
<span class="sd">            function.  See notes for details.</span>
<span class="sd">        offset : array-like, optional</span>
<span class="sd">            Offset values.  See notes for details.</span>
<span class="sd">        linear : bool</span>
<span class="sd">            If True, returns the linear predicted values.  If False,</span>
<span class="sd">            returns the value of the inverse of the model&#39;s link function at</span>
<span class="sd">            the linear predicted values.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        An array of fitted values</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Any `exposure` and `offset` provided here take precedence over</span>
<span class="sd">        the `exposure` and `offset` used in the model fit.  If `exog`</span>
<span class="sd">        is passed as an argument here, then any `exposure` and</span>
<span class="sd">        `offset` values in the fit will be ignored.</span>

<span class="sd">        Exposure values must be strictly positive.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Use fit offset if appropriate</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">exog</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;offset&#39;</span><span class="p">):</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;offset&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">offset</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="k">if</span> <span class="n">exposure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">link</span><span class="p">,</span>
                                                   <span class="n">families</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">Log</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;exposure can only be used with the log link function&quot;</span><span class="p">)</span>

        <span class="c"># Use fit exposure if appropriate</span>
        <span class="k">if</span> <span class="n">exposure</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">exog</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;exposure&#39;</span><span class="p">):</span>
            <span class="c"># Already logged</span>
            <span class="n">exposure</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;exposure&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">exposure</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">exposure</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exposure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">exposure</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>

        <span class="n">linpred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">exposure</span>
        <span class="k">if</span> <span class="n">linear</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">linpred</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">fitted</span><span class="p">(</span><span class="n">linpred</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GLM.fit"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLM.fit.html#statsmodels.genmod.generalized_linear_model.GLM.fit">[docs]</a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;IRLS&#39;</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cov_type</span><span class="o">=</span><span class="s">&#39;nonrobust&#39;</span><span class="p">,</span> <span class="n">cov_kwds</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">use_t</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fits a generalized linear model for a given family.</span>

<span class="sd">        parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        maxiter : int, optional</span>
<span class="sd">            Default is 100.</span>
<span class="sd">        method : string</span>
<span class="sd">            Default is &#39;IRLS&#39; for iteratively reweighted least squares.  This</span>
<span class="sd">            is currently the only method available for GLM fit.</span>
<span class="sd">        scale : string or float, optional</span>
<span class="sd">            `scale` can be &#39;X2&#39;, &#39;dev&#39;, or a float</span>
<span class="sd">            The default value is None, which uses `X2` for Gamma, Gaussian,</span>
<span class="sd">            and Inverse Gaussian.</span>
<span class="sd">            `X2` is Pearson&#39;s chi-square divided by `df_resid`.</span>
<span class="sd">            The default is 1 for the Binomial and Poisson families.</span>
<span class="sd">            `dev` is the deviance divided by df_resid</span>
<span class="sd">        tol : float</span>
<span class="sd">            Convergence tolerance.  Default is 1e-8.</span>
<span class="sd">        start_params : array-like, optional</span>
<span class="sd">            Initial guess of the solution for the loglikelihood maximization.</span>
<span class="sd">            The default is family-specific and is given by the</span>
<span class="sd">            ``family.starting_mu(endog)``. If start_params is given then the</span>
<span class="sd">            initial mean will be calculated as ``np.dot(exog, start_params)``.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This method does not take any extra undocumented ``kwargs``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span>
        <span class="k">if</span> <span class="n">endog</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">endog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">data_weights</span> <span class="o">=</span> <span class="n">endog</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># weights are total trials</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">endog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_weights</span> <span class="o">=</span> <span class="n">data_weights</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_weights</span><span class="p">)</span> <span class="o">==</span> <span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_weights</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_weights</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">endog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaletype</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="p">,</span> <span class="n">families</span><span class="o">.</span><span class="n">Binomial</span><span class="p">):</span>
        <span class="c"># this checks what kind of data is given for Binomial.</span>
        <span class="c"># family will need a reference to endog if this is to be removed from</span>
        <span class="c"># preprocessing</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">)</span>

        <span class="c"># Construct a combined offset/exposure term.  Note that</span>
        <span class="c"># exposure has already been logged if present.</span>
        <span class="n">offset_exposure</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;offset&#39;</span><span class="p">):</span>
            <span class="n">offset_exposure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;exposure&#39;</span><span class="p">):</span>
            <span class="n">offset_exposure</span> <span class="o">=</span> <span class="n">offset_exposure</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">exposure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_offset_exposure</span> <span class="o">=</span> <span class="n">offset_exposure</span>

        <span class="n">wlsexog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span>
        <span class="k">if</span> <span class="n">start_params</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">starting_mu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">)</span>
            <span class="n">lin_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lin_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">wlsexog</span><span class="p">,</span> <span class="n">start_params</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset_exposure</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">fitted</span><span class="p">(</span><span class="n">lin_pred</span><span class="p">)</span>
        <span class="n">dev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">deviance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">,</span> <span class="n">mu</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dev</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;The first guess on the deviance function &quot;</span>
                             <span class="s">&quot;returned a nan.  This could be a boundary &quot;</span>
                             <span class="s">&quot; problem and should be reported.&quot;</span><span class="p">)</span>

        <span class="c"># first guess on the deviance is assumed to be scaled by 1.</span>
        <span class="c"># params are none to start, so they line up with the deviance</span>
        <span class="n">history</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="n">start_params</span><span class="p">],</span> <span class="n">deviance</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">dev</span><span class="p">])</span>
        <span class="n">converged</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">criterion</span> <span class="o">=</span> <span class="n">history</span><span class="p">[</span><span class="s">&#39;deviance&#39;</span><span class="p">]</span>
        <span class="c"># This special case is used to get the likelihood for a specific</span>
        <span class="c"># params vector.</span>
        <span class="k">if</span> <span class="n">maxiter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">fitted</span><span class="p">(</span><span class="n">lin_pred</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_scale</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
            <span class="n">wls_results</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">RegressionResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_params</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="n">iteration</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxiter</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">data_weights</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">weights</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
            <span class="n">wlsendog</span> <span class="o">=</span> <span class="p">(</span><span class="n">lin_pred</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">deriv</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span>
                        <span class="o">-</span> <span class="n">offset_exposure</span><span class="p">)</span>
            <span class="n">wls_results</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">WLS</span><span class="p">(</span><span class="n">wlsendog</span><span class="p">,</span> <span class="n">wlsexog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
            <span class="n">lin_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span> <span class="n">wls_results</span><span class="o">.</span><span class="n">params</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset_exposure</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">fitted</span><span class="p">(</span><span class="n">lin_pred</span><span class="p">)</span>
            <span class="n">history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_history</span><span class="p">(</span><span class="n">wls_results</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">history</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_scale</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">endog</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">mu</span> <span class="o">-</span> <span class="n">endog</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Perfect separation detected, results not available&quot;</span>
                <span class="k">raise</span> <span class="n">PerfectSeparationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">converged</span> <span class="o">=</span> <span class="n">_check_convergence</span><span class="p">(</span><span class="n">criterion</span><span class="p">,</span> <span class="n">iteration</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">converged</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span>

        <span class="n">glm_results</span> <span class="o">=</span> <span class="n">GLMResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wls_results</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
                                 <span class="n">wls_results</span><span class="o">.</span><span class="n">normalized_cov_params</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span>
                                 <span class="n">cov_type</span><span class="o">=</span><span class="n">cov_type</span><span class="p">,</span> <span class="n">cov_kwds</span><span class="o">=</span><span class="n">cov_kwds</span><span class="p">,</span>
                                 <span class="n">use_t</span><span class="o">=</span><span class="n">use_t</span><span class="p">)</span>

        <span class="n">history</span><span class="p">[</span><span class="s">&#39;iteration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">iteration</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">glm_results</span><span class="o">.</span><span class="n">fit_history</span> <span class="o">=</span> <span class="n">history</span>
        <span class="k">return</span> <span class="n">GLMResultsWrapper</span><span class="p">(</span><span class="n">glm_results</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GLM.fit_constrained"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLM.fit_constrained.html#statsmodels.genmod.generalized_linear_model.GLM.fit_constrained">[docs]</a>    <span class="k">def</span> <span class="nf">fit_constrained</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraints</span><span class="p">,</span> <span class="n">start_params</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_kwds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;fit the model subject to linear equality constraints</span>

<span class="sd">        The constraints are of the form   `R params = q`</span>
<span class="sd">        where R is the constraint_matrix and q is the vector of</span>
<span class="sd">        constraint_values.</span>

<span class="sd">        The estimation creates a new model with transformed design matrix,</span>
<span class="sd">        exog, and converts the results back to the original parameterization.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        constraints : formula expression or tuple</span>
<span class="sd">            If it is a tuple, then the constraint needs to be given by two</span>
<span class="sd">            arrays (constraint_matrix, constraint_value), i.e. (R, q).</span>
<span class="sd">            Otherwise, the constraints can be given as strings or list of</span>
<span class="sd">            strings.</span>
<span class="sd">            see t_test for details</span>
<span class="sd">        start_params : None or array_like</span>
<span class="sd">            starting values for the optimization. `start_params` needs to be</span>
<span class="sd">            given in the original parameter space and are internally</span>
<span class="sd">            transformed.</span>
<span class="sd">        **fit_kwds : keyword arguments</span>
<span class="sd">            fit_kwds are used in the optimization of the transformed model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        results : Results instance</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">patsy</span> <span class="kn">import</span> <span class="n">DesignInfo</span>
        <span class="kn">from</span> <span class="nn">statsmodels.base._constraints</span> <span class="kn">import</span> <span class="n">fit_constrained</span>

        <span class="c"># same pattern as in base.LikelihoodModel.t_test</span>
        <span class="n">lc</span> <span class="o">=</span> <span class="n">DesignInfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exog_names</span><span class="p">)</span><span class="o">.</span><span class="n">linear_constraint</span><span class="p">(</span><span class="n">constraints</span><span class="p">)</span>
        <span class="n">R</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">lc</span><span class="o">.</span><span class="n">coefs</span><span class="p">,</span> <span class="n">lc</span><span class="o">.</span><span class="n">constants</span>

        <span class="c"># TODO: add start_params option, need access to tranformation</span>
        <span class="c">#       fit_constrained needs to do the transformation</span>
        <span class="n">params</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">res_constr</span> <span class="o">=</span> <span class="n">fit_constrained</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span>
                                                  <span class="n">start_params</span><span class="o">=</span><span class="n">start_params</span><span class="p">,</span>
                                                  <span class="n">fit_kwds</span><span class="o">=</span><span class="n">fit_kwds</span><span class="p">)</span>
        <span class="c">#create dummy results Instance, TODO: wire up properly</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">start_params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c"># we get a wrapper back</span>
        <span class="n">res</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">res</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">normalized_cov_params</span> <span class="o">=</span> <span class="n">cov</span>
        <span class="n">k_constr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">res</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">df_resid</span> <span class="o">+=</span> <span class="n">k_constr</span>
        <span class="n">res</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">df_model</span> <span class="o">-=</span> <span class="n">k_constr</span>
        <span class="n">res</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="n">lc</span>
        <span class="n">res</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">k_constr</span> <span class="o">=</span> <span class="n">k_constr</span>
        <span class="n">res</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">results_constrained</span> <span class="o">=</span> <span class="n">res_constr</span>
        <span class="c"># TODO: the next is not the best. history should bin in results</span>
        <span class="n">res</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="n">res_constr</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">history</span>
        <span class="n">res</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="n">res_constr</span><span class="o">.</span><span class="n">mu</span>
        <span class="k">return</span> <span class="n">res</span>

</div></div>
<div class="viewcode-block" id="GLMResults"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLMResults.html#statsmodels.genmod.generalized_linear_model.GLMResults">[docs]</a><span class="k">class</span> <span class="nc">GLMResults</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">LikelihoodModelResults</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to contain GLM results.</span>

<span class="sd">    GLMResults inherits from statsmodels.LikelihoodModelResults</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    See statsmodels.LikelihoodModelReesults</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    **Attributes**</span>

<span class="sd">    aic : float</span>
<span class="sd">        Akaike Information Criterion</span>
<span class="sd">        -2 * `llf` + 2*(`df_model` + 1)</span>
<span class="sd">    bic : float</span>
<span class="sd">        Bayes Information Criterion</span>
<span class="sd">        `deviance` - `df_resid` * log(`nobs`)</span>
<span class="sd">    deviance : float</span>
<span class="sd">        See statsmodels.families.family for the distribution-specific deviance</span>
<span class="sd">        functions.</span>
<span class="sd">    df_model : float</span>
<span class="sd">        See GLM.df_model</span>
<span class="sd">    df_resid : float</span>
<span class="sd">        See GLM.df_resid</span>
<span class="sd">    fit_history : dict</span>
<span class="sd">        Contains information about the iterations. Its keys are `iterations`,</span>
<span class="sd">        `deviance` and `params`.</span>
<span class="sd">    fittedvalues : array</span>
<span class="sd">        Linear predicted values for the fitted model.</span>
<span class="sd">        dot(exog, params)</span>
<span class="sd">    llf : float</span>
<span class="sd">        Value of the loglikelihood function evalued at params.</span>
<span class="sd">        See statsmodels.families.family for distribution-specific</span>
<span class="sd">        loglikelihoods.</span>
<span class="sd">    model : class instance</span>
<span class="sd">        Pointer to GLM model instance that called fit.</span>
<span class="sd">    mu : array</span>
<span class="sd">        See GLM docstring.</span>
<span class="sd">    nobs : float</span>
<span class="sd">        The number of observations n.</span>
<span class="sd">    normalized_cov_params : array</span>
<span class="sd">        See GLM docstring</span>
<span class="sd">    null_deviance : float</span>
<span class="sd">        The value of the deviance function for the model fit with a constant</span>
<span class="sd">        as the only regressor.</span>
<span class="sd">    params : array</span>
<span class="sd">        The coefficients of the fitted model.  Note that interpretation</span>
<span class="sd">        of the coefficients often depends on the distribution family and the</span>
<span class="sd">        data.</span>
<span class="sd">    pearson_chi2 : array</span>
<span class="sd">        Pearson&#39;s Chi-Squared statistic is defined as the sum of the squares</span>
<span class="sd">        of the Pearson residuals.</span>
<span class="sd">    pinv_wexog : array</span>
<span class="sd">        See GLM docstring.</span>
<span class="sd">    pvalues : array</span>
<span class="sd">        The two-tailed p-values for the parameters.</span>
<span class="sd">    resid_anscombe : array</span>
<span class="sd">        Anscombe residuals.  See statsmodels.families.family for distribution-</span>
<span class="sd">        specific Anscombe residuals.</span>
<span class="sd">    resid_deviance : array</span>
<span class="sd">        Deviance residuals.  See statsmodels.families.family for distribution-</span>
<span class="sd">        specific deviance residuals.</span>
<span class="sd">    resid_pearson : array</span>
<span class="sd">        Pearson residuals.  The Pearson residuals are defined as</span>
<span class="sd">        (`endog` - `mu`)/sqrt(VAR(`mu`)) where VAR is the distribution</span>
<span class="sd">        specific variance function.  See statsmodels.families.family and</span>
<span class="sd">        statsmodels.families.varfuncs for more information.</span>
<span class="sd">    resid_response : array</span>
<span class="sd">        Respnose residuals.  The response residuals are defined as</span>
<span class="sd">        `endog` - `fittedvalues`</span>
<span class="sd">    resid_working : array</span>
<span class="sd">        Working residuals.  The working residuals are defined as</span>
<span class="sd">        `resid_response`/link&#39;(`mu`).  See statsmodels.family.links for the</span>
<span class="sd">        derivatives of the link functions.  They are defined analytically.</span>
<span class="sd">    scale : float</span>
<span class="sd">        The estimate of the scale / dispersion for the model fit.</span>
<span class="sd">        See GLM.fit and GLM.estimate_scale for more information.</span>
<span class="sd">    stand_errors : array</span>
<span class="sd">        The standard errors of the fitted GLM.   #TODO still named bse</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    statsmodels.base.model.LikelihoodModelResults</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">normalized_cov_params</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span>
                 <span class="n">cov_type</span><span class="o">=</span><span class="s">&#39;nonrobust&#39;</span><span class="p">,</span> <span class="n">cov_kwds</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">use_t</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GLMResults</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span>
                                         <span class="n">normalized_cov_params</span><span class="o">=</span>
                                         <span class="n">normalized_cov_params</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">family</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">family</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_endog</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">endog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nobs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">endog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">mu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_weights</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">data_weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_resid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">df_resid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">df_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinv_wexog</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">pinv_wexog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span> <span class="o">=</span> <span class="n">resettable_cache</span><span class="p">()</span>
        <span class="c"># are these intermediate results needed or can we just</span>
        <span class="c"># call the model&#39;s attributes?</span>

        <span class="c"># for remove data and pickle without large arrays</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_attr</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&#39;results_constrained&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_in_cache</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;data_in_cache&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_in_cache</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&#39;null&#39;</span><span class="p">])</span>

        <span class="c"># robust covariance</span>
        <span class="kn">from</span> <span class="nn">statsmodels.base.covtype</span> <span class="kn">import</span> <span class="n">get_robustcov_results</span>
        <span class="k">if</span> <span class="n">use_t</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_t</span> <span class="o">=</span> <span class="bp">False</span>    <span class="c"># TODO: class default</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_t</span> <span class="o">=</span> <span class="n">use_t</span>
        <span class="k">if</span> <span class="n">cov_type</span> <span class="o">==</span> <span class="s">&#39;nonrobust&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cov_type</span> <span class="o">=</span> <span class="s">&#39;nonrobust&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cov_kwds</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;description&#39;</span> <span class="p">:</span> <span class="s">&#39;Standard Errors assume that the &#39;</span> <span class="o">+</span>
                             <span class="s">&#39;covariance matrix of the errors is correctly &#39;</span> <span class="o">+</span>
                             <span class="s">&#39;specified.&#39;</span><span class="p">}</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cov_kwds</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">cov_kwds</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">get_robustcov_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cov_type</span><span class="o">=</span><span class="n">cov_type</span><span class="p">,</span> <span class="n">use_self</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                       <span class="n">use_t</span><span class="o">=</span><span class="n">use_t</span><span class="p">,</span> <span class="o">**</span><span class="n">cov_kwds</span><span class="p">)</span>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="GLMResults.resid_response"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLMResults.resid_response.html#statsmodels.genmod.generalized_linear_model.GLMResults.resid_response">[docs]</a>    <span class="k">def</span> <span class="nf">resid_response</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_weights</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endog</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span>
</div>
    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="GLMResults.resid_pearson"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLMResults.resid_pearson.html#statsmodels.genmod.generalized_linear_model.GLMResults.resid_pearson">[docs]</a>    <span class="k">def</span> <span class="nf">resid_pearson</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_weights</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endog</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span> <span class="o">/</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">variance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">)))</span>
</div>
    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="GLMResults.resid_working"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLMResults.resid_working.html#statsmodels.genmod.generalized_linear_model.GLMResults.resid_working">[docs]</a>    <span class="k">def</span> <span class="nf">resid_working</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resid_response</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">deriv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">))</span>
        <span class="n">val</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_weights</span>
        <span class="k">return</span> <span class="n">val</span>
</div>
    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="GLMResults.resid_anscombe"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLMResults.resid_anscombe.html#statsmodels.genmod.generalized_linear_model.GLMResults.resid_anscombe">[docs]</a>    <span class="k">def</span> <span class="nf">resid_anscombe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">resid_anscombe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span>
</div>
    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="GLMResults.resid_deviance"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLMResults.resid_deviance.html#statsmodels.genmod.generalized_linear_model.GLMResults.resid_deviance">[docs]</a>    <span class="k">def</span> <span class="nf">resid_deviance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">resid_dev</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span>
</div>
    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="GLMResults.pearson_chi2"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLMResults.pearson_chi2.html#statsmodels.genmod.generalized_linear_model.GLMResults.pearson_chi2">[docs]</a>    <span class="k">def</span> <span class="nf">pearson_chi2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">chisq</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endog</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">variance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span>
        <span class="n">chisq</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_weights</span>
        <span class="n">chisqsum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">chisq</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">chisqsum</span>
</div>
    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="GLMResults.fittedvalues"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLMResults.fittedvalues.html#statsmodels.genmod.generalized_linear_model.GLMResults.fittedvalues">[docs]</a>    <span class="k">def</span> <span class="nf">fittedvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span>
</div>
    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="GLMResults.null"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLMResults.null.html#statsmodels.genmod.generalized_linear_model.GLMResults.null">[docs]</a>    <span class="k">def</span> <span class="nf">null</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">endog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endog</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="n">exog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">endog</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s">&#39;offset&#39;</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;offset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">offset</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s">&#39;exposure&#39;</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;exposure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">exposure</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">GLM</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">mu</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wls_model</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">WLS</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_weights</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">wls_model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">fittedvalues</span>
</div>
    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="GLMResults.deviance"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLMResults.deviance.html#statsmodels.genmod.generalized_linear_model.GLMResults.deviance">[docs]</a>    <span class="k">def</span> <span class="nf">deviance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">deviance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span>
</div>
    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="GLMResults.null_deviance"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLMResults.null_deviance.html#statsmodels.genmod.generalized_linear_model.GLMResults.null_deviance">[docs]</a>    <span class="k">def</span> <span class="nf">null_deviance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">deviance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">null</span><span class="p">)</span>
</div>
    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="GLMResults.llnull"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLMResults.llnull.html#statsmodels.genmod.generalized_linear_model.GLMResults.llnull">[docs]</a>    <span class="k">def</span> <span class="nf">llnull</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">loglike</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">null</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">)</span>
</div>
    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="GLMResults.llf"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLMResults.llf.html#statsmodels.genmod.generalized_linear_model.GLMResults.llf">[docs]</a>    <span class="k">def</span> <span class="nf">llf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_modelfamily</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_modelfamily</span><span class="p">,</span> <span class="n">families</span><span class="o">.</span><span class="n">NegativeBinomial</span><span class="p">):</span>
            <span class="n">lin_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span> <span class="o">+</span>\
                       <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_offset_exposure</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">_modelfamily</span><span class="o">.</span><span class="n">loglike</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span><span class="p">,</span>
                                       <span class="n">lin_pred</span><span class="o">=</span><span class="n">lin_pred</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">_modelfamily</span><span class="o">.</span><span class="n">loglike</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val</span>
</div>
    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="GLMResults.aic"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLMResults.aic.html#statsmodels.genmod.generalized_linear_model.GLMResults.aic">[docs]</a>    <span class="k">def</span> <span class="nf">aic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">llf</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_model</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</div>
    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="GLMResults.bic"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLMResults.bic.html#statsmodels.genmod.generalized_linear_model.GLMResults.bic">[docs]</a>    <span class="k">def</span> <span class="nf">bic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deviance</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_resid</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nobs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GLMResults.remove_data"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLMResults.remove_data.html#statsmodels.genmod.generalized_linear_model.GLMResults.remove_data">[docs]</a>    <span class="k">def</span> <span class="nf">remove_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#GLM has alias/reference in result instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_attr</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_data_attr</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;_data.&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">])</span>
        <span class="nb">super</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">remove_data</span><span class="p">()</span>

        <span class="c">#TODO: what are these in results?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_endog</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_weights</span> <span class="o">=</span> <span class="bp">None</span>
</div>
    <span class="n">remove_data</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">LikelihoodModelResults</span><span class="o">.</span><span class="n">remove_data</span><span class="o">.</span><span class="n">__doc__</span>

<div class="viewcode-block" id="GLMResults.summary"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLMResults.summary.html#statsmodels.genmod.generalized_linear_model.GLMResults.summary">[docs]</a>    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mo">05</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Summarize the Regression Results</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        yname : string, optional</span>
<span class="sd">            Default is `y`</span>
<span class="sd">        xname : list of strings, optional</span>
<span class="sd">            Default is `var_##` for ## in p the number of regressors</span>
<span class="sd">        title : string, optional</span>
<span class="sd">            Title for the top table. If not None, then this replaces the</span>
<span class="sd">            default title</span>
<span class="sd">        alpha : float</span>
<span class="sd">            significance level for the confidence intervals</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        smry : Summary instance</span>
<span class="sd">            this holds the summary tables and text, which can be printed or</span>
<span class="sd">            converted to various output formats.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        statsmodels.iolib.summary.Summary : class to hold summary</span>
<span class="sd">            results</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">top_left</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;Dep. Variable:&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&#39;Model:&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&#39;Model Family:&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">]),</span>
                    <span class="p">(</span><span class="s">&#39;Link Function:&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">]),</span>
                    <span class="p">(</span><span class="s">&#39;Method:&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;IRLS&#39;</span><span class="p">]),</span>
                    <span class="p">(</span><span class="s">&#39;Date:&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&#39;Time:&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&#39;No. Iterations:&#39;</span><span class="p">,</span>
                     <span class="p">[</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_history</span><span class="p">[</span><span class="s">&#39;iteration&#39;</span><span class="p">]]),</span>
                    <span class="p">]</span>

        <span class="n">top_right</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;No. Observations:&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;Df Residuals:&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;Df Model:&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;Scale:&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">]),</span>
                     <span class="p">(</span><span class="s">&#39;Log-Likelihood:&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
                     <span class="p">(</span><span class="s">&#39;Deviance:&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;</span><span class="si">%#8.5g</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">deviance</span><span class="p">]),</span>
                     <span class="p">(</span><span class="s">&#39;Pearson chi2:&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;</span><span class="si">%#6.3g</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">pearson_chi2</span><span class="p">])</span>
                     <span class="p">]</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Generalized Linear Model Regression Results&quot;</span>

        <span class="c">#create summary tables</span>
        <span class="kn">from</span> <span class="nn">statsmodels.iolib.summary</span> <span class="kn">import</span> <span class="n">Summary</span>
        <span class="n">smry</span> <span class="o">=</span> <span class="n">Summary</span><span class="p">()</span>
        <span class="n">smry</span><span class="o">.</span><span class="n">add_table_2cols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gleft</span><span class="o">=</span><span class="n">top_left</span><span class="p">,</span> <span class="n">gright</span><span class="o">=</span><span class="n">top_right</span><span class="p">,</span>  <span class="c"># [],</span>
                             <span class="n">yname</span><span class="o">=</span><span class="n">yname</span><span class="p">,</span> <span class="n">xname</span><span class="o">=</span><span class="n">xname</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="n">smry</span><span class="o">.</span><span class="n">add_table_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yname</span><span class="o">=</span><span class="n">yname</span><span class="p">,</span> <span class="n">xname</span><span class="o">=</span><span class="n">xname</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                              <span class="n">use_t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_t</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;constraints&#39;</span><span class="p">):</span>
            <span class="n">smry</span><span class="o">.</span><span class="n">add_extra_txt</span><span class="p">([</span><span class="s">&#39;Model has been estimated subject to linear &#39;</span>
                          <span class="s">&#39;equality constraints.&#39;</span><span class="p">])</span>

        <span class="c">#diagnostic table is not used yet:</span>
        <span class="c">#smry.add_table_2cols(self, gleft=diagn_left, gright=diagn_right,</span>
        <span class="c">#                  yname=yname, xname=xname,</span>
        <span class="c">#                  title=&quot;&quot;)</span>

        <span class="k">return</span> <span class="n">smry</span>
</div>
<div class="viewcode-block" id="GLMResults.summary2"><a class="viewcode-back" href="../../../generated/statsmodels.genmod.generalized_linear_model.GLMResults.summary2.html#statsmodels.genmod.generalized_linear_model.GLMResults.summary2">[docs]</a>    <span class="k">def</span> <span class="nf">summary2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
                 <span class="n">float_format</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%.4f</span><span class="s">&quot;</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Experimental summary for regression Results</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        yname : string</span>
<span class="sd">            Name of the dependent variable (optional)</span>
<span class="sd">        xname : List of strings of length equal to the number of parameters</span>
<span class="sd">            Names of the independent variables (optional)</span>
<span class="sd">        title : string, optional</span>
<span class="sd">            Title for the top table. If not None, then this replaces the</span>
<span class="sd">            default title</span>
<span class="sd">        alpha : float</span>
<span class="sd">            significance level for the confidence intervals</span>
<span class="sd">        float_format: string</span>
<span class="sd">            print format for floats in parameters summary</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        smry : Summary instance</span>
<span class="sd">            this holds the summary tables and text, which can be printed or</span>
<span class="sd">            converted to various output formats.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        statsmodels.iolib.summary2.Summary : class to hold summary</span>
<span class="sd">            results</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="s">&#39;IRLS&#39;</span>
        <span class="kn">from</span> <span class="nn">statsmodels.iolib</span> <span class="kn">import</span> <span class="n">summary2</span>
        <span class="n">smry</span> <span class="o">=</span> <span class="n">summary2</span><span class="o">.</span><span class="n">Summary</span><span class="p">()</span>
        <span class="n">smry</span><span class="o">.</span><span class="n">add_base</span><span class="p">(</span><span class="n">results</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="n">float_format</span><span class="p">,</span>
                      <span class="n">xname</span><span class="o">=</span><span class="n">xname</span><span class="p">,</span> <span class="n">yname</span><span class="o">=</span><span class="n">yname</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;constraints&#39;</span><span class="p">):</span>
            <span class="n">smry</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="s">&#39;Model has been estimated subject to linear &#39;</span>
                          <span class="s">&#39;equality constraints.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">smry</span>

</div></div>
<span class="k">class</span> <span class="nc">GLMResultsWrapper</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">RegressionResultsWrapper</span><span class="p">):</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;resid_anscombe&#39;</span> <span class="p">:</span> <span class="s">&#39;rows&#39;</span><span class="p">,</span>
        <span class="s">&#39;resid_deviance&#39;</span> <span class="p">:</span> <span class="s">&#39;rows&#39;</span><span class="p">,</span>
        <span class="s">&#39;resid_pearson&#39;</span> <span class="p">:</span> <span class="s">&#39;rows&#39;</span><span class="p">,</span>
        <span class="s">&#39;resid_response&#39;</span> <span class="p">:</span> <span class="s">&#39;rows&#39;</span><span class="p">,</span>
        <span class="s">&#39;resid_working&#39;</span> <span class="p">:</span> <span class="s">&#39;rows&#39;</span>
    <span class="p">}</span>
    <span class="n">_wrap_attrs</span> <span class="o">=</span> <span class="n">wrap</span><span class="o">.</span><span class="n">union_dicts</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">RegressionResultsWrapper</span><span class="o">.</span><span class="n">_wrap_attrs</span><span class="p">,</span>
                                   <span class="n">_attrs</span><span class="p">)</span>
<span class="n">wrap</span><span class="o">.</span><span class="n">populate_wrapper</span><span class="p">(</span><span class="n">GLMResultsWrapper</span><span class="p">,</span> <span class="n">GLMResults</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="kn">as</span> <span class="nn">sm</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">longley</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
    <span class="c">#data.exog = add_constant(data.exog)</span>
    <span class="n">GLMmod</span> <span class="o">=</span> <span class="n">GLM</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">endog</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">exog</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">GLMT</span> <span class="o">=</span> <span class="n">GLMmod</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">returns</span><span class="o">=</span><span class="s">&#39;tables&#39;</span><span class="p">)</span>
<span class="c">##    GLMT[0].extend_right(GLMT[1])</span>
<span class="c">##    print(GLMT[0])</span>
<span class="c">##    print(GLMT[2])</span>
    <span class="n">GLMTp</span> <span class="o">=</span> <span class="n">GLMmod</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Test GLM&#39;</span><span class="p">)</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">From Stata</span>
<span class="sd">. webuse beetle</span>
<span class="sd">. glm r i.beetle ldose, family(binomial n) link(cloglog)</span>

<span class="sd">Iteration 0:   log likelihood = -79.012269</span>
<span class="sd">Iteration 1:   log likelihood =  -76.94951</span>
<span class="sd">Iteration 2:   log likelihood = -76.945645</span>
<span class="sd">Iteration 3:   log likelihood = -76.945645</span>

<span class="sd">Generalized linear models                          No. of obs      =        24</span>
<span class="sd">Optimization     : ML                              Residual df     =        20</span>
<span class="sd">                                                   Scale parameter =         1</span>
<span class="sd">Deviance         =  73.76505595                    (1/df) Deviance =  3.688253</span>
<span class="sd">Pearson          =   71.8901173                    (1/df) Pearson  =  3.594506</span>

<span class="sd">Variance function: V(u) = u*(1-u/n)                [Binomial]</span>
<span class="sd">Link function    : g(u) = ln(-ln(1-u/n))           [Complementary log-log]</span>

<span class="sd">                                                   AIC             =   6.74547</span>
<span class="sd">Log likelihood   = -76.94564525                    BIC             =  10.20398</span>

<span class="sd">------------------------------------------------------------------------------</span>
<span class="sd">             |                 OIM</span>
<span class="sd">           r |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]</span>
<span class="sd">-------------+----------------------------------------------------------------</span>
<span class="sd">      beetle |</span>
<span class="sd">          2  |  -.0910396   .1076132    -0.85   0.398    -.3019576    .1198783</span>
<span class="sd">          3  |  -1.836058   .1307125   -14.05   0.000     -2.09225   -1.579867</span>
<span class="sd">             |</span>
<span class="sd">       ldose |   19.41558   .9954265    19.50   0.000     17.46458    21.36658</span>
<span class="sd">       _cons |  -34.84602    1.79333   -19.43   0.000    -38.36089   -31.33116</span>
<span class="sd">------------------------------------------------------------------------------</span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="c">#NOTE: wfs dataset has been removed due to a licensing issue</span>
    <span class="c"># example of using offset</span>
    <span class="c">#data = sm.datasets.wfs.load()</span>
    <span class="c"># get offset</span>
    <span class="c">#offset = np.log(data.exog[:,-1])</span>
    <span class="c">#exog = data.exog[:,:-1]</span>

    <span class="c"># convert dur to dummy</span>
    <span class="c">#exog = sm.tools.categorical(exog, col=0, drop=True)</span>
    <span class="c"># drop reference category</span>
    <span class="c"># convert res to dummy</span>
    <span class="c">#exog = sm.tools.categorical(exog, col=0, drop=True)</span>
    <span class="c"># convert edu to dummy</span>
    <span class="c">#exog = sm.tools.categorical(exog, col=0, drop=True)</span>
    <span class="c"># drop reference categories and add intercept</span>
    <span class="c">#exog = sm.add_constant(exog[:,[1,2,3,4,5,7,8,10,11,12]])</span>

    <span class="c">#endog = np.round(data.endog)</span>
    <span class="c">#mod = sm.GLM(endog, exog, family=sm.families.Poisson()).fit()</span>

    <span class="c">#res1 = GLM(endog, exog, family=sm.families.Poisson(),</span>
    <span class="c">#                        offset=offset).fit(tol=1e-12, maxiter=250)</span>
    <span class="c">#exposuremod = GLM(endog, exog, family=sm.families.Poisson(),</span>
    <span class="c">#                        exposure = data.exog[:,-1]).fit(tol=1e-12,</span>
    <span class="c">#                                                        maxiter=250)</span>
    <span class="c">#assert(np.all(res1.params == exposuremod.params))</span>
</pre></div>




          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2009-2013, Josef Perktold, Skipper Seabold, Jonathan Taylor, statsmodels-developers.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>